---
title: 红队外网打点实战案例分享 - 渗透测试中心
url: https://www.cnblogs.com/backlion/p/18813766
source: 博客园 - 渗透测试中心
date: 2025-04-08
fetch_date: 2025-10-06T22:07:31.421127
---

# 红队外网打点实战案例分享 - 渗透测试中心

[![](https://img2024.cnblogs.com/blog/35695/202509/35695-20250929100304557-587378723.jpg)](https://qoder.com/)

* [![博客园logo](//assets.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园")
* [会员](https://cnblogs.vip/)
* [众包](https://www.cnblogs.com/cmt/p/18500368)
* [新闻](https://news.cnblogs.com/)
* [博问](https://q.cnblogs.com/)
* [闪存](https://ing.cnblogs.com/)
* [赞助商](https://www.cnblogs.com/cmt/p/19081960)
* [HarmonyOS](https://harmonyos.cnblogs.com/)
* [Chat2DB](https://chat2db-ai.com/)

* ![搜索](//assets.cnblogs.com/icons/search.svg)
  ![搜索](//assets.cnblogs.com/icons/enter.svg)
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    所有博客
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    当前博客
* [![写随笔](//assets.cnblogs.com/icons/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔")
  [![我的博客](//assets.cnblogs.com/icons/myblog.svg)](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客")
  [![短消息](//assets.cnblogs.com/icons/message.svg)](https://msg.cnblogs.com/ "短消息")
  ![简洁模式](//assets.cnblogs.com/icons/lite-mode-on.svg)

  [![用户头像](//assets.cnblogs.com/icons/avatar-default.svg)](https://home.cnblogs.com/)

  [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx)
  [我的园子](https://home.cnblogs.com/)
  [账号设置](https://account.cnblogs.com/settings/account)
  [会员中心](https://vip.cnblogs.com/my)
  简洁模式 ...
  退出登录

  [注册](https://account.cnblogs.com/signup)
  登录

[![返回主页](/skins/custom/images/logo.gif)](https://www.cnblogs.com/backlion/)

# [渗透测试中心](https://www.cnblogs.com/backlion)

##

* [博客园](https://www.cnblogs.com/)
* [首页](https://www.cnblogs.com/backlion/)
* [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
* [联系](https://msg.cnblogs.com/send/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%BF%83)
* [管理](https://i.cnblogs.com/)
* 订阅
  [![订阅](/skins/coffee/images/xml.gif)](https://www.cnblogs.com/backlion/rss/)

# [红队外网打点实战案例分享](https://www.cnblogs.com/backlion/p/18813766 "发布于 2025-04-07 22:46")

### 从最基础的登录框突破

登录框作为hw出现场次最多的角色，也是最容易出洞的，下面介绍一些自己常用的测试方法

#### 登录爆破小技巧

![image-20231130171640751](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224509027-1713778300.png)

像这种系统的爆破我们有两种解决方法：

* 分析前端加密算法，写脚本模拟对密码进行加密
* 固定密码为123456 000000 使用常见的用户名作为字典进行爆破

两种方法各有优劣，我更倾向于第二种，在比赛打点效率会更高，分析加密算法更适用于红队检测项目

![image-20231201170955410](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224509883-907094332.png)

使用爆破的账号密码登入后台，便可以继续寻找后台上传点

看到图片类型这里限制上传的文件格式

![image-20231201171410743](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224510675-235121418.png)

直接添加 `aspx` 文件格式类型

![image-20231201171600249](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224511513-1730761349.png)

成功getshell

![image-20231201171755656](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224512711-1573633164.png)

#### 修改返回数据包参数进入后台

有些时候网站登录状态是根据前端判断的，这时候我们就可以直接修改返回包进行绕过

![image-20231128172935703](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224513647-559736304.png)

前端判断登录逻辑根据返回包的ret值决定，当返回值为1则成功登录

![image-20231128173007315](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224514461-83156289.png)

成功进入后台

![image-20231128173130312](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224515495-1102134327.png)

#### 插件探测常见sql注入和log4j漏洞

sql注入插件推荐 <https://github.com/smxiazi/xia_sql>

基本原理是通过发送多个数据包，根据返回数据长度判断是否存在注入

![image-20231128170800532](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224516512-642906070.png)

除了被动扫描以外，我们还可以通过手动添加单引号、双引号去查看返回包，若存在类似报错则可能存在sql注入

![image-20231128164205795](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224517544-295712424.png)

![image-20231205180145610](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224518428-35679694.png)

sqlmap一把梭

![image-20231128173629321](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224519457-583916559.png)

log4j插件推荐 <https://github.com/TheKingOfDuck/burpFakeIP>

通过burp插件fuzz数据包的header头

![image-20231128171023433](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224520467-1031469860.png)

成功探测出登录框的log4j漏洞

但要注意的的是很多dnslog平台已被防火墙标黑，因此推荐使用ceye或者自搭建dnslog平台

![image-20231108153844067](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224521585-2118081127.png)

#### 系统默认口令+后台1day漏洞利用

随着攻防比赛愈发频繁，公网能直接利用的前台漏洞越来越少，大多数都被批量扫描修复过了，但我们可以利用系统的默认口令结合1day进行利用

如若依存在默认口令 `admin/admin123`

![image-20231128173913383](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224522744-373618293.png)

进入后台就可以通过计划任务或反序列化执行命令

![image-20231128174037559](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224523562-1383043532.png)

很多时候我们碰到OA系统，拿OA漏洞检测工具扫一下没漏洞就放弃了，其实像这种OA系统还可能会存在默认口令的问题

> ## 默认口令
>
> 系统管理员：system/system
> 集团管理员(A8-v5集团版) group-admin/123456
> 单位管理员(A8-V5企业版) admin1/admin123456
> 审计管理员(所有版本) audit-admin/seeyon123456

![image-20231108142849667](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224525243-284597289.png)

前台使用账号密码有时候不能登录，可发送下面数据包获取cookie

POST /seeyon/rest/authentication/ucpcLogin HTTP/1.1
Host:
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0
Content-Length: 71
Content-Type: application/x-www-form-urlencoded
Accept-Encoding: gzip

UserAgentFrom=xx&login\_username=audit-admin&login\_password=seeyon123456

获取cookie之后就可以使用补丁较新的后台洞进行深入利用，这次使用copyfile这个后台洞

但实战后发现这个漏洞存在一些坑点，写入webshell时候报错了

POST /seeyon/ajax.do?method=ajaxAction&managerName=portalCssManager&rnd=111 HTTP/1.1
Accept: \*/\*
Content-Type: application/x-www-form-urlencoded;charset=UTF-8
Content-Length: 70
Host: 192.168.91.17
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.5.13 (Java/1.8.0\_321)
Accept-Encoding: gzip,deflate

arguments=%5B%22xxxxxx%22%5D&managerMethod=generateCssFileByCssStr

![image-20231108144907706](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224526524-1303586334.png)

本地开环境调试一下，fuzz发现是双引号所导致，可通过前面加`\`解决，还有其他的问题总结如下：

* 写seeyon路径下会404，可以换写到root目录下
* webshell的双引号需要前面加入反斜杠，即`“`换成`\"`
* 复制的文件名不能与之前的相同，否则会复制失败
* `//`后需要进行换行

经过一首歌的时间，最终成功getshell

![image-20231108144745332](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224527325-1516267213.png)

同样，X微OA的默认账号密码有 `sysadmin/1` `sysadmin/Weaver@2001`等等

![image-20231108145625641](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224528089-452090584.png)

### 差点擦肩而过的shiro漏洞

#### 被动扫描识别shiro指纹

使用`afrog`、`Wappalyzer`等指纹识别器有时候无法直接识别shiro框架

![image-20231205182048928](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224528785-924176143.png)

抓包使用`hae`插件被动扫描识别网站特征

<https://github.com/gh0stkey/HaE>

![image-20231205181820379](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224529490-238215945.png)

#### WAF拦截绕过

使用工具检测到key，但利用链爆破时候被拦截了，访问网站发现被拦截了

![image-20231206155954218](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224530103-198564163.png)

换个ip继续冲，工具直接打不行，准备改用burp手动发包，但是问题又来了，挂着burp网站直接无法访问了

改用`yakit`能正常发包，猜测可能是`burp`特征被识别了，这时候想到最近看的github项目，决定尝试一下

<https://github.com/sleeyax/burp-awesome-tls>

未使用插件前，burp指纹特征被识别，抓包被拦截

![image-20230926103809988](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224530850-499778533.png)

使用插件后正常抓包

![image-20231206155620773](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224531680-1585266711.png)

最终通过 OPTIONS 请求方式 + 静态资源 uri 路径 + 缩短payload长度成功绕过WAF

缩短payload长度可使用 `4raIn`师傅的项目 <https://github.com/antiRookit/ShortPayload>

成功getshell

![image-20231206161014300](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224532540-413046270.png)

#### Yso重编译拿下某企业shiro系统

某个目标资产搜集到一个shiro框架系统，通过工具探测到存在默认密钥 `kPH+bIxk5D2deZiIxcaaaA==`

![image-20231201152530229](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224533167-1730077693.png)

存在JRMP利用方式，但JRMP执行失败

![image-20231201152802850](https://img2023.cnblogs.com/blog/1049983/202504/1049983-20250407224533739-615659675.png)

可能原因：Yso自带的CB链版本和目标环境CB链版本不一致

!...