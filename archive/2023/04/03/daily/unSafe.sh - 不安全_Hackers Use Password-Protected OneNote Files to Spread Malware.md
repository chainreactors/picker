---
title: Hackers Use Password-Protected OneNote Files to Spread Malware
url: https://buaq.net/go-156587.html
source: unSafe.sh - 不安全
date: 2023-04-03
fetch_date: 2025-10-04T11:29:35.684885
---

# Hackers Use Password-Protected OneNote Files to Spread Malware

* [unSafe.sh - 不安全](https://unsafe.sh)
* [我的收藏](/user/collects)
* [今日热榜](/?hot=true)
* [公众号文章](/?gzh=true)
* [导航](/nav/index)
* [Github CVE](/cve)
* [Github Tools](/tools)
* [编码/解码](/encode)
* [文件传输](/share/index)
* [Twitter Bot](https://twitter.com/buaqbot)
* [Telegram Bot](https://t.me/aqinfo)
* [Search](/search/search)

[Rss](/rss.xml)

[ ]
黑夜模式

![](https://8aqnet.cdn.bcebos.com/8c950729bea6a6bdd215598c0ed3ecfd.jpg)

Hackers Use Password-Protected OneNote Files to Spread Malware

Last week, the cybersecurity researchers on Perception Point’s IR team uncovered an attack that
*2023-4-2 21:30:52
Author: [perception-point.io(查看原文)](/jump-156587.htm)
阅读量:25
收藏*

---

Last week, the cybersecurity researchers on Perception Point’s IR team uncovered an attack that leverages password-protected OneNote files to deliver [malware](https://perception-point.io/blog/attack-trends/how-to-prevent-malware-attacks/). Caught by our advanced threat detection platform, the attack was flagged due to the executables embedded in the document. Upon further review, our researchers analyzed the new evasion technique that aims to conceal the malicious payload by exploiting encrypted OneNote documents. Read on to learn more.

## The OneNote Attack

In recent years, threat actors have increasingly turned to social engineering tactics and sophisticated malware delivery methods to target individuals and organizations. One technique involves the use of OneNote documents to deliver malware via malicious spam emails. By tricking recipients into downloading seemingly harmless OneNote files, attackers can effectively infect systems and steal sensitive information. What makes this attack particularly unique, however, is the addition of encryption. Instead of relying on the target to click on the file, automatically triggering the payload, the architects of this attack employ this extra step under the guise of “security” and to evade detection. Here’s how it works:

The user receives a [phishing email](https://perception-point.io/blog/attack-trends/how-to-prevent-phishing-attacks/), detailing the remittance advice of an online transaction for a payment of $175k.

![](https://lh6.googleusercontent.com/sNxq14793sCi7CeMX2Wu4CfvXUvAJ7SUsV3LbpUZaPxq5umfNY5LCyzJ3ovoJs42B4hIoH3BRHWXPQJPlZpMVB2p2N9Gkegwu8ennhv6BTXjU3XKA4zVHWmq5-aP8asU8FF-O9fnrwww_PJQag0tixw)

Figure 1: The phishing email

By mentioning such a large sum of money, the attacker adds a sense of urgency to the email. The goal is to convince the user to open the document without a second thought. However, perhaps more interesting is that the attacker includes password details to download the encrypted OneNote file.

Attached to the email is a file called “0323 Remittance.onepkg.”

![](https://lh3.googleusercontent.com/t3Xc8cH_Ks5Qr44bfXJ2WUF9_FbcN1IaDcPpvyUtJ9dan3Rtzf9X80YGfaHNWiIYtkLCtza9iF-_3T40XrL3pkkESGY4OQaTyTcF23G_VJDsKRVWpzkrhpgdjodwzFprp1aFvbdwgWXKf9H_ngbyNjc)

Figure 2: The OneNote attachment

This attachment is a OnePKG file, a Microsoft OneNote package file that contains multiple files and folders related to a specific notebook, including the pages, sections, and images that comprise the notebook. OnePKG files can be used to backup, transfer, or share OneNote notebooks.

When the user double clicks on the file, the OneNote application opens, displaying the following window:

![](https://lh5.googleusercontent.com/1i3P9TUPd0B5XRFTxveje7vrGjQo9aGVzI83UguR8rHzWR9vBBL5IiGaPsPxzhTz84377iHXyHMMX_rSrxyg2NLhrggPUPn5TIDPAOYp396mkdbwHR5LTRq_2nNk8YQ_ls5sntlf-i0zKToWdKadBuc)

Figure 3: OneNote display window

The user is then prompted to enter the password included in the initial email.

![](https://lh4.googleusercontent.com/Q_Pbok3BVYEfs1_JMu0WazSuHfdnVYW0pxKXgvDykL9t0gMJHjm6f-NrsmXRAdd3JEfjcONh3SQD1jhuumA9xgGGnwll-WRY_rDZr-lOVE0X9I0KmZwt3RFaBPuGFRHdK5Cl4-HKcj8lQ3U3LUZX0CA)

Figure 4: The OneNote password

Once the user enters the password, the malicious notebook is presented:

![](https://lh4.googleusercontent.com/majscNBmSlYCEO732WFCSkJAO4dVma5QEmUvtp3BvX2SA_wrm_xBtc6114YLN_9Yr1LUYsvu7gPF2OhGw5-j26lQ3ifA9wf19hm2aKTLnYjnfYvbbrscZNb58xe1YIyFDeqq9Qn_FxrFzgxOeKJDRbY)

Figure 5: The malicious notebook

What then appears is a fake document with a “click to action” button. Once the user clicks, an embedded executable starts running, unleashing [RedLine Stealer](https://malpedia.caad.fkie.fraunhofer.de/details/win.redline_stealer) malware. RedLine Stealer is a malware used to harvest credentials and data from browsers, steal cryptocurrency, and execute commands. This means that once a computer is infected, the user faces potentially irreparable consequences.

*Learn more about RedLine Stealer malware in the Tweets below:*

## Behind the OneNote Attack

When our researchers saw this attack, they wanted to dive deeper and extract the payload manually. In order to do so, they needed to first extract the OneNote attachment payload statically without running the OneNote document. To do this, they used the tool “[OneNoteAnalyzer](https://github.com/knight0x07/OneNoteAnalyzer),” created by [@knight0x07](https://twitter.com/knight0x07).

They wanted to extract the OneNote document itself (.one) and not the initial OneNote package file. By opening the .onepkg in [7zip](https://www.7-zip.org/), they were able to extract the .one file individually (this was necessary because the .one file is the actual document that the user would open).

![](https://lh3.googleusercontent.com/NPeMFklajPtXRQBkxBbbZuBBY9BK4llnold4wHEFKjn1p_CTh4IT2or4OOO-2nh6OmGBn9gmIjhIq8hVkKbelq17ERGZnliCUpVa0PZ4ZDYWuv0hh7bymAja5MOUjoH42zIfR-K0BP34rJSPbmgJQFY)

Figure 6: Opening the OneNote file

Upon running the extracted document through the OneNoteAnalyzer tool, an error pops up:

![](https://lh4.googleusercontent.com/4F0wylzAa1AnpEXLOPRMUL_HwTPGH5XXxR9SE_R-TgoM0l-UGFDtEIuYaZLoPLpH5_qspEEc1BSlWjc2FPhqzIs56bKXzU5b2fHgqKFREih7wymshVUEcdXCPpVn2MTqemCntHq6tTHGgG6CsL5hGjs)

Figure 7: OneNoteAnalyzer Error

The error appears because the document is password encrypted, as are the files. This means that they cannot be accessed without the password. To overcome this, our researchers [modified the tool](https://github.com/0xToxin/OneNoteAnalyzer) slightly and added the support for password input (by adding the flag –pass). By doing this, we were able to easily extract the embedded files.

![](https://lh5.googleusercontent.com/9jD-aSWOiic5a-lJFqa6Ek7a_yxV_y3Tgpx82F23x4BOInvGJpGv45EtzrI3WvPE17Ozar1hAudopGVf7vB2gXcZoZvFDc8S0SpJrO2KZ2MvDK1NJcdnWNFUkf0JpTMcIL6Vo4Q0zGISJVQrRPumQGw)

Figure 8: The modified tool

## Takeaways from the OneNote Attack

The use of OneNote attachments as a delivery method for malware highlights the importance of being cautious when opening attachments, even if they appear to be from a trusted source. Social engineering tactics such as creating a sense of urgency or fear, and presenting seemingly harmless documents, can be effective in tricking users into opening malicious files. Additionally, using passwords as a means of evasion can further increase the risk of infection, as we saw in this attack. It is crucial for individuals and organizations to remain vigilant and stay informed about the latest cybersecurity threats to mitigate the risk of falling victim to these types of attacks.

Learn more about how to protect your organization against malware [here](https://perception-point.io/malware-detection/).

## IOC’s

* Files:
  + 0323 Remittance.onepkg – [1155a4bda37531553661a61fcee361d664103ced30ace615406c6cd298a2c93d](https://bazaar.abuse.ch/sample/1155a4bda37531553661a61fcee361d664103ced30ace615406c6cd298a2c93d/)
  + New Section 1.one – [462bf8a2e19a3e2dd4e5635aa5089e7bdc291d5c5c4665549f64f67abf0b598a](https://bazaar.abuse.ch/sample/462bf8a2e19a3e2dd4e5635aa5089e7bdc291d5c5c4665549f64f67abf0b598a/)
* URLs:
  + https://rentry[.]co/u3y8w/raw
  + https://cdn.discordapp[.]com/attachments/1090282375688245381/1090289652914716702/message.txt
* C2:
  + 172.245.45[.]213:3235...