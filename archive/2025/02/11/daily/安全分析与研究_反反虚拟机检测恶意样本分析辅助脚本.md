---
title: 反反虚拟机检测恶意样本分析辅助脚本
url: https://mp.weixin.qq.com/s?__biz=MzA4ODEyODA3MQ==&mid=2247490410&idx=1&sn=bdd5179d0b93c73a1e36752aaf4a439b&chksm=902fb442a7583d54064cbd8ea6ecdd7b8c0936a06e05a021f6fae8e4838a4c76fe1d76456a06&scene=58&subscene=0#rd
source: 安全分析与研究
date: 2025-02-11
fetch_date: 2025-10-06T20:38:29.829842
---

# 反反虚拟机检测恶意样本分析辅助脚本

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/oibWJqH5OVmUVw2sBobtq1lPVncziaiaBLicmBySZ63G1ia3GlGTsib2WedHaWNIuGlHOClrItYrl5hPMkjhXG22DRog/0?wx_fmt=jpeg)

# 反反虚拟机检测恶意样本分析辅助脚本

原创

pandazhengzheng

安全分析与研究

‍

**‍安全分析与研究**

专注于全球恶意软件的分析与研究

前言概述

很多恶意软件都会使用一些对抗技术，其中就包含反虚拟机技术，会检测样本是否运行在虚拟机环境或沙箱环境，以逃避自动化分析，这时候就需要对分析环境进行一些处理使样本能用效运行，攻防对抗就是矛与盾的关系。

分享一个反反虚拟机检测的脚本，可以用这个脚本对虚拟机环境进行处理，让一部分简单的反虚拟机样本能运行，仍然攻防对抗永远是相对的，没有哪个工具能一劳永逸，也没有哪种防御手段能一直有效，这是一个长期对抗的过程。

辅助脚本

辅助分析脚本开源地址：

https://github.com/d4rksystem/VMwareCloak

该PowerShell脚本试图帮助恶意软件分析师隐藏他们的VMware Windows VM，以防可能试图逃避分析的恶意软件，下面我们就来分析一下，它做了哪些对抗操作。

1.该脚本一共提供了四个可选的参数，分别执行不同的对抗操作，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUVw2sBobtq1lPVncziaiaBLicl39Af2bAaDHvfPtYgPkMjpHsrZMfYpDoDzAs82lGqoUic8fNiaME9bJQ/640?wx_fmt=png)

2.使用all参数运行脚本，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUVw2sBobtq1lPVncziaiaBLicMIJJtkulVHWnoRSOetMn9ibMFez7jC5vicnqbs6lib8JQ3qsNibqO1VybA/640?wx_fmt=png)

3.处置完成之后，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUVw2sBobtq1lPVncziaiaBLicZqphKe2DxVdVXoy0Fz5vH2NkfIOzdhQtoYKavNNNMHRy1ic1RQCE64w/640?wx_fmt=png)

4.结束VM相关进程，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUVw2sBobtq1lPVncziaiaBLicd6Ium0aaibanLoz4WLzxDxQMNvs21SrsvRdfXO7F4L4zq4HmrFuN4aA/640?wx_fmt=png)

5.修改VM相关的注册表项，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUVw2sBobtq1lPVncziaiaBLicTfYqibnMw4dmGjicuyNEYoWIPrFk3Zzg2LxD0NyGDy840Oic2Nok84LmQ/640?wx_fmt=png)

6.重命名VM相关目录与文件，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUVw2sBobtq1lPVncziaiaBLicNAV4tCRpfwf6ThaSvIicicYHZH5xGZJrcwuiaJvjVdx2VCz0hY8NiaIRGw/640?wx_fmt=png)

基本上就是做了上面这些处理，把虚拟机相关的进程、文件、注册表都处理了，使一些反虚拟机恶意软件在运行的过程中检测虚拟机进程、文件、注册表的时候，检测不到这些特征，这样就达到了反反虚拟机的目的，从而可以让一些简单的反虚拟机恶意软件正常运行。

总结结尾

如果对恶意软件分析感兴趣的，可以加入笔者的全球安全分析与研究专业群，一起共同分析和研究全球流行恶意软件家族。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oibWJqH5OVmXDIda3D6VvFWhqojST24E2rTRBJMYDfYowK8WcvBScfWlJiaYZ5elMdlrREG1LDVODxFQ0Eoy0YLQ/640?wx_fmt=jpeg)

安全分析与研究，专注于全球恶意软件的分析与研究，深度追踪全球黑客组织攻击活动，欢迎大家关注，获取全球最新的黑客组织攻击事件威胁情报。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oibWJqH5OVmW8qYF2seSKglWFKoJdassltn5V5IPUn3OGXsdD4v2nRPg8ZzFAicpXlmlwVmd9KTm4XPkRcXtBEKw/640?wx_fmt=jpeg)

王正

笔名：熊猫正正

恶意软件研究员

长期专注于全球恶意软件的分析与研究，深度追踪全球黑客组织的攻击活动，擅长各种恶意软件逆向分析技术，具有丰富的样本分析实战经验，对勒索病毒、挖矿病毒、窃密、远控木马、银行木马、僵尸网络、高端APT样本都有深入的分析与研究

‍

‍

预览时标签不可点

![]()

微信扫一扫
关注该公众号

继续滑动看下一个

轻触阅读原文

![](http://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmVcFgYKtoVnKR7h3pkl3AyxwS0l7iagicAJnYjEQhwIuZgR3RR65DLpJh2TGZS82DY7CjsBUmiaAl7BQ/0?wx_fmt=png)

安全分析与研究

向上滑动看下一个

知道了

![]()
微信扫一扫
使用小程序

取消
允许

取消
允许

取消
允许

×
分析

![跳转二维码]()

![作者头像](http://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmVcFgYKtoVnKR7h3pkl3AyxwS0l7iagicAJnYjEQhwIuZgR3RR65DLpJh2TGZS82DY7CjsBUmiaAl7BQ/0?wx_fmt=png)

微信扫一扫可打开此内容，
使用完整服务

：
，
，
，
，
，
，
，
，
，
，
，
，
。

视频
小程序
赞
，轻点两下取消赞
在看
，轻点两下取消在看
分享
留言
收藏
听过