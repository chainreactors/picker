---
title: Using the Jamf Pro API to report on Self Service policies
url: https://derflounder.wordpress.com/2022/10/14/using-the-jamf-pro-api-to-report-on-self-service-policies/
source: Der Flounder
date: 2022-10-15
fetch_date: 2025-10-03T19:55:12.798530
---

# Using the Jamf Pro API to report on Self Service policies

# [Der Flounder](https://derflounder.wordpress.com/)

Seldom updated, occasionally insightful.

* [Home](https://derflounder.wordpress.com/ "Home")
* [About](https://derflounder.wordpress.com/about-2/)
* [Contact](https://derflounder.wordpress.com/contact/)

[Home](https://derflounder.wordpress.com/ "Go to homepage")
> [Jamf Pro](https://derflounder.wordpress.com/category/jamf-pro/), [Jamf Pro API](https://derflounder.wordpress.com/category/jamf-pro-api/), [Jamf Pro Classic API](https://derflounder.wordpress.com/category/jamf-pro-classic-api/), [Scripting](https://derflounder.wordpress.com/category/scripting/) > Using the Jamf Pro API to report on Self Service policies

## Using the Jamf Pro API to report on Self Service policies

October 14, 2022
[rtrouton](https://derflounder.wordpress.com/author/rtrouton/ "Posts by rtrouton") [Leave a comment](#respond)
[Go to comments](#comments)

Every so often, it may be necessary to generate a report from Jamf Pro of which policies are available in Self Service. To assist with this task, I’ve written a script which uses the Jamf Pro Classic API to search through the policy records and generate a report in .tsv format.

For more details, please see below the jump.

**Pre-requisites:**

If setting up a specific Jamf Pro user account for this purpose with limited rights, here are the required API privileges for the account on the Jamf Pro server:

**Jamf Pro Server Objects:**

* Policies: Read

For authentication, the script can accept manual input or values stored in a **~/Library/Preferences/com.github.jamfpro-info.plist** file.

The plist file can be created by running the following commands and substituting your own values where appropriate:

To store the Jamf Pro URL in the plist file:

```
defaults write com.github.jamfpro-info jamfpro_url https://jamf.pro.server.goes.here:port_number_goes_here
```

To store the account username in the plist file:

```
defaults write com.github.jamfpro-info jamfpro_user account_username_goes_here
```

To store the account password in the plist file:

```
defaults write com.github.jamfpro-info jamfpro_password account_password_goes_here
```

Usage:

./Generate\_Self\_Service\_Policy\_Report.sh

![Screen Shot 2022 10 14 at 5 29 53 PM](https://derflounder.wordpress.com/wp-content/uploads/2022/10/screen-shot-2022-10-14-at-5.29.53-pm.png?w=595 "Screen Shot 2022-10-14 at 5.29.53 PM.png")

The script takes the following actions:

1. Uses the Jamf Pro Classic API to download the Jamf Pro IDs of all computer policies.
2. Checks which policies are Self Service policies.
3. Uses the Jamf Pro Classic API to download all information about matching Self Service policies.
4. Pulls the following information out of the policy record data:

* Jamf Pro ID
* If the policy is enabled in the Jamf Pro admin console
* The policy’s name in the Jamf Pro admin console
* The name of the policy’s category
* The name displayed in Self Service for the policy

Create a report in tab-separated value (.tsv) format which contains the following information about the Self Service policies.

* Jamf Pro ID
* If it’s a Self Service policy
* If the policy is enabled in the Jamf Pro admin console
* The policy’s name in the Jamf Pro admin console
* The name of the policy’s category
* The name displayed in Self Service for the policy
* Jamf Pro admin console URL for the Self Service policy

The report generated by script should appear similar to what is shown below:

This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

[Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | Jamf Pro ID Number | Self Service Policy | Policy Enabled | Policy Name | Category | Self Service Display Name | Jamf Pro URL |
| --- | --- | --- | --- | --- | --- | --- | --- |
|  | 105 | TRUE | TRUE | Check for Apple Software Updates | First Aid | Check for Apple Software Updates | <https://server.name.here/policies.html?id=105> |
|  | 107 | TRUE | FALSE | Get Logs | Utilities | Get Logs | <https://server.name.here/policies.html?id=107> |
|  | 94 | TRUE | TRUE | Microsoft Office 365 | Microsoft | Microsoft Office 16.47.0 | <https://server.name.here/policies.html?id=94> |
|  | 23 | TRUE | TRUE | Microsoft OneNote | Microsoft | Microsoft OneNote | <https://server.name.here/policies.html?id=23> |
|  | 22 | TRUE | TRUE | Microsoft Remote Desktop | Remote Access | Microsoft Remote Desktop | <https://server.name.here/policies.html?id=22> |
|  | 104 | TRUE | TRUE | Slack | Communication | Slack | <https://server.name.here/policies.html?id=104> |

[view raw](https://gist.github.com/rtrouton/6e36e90afb7ac8c060e8c039234563b7/raw/ea6af5ea4fe2134b0a370694996bb580ef201f25/tmp.4KGOYqAP.tsv)
 [tmp.4KGOYqAP.tsv](https://gist.github.com/rtrouton/6e36e90afb7ac8c060e8c039234563b7#file-tmp-4kgoyqap-tsv)
hosted with ❤ by [GitHub](https://github.com)

This script is available below and also from GitHub at the following location:

<https://github.com/rtrouton/rtrouton_scripts/tree/main/rtrouton_scripts/Casper_Scripts/Generate_Self_Service_Policy_Report>

This file contains hidden or bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

[Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  |  |
| --- | --- |
|  | #!/bin/bash |
|  |  |
|  | # This script uses the Jamf Pro Classic API to detect Jamf Pro policies are |
|  | # Self Service policies and generates a report with information about those |
|  | # policies. |
|  |  |
|  | # Set default exit code |
|  | exitCode=0 |
|  |  |
|  | # Create report file |
|  | report\_file="$(mktemp).tsv" |
|  |  |
|  | # If you're on Jamf Pro 10.34.2 or earlier, which doesn't support using Bearer Tokens |
|  | # for Classic API authentication, set the NoBearerToken variable to the following value |
|  | # as shown below: |
|  | # |
|  | # yes |
|  | # |
|  | # NoBearerToken="yes" |
|  | # |
|  | # If you're on Jamf Pro 10.35.0 or later, which does support using Bearer Tokens |
|  | # for Classic API authentication, set the NoBearerToken variable to the following value |
|  | # as shown below: |
|  | # |
|  | # NoBearerToken="" |
|  |  |
|  | NoBearerToken="" |
|  |  |
|  | GetJamfProAPIToken() { |
|  |  |
|  | # This function uses Basic Authentication to get a new bearer token for API authentication. |
|  |  |
|  | # Use user account's username and password credentials with Basic Authorization to request a bearer token. |
|  |  |
|  | if [[ $(/usr/bin/sw\_vers -productVersion | awk -F . '{print $1}') -lt 12 ]]; then |
|  | api\_token=$(/usr/bin/curl -X POST –silent -u "${jamfpro\_user}:${jamfpro\_password}" "${jamfpro\_url}/api/v1/auth/token" | python -c 'import sys, json; print json.load(sys.stdin)["token"]') |
|  | else |
|  | api\_token=$(/usr/bin/curl -X POST –silent -u "${jamfpro\_user}:${jamfpro\_password}" "${jamfpro\_url}/api/v1/auth/token" | plutil -extract token raw -) |
|  | fi |
|  |  |
|  | } |
|  |  |
|  | APITokenValidCheck() { |
|  |  |
|  | # Verify that API authentication is using a valid token by running an API command |
|  | # which displays the authorization details associated with the current API user. |
|  | # The API call will only return the HTTP status code. |
|  |  |
|  | api\_authentication\_check=$(/usr/bin/curl –write-out %{http\_code} –silent –output /dev/null "${jamfpro\_url}/api/v1/auth" –request GET –header "Authorization: Bearer ${api\_token}") |
|  |  |
|  | } |
|  |  |
|  | CheckAndRenewAPIToken() { |
|  |  |
|  | # Verify that API authentication is using a valid token by running an API command |
|  | # which displays the authorization...