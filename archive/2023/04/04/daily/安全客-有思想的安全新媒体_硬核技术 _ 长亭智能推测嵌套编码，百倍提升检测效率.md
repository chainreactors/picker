---
title: 硬核技术 | 长亭智能推测嵌套编码，百倍提升检测效率
url: https://www.anquanke.com/post/id/288070
source: 安全客-有思想的安全新媒体
date: 2023-04-04
fetch_date: 2025-10-04T11:29:07.159070
---

# 硬核技术 | 长亭智能推测嵌套编码，百倍提升检测效率

首页

阅读

* [安全资讯](https://www.anquanke.com/news)
* [安全知识](https://www.anquanke.com/knowledge)
* [安全工具](https://www.anquanke.com/tool)

活动

社区

学院

安全导航

内容精选

* [专栏](/column/index.html)
* [精选专题](https://www.anquanke.com/subject-list)
* [安全KER季刊](https://www.anquanke.com/discovery)
* [360网络安全周报](https://www.anquanke.com/week-list)

# 硬核技术 | 长亭智能推测嵌套编码，百倍提升检测效率

阅读量**418485**

|评论**1**

发布时间 : 2023-04-03 17:30:41

**x**

##### 译文声明

本文是翻译文章

译文仅供参考，具体内容表达以及含义原文为准。

当前被编码后的变种攻击载荷数量已达万亿级别，如何防护？

长亭科技发明了一种智能推测嵌套编码的方法，百倍提升检测效率，并获得发明专利。

![]()

先来一个随堂测试：

“1%27%20or%201%3D1” 这是什么代码？

有经验的安全人员很快会发现，
这是经过url编码之后的SQL注入攻击，也是一种“万能密码”。

“MSUyNyUyMG9yJTIwMSUzRDE=”这个呢？
“TVNVeU55VXlNRzl5SlRJd01TVXpSREU9”再看这个呢？
“VFZOVmVVNTVWWGxOUnpsNVNsUkpkMDFUVlhwU1JFVTk=” 还有这个呢？

其实它们都是同一个攻击载荷，即SQL注入万能密码”1’ or 1=1”，只是分别经过了1层url编码、1层base64编码、2层base64编码、3层base64编码。

经过多层编码之后，攻击特征完全看不出来了。

编码绕过是种非常普遍的绕过WAF攻击手段。
其做法是利用各种编程语言、中间件、框架的特性，将攻击载荷通过多次、多层的编码，产生一个与原始攻击载荷完全不同的变种载荷，隐藏攻击特征，从而绕过检测软件。

在现实网络中，
攻击编码方式有十数种，
嵌套编码层数可达十余层，
变种后，载荷的数量将呈指数级增长，
这个总数是万亿级别。

![]()

一层解码其实不是难题，毕竟编码方式是公开的，反向推导就可以。
多层编码呢？是不是也这么容易？

不如让最近大火的Chat-GPT来测试一下，
还是回答开头的测试题。

![]()

不愧是人工智能界的扛把子，Chat-GPT很轻松的就解出了经过一层编码的攻击载荷“1’or1=1”，而且思路清晰、有理有据。

我们加一点难度，同样还是原始载荷“1’or1=1”，再试试三层编码后的。

![]()

可以看到，尽管我们把解码方式和路径都告诉了Chat-GPT，尽管作答过程依然看起来十分规范，但显然答案错误。

经过多次、多层嵌套编码后的攻击载荷问题并不好解决。

那么，Web应用防火墙这类专业流量检测设备怎么做呢？

常见方式是，安全研究人员首先分析已知攻击检测用例，提取攻击特征载荷，使用特定规则语言描述攻击特征，再生效在WAF中。

![]()

这种方式的局限性很明显：
1、变种攻击载荷数量远超设备常规规则数量
传统安全检测设备支持的规则数目大概是万级别，必然无法完全枚举万亿级别的变种攻击载荷。在这种情况下，安全人员通常会优先编写置入近期热门变种特征规则，大量绕过就此诞生。
2、大量增加规则数量后，检测效率降低
当规则库增大后，需要大量标记是否匹配解码规则，以判断是否需要这个类型的解码，逐渐影响检测效率。

有没有更聪明的解法？

区别于普通解码方式，长亭雷池（SafeLine）下一代Web应用防火墙的专利解码技术使用了 “剪枝”策略。

![]()

这是一个被多次、多层编码后的Payload：

![]()

首先机器对该Payload进行第一波扫描，推测出了6种解码可能性：

![]()

根据这个结果调用对应解码器尝试解码，其中灰色4条路径解码失败，另外绿色2条路径解码成功：

![]()

接下来，攻击检测规则对两条解码成功的载荷进行检测，因未发现攻击特征，继续对这两个载荷进行解码探测、重复上述步骤，直至解码至Payload133检测到攻击特征、拦截该请求：

![]()

整体上来说， 长亭智能推测嵌套编码是一个重复“猜测-验证”的过程；通过自动化的探测流程不断摒弃错误的编码路径，直到还原到原始的攻击载荷。

得益于“剪枝”策略，雷池（SafeLine）不必存储大量攻击载荷被编码的规则，这大大提升了检测效率，同时突破规则枚举不全造成的攻击绕过局限性，提高检测准确率。

![]()

同时，为了不放过潜在的攻击行为，雷池（SafeLine）对http请求的内容执行无差别检测策略。

#### 无差别检测

即不具体拆解Payload具体是在哪UrlPath下、哪个Query参数中、哪个Form表单中；

而是自适应地对所有请求参数进行智能的编码探测、解码，攻击检测，尽可能扫描到所有的攻击Payload。

这意味着，不管攻击载荷是什么样子，雷池（SafeLine）都能经过层层还原，识别出原始攻击载荷，对部分0day攻击也有很好的检测效果。

雷池（SafeLine）识别过的部分0day攻击列表
![]()

AI让人焦虑，落地才是真实。

本文翻译自 原文链接。如若转载请注明出处。

商务合作，文章发布请联系 anquanke@360.cn

本文由**长亭科技**原创发布

转载，请参考[转载声明](https://www.anquanke.com/note/repost)，注明出处： [https://www.anquanke.com/post/id/288070](/post/id/288070)

安全KER - 有思想的安全新媒体

本文转载自:

如若转载,请注明出处：

安全KER - 有思想的安全新媒体

分享到：![微信](https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png)

* [编码](/tag/%E7%BC%96%E7%A0%81)

**+1**5赞

收藏

![](https://p2.ssl.qhimg.com/t012a2b2cc9165a693a.jpg)长亭科技

分享到：![微信](https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png)

## 发表评论

您还未登录，请先登录。

[登录](/login/index.html)

![](https://p5.ssl.qhimg.com/t01771e47b7b4fab146.png)

[![](https://p2.ssl.qhimg.com/t012a2b2cc9165a693a.jpg)](/member.html?memberId=122590)

[长亭科技](/member.html?memberId=122590)

Smart Makes Security

* 文章
* **118**

* 粉丝
* **116**

### TA的文章

* ##### [硬核技术 | 长亭智能推测嵌套编码，百倍提升检测效率](/post/id/288070)

  2023-04-03 17:30:41
* ##### [钟馗捉鬼 | 长亭万象（COSMOS）安全运营操作实录](/post/id/287068)

  2023-03-06 14:34:57
* ##### [2000亿！单日检测流量，长亭WAF花式演绎](/post/id/286756)

  2023-02-27 14:31:40
* ##### [放羊式管理云主机：一款面向技术爱好者的远程主机管理助手](/post/id/286534)

  2023-02-22 16:30:34
* ##### [三项全能！长亭科技获通信网络安全服务认证](/post/id/286529)

  2023-02-21 15:06:00

### 相关文章

* ##### [人工智能可能修复帮助传播了 15 年的漏洞](/post/id/308401)

  2025-06-12 15:19:33
* ##### [德克萨斯州交通部 (TxDOT) 数据泄露事件暴露了 30 万份车祸报告](/post/id/308355)

  2025-06-11 16:33:57
* ##### [德国对沃达丰隐私和安全漏洞罚款 5100 万美元](/post/id/308315)

  2025-06-10 13:44:46
* ##### [ChatGPT 为 200 美元专业版用户准备了 o3-pro 模式](/post/id/308311)

  2025-06-10 13:42:13
* ##### [2025 RSAC热点研讨会 | AI重塑安全运营，智能体引领未来发展](/post/id/308283)

  2025-06-10 13:10:53
* ##### [美国 CISA 将谷歌 Chromium V8 漏洞列入已知漏洞目录](/post/id/308189)

  2025-06-06 15:15:34
* ##### [全球勒索软件攻击激增，人工智能加速了勒索软件的威胁](/post/id/308185)

  2025-06-06 15:09:04

### 热门推荐

文章目录

![](https://p0.qhimg.com/t11098f6bcd5614af4bf21ef9b5.png)

安全KER

* [关于我们](/about)
* [联系我们](/note/contact)
* [用户协议](/note/protocol)
* [隐私协议](/note/privacy)

商务合作

* [合作内容](/note/business)
* [联系方式](/note/contact)
* [友情链接](/link)

内容需知

* [投稿须知](https://www.anquanke.com/contribute/tips)
* [转载须知](/note/repost)
* 官网QQ群：568681302

合作单位

* [![安全KER](https://p0.ssl.qhimg.com/t01592a959354157bc0.png)](http://www.cert.org.cn/)
* [![安全KER](https://p0.ssl.qhimg.com/t014f76fcea94035e47.png)](http://www.cnnvd.org.cn/)

Copyright © 北京奇虎科技有限公司 三六零数字安全科技集团有限公司 安全KER All Rights Reserved [京ICP备08010314号-66](https://beian.miit.gov.cn/)[![](https://icon.cnzz.com/img/pic.gif)](https://www.cnzz.com/stat/website.php?web_id=1271278035 "站长统计")

微信二维码

**X**![安全KER](https://p0.ssl.qhimg.com/t0151209205b47f2270.jpg)