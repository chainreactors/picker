---
title: Threat actors using MacroPack to deploy Brute Ratel, Havoc and PhantomCore payloads
url: https://blog.talosintelligence.com/threat-actors-using-macropack/
source: Over Security - Cybersecurity news aggregator
date: 2024-09-04
fetch_date: 2025-10-06T18:30:32.977649
---

# Threat actors using MacroPack to deploy Brute Ratel, Havoc and PhantomCore payloads

# Cisco Talos Blog

[ ]

* [Intelligence Center](https://talosintelligence.com/reputation)

  [ ]

  + [# Intelligence Center](https://talosintelligence.com/reputation)
  + BACK
  + [Intelligence Search](https://talosintelligence.com/reputation_center)
  + [Email & Spam Trends](https://talosintelligence.com/reputation_center/email_rep)
* [Vulnerability Research](https://talosintelligence.com/vulnerability_info)

  [ ]

  + [# Vulnerability Research](https://talosintelligence.com/vulnerability_info)
  + BACK
  + [Vulnerability Reports](https://talosintelligence.com/vulnerability_reports)
  + [Microsoft Advisories](https://talosintelligence.com/ms_advisories)
* [Incident Response](https://talosintelligence.com/incident_response)

  [ ]

  + [# Incident Response](/incident_response)
  + BACK
  + [Reactive Services](https://talosintelligence.com/incident_response/services#reactive-services)
  + [Proactive Services](https://talosintelligence.com/incident_response/services#proactive-services)
  + [Emergency Support](https://talosintelligence.com/incident_response/contact)
* [Blog](https://blog.talosintelligence.com)
* [Support](https://support.talosintelligence.com)

More

* Security Resources

  [ ]

  # Security Resources

  + BACK

  Security Resources
  + [Open Source Security Tools](https://talosintelligence.com/software)
  + [Intelligence Categories Reference](https://talosintelligence.com/categories)
  + [Secure Endpoint Naming Reference](https://talosintelligence.com/secure-endpoint-naming)
* Media

  [ ]

  # Media

  + BACK

  Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](https://talosintelligence.com/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](https://talosintelligence.com/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* Company

  [ ]

  # Company

  + BACK

  Company
  + [About Talos](https://talosintelligence.com/about)
  + [Careers](https://talosintelligence.com/careers)

![](/content/images/2024/09/threat-spotlight.png)

# Threat actors using MacroPack to deploy Brute Ratel, Havoc and PhantomCore payloads

By
[Vanja Svajcer](https://blog.talosintelligence.com/author/vanja-svajcer/)

Tuesday, September 3, 2024 08:00

[Threats](/category/threats/)

* Cisco Talos recently discovered several related Microsoft Office documents uploaded to VirusTotal by various actors between May and July 2024 that were all generated by a version of a payload generator framework called “MacroPack.”
* MacroPack is a framework designated for Red Team exercises, but we assess, with moderate confidence, that malicious actors are also using it to deploy malicious payloads.
* Talos analyzed the most recent documents uploaded to VirusTotal from different sources and countries, including China, Pakistan, Russia and the U.S., uncovering connections between the payloads and motivations for creating these documents.
* These malicious files deliver multiple payloads, including the Havoc and Brute Ratel post-exploitation frameworks and a new variant of the PhantomCore remote access trojan (RAT).
* Talos was not able to attribute these activities to a single actor despite some similarities in tactics, techniques and procedures (TTPs). No Talos customers were affected by these attacks and there are no related activities  in any Cisco product telemetry.

The threat of VBA macros has diminished since Microsoft prevented the execution of macros in Microsoft Office documents downloaded from the internet, but not all users are using the latest up-to-date Office versions and can still be vulnerable.

As a part of regular hunting exercises for malicious documents similar to the ones used by [UNC1151](https://blog.talosintelligence.com/malicious-campaigns-target-entities-in-ukraine-poland/), we discovered several suspicious documents using VBA macros that were similar but could not be attributed to the same threat actor.

Although the VBA code was similar — using obfuscated variable and function names and one or more layers of obfuscated code in their following stages — the lure themes were different, ranging from generic topics that instruct users to enable VBA macros, to official-looking documents and letters that appear to come from military organizations, pointing to various distinct threat actors.

## Common characteristics of MacroPack VBA code

The VBA code in all the documents had similar characteristics, which we traced to the MacroPack framework. MacroPack can generate several types of payloads packaged into different file types, including popular Office-supported formats, scripting files and shortcuts.

The code generated by the framework has the following characteristics, making it more difficult to detect using file content signatures:

* Function renaming.
* Variable renaming.
* Removal of surplus space characters.
* Removal of comments.
* Strings encoding.
* Payload obfuscation.

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXetI7X00OCZ7LlC8sPdVVrLPUmSuxY43n0hYh5NLP2SGTqkjrBPePrKwK-Frh8EIPAIDYBMueJSBedmsExONRa4DUvBdOrOO-26c3olhd-fKTvluYDJk7sC-z6orDExvs1D9Xjy0iT6BvnnyqDPo-8idLdl?key=2U1SLKATkzYvUNWGq241rw)

A payload string deobfuscation function generated by MacroPack.

MacroPack is designed to be easy to use and quickly generate various payloads allowing users to build working implants with a single command line.

MacroPack also exists in a professional, supported version, which contains additional functionality to make payloads more resilient and has some more advanced features such as anti-malware bypass, more advanced payloads, anti-reversing and additional payloads. The author states that the tool is intended to be used by Red Team members and not for malicious purposes, although there is no control over who uses the free version of the tool.

### Inclusion of non-malicious code

A common feature in all the malicious documents we dissected that caught our attention is the existence of four non-malicious VBA subroutines. These subroutines appeared in all the samples and were not obfuscated. They also had never been used by any other malicious subroutines or anywhere else in any documents.

At the beginning of the investigation, we suspected all the documents containing these unusual non-malicious subroutines were created by a single threat actor. But the different document lures and countries from where the documents were uploaded lead us to conclude that those subroutines were included by the professional version of MacroPack, which we confirmed via reliable, high-fidelity sources.

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXeE5DI2N0sjfVz8HB9yGrwX0HNBdd_6ENKpmhJqUz3ilY6qrlCSR_chvxqX9R7Hgtw5g47U3CPvS3galhlsB1f_6_gjmJobyUv10iErByefb6zQQMSCBYgKjfTz7vUqxT9fOeEeFaqLKR2xfiJZ_CCln_49?key=2U1SLKATkzYvUNWGq241rw)

Snippet of code taken from a Word programming book.

We traced the origin of the two functions to a website hosting various [VBA examples](https://www.automateexcel.com/vba/word/macro-examples) and one to a French Microsoft Word programming book [“Rédigez Facilement Des Documents Avec Word”](https://archive.org/details/RedigezFacilementDesDocumentsAvecWord) (“Easily Writing Documents with Word”) by Michel Martin.

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXcmT8_SqZyZR4oHmo-_IZ9tT6TMmapBISeD1gPPXsfQKYbaeIpWnRyMFrYusIUONFqv2hmvQrvQPX0g8-8fjh5YJYLhTIR56xWy6sg8XSfOPScA2c_cWb5ofl11GtksxV6vqjIOq6ferUNsX1HJtzs7IGxz?key=2U1SLKATkzYvUNWGq241rw)

Non-malicious functions common for all discovered documents from the VBA examples website.

The inclusion of the benign code is likely to lower the level of suspicion of the code generated by MacroPack. Some anti-malware engines may be able to detect code as suspicious if the entropy of the code is high to indicate pseudo-randomly named variables, functions and obfusca...