---
title: 域渗透小工具分享 - 渗透测试中心
url: https://www.cnblogs.com/backlion/p/17247550.html
source: 博客园 - 渗透测试中心
date: 2023-03-24
fetch_date: 2025-10-04T10:29:48.083562
---

# 域渗透小工具分享 - 渗透测试中心

[![](https://img2024.cnblogs.com/blog/35695/202509/35695-20250929100304557-587378723.jpg)](https://qoder.com/)

* [![博客园logo](//assets.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园")
* [会员](https://cnblogs.vip/)
* [众包](https://www.cnblogs.com/cmt/p/18500368)
* [新闻](https://news.cnblogs.com/)
* [博问](https://q.cnblogs.com/)
* [闪存](https://ing.cnblogs.com/)
* [赞助商](https://www.cnblogs.com/cmt/p/19081960)
* [HarmonyOS](https://harmonyos.cnblogs.com/)
* [Chat2DB](https://chat2db-ai.com/)

* ![搜索](//assets.cnblogs.com/icons/search.svg)
  ![搜索](//assets.cnblogs.com/icons/enter.svg)
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    所有博客
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    当前博客
* [![写随笔](//assets.cnblogs.com/icons/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔")
  [![我的博客](//assets.cnblogs.com/icons/myblog.svg)](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客")
  [![短消息](//assets.cnblogs.com/icons/message.svg)](https://msg.cnblogs.com/ "短消息")
  ![简洁模式](//assets.cnblogs.com/icons/lite-mode-on.svg)

  [![用户头像](//assets.cnblogs.com/icons/avatar-default.svg)](https://home.cnblogs.com/)

  [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx)
  [我的园子](https://home.cnblogs.com/)
  [账号设置](https://account.cnblogs.com/settings/account)
  [会员中心](https://vip.cnblogs.com/my)
  简洁模式 ...
  退出登录

  [注册](https://account.cnblogs.com/signup)
  登录

[![返回主页](/skins/custom/images/logo.gif)](https://www.cnblogs.com/backlion/)

# [渗透测试中心](https://www.cnblogs.com/backlion)

##

* [博客园](https://www.cnblogs.com/)
* [首页](https://www.cnblogs.com/backlion/)
* [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
* [联系](https://msg.cnblogs.com/send/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%BF%83)
* [管理](https://i.cnblogs.com/)
* 订阅
  [![订阅](/skins/coffee/images/xml.gif)](https://www.cnblogs.com/backlion/rss/)

# [域渗透小工具分享](https://www.cnblogs.com/backlion/p/17247550.html "发布于 2023-03-23 15:12")

## 0x01. NetLocalGroupGetMembers

功能：查询目标服务器本地管理组的成员

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151123817-61694149.png)

## 0x02. NetLocalGroupEnum

功能：返回指定服务器上的所有本地组

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151125016-233092716.png)

## 0x03. NetGroupGetUsers

功能：返回指定服务器指定组的所有成员

查询域里的各个组里的成员，IP必须是域控IP

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151126012-1342971612.png)

0x04. NetUserEnum

功能：查询目标服务器所有用户，包括隐藏用户

[![](https://github.com/SkewwG/domainTools/raw/master/imgs/NetUserEnum.png)](https://github.com/SkewwG/domainTools/blob/master/imgs/NetUserEnum.png)

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151126797-88203591.png)

0x05. wnetaddconnection2a

功能：建立IPC连接，可以将目标共享目录映射到本地磁盘

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151127542-1431694340.png)

0x06. WNetCancelConnection2

功能：删除IPC连接

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151128551-473455335.png)

0x07. EnuDomainUser

功能：枚举域用户

1. 介绍

适用于：当前边界机器权限是工作组机器，通过nltest或者nbtscan等工具发现内网有域环境，并且找到域控IP，但是没有域用户的权限下渗透思路。

前提条件：能够和域控建立空连接

实现原理：域管默认都会有administrator用户，通过windows api查出administrator域管的SID，然后遍历SID范围，枚举出域成员（域用户和域机器）。

SID范围：域用户和域机器的SID一般是1000以上，所以使用工具的时候遍历1000以上的SID

2. 工具使用

使用帮助：

```
C:\Users\Administrator\Desktop>EnuDomainUser.exe
Usage: EnuDomainUser.exe <DC-IP> <domainname\username> <start Sid> <end Sid> <t_num>
       EnuDomainUser.exe \\192.168.52.2 hack\administrator 1000 2000 100
       EnuDomainUser.exe \\域控IP 域名\域用户名<默认administrator> 起始Sid 末尾Sid 多线程数目
```

使用demo：

EnuDomainUser.exe 192.168.52.2 hack\administrator 1000 2000 100

参数解释：

```
192.168.52.2  是域控IP
hack          是域名
administrator 是域管默认用户
1000          是遍历SID的起始
2000          是遍历SID的末尾-可以设置高一点，例如10000，20000等
100           是多线程的数目
```

[![](https://github.com/SkewwG/domainTools/raw/master/imgs/EnuDomainUser.png)](https://github.com/SkewwG/domainTools/blob/master/imgs/EnuDomainUser.png)

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151129593-1430331576.png)

0x08. BlastDomainUserPwd

功能：爆破域用户密码

1. 介绍

通过IPC连接->爆破域用户的密码

结合EnuDomainUser工具或者kerbrute工具获取域用户名列表，然后进行爆破

如果被360杀，改一下exe名字即可

设计思路：

1. 如果能够和域控建立空连接，则用EnuDomainUser工具枚举遍历出所有域用户名
2. 如果不能够和域控建立空连接，则用kerbrute工具爆破域用户名

当获取到一批域用户名后，开始尝试域用户密码的弱口令爆破

域用户密码有强度要求，则尝试爆破强弱口令。例如：P@ssw0rd、1qaz@WSX等

2. 工具的使用

```
Usage: BlastDomainUserPwd.exe <domainComputerIp> <domainUser.txt> <password> <t_num>
       BlastDomainUserPwd.exe \\192.168.52.29 domainUser.txt password 100
       BlastDomainUserPwd.exe \\域机器IP 域用户名字典 尝试爆破的密码 多线程数目
```

域用户名字典格式规范：域名\域用户名

domain\user

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151130536-534546264.png)

运行实例： BlastDomainUserPwd.exe \\192.168.52.2 domainUser.txt 1qaz@WSX 3

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151131665-478973375.jpg)

成功爆破出的域用户密码保存在当前目录的success.txt文本里

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151132492-1163518885.png)

[![](https://github.com/SkewwG/domainTools/raw/master/imgs/BlastDomainUserPwd_success.png)](https://github.com/SkewwG/domainTools/blob/master/imgs/BlastDomainUserPwd_success.png)

0x09. SchtaskBackDoorWebshell

功能：计划任务维持webshell

1. 适用场景：

护网中被防守方发现webshell，并清除出去，漏洞也被修复，然后网站恢复后不能再上传webshell时，通过计划任务重写webshell。

2. 条件：

管理员权限，因为创建计划任务得需要管理员权限

3. 使用方法：

xxxx.exe c:\wwww\upload\1.jsp

4. 实现过程：

将c:\wwww\upload\1.jsp内容复制到c:\windows\temp\tempsh.txt里，然后创建了一个计划任务，执行的命令是c:\windows\system32\cmd.exe /c copy c:\windows\temp\tempsh.txt c:\wwww\upload\1.jsp，每半小时触发一次。

5. 视频展示：

[![](https://github.com/SkewwG/domainTools/raw/master/imgs/webshell计划任务后门.gif)](https://github.com/SkewwG/domainTools/blob/master/imgs/webshell%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E5%90%8E%E9%97%A8.gif)

0x10. regeditBypassUAC

功能：过uac执行exe，编译好的exe只适用于win10，win7不行

1. 具体过程

[基于白名单程序注册表bypassUAC](https://github.com/SkewwG/domainTools/blob/master/regeditBypassUAC/README.md)

2. 视频演示

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151133619-1385657115.jpg)

0x11. delegationVul

功能：检测内网域的约束委派

1. 约束委派利用

[约束委派利用](https://github.com/SkewwG/domainTools/blob/master/delegationVul/%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E5%88%A9%E7%94%A8.md)

2. 视频演示

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151135034-1208473538.jpg)

3. 基于资源的约束委派利用

[基于资源的约束委派利用](https://github.com/SkewwG/domainTools/blob/master/delegationVul/%E5%9F%BA%E4%BA%8E%E8%B5%84%E6%BA%90%E7%9A%84%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E5%88%A9%E7%94%A8.md)

4. 视频演示

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151136117-431754580.jpg)

0x12. 360SafeBrowserDecrypt

功能：

```
直接在目标机器上运行，但是不免杀
360SafeBrowserDecrypt.exe

将目标的机器id和assis2.db数据库拖回到本地解密
查机器id:
reg query "HKLM\SOFTWARE\MICROSOFT\CRYPTOGRAPHY" /v "MachineGuid"
查360安全浏览器安装目录:
reg query "HKCR\360SeSES\DefaultIcon"
默认的assis2.db数据库目录:
C:\Users\xxxxxxx\AppData\Roaming\360se6\User Data\Default\apps\LoginAssis

本地运行:
360SafeBrowserDecrypt.exe xxx-xxx-xxx-xxx assis2.db
```

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323151136965-882402939.png)

```
结果显示:
有收藏夹的url和保存密码的url

文章中所用到工具：  链接：https://pan.baidu.com/s/1bKo-srQJMWgpQt5mPCFPfA  提取码：ryzx
```

[![](https://github.com/SkewwG/domainTools/raw/master/imgs/360SafeBrowserDecrypt.jpg)](https://github.com/SkewwG/domainTools/blob/master/imgs/360SafeBrowserDecrypt.jpg)

分析文章：[动态调试360安全浏览器获取密钥](https://skewwg.github.io/2020/11/26/dong-tai-diao-shi-360-an-quan-liu-lan-qi-huo-qu-mi-yao/)

原文链接：<https://github.com/SkewwG/domainTools>

![](https://img2023.cnblogs.com/blog/1049983/202303/1049983-20230323153953317-1396180329.jpg)

posted @
2023-03-23 15:12
[渗透测试中心](https://www.cnblogs.com/backlion)
阅读(427)
评论(0)

收藏
举报

刷新页面[返回顶部](#top)

[![](https://img2024.cnblogs.com/blog/35695/202508/35695-20250830121216742-1062949948.jpg)](https://developer.huawei.com/consumer/cn/activity/digixActivity/digixcmsdetail/101750143863263087?ha_source=BKYQ3&ha_sourceId=890004...