---
title: 一个文件上传漏洞靶场
url: https://www.secpulse.com/archives/196724.html
source: 安全脉搏
date: 2023-02-28
fetch_date: 2025-10-04T08:11:53.388232
---

# 一个文件上传漏洞靶场

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 一个文件上传漏洞靶场

[漏洞](https://www.secpulse.com/archives/category/vul)

[Lemon](https://www.secpulse.com/newpage/author?author_id=5109)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng3.png)

2023-02-27

11,040

# **前言**

这篇文章是关于一个上传漏洞靶场的挑战译文，原文链接如下：

https://github.com/frank-leitner/tryhackme/tree/main/Upload\_Vulnerabilities

靶机说明：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477147.png)

# **步骤**

Web应用程序是一组轮询的背景图像，同时它也允许上传自己图像。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477148.png)

### **检测内容**

首先页面本身没有透露什么太有趣的内容。那就从模糊测试开始，看看能不能找到更多内容：

```
ffuf -w /usr/share/wordlists/dirb/big.txt -u http://jewel.uploadvulns.thm/FUZZ
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477150.png)

果然成功找到了更多的目录。快速浏览一下 CSS，你就会发现旋转的背景图像是从目录`/content/`中获取的。该目录`/admin/`显示一条注释，这就说明可以在这里激活一些模块。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477153.png)

其他目录并没有显示出其他什么有用的内容。

### **检测使用的技术**

下一步是找出页面使用了什么技术，同时看看它们可能引用了哪些模块类型。因此我用Wappalyzer检查了一下页面：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477154.png)

这里显示出来的是在`Express`框架上运行的`node.js`应用程序。

### **在子目录中查找内容**

接下来我检查子目录去查找其他内容。提供的单词列表中的命名模式与图像的命名模式匹配，因此我也使用该列表检查/content/目录。

```
ffuf -w ./UploadVulnsWordlist.txt -u http://jewel.uploadvulns.thm/content/FUZZ.jpg
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477155.png)

果然，它找到了四个用作背景的图像。

### **获取反向shell的脚本**

因为我知道该应用程序是一个Node.js应用程序，所以我从PayloadsAllTheThings那里得到了一个反向shell，并更改了IP /端口来匹配自己服务器：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477157.png)

#### **上传shell**

本来想说尝试上传脚本，但它被阻止了。不过这是一个由JavaScript触发的消息，因此我使用Burp历史记录来检查加载的脚本文件。

然后我就找到了罪魁祸首，客户端验证代码：`/assets/js/upload.js`

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477158.png)

如果要拦截JavaScript文件，我需要更改代理选项以拦截JS文件，因为默认情况下Burp Proxy是不会拦截它们的：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477159.png)

删除条件`^.js$`后，使用Ctrl-F5重新加载页面来实现强制完全刷新。

当`upload.js`请求被拦截时，再指示Burp拦截其响应（`Do Intercept->Response to this request`）并删除上面标记的行。

虽然我已经试图重新上传了，但它还是失败了，这次是在服务器端完成的验证。

在理想情况下，服务器应执行客户端执行的所有验证。毕竟客户端验证只是为了可用性。最终的安全性只能通过服务器端验证来提供。

不过现实很骨感，服务器执行了其他验证。我将文件扩展名更改为jpg并重试上传。这一次它成功了。

### **查找已上传的shell**

我刚刚上传的文件在任何目录中都找不到其已知文件名。然后我使用提供的单词列表重新运行目录的模糊测试。

这一次，我在那里找到了一个额外的文件：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477160.png)

### **获取反向shell**

在/admin/页面上，我可以激活/modules/目录中的模块，服务器应该强制它不接受任何其他位置。

我刚刚上传的文件位于`/content/` .不过可能没有适当的验证来防止路径遍历。

然后我在我的机器上启动一个监听器`nc -nvlp 8888`，并通过其相对路径激活模块：`../content/WON.jpg`

我收到的 shell 显示应用程序以 root 身份运行。因此，不需要权限提升，我可以立即获得flag：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-196724-1677477162.png)

```
转自：雷石安全实验室
```

**侵权请私聊公众号删文**

****欢迎关注LemonSec****

**本文作者：[Lemon](newpage/author?author_id=5109)**

**本文为安全脉搏专栏作者发布，转载请注明：**[**https://www.secpulse.com/archives/196724.html**](https://www.secpulse.com/archives/196724.html)

Tags: [Web应用](https://www.secpulse.com/archives/tag/web%E5%BA%94%E7%94%A8)、[文件上传](https://www.secpulse.com/archives/tag/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0)、[模糊测试](https://www.secpulse.com/archives/tag/%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95)、[漏洞](https://www.secpulse.com/archives/tag/%E6%BC%8F%E6%B4%9E)

点赞：
1
[评论：0](#goComment)
收藏：
0

*新浪微博
QQ空间
微信扫一扫*

### 相关文章

* [![代码审计 | 同源策略的绕过](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2023/09/a799223d33bd92e8b0620d8ad38ecd2.jpg)

  代码审计 | 同源策略的绕过](https://www.secpulse.com/archives/203439.html "详细阅读 代码审计 | 同源策略的绕过")
* [![云原生安全联防联抗策略玩转微隔离](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2023/09/1694157547520-300x155.png)

  云原生安全联防联抗策略玩转微隔离](https://www.secpulse.com/archives/203414.html "详细阅读 云原生安全联防联抗策略玩转微隔离")
* [![从2023蓝帽杯0解题heapSpary入门堆喷](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2023/08/1693450185258-300x157.png)

  从2023蓝帽杯0解题heapSpary…](https://www.secpulse.com/archives/203218.html "详细阅读 从2023蓝帽杯0解题heapSpary入门堆喷")

评论  (0)

昵称

必填
您当前尚未登录。
[登录？](https://www.secpulse.com/user_login "登录")
[注册](https://www.secpulse.com/user-register)

邮箱

必填（保密）

快来写下你的想法吧！

upload

|  |  |  |
| --- | --- | --- |
| [![]( https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/f43a6447ea66cf84915afd0ca2631f09.png)](https://www.secpulse.com/newpage/author?author_id=5109aaa) | [Lemon ![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng3.png)](https://www.secpulse.com/newpage/author?author_id=5109) | |
| 文章数：68 | 积分： 647 |
|  | |

* [![阿波罗主机安全管理](/wp-content/themes/secpulse2017/img/product-agent.png)](https://linkage.duoyinsu.com)
* [![伏特漏洞扫描云平台](/wp-content/themes/secpulse2017/img/product-fute.png)](https://v.duoyinsu.com)

### 安全问答社区

![安全问答社区](https://www.secpulse.com/wp-content/themes/secpulse2017/img/xcx.png)

### 脉搏官方公众号

![脉搏公众号](https://www.secpulse.com/wp-content/themes/secpulse2017/img/SecPulse.png)

### 活动日程

[显示更多](https://www.secpulse.com/newpage/activity)

#### 2022-06-17

[Gdevops 全球敏捷运维峰会](https://www.bagevent.com/event/8022600?bag_track=AQMB)

#### 2022-05-12

[Mastering the Challenge！——来自The 3rd AutoCS 2022智能汽车信息安全大会的邀请函](https://autocs2022.artisan-event.com/)

#### 2021-11-18

[AutoSW 2021智能汽车软件开发大会](https://autosw2021.artisan-event.com)

#### 2021-06-27

[2021中国国际网络安全博览会暨高峰论坛](http://www.sins-expo.com)

#### 2021-05-27

...