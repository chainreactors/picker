---
title: 一种很骚的新颖姿势盗取别人登陆凭证
url: https://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247497159&idx=1&sn=af4e0fe11576987541039d7b351fae33&chksm=e8a5ffa4dfd276b2dfc2800231891784cdbe2a507b355c753062fbf3ac31420f8500f1d4e393&scene=58&subscene=0#rd
source: 迪哥讲事
date: 2025-02-18
fetch_date: 2025-10-06T20:47:25.234778
---

# 一种很骚的新颖姿势盗取别人登陆凭证

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/YmmVSe19Qj6UJDWwP6mFV4xv94zENhUV9E6ib4kCwbHwOaMGiaDKOV7WTicib9shQ1gHrGeYY73OVAJhbnYCO4iakEw/0?wx_fmt=jpeg)

# 一种很骚的新颖姿势盗取别人登陆凭证

迪哥讲事

以下文章来源于一个不正经的黑客
，作者一个不正经的黑客

![](http://wx.qlogo.cn/mmhead/Q3auHgzwzM7Ye8K1LdT6vUsuNeKr1S2DofpqlI98Xh2GQVibnXy64mg/0)

**一个不正经的黑客**
.

以黑客之荣耀，执0day之利剑，击溃所有的防护，势必划破无尽的黑暗！

最近OpenAI被爆出2000万个OpenAI账户的出售。

看到这个新闻，我联想到以前OpenAI出现过一些与此可能相关漏洞，其中有一个很有趣的姿势，迫不及待想和各位粉丝朋友一起分享学习下。

![](https://mmbiz.qpic.cn/mmbiz_png/cxf9lzscpMqycVsAqsXX6JBC4RhLSyBbLnpQ61iac1sAV4bibtyycHkvqeM5AiaLEcHrNGTzvOexBOCdtoIgpQAEg/640?wx_fmt=png&from=appmsg)

## 背景说明

这是一类被习惯性忽略的漏洞，但是危害却是严重级别的ATO账户接管。

下面让我们以chatgpt的漏洞案例进行分析，以让大家更好地理解"缓存"漏洞挖掘的姿势及其如何巧妙地产生危害！

## 正文内容

在这篇文章中，我将解释如何利用路径遍历URL解析混淆，滥用这一漏洞达到我所称之为“通配符”缓存欺骗漏洞，进而窃取用户的认证令牌并接管他们的账户。

我假设读者已经了解Web缓存欺骗漏洞的基础知识，因此不会深入解释。

如果你还不熟悉这个非常有趣的漏洞，建议保持关注此公众号之前发表过一些类似的缓存漏洞文章。

此外，这个漏洞使用的概念与我去年在Glassdoor发现的Web缓存投毒漏洞类似，允许我们缓存“无法缓存”的文件和端点。

尽管它不是完全相同的技术，但它展示了URL解析混淆，特别是路径遍历，如何为各种缓存漏洞打开新大门。

### 初步发现

在玩ChatGPT新实现的“分享”功能时，我注意到了一些奇怪的现象。

**PS.敏锐发现场景差异**

这个功能允许用户将他们的聊天内容公开分享给他人，但我发现，**当我继续与ChatGPT对话时，所有我分享的聊天链接都不会更新**。

经历过类似的bug后，第一时间想到的是缓存问题。我猜测共享的聊天内容是被缓存的，因此在缓存条目过期之前，它不会更新。

为了验证这一点，我打开了开发者工具中的网络标签，检查响应头，正如我预料的那样，我看到了Cf-Cache-Status: HIT头部。

这对我来说很有意思，因为这并不是一个静态文件。我检查了URL，发现路径中没有预期的静态扩展名：

https://chat.openai.com/share/CHAT-UUID

这意味着，可能存在一个缓存规则，它不依赖于文件的扩展名，而是依赖于URL路径中的位置。

为了验证这一点，我检查了

https://chat.openai.com/share/random-path-that-does-not-exist ，

果然，它也被缓存了。很快，我意识到缓存规则大概是这样的：/share/\*。这意味着，基本上所有位于/share/路径下的内容都会被缓存。

这立刻引起我的警觉，因为在我上次进行缓存投毒漏洞研究时，就记下了：**特别是当URL解析混淆存在时，放宽缓存规则可能非常危险**。

### 路径遍历混淆

在使用缓存的网站中，请求必须先通过CDN，再到达Web服务器。

这意味着URL会被解析两次，从而可能会出现URL解析混淆的问题。

在ChatGPT的案例中，URL解析混淆意味着两个服务器对URL编码的斜杠（%2F）解析方式不同：

Cloudflare的CDN不会解码，也不会规范化URL编码的路径遍历，而Web服务器会。

所以，URL编码的路径遍历允许攻击者从服务器缓存任何他们希望的文件，包括那些包含授权令牌的高影响力API端点。

这听起来有些复杂，下面是一个示例负载：

注意，%2F解码后为/，而/api/auth/session是一个敏感的API端点，包含用户的授权令牌：

https://chat.openai.com/share/%2F..%2Fapi/auth/session?cachebuster=123

让我们来解析一下这个过程：

* 我们已经确认，CDN会缓存所有位于/share/下的内容。
* 我们也说过，CDN不会解码或规范化%2F..%2F，因此响应会被缓存。
* 然而，当CDN将这个URL转发给Web服务器时，Web服务器会解码并规范化%2F..%2F，并且会响应/api/auth/session，该端点包含授权令牌。

将这些信息结合起来，当受害者访问

https://chat.openai.com/share/%2F..%2Fapi/auth/session?cachebuster=123

他们的授权令牌会被缓存。当攻击者稍后访问

https://chat.openai.com/share/%2F..%2Fapi/auth/session?cachebuster=123

他们将看到受害者缓存的授权令牌。此时，攻击者就可以完全接管账户，查看聊天记录、账单信息等。

为了帮助大家更好地理解，我画了一个简单的草图来帮助你们可视化这个过程：

![](https://mmbiz.qpic.cn/mmbiz_png/cxf9lzscpMqycVsAqsXX6JBC4RhLSyBbdNKoI5icfxw7udLPQCBdx8nP7HlSXotciakgtH7HiaMWarlMMGsibY2Wtw/640?wx_fmt=png&from=appmsg)

总结来说，我通过利用URL编码的路径遍历，借助CDN和Web服务器之间路径规范化的不一致，成功缓存了敏感的API端点。

最后该漏洞悬赏6500美元。

thanks https://nokline.github.io/bugbounty/2024/02/04/ChatGPT-ATO.html

## 漏洞分析

首先，这个漏洞的发现过程非常有指导意义。

1.白帽子通过结合业务的理解观察到分享功能的链接不会更新

2.去验证想法发现/share目录下的内容都会被CDN缓存

3.发现利用CDN和Web服务器解码的差异可逃逸出缓存规则

4.构造路径穿越，强迫CDN服务器缓存到本不该缓存的登陆凭证页面

之后所有的用户包括黑客都可访问到此缓存页面，黑客从缓存里面获取到受害者的登陆凭证信息完成攻击，整个攻击链路非常的巧妙，可实现1click接管用户的帐号！

如果你是一个长期主义者，欢迎加入我的知识星球，我们一起往前走，每日都会更新，精细化运营，微信识别二维码付费即可加入，如不满意，72 小时内可在 App 内无条件自助退款

![](https://mmbiz.qpic.cn/mmbiz_png/YmmVSe19Qj5EMr3X76qdKBrhIIkBlVVyuiaiasseFZ9LqtibyKFk7gXvgTU2C2yEwKLaaqfX0DL3eoH6gTcNLJvDQ/640?wx_fmt=png&from=appmsg)

## 往期回顾

[一款bp神器](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247495880&idx=1&sn=65d42fbff5e198509e55072674ac5283&chksm=e8a5faabdfd273bd55df8f7db3d644d3102d7382020234741e37ca29e963eace13dd17fcabdd&scene=21#wechat_redirect)

[挖掘有回显ssrf的隐藏payload](https://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247496898&idx=1&sn=b6088e20a8b4fc9fbd887b900d8c5247&scene=21#wechat_redirect)

[ssrf绕过新思路](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247495841&idx=1&sn=bbf477afa30391b8072d23469645d026&chksm=e8a5fac2dfd273d42344f18c7c6f0f7a158cca94041c4c4db330c3adf2d1f77f062dcaf6c5e0&scene=21#wechat_redirect)

[一个辅助测试ssrf的工具](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247496380&idx=1&sn=78c0c4c67821f5ecbe4f3947b567eeec&chksm=e8a5f8dfdfd271c935aeb4444ea7e928c55cb4c823c51f1067f267699d71a1aad086cf203b99&scene=21#wechat_redirect)

[dom-xss精选文章](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247488819&idx=1&sn=5141f88f3e70b9c97e63a4b68689bf6e&chksm=e8a61f50dfd1964692f93412f122087ac160b743b4532ee0c1e42a83039de62825ebbd066a1e&scene=21#wechat_redirect)

[年度精选文章](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247487187&idx=1&sn=622438ee6492e4c639ebd8500384ab2f&chksm=e8a604b0dfd18da6c459b4705abd520cc2259a607dd9306915d845c1965224cc117207fc6236&scene=21#wechat_redirect)

[Nuclei权威指南-如何躺赚](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247487122&idx=1&sn=32459310408d126aa43240673b8b0846&chksm=e8a604f1dfd18de737769dd512ad4063a3da328117b8a98c4ca9bc5b48af4dcfa397c667f4e3&scene=21#wechat_redirect)

[漏洞赏金猎人系列-如何测试设置功能IV](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247486973&idx=1&sn=6ec419db11ff93d30aa2fbc04d8dbab6&chksm=e8a6079edfd18e88f6236e237837ee0d1101489d52f2abb28532162e2937ec4612f1be52a88f&scene=21#wechat_redirect)

[漏洞赏金猎人系列-如何测试注册功能以及相关Tips](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247486764&idx=1&sn=9f78d4c937675d76fb94de20effdeb78&chksm=e8a6074fdfd18e59126990bc3fcae300cdac492b374ad3962926092aa0074c3ee0945a31aa8a&scene=21#wechat_redirect)

预览时标签不可点

![]()

微信扫一扫
关注该公众号

继续滑动看下一个

轻触阅读原文

![](http://mmbiz.qpic.cn/mmbiz_png/YmmVSe19Qj4k2mXPm8xlXujVgicTGvZbcictoGLuPERQn9lRPAKkKUB5ut9XMicric8PxLRmSOq0tT5LuGuD1WemBQ/0?wx_fmt=png)

迪哥讲事

向上滑动看下一个

知道了

![]()
微信扫一扫
使用小程序

取消
允许

取消
允许

取消
允许

×
分析

![跳转二维码]()

![作者头像](http://mmbiz.qpic.cn/mmbiz_png/YmmVSe19Qj4k2mXPm8xlXujVgicTGvZbcictoGLuPERQn9lRPAKkKUB5ut9XMicric8PxLRmSOq0tT5LuGuD1WemBQ/0?wx_fmt=png)

微信扫一扫可打开此内容，
使用完整服务

：
，
，
，
，
，
，
，
，
，
，
，
，
。

视频
小程序
赞
，轻点两下取消赞
在看
，轻点两下取消在看
分享
留言
收藏
听过