---
title: Exploiting a Logic Bug in Discount Codes Generation
url: https://infosecwriteups.com/exploiting-a-logic-bug-in-discount-code-generation-a7f624bb396f?source=rss----7b722bfd1b8d--bug_bounty
source: Bug Bounty in InfoSec Write-ups on Medium
date: 2024-09-30
fetch_date: 2025-10-06T18:23:16.973658
---

# Exploiting a Logic Bug in Discount Codes Generation

[Sitemap](/sitemap/sitemap.xml)

[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fa7f624bb396f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&%7Estage=mobileNavBar&source=post_page---top_nav_layout_nav-----------------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Finfosecwriteups.com%2Fexploiting-a-logic-bug-in-discount-code-generation-a7f624bb396f&source=post_page---top_nav_layout_nav-----------------------global_nav------------------)

[Medium Logo](https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav------------------)

[Search](https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Finfosecwriteups.com%2Fexploiting-a-logic-bug-in-discount-code-generation-a7f624bb396f&source=post_page---top_nav_layout_nav-----------------------global_nav------------------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)

[## InfoSec Write-ups](https://infosecwriteups.com/?source=post_page---publication_nav-7b722bfd1b8d-a7f624bb396f---------------------------------------)

·

Follow publication

[![InfoSec Write-ups](https://miro.medium.com/v2/resize:fill:76:76/1*SWJxYWGZzgmBP1D0Qg_3zQ.png)](https://infosecwriteups.com/?source=post_page---post_publication_sidebar-7b722bfd1b8d-a7f624bb396f---------------------------------------)

A collection of write-ups from the best hackers in the world on topics ranging from bug bounties and CTFs to vulnhub machines, hardware challenges and real life encounters. Subscribe to our weekly newsletter for the coolest infosec updates: <https://weekly.infosecwriteups.com/>

Follow publication

# Exploiting a Logic Bug in Discount Codes Generation

[![Sam](https://miro.medium.com/v2/resize:fill:64:64/1*3-6QxMOzNien582LhZvITA.jpeg)](https://medium.com/%40sam_0x0?source=post_page---byline--a7f624bb396f---------------------------------------)

[Sam](https://medium.com/%40sam_0x0?source=post_page---byline--a7f624bb396f---------------------------------------)

5 min read

·

Sep 28, 2024

--

5

Listen

Share

In online shopping, we will find a wonderful feature most sites offer: discount codes, which provide great discounts on some products. So, what happens when hackers find a logic bug that allows them to create thousands of discount codes?

We have a target let’s call “**xyz.com**”.

> Usually, I start testing on a main domain and here I want to say that many researchers say that you will not find any bug in the main domain and this is a mistake. You should search and then move to the subdomains.

First, I start using the web application like any other user to understand the website and all its functions and take some notes.

After understanding the site, I found a unique **CSRF-Token** that prevents CSRF attacks. The strange thing is that this token is fixed and does not change. This means that every user who visits the site has a unique **CSRF-Token** created for him that is fixed and does not change.

Usually, in this case, the **CSRF-TOKEN** is linked to one of the cookies that is essential for the site, so I began analyzing the cookies and sending more requests to understand and determine their importance.

### Analyzing the cookies

Here I found some cookies like (**XYZ**, **xyz\_data,** PHPSESSION**)**

**XYZ Cookie:** contains (hash\_value)

**xyz\_Data Cookie**: contains some information for the user like (user\_id: timestamp, etc..)

**PHPSESSION**: This is a normal session given to the user after logging in.

After I opened my account from another device with the same account, I found that the **CSRF-TOKEN** had been changed. This means that the site depends on some user information such as IP, time, device information, etc, and Here, a unique **CSRF-TOKEN** is generated.

It’s good to understand that, After that I found a new function on the website it’s called a club.

> This feature allows users to join and give them some discount codes. The number of these codes is 7, and they are free and no more than that. After purchasing with these codes, the account that owns these codes gets points, and these points give it other discounts that reach more than 50%.

Here, I created another account to test it and when I entered this feature I found this message.

![]()

The website needs a verification email

This means I am unable to join or use this feature here. I have switched to my other account to see the endpoints the site relies on.

**Endpoints**:

1. /api//join → Join to the club
2. /api/deactivate → Remove your account from this feature.
3. /api/discount\_codes → Return discount codes

After I understanding the most important endpoints, let’s move to the other account to see if we can use this feature or not.

Here, I send a POST request to join.

Press enter or click to view image in full size

![]()

CSRF-Token Error

I encountered an error due to a missing CSRF token header. To obtain the token, I added a product to my favorites list, intercepted the request, and found the token. After copying this token, I went back to the join request.

Press enter or click to view image in full size

![]()

Great it works then I moved on to reading the discount codes via ```/api/discount\_codes```

![]()

Discount Codes

Now, I can use this feature without a verification email. I reported this as a privilege escalation, but the team closed my report as informative because there was no impact from this bug.

![]()

Press enter or click to view image in full size![]()

After two days, I returned to see if I could make a bigger impact. I asked myself, “What is crucial in this process? Are the discount codes working properly?” Now, I need to understand how the website generates discount codes. I jotted down the old discount codes in my notepad and started testing this feature. After deactivating and reactivating my account to check if I would receive the same codes, I discovered that the new discount codes were very different from the old ones. I noted the new codes and decided to repeat the process. Upon doing so, I found that the codes were indeed different, It’s good. Now, I need to verify that these codes have not been invalidated. I proceeded to my shopping cart, added some items, and applied the code to confirm its functionality.

![]()

Great, it doesn’t invalidate old codes. Now I need to write a script to exploit this bug.

Exploit

After finishing this I found that it worked and there was no problem after that I did a crazy step which was collecting thousands of discount codes.

![]()

Here I was worried that the WAF would block me, but the WAF didn’t block me.

Press enter or click to view image in full size

![]()

Photo by [sohail shaikh](https://unsplash.com/%40sohailnj?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com/?utm_source=medium&utm_medium=referral)

**Impact:**

1. Generate Unlimited Discount Codes: Users can create numerous discount codes by repeatedly rejoining the club.
2. Financial Loss: These codes can be shared or sold, leading to significant financial losses for the business.
3. Abuse of Membership Privileges: Non-members can gain unauthorized access to benefits intended for paying members.
4. Hackers can abuse this bug and sell it on the dark web, causing financial losses.

After reporting again, it was triaged and I received a bounty of $$$ 10 days later.

![]()

I hope you like it and that everything is clear. Thank you for reading.

**You can contact me at:**

[Linkedin](https://www.linkedin.com/in/eslam--omar/)

[Twitter](https://x.com/Sam_0x0)

[Bug Bounty](https://medium.com/tag/bu...