---
title: OrBit: analysis of a Linux dedicated malware
url: https://buaq.net/go-143792.html
source: unSafe.sh - 不安全
date: 2023-01-03
fetch_date: 2025-10-04T02:54:31.822113
---

# OrBit: analysis of a Linux dedicated malware

* [unSafe.sh - 不安全](https://unsafe.sh)
* [我的收藏](/user/collects)
* [今日热榜](/?hot=true)
* [公众号文章](/?gzh=true)
* [导航](/nav/index)
* [Github CVE](/cve)
* [Github Tools](/tools)
* [编码/解码](/encode)
* [文件传输](/share/index)
* [Twitter Bot](https://twitter.com/buaqbot)
* [Telegram Bot](https://t.me/aqinfo)
* [Search](/search/search)

[Rss](/rss.xml)

[ ]
黑夜模式

![](https://8aqnet.cdn.bcebos.com/2be6ca165d5d901af94652c099645d9f.jpg)

OrBit: analysis of a Linux dedicated malware

Orbit is a two-stage malware that appeared in July 2022, discovered by Interzer lab. Acting as a
*2023-1-2 22:36:41
Author: [www.stormshield.com(查看原文)](/jump-143792.htm)
阅读量:22
收藏*

---

**Orbit is a two-stage malware that appeared in July 2022, discovered by Interzer lab. Acting as a stealer and backdoor on 64-bit Linux systems, it consists of an executable acting as a dropper and a dynamic library.**

In July 2022, Interzer's research teams published [the first paper](https://www.intezer.com/blog/incident-response/orbit-new-undetected-linux-threat) on the OrBit malware, with an evocative title: '*New Undetected Linux Threat Uses Unique Hijack of Execution Flow*'.

Debugging information

$Yes

Required privileges

$root (fails without superadmin rights)

SHA-256

$f1612924814ac73339f777b48b0de28b716d606e142d4d3f4308ec648e3f56c8

MD5

$67048a69a007c37f8be5d01a95f6a026

The goal of the dropper is to install a shared library on the target system.

Several command line arguments are supported:

* Without argument, the malware is installed in the directory *`/lib/libntpVnQE6mk/`*
* ***sh*** installs the malware in *`/dev/shm/ldx`*
* ***shred***removes the malware
* ***newpath***modify the linker to write the path passed in parameter
* ***mov*** installs the malicious library in the chosen directory with name passed in parameter
* ***-O*** ignore the version of the binary **ld.so** during installation
* ***-o*** allows to rewrite the path written in the linker by *`/dev/shm/ldx/.l`*
* ***-u*** reinstalls the malware

.backup\_ld.so

$linker backup

libdl.so

$malicious shared library

.l

$contains the path to the malicious library

.profile

$script to be installed in a home directory

.bashrc

$symbolic link to .profile

escalator

$privilege elevation script

.bootsh

$file to execute when the cron daemon is activated

.logpam

$indicates whether ssh passwords should be saved

sshpass.txt

$PAM password list

sshpass2.txt

$sudo or ssh password list

.ports

$list of ports to filter in TCP

## Persistent installation

### Entry point of the malware

The **`main`** function vérifie checks for the presence of the directory *`/lib/libntpVnQE6mk`*, this will eventually contain all the files and subdirectories needed for the malware to work effectively, its absence means that the malware is not yet present.

Once the directory is created, the program changes the owner group ID to **920366**.

```
main() - Creation of the directory
if (stat("/lib/libntpVnQE6mk", ...) {
   puts("new hdd");-u  system("mkdir /lib/libntpVnQE6mk");
   chown("/lib/libntpVnQE6mk", 0, 920366);
   backup_ld();
}
```

This identifier is very unlikely to belong to a group already present on the system and is used by the malware to differentiate malicious directories, files and processes from normal ones.

![](https://www.stormshield.com/wp-content/uploads/orbit-capture-1.png "OrBit - capture 1")

#### Backup of the linker

The program then calls the **`backup_ld`** function, as its name suggests, this function makes a backup of the dynamic linker present on the machine.

```
backup_ld() - Linker backup
readlink("/lib64/ld-linux-x86-64.so.2", dest);
/* ... */
sprintf(src, "cp %s /lib/libntpVnQE6mk/.backup_ld.so", dest);
return (system(src));
```

On a 64-bit Linux system, the symbolic link*`/lib64/ld-linux-x86-64.so.2`* points to the dynamic linker binary.

The malware obtains the path to the linker through this symbolic link and copies it to the location *`/lib/libntpVnQE6mk/.backup_ld.so`.*

![](https://www.stormshield.com/wp-content/uploads/orbit-capture-2.png "OrBit - capture 2")

### Creation of the malicious dynamic library

The malware then introduces a malicious shared library with the **`load_ld`** function which takes as parameter the destination path of this library.
A check is performed on the version of the linker, it has a name like `ld-${LIBC_VERSION}.so`, which means that each libc version brings a new linker.

If the version is lower than 2.4 (before September 2006), then the check fails unless you use the ***`-O`***  option on the command line`.`

The path passed in parameter is then created.

```
load_ld() - Check of the linker version
stream = popen("ls -l /lib64/ld-linux-x86-64.so.2", "r");
fread(buffer, 1, 255, stream);
/* ... */
ld_version = strstr(buffer, "ld-2.");
if (ld_version) {
    if (ld_version[5] <= '4' && ld_version[6] == '.') {
        printf("ld error: %s\n", buffer);
        return override_version != 0;
    } else {
        return (1):
    }
} else {
    printf("ld: %s\n", buffer);
    return (0);
}
```

Two symbols are then used to fill the file:

* **`rkld_so`** whose first 4 bytes (`7F 45 4C 46`) are the signature of an executable binary under Linux: this is where the malicious library of the malware is located.
* **`rkld_so_len`** which contains the size of the malicious library.

```
load_ld() - Creation of the malicious library
unlink(a1);
fd = open(...);
write(fd, &rkld_so, rkld_so_len);
fchown(fd, 0, 920366);
close(fd);
return (build_root());
```

Being one of the files associated with the malware, it is assigned the group ID **920366**.

![](https://www.stormshield.com/wp-content/uploads/orbit-capture-3.png "OrBit - capture 3")

### Creation of utility files

Once the library is on the system, the malware will build a directory and file tree that will be useful when the malicious library is used.

The two files placed in *`/lib/libntpVnQE6mk/bin`* stand out:

* `python` which is the copy of the python interpreter bcy adding a SUID bit to it.
* A python script stored in base64 in the binary that is used to elevate the privileges of a user.

Finally, the `.l` is added and the malicious library path is written to it (*`/lib/libntpVnQE6mk/libdl.so`*).

![](https://www.stormshield.com/wp-content/uploads/orbit-capture-4.png "OrBit - capture 4")

### Linker modification and replacement

The last function called to finish the installation of the malware is **`patch_ld`**  which will allow the malicious library to be used instead of the classic libraries.

In the same way as for the backup seen previously, the program, thanks to the symbolic link *`/lib64/ld-linux-x86-64.so.2`*, then copies the original linker to *`/lib/lib0UZ0LfvWZ.so`.*

This file is then opened and mapped in memory to search for the string *`/etc/ld.so.preload`* and replace it by *`/lib/libntpVnQE6mk/.l`*  (see precision part).

The program then changes the location of the copy of the linker to that of the original linker, so that every time the program is run, the modified copy of the linker is used.

![](https://www.stormshield.com/wp-content/uploads/orbit-capture-5.png "OrBit - capture 5")

## Volatile installation

### Entry point of the malware

Using ***sh*** eon the command line, the program will install the shared library in the *`/dev/shm/ldx`* directory.

This directory is not really a directory, it is a tree representation of the shared memory system(**SH**ared **M**emory) which is a way to communicate between different processes (e.g. during a fork).

The data present is erased as soon as the user disconnects from the machine.

### Installation function

The **`rkload_shm`**  function is then called, which performs all the necessary steps to deploy the malware.

The temporary installation is very similar to the persistent installation:

* The creation of the *`/dev/shm/ldx`*  directory avec 920366 as the group ID
* The creation a backup of the linker  (*`/dev/shm/ldx/.backdup_ld.so`*)
* The modification o...