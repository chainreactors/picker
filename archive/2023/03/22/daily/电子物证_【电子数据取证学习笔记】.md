---
title: 【电子数据取证学习笔记】
url: https://mp.weixin.qq.com/s?__biz=MzAwNDcwMDgzMA==&mid=2651045178&idx=2&sn=c1b7b16bd95c4c4d27be9ee410f47a01&chksm=80d0f2cbb7a77bdd5f84b101a47b7becba970270d3d2f7516516081c5eb151a6f9358dbccb4d&scene=58&subscene=0#rd
source: 电子物证
date: 2023-03-22
fetch_date: 2025-10-04T10:17:21.339306
---

# 【电子数据取证学习笔记】

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/dDhDhftpRFtJvUpAiao3gFymboxJqeicQV8xalrFXajF6FWIF06hX2NKOwVGjvlZdXaUsCHqjB6elfEj527HgSaA/0?wx_fmt=jpeg)

# 【电子数据取证学习笔记】

电子物证

以下文章来源于Tide安全团队
，作者Decease

![](http://wx.qlogo.cn/mmhead/Q3auHgzwzM7f2r4cHKV0tKOK4v87qvAYZazjibgqC5HkYyaQeibGau4g/0)

**Tide安全团队**
.

Tide安全团队以信安技术研究为目标，致力于分享高质量原创文章、开源安全工具、交流安全技术，研究方向覆盖网络攻防、Web安全、移动终端、安全开发、物联网/工控安全/AI安全等多个领域，对安全感兴趣的小伙伴可以关注我们。

# 1、电子数据取证架构

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RWlI67T7GLMsBp0NRUjcaTYEeDicNWGJnYQa4dic0rXfBqKibUNhZmONR9Xic9ULbvbEzI8Ug2RYNShBQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "null")

# 2、电子数据取证与应急响应的区别

## 2.1 实施主体不同

电子取证的主体一般为执法部门和内部安全审计人员，应急响应的主体一般为负责网络安全的政府组织、安全厂商、系统维护人员。

## 2.2 过程不同

电子数据取证是案件发生后采取措施的过程，应急响应贯穿到事先预防、集中处理和事后弥补整个过程。

## 2.3 目标不同

电子数据取证是为了获得违法犯罪的证据，目的是形成证据链，应急响应的目标是为了恢复整个系统的正常。

# 3、存储器指标

## 3.1 存储器容量

存储容量是存储介质中可以容纳二进制信息的总量，即存储容量=存储单元数✖️存储字长。存储容量越大存储的信息就越多。存储容量通常用位(bit)或字节(Byte)来表示，一般一个字节定义为8个二进制位，因此计算机中一个字的字长通常是8的整数倍。

## 3.2 数据传输率

数据传输率是指单位时间内存储器所存取的信息量，度量单位通常为位(bit)/秒或字节(Byte)/秒，是衡量电子数据取证效率的重要技术指标。速率越高，意味着单位时间镜像或分析的数据越多。

## 3.3 数据接口

电子数据取证人员在工作中可能会见到各种外部存储介质接口。接口上的标识主要有IDE、ATA、Ultra
ATA/33、Ultra ATA/66、Ultra ATA/100、Ultra ATA/133、Ultra DMA/33、Ultra
DMA/66、Ultra DMA/100、Ultra DMA/133、Serial ATA、SCSI、SCSI II、Wide SCSI
II、Ultra SCSI II、Ultra Wide SCSI II、Ultra2 SCSI、Ultra160 SCSI、Ultra320
SCSI。
接口按照物理接口种类区别，常见只有九类：SATA、SAS、IDE、SCSI、光纤通道、ZIF、LIF、IEEE 1394和USB。
从控制指令区分，存储介质可以归纳为两大类，即ATA类与SCSI类。SATA、IDE、ZIF、LIF使用的是ATA指令，除了SATA使用串行方式传输数据，其他的都以并行方式传输数据，又称为PATA类；SCSI、SAS和光纤通道使用SCSI指令。

# 4、扩展分区结构

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RWlI67T7GLMsBp0NRUjcaTYFP6WChGJ7LruaZhYS8kaBFnKg0GOqnj9ewN6rK1GDUf7SQSU7tZZbQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "null")

# 5、逻辑数据恢复原理

高级格式化仅更新文件分配表，数据区并未被擦除，只有数据擦除或低级格式化，才能破坏系统区域和数据区域的数据。
数据区域的数据通常通过两种方式恢复：
一种是按照文件系统的存储原理，重建MBR、DBR、FAT、FDT，根据存储介质内的数据信息来确定记录文件或目录存储位置的FAT或MFT中的值，从而找回丢失的数据；
另一种是根据文件签名特征中文件头和文件尾特征值进行检索，通过文件签名特征恢复技术直接从数据区域的数据中找回丢失的特定格式的文件。

## 5.1 文件系统恢复原理

### （1）FAT文件系统

在Windows系统中，删除文件或文件夹一般分为普通删除和彻底删除。
普通删除：将文件或文件夹移入回收站(RECYCLER)，回收站是Windows系统自动建立在每个硬盘分区根目录下的隐藏文件夹。
FAT文件系统删除一个文件或文件夹需要经过以下过程：

* • 将文件或文件夹所对应目录项的第一个字节被标记为“已删除对象”，该目录项将不再显示给用户
* • 更新FAT，FAT表中所记录的分配给该文件或文件夹的所有簇的状态值全部改变为“未分配簇”（Unallocated）

通过这一过程，DATA区中该文件或文件夹的实际数据并未发生改变，仍然保留在原来的簇中。
文件删除前后文件数据区域对比。
“fat-test.txt”文件被删除后，文件目录项头字节被修改为删除标记“E5”，表示该文件已被删除，FAT表中该文件占用的簇被标记为“0”，表示该簇未分配使用，但是文件的数据区域并没有发生任何变化。带有删除标记的文件，操作系统会认为已被删除，在操作系统下不借助专门程序或软件无法看到，直到这些簇被新的文件或文件夹占用，当再次往硬盘中写入数据文件时，系统才会覆盖这些被标为已删除的文件所占用的簇，写入新的数据从而覆盖原文件内容。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RWlI67T7GLMsBp0NRUjcaTY1ClUibhI7tMM3iaJnarvp043qg7SiaZYf7KAT4JAjHZspsQxbZucTsR0w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "null")![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RWlI67T7GLMsBp0NRUjcaTYicAia4Uia4ic7jzcz7QTDVzkKNibVnNOcdhrLTdXQzOHaJ76bZ2csWoXnbQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "null")

### （2）NTFS文件系统

删除文件或文件夹时，主文件表MFT中会更新对象对应的记录，将其状态标记为可重新使用，然后在位图文件（$Bitmap）中将对象所占用的簇标记为未分配状态，即可被重新使用。与FAT文件系统相同，只要原文件数据所在的簇未被分配给新的文件，对象实际数据就仍可被恢复，知道这些簇被新的文件或文件夹占用。

偏移量00H～37H为$MFT属性头，38H～4FH为MFT的10属性头，98H～AFH为MFT的30属性头，188H～19FH为MFT的40属性头，1B0H～1C7H为MFT的80属性头。
“delete-test.txt”文件被删除后，$MFT属性头的4处数据发生了变化，偏移08H～0FH处由“6F
0D E0 00 00 00 00 00”修改为“A8 08 00 01 00 00 00
00”，这8个字节是日志文件的序列号，每当文件被修改时，都会在$LogFile日志文件中生成相应记录，从而引起日志文件序列号发生变化。
偏移10H～11H处由“01 00”被修改为“02 00”，这2个字节是序列号，记录主文件记录表被重复使用的次数，由于文件被删除，主文件记录表被修改，因此序列号增加1。
偏移16H～17H处由“01 00”被修改为“00 00”，这2个字节是主文件记录表使用标志，“00 00”表示文件被删除。
偏移30H～31H处由“08
00”被修改为“09
00”，这2个字节是主文件记录表的更新序列号，这2个字节同时会出现在该文件记录第一个扇区和第二个扇区最后2个字节处，但$MTF项的10H、30H、40H、80H属性数据均未发生改变。其中80H属性即$DATA属性，容纳着文件的内容，从图中可以看出，该80H属性为常驻属性，属性头后面紧跟的是文件的内容，文件数据内容部分也没有发生该改变，常驻80H属性以“00H”结束，由于文件属性长度是8的整数倍，如果文件内容结束不能达到8的整数倍时，就用“00H”来填充。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RWlI67T7GLMsBp0NRUjcaTYhxyfYNsRLHCygXFCticgIKA54V9aGGd3Bge3gx1UoKK6bzXBuOD06Mw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "null")![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RWlI67T7GLMsBp0NRUjcaTY8RDWWbibC1X2ibOabkeiaKUykhQPSDH4slGbQE4tPNHfBzDcn17icITWfA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "null")

### （3）exFAT文件系统

exFAT文件删除文件或目录时，文件的每个目录项的首字节被更改，该文件在簇位图文件中对应的位和FAT表中的簇链均被清零，用以表示原文件占用的簇已被释放，但是文件目录项中文件的起始簇号、大小、文件名等信息以及文件所占用的数据区不会被修改和删除。

### （4）HFS+文件系统

HFS+文件系统删除文件时，其文件记录完全丢失，文件记录中存放的该文件的文件名、CNID、父目录
ID、时间信息和盘区地址等指向数据存放地址的指针信息全都丢失，但是数据内容并不好被清除，因此对于HFS+文件系统进行恢复时，主要通过文件类型签名进行恢复，HFS+文件系统采用盘区存放数据，数据的连续性比较好，为数据的成功恢复带来了机会。

### （5）Ext3

Ext3文件系统删除文件后，被删除文件的目录项的长度值会被添加到上一个目录项的报告长度中，从而回收被删除文件目录项所占用的空间，使系统忽略对被删除文件目录项的读取，但是，被删除目录项中的i-节点号、文件名等信息都没有被改变。被删除的上级目录的i-节点变化时间和修改时间(Modified
Time)都会发生相应改变。被删除文件的i-节点的“链接数”将减1，如果链接数成为0，那么就要回收这个i-节点，i-节点中的文件大小和文件的块指针也全部清零，并将文件删除的时间记录下来。被删除文件的i-节点位图中的相应位设置为0以回收该i-节点，然后更新块组描述符和超级块中的空闲i-节点数。同时，被删除文件所占用的块也会通过将块位图中的相应位设置为0来进行回收，并更新块组描述符和超级块中的空闲块数。
从Ext3文件系统删除文件的过程可以看出，被删除文件的目录项中的文件名和i-节点号还存在，通过这些信息可以找到文件的i-节点，但是i-节点中的文件大小和块指针都被清零，虽然数据块没有被清零，但要找到文件的存储位置很难，因此，Ext3文件系统下删除文件的恢复可以考虑按照文件类型签名进行恢复，但是如果文件占用的块比较多，文件不连续存储的可能性较大，文件恢复难度也会增加。

# 6、文件数据恢复原理

## 6.1 逻辑数据恢复原理

文件签名特征恢复是数据恢复中较为常用的文件恢复方法。基于文件签名特征的数据恢复中，采用文件签名特征与全盘深度扫描结合的方法，根据不同类型文件签名以扇区为单位在硬盘中检索，首先在每个扇区中搜索去陪文件的头部特征，发现与头部匹配的扇区，确定文件的开始位置，然后再以扇区为单位扫描并根据文件的尾部特征来确定文件在硬盘中的结束位置，并将文件头和文件尾之间的数据保存成文件。
特点：扫描完全，只要数据区中存在特征文件，就会被检索出来。
例：word文档(97-2003)
word文档在硬盘中的实际构成总是以“D0CF11E0A1B11AE10000000000000000”为文件头部特征的，如下图。扫描到文件头之后，继续按扇区查找其文件脚，发现它的二进制表示的文件脚。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RWlI67T7GLMsBp0NRUjcaTYNo78L3VOEYdgVmPicU2oyhGXOTMFnjVr4JjcicUsC0C1h4oM47An4iaHA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "null")

这样恢复的文件由于没有先前的目录信息，因此不能恢复出文件名，但是只要数据没被覆盖，就可以对文件进行完全恢复。

影响基于文件特征数据恢复方法的效果主要有两个方面：

* • 一是文件是否为连续存储，即是否存在碎片；
* • 二是文件中数据是否被覆盖（部分覆盖）。

这两种情况下恢复出来的数据可能无法打开或者只显示部分数据。

# 7、物理修复原理

## 7.1 固件修复

固件修复属于底层的数据恢复技术，是电子数据取证领域的重要一环，在电子数据存储介质出现大量物理或逻辑坏道、固件损坏（无法识别硬盘或出现全盘坏道）、因物理损坏导致固件受损等情况中，需先对固件进行修复，然后才能进行逻辑层面的数据恢复。

### 固件的概念

固件是固化在硬件中的软件，存储着计算机系统中硬件设备最基本的参数，为系统提供最底层、最直接的硬件控制。
固件存放位置一般有两种形式：

* • 一种是一部分固件数据保存在硬盘电路板的芯片中，另一部分保存在硬盘盘片的副磁道上，即0磁道前面的磁道
* • 另一种是所有的固件数据全部保存在硬盘的副磁道上。

  ### 固件的结构

  大部分硬盘固件有两个工作区，即主固件和次固件区，有些硬盘则有三个，多一个备份固件区。
* • 固件管理模块：由初始诊断模块、伺服电机旋转控制模块、磁头定位模块、硬盘控制器和缓冲存储器的信息交换模块等构成。管理模块出现损坏，一般会造成硬盘不能准备就绪或者硬盘的型号、容量等相关参数不能被正确识别等故障。
* • 配置和设置表：包含关于硬盘空间的逻辑和物理信息。如果配置和设置表出现故障，硬盘的型号、最大LBA值、物理磁头的定位、Zone分配表等相关参数将不能被正确识别。
* • 缺陷列表：厂家会通过缺陷列表的方式将缺陷扇区进行记录，从而使用户不能发现和使用到缺陷扇区。一般缺陷列表包括P-list、G-list、U表和道表四种。P-list又称为永久缺陷列表，厂家在硬盘出场前会对其进行全面校准，将校准过程中找到的缺陷磁道和扇区记录在P-list中，并且对所有磁道和扇区编号过程中，跳过这些缺陷扇区。G-list又称为增长缺陷列表，硬盘在使用中如果出现了新的缺陷扇区，硬盘会通过自动修复机制，使用保留扇区中的一个备用扇区来替换该缺憾扇区，并将新发现的缺陷扇区记录到G-list中。保留扇区在硬盘内磁道，缺陷扇区加入G-list后会影响读写速度。U表即固件区缺陷列表，用于记录硬盘固件区产生的缺陷，该表主要存在于迈拓和西部数据两个品牌的硬盘。道表就是压缩后的P表，由于固件区存储空间有限，当向其中加入的缺陷信息达到一定程度时，无法继续写入，这是就可将P-list进行压缩，以增加P-list容量。
* • 固件区还有硬盘工作记录表，包括硬盘生产和运行过程中的辅助信息，如检测结果、检测程序动作记录等。

## 7.2 硬盘物理故障修复

硬盘是机、电、磁一体化的复杂系统，硬盘物理故障主要包括电路板故障、磁头组件故障、主轴电机故障、盘片故障等方面。
对于硬盘电路板供电、接口、缓存、BIOS、电机驱动芯片等出现故障时，既可以通过维修或更换受损电阻、电容、场效应管等元器件修复故障硬盘的电路板，也可以使用相同型号硬盘的电路板替换故障硬盘的电路板，从而使硬盘恢复正常工作。
对于硬盘磁头芯片、前置信号处理器、音圈电机、磁头等磁头组件出现故障时，由于磁头组件精密度高、维修成本高，因此一般是使用相同型号的硬盘的磁头组件替换故障硬盘的磁头组件，从而将故障硬盘上的数据读取出来。
对于硬盘主轴电机故障，由于多数硬盘的主轴电机是铆在硬盘盘体上，不能拆解，因此一般是通过把故障硬盘盘片取下放到相同型号的备件盘盘体内的方法，使用备件盘将故障盘盘片上的数据读取出来。
对于硬盘盘片出现坏扇区时，一般通过替换G-list或者隐藏P-list等方法进行修复，而如果硬盘盘片出现划伤，盘片上的数据基本就无法恢复了。

## 7.3 芯片存储物理故障修复

芯片级存储设备具有数据动态性、系统封闭性、存储方式多样性等特点。
芯片存储设备（U盘、存储卡、固态硬盘等）出现物理故障一般表现为没有任何反应、无法识别的设备、无容量、无媒体、无法格式化等情况，故障原因一般为接口故障、供电故障、晶振故障、主控芯片故障、闪存芯片故障或其他元器件烧毁。
对于U盘的故障，一般可以通过焊脚补焊、替换相同频率晶振、替换相同型号主控芯片等方法进行修复。如果U盘电路板上的元器件损坏比较严重，较难修复，可以将其闪存芯片吹焊下来，再吹焊到相同型号的备件U盘电路板上，使U盘能够正常工作。
除此之外，还可以利用由软件和硬件相结合来实现一个U盘控制器的仿真器，通过译码器运算将闪存芯片的内容解码，即可实现正确读取闪存芯片内数据的目的。

# 8、数据分析

## 8.1 时间的基本知识

计算机中，确认时间时，通常包含两部分：日期和时间，而且这两者始终是保存在一起的。

### 1、时间概念

* • GMT（格林威治平均时）时间：平太阳时就是指经修订后的视太阳时。在本初子午线（英国格林威治子午线）上的平太阳时被确定为格林威治平时（GMT）
* • UTC是协调世界时英文缩写，由于地球每天的自转是有些不规则的，而且正在缓慢减速。UTC相当于本初子午线（即经度0度）上的平均太阳时，UTC的本质强调的是比GMT更为精确的世界时间标准，不过对于大部分应用来说，GMT与UTC的功能与精确度是没有区别的。
* • 国际原子时（TAI）：国际计量局（BIPM）根据世界20多个国家的实验室的100多台原子钟提供的数据进行处理，得出“国际时间标准”称为国际原子时（TAI）。国际原子时（TAI）的准确度为每日数纳秒，而协调世界时（UTC）的准确度为每日数毫秒。计算机中，一般不用国际原子时（TAI）表示时间，多采用GMT和UTC时间基准。国际原子时（TAI）仅在网络校时中起到一定作用。
* • 时区
* • 夏时制（简称D.S.T）：是指夏天太阳升起的比较早时，将时钟拨快一小时，以提早日光的使用，在英国则称为夏...