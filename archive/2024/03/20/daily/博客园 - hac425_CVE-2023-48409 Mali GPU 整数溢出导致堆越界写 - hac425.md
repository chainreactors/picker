---
title: CVE-2023-48409 Mali GPU 整数溢出导致堆越界写 - hac425
url: https://www.cnblogs.com/hac425/p/18082284/cve202348409-mali-gpu-integer-overflow-leads-to-the-bidding-crossborder-writing-1bccrr
source: 博客园 - hac425
date: 2024-03-20
fetch_date: 2025-10-04T12:12:11.953480
---

# CVE-2023-48409 Mali GPU 整数溢出导致堆越界写 - hac425

[![](https://img2024.cnblogs.com/blog/35695/202509/35695-20250929100304557-587378723.jpg)](https://qoder.com/)

* [![博客园logo](//assets.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园")
* [会员](https://cnblogs.vip/)
* [众包](https://www.cnblogs.com/cmt/p/18500368)
* [新闻](https://news.cnblogs.com/)
* [博问](https://q.cnblogs.com/)
* [闪存](https://ing.cnblogs.com/)
* [赞助商](https://www.cnblogs.com/cmt/p/19081960)
* [HarmonyOS](https://harmonyos.cnblogs.com/)
* [Chat2DB](https://chat2db-ai.com/)

* ![搜索](//assets.cnblogs.com/icons/search.svg)
  ![搜索](//assets.cnblogs.com/icons/enter.svg)
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    所有博客
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    当前博客
* [![写随笔](//assets.cnblogs.com/icons/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔")
  [![我的博客](//assets.cnblogs.com/icons/myblog.svg)](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客")
  [![短消息](//assets.cnblogs.com/icons/message.svg)](https://msg.cnblogs.com/ "短消息")
  ![简洁模式](//assets.cnblogs.com/icons/lite-mode-on.svg)

  [![用户头像](//assets.cnblogs.com/icons/avatar-default.svg)](https://home.cnblogs.com/)

  [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx)
  [我的园子](https://home.cnblogs.com/)
  [账号设置](https://account.cnblogs.com/settings/account)
  [会员中心](https://vip.cnblogs.com/my)
  简洁模式 ...
  退出登录

  [注册](https://account.cnblogs.com/signup)
  登录

[![返回主页](/skins/custom/images/logo.gif)](https://www.cnblogs.com/hac425/)

# [hac425](https://www.cnblogs.com/hac425)

## 博客迁移自 blog.hac425.top， 部分博文由于新浪图床的限制无法显示图片。pdf 版本：https://gitee.com/hac425/data/tree/master/blog\_pdf

* [首页](https://www.cnblogs.com/hac425/)
* [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
* [联系](https://msg.cnblogs.com/send/hac425)
* 订阅
* [管理](https://i.cnblogs.com/)

# [CVE-2023-48409 Mali GPU 整数溢出导致堆越界写](https://www.cnblogs.com/hac425/p/18082284/cve202348409-mali-gpu-integer-overflow-leads-to-the-bidding-crossborder-writing-1bccrr "发布于 2024-03-19 10:55")

# CVE-2023-48409 Mali GPU 整数溢出导致堆越界写

* <https://github.com/0x36/Pixel_GPU_Exploit>

漏洞原语：假设分配的大小为 `0x3004`​， 会执行 copy\_from\_user(ptr-0x4000, from, 0x7004)，导致越界写

由于 [CONFIG\_HARDENED\_USERCOPY](https://lwn.net/Articles/693745/) 如果 to 是 slab 中的地址，copy\_from\_user 会确保拷贝时不会跨越 slab 中的对象

```
static inline __must_check unsigned long
_copy_from_user(void *to, const void __user *from, unsigned long n)
{
	unsigned long res = n;
	might_fault();
	if (!should_fail_usercopy() && likely(access_ok(from, n))) {
		instrument_copy_from_user(to, from, n);
		res = raw_copy_from_user(to, from, n);
	}
	if (unlikely(res))
		memset(to + (n - res), 0, res);
	return res;
}
```

利用思路：分配大内存让 kmalloc 从 页分配器中申请内存，绕过 [CONFIG\_HARDENED\_USERCOPY](https://lwn.net/Articles/693745/)

漏洞对象：pipe\_buffer

```
struct pipe_buffer {
	struct page *page;
	unsigned int offset, len;
	const struct pipe_buf_operations *ops;
	unsigned int flags;
	unsigned long private;
};
```

控制 page 指针做任意物理内存读写，而且 pixel 上 virt2page 直接可以写死，不像 x86 vmemap\_base 是随机的（可能和物理地址随机化有关）

```
__u64 __virt_to_page(__u64 addr)
{
        return ((((__u64)(((signed long long)((__u64)(addr) << 8) >> 8) + \
                          0x8000000000LL) >> 6) & 0x3FFFFFFFFFFFFC0LL) + \
                0xFFFFFFFEFFE00000);
}
```

伪造思路：使用 CVE-2023-26083 泄露堆地址 `kbase_kcpu_command_queue`​ ，然后伪造结构体

```
struct pipe_buffer {
	.page = virt_to_page(addr),
	.offset =  0,
	.len = 0x40,
	.ops = kcpu_addr + 0x50,  // 伪造空的 ops
	.flags = PIPE_BUF_FLAG_CAN_MERGE,
	unsigned long private = 0
};
```

然后释放 `kbase_kcpu_command_queue`​ 用 pipe\_buffer 占位，就能够用 pipe\_buffer 修改另一个 pipe\_buffer.

‍

‍

‍

posted @
2024-03-19 10:55
[hac425](https://www.cnblogs.com/hac425)
阅读(300)
评论(0)

收藏
举报

刷新页面[返回顶部](#top)

[![](https://img2024.cnblogs.com/blog/35695/202508/35695-20250830121216742-1062949948.jpg)](https://developer.huawei.com/consumer/cn/activity/digixActivity/digixcmsdetail/101750143863263087?ha_source=BKYQ3&ha_sourceId=89000408)

### 公告

[![](https://img2024.cnblogs.com/blog/35695/202509/35695-20250923174722171-270282128.jpg)](https://qoder.com/)

[博客园](https://www.cnblogs.com/)
  ©  2004-2025

[![](//assets.cnblogs.com/images/ghs.png)浙公网安备 33010602011771号](http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602011771)
[浙ICP备2021040463号-3](https://beian.miit.gov.cn)