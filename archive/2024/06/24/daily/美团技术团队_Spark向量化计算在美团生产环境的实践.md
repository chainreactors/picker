---
title: Spark向量化计算在美团生产环境的实践
url: https://tech.meituan.com/2024/06/23/spark-gluten-velox.html
source: 美团技术团队
date: 2024-06-24
fetch_date: 2025-10-06T16:55:34.627444
---

# Spark向量化计算在美团生产环境的实践

[莽戮聨氓聸垄忙聤聙忙聹炉氓聸垄茅聵聼](https://tech.meituan.com/ "莽戮聨氓聸垄忙聤聙忙聹炉氓聸垄茅聵聼")

* [忙聹聙忙聳掳忙聳聡莽芦聽](https://tech.meituan.com/ "忙聼楼莽聹聥忙聹聙忙聳掳忙聳聡莽芦聽")
* [忙聳聡莽芦聽氓颅聵忙隆拢](/archives "忙聼楼莽聹聥忙聳聡莽芦聽氓颅聵忙隆拢氓聠聟氓庐鹿")
* [忙聤聙忙聹炉忙虏聶茅戮聶](/tech-salon "盲潞聠猫搂拢忙聤聙忙聹炉忙虏聶茅戮聶")
* [氓聟鲁盲潞聨忙聢聭盲禄卢](/about "盲潞聠猫搂拢忙聸麓氓陇職氓聟鲁盲潞聨忙聢聭盲禄卢莽職聞盲潞聥忙聝聟")

脗漏 2023 莽戮聨氓聸垄忙聤聙忙聹炉氓聸垄茅聵聼

All rights reserved.

# [Spark氓聬聭茅聡聫氓聦聳猫庐隆莽庐聴氓聹篓莽戮聨氓聸垄莽聰聼盲潞搂莽聨炉氓垄聝莽職聞氓庐聻猫路碌](https://tech.meituan.com/2024/06/23/spark-gluten-velox.html)

2024氓鹿麓06忙聹聢23忙聴楼
盲陆聹猫聙聟: luhao 氓路娄氓聠聸 lux莽颅聣
[忙聳聡莽芦聽茅聯戮忙聨楼](https://tech.meituan.com/2024/06/23/spark-gluten-velox.html)
10242氓颅聴
21氓聢聠茅聮聼茅聵聟猫炉禄

## 1 盲禄聙盲鹿聢忙聵炉氓聬聭茅聡聫氓聦聳猫庐隆莽庐聴

### 1.1 氓鹿露猫隆聦忙聲掳忙聧庐氓陇聞莽聬聠茂录職SIMD忙聦聡盲禄陇

猫庐漏忙聢聭盲禄卢盲禄聨盲赂聙盲赂陋莽庐聙氓聧聲茅聴庐茅垄聵氓录聙氓搂聥茂录職氓聛聡猫庐戮猫娄聛氓庐聻莽聨掳芒聙聹忙聲掳莽禄聞a+b氓颅聵氓聟楼c芒聙聺茂录聦猫庐戮盲赂聣盲赂陋忙聲麓氓聻聥忙聲掳莽禄聞莽職聞茅聲驴氓潞娄茅聝陆忙聵炉100茂录聦茅聜拢盲鹿聢氓聫陋茅聹聙氓掳聠芒聙聹c[i] = a[i] + b[i]芒聙聺莽陆庐盲潞聨盲赂聙盲赂陋100忙卢隆莽職聞氓戮陋莽聨炉氓聠聟茂录聦盲禄拢莽聽聛氓娄聜盲赂聥茂录職

```
void addArrays(const int* a, const int* b, int* c, int num) {
  for (int i = 0; i < num; ++i) {
    c[i] = a[i] + b[i];
  }
}
```

忙聢聭盲禄卢莽聼楼茅聛聯茂录職**猫庐隆莽庐聴氓聹篓CPU氓聠聟氓庐聦忙聢聬茂录聦茅聙禄猫戮聭猫庐隆莽庐聴氓聧聲氓聟聝忙聯聧盲陆聹氓炉聞氓颅聵氓聶篓盲赂颅莽職聞忙聲掳忙聧庐茂录聦莽庐聴忙聹炉猫驴聬莽庐聴莽職聞忙潞聬忙聯聧盲陆聹忙聲掳猫娄聛氓聟聢忙聰戮莽陆庐氓聢掳CPU莽職聞氓炉聞氓颅聵氓聶篓盲赂颅茂录聦氓聯陋忙聙聲莽庐聙氓聧聲莽職聞氓聠聟氓颅聵忙聥路猫麓聺盲鹿聼茅聹聙猫娄聛猫驴聡CPU氓炉聞氓颅聵氓聶篓**茫聙聜忙聣聙盲禄楼茂录聦氓庐聦忙聢聬芒聙聹c[i] = a[i] + b[i]芒聙聺茅聹聙莽禄聫盲赂聣忙颅楼茂录職

1. 氓聤聽猫陆陆茂录聢Load茂录聣茂录聦盲禄聨氓聠聟氓颅聵氓聤聽猫陆陆2盲赂陋忙潞聬忙聯聧盲陆聹忙聲掳茂录聢a[i]氓聮聦b[i]茂录聣氓聢掳2盲赂陋氓炉聞氓颅聵氓聶篓茫聙聜
2. 猫庐隆莽庐聴茂录聢Compute茂录聣茂录聦忙聣搂猫隆聦氓聤聽忙鲁聲忙聦聡盲禄陇茂录聦盲陆聹莽聰篓盲潞聨2盲赂陋氓炉聞氓颅聵氓聶篓茅聡聦莽職聞忙潞聬忙聯聧盲陆聹忙聲掳氓聣炉忙聹卢茂录聦莽禄聯忙聻聹盲潞搂莽聰聼氓聢掳莽聸庐忙聽聡氓炉聞氓颅聵氓聶篓茫聙聜
3. 氓颅聵氓聜篓茂录聢Store茂录聣茂录聦氓掳聠莽聸庐忙聽聡氓炉聞氓颅聵氓聶篓莽職聞忙聲掳忙聧庐氓颅聵氓聟楼茂录聢忙聥路猫麓聺茂录聣氓聢掳莽聸庐忙聽聡氓聠聟氓颅聵盲陆聧莽陆庐茂录聢c[i]茂录聣茫聙聜

氓聟露盲赂颅茂录聦氓聤聽猫陆陆氓聮聦氓颅聵氓聜篓氓炉鹿氓潞聰猫庐驴氓颅聵忙聦聡盲禄陇茂录聢Memory Instruction茂录聣茂录聦猫庐隆莽庐聴忙聵炉莽庐聴忙聹炉氓聤聽忙聦聡盲禄陇茂录聦氓戮陋莽聨炉忙聣搂猫隆聦100忙卢隆盲赂聤猫驴掳盲赂聣忙颅楼茅陋陇茂录聦氓掳卤氓庐聦忙聢聬盲潞聠芒聙聹忙聲掳莽禄聞a + 忙聲掳莽禄聞b => 忙聲掳莽禄聞c芒聙聺茫聙聜猫炉楼忙碌聛莽篓聥氓聧鲁氓炉鹿氓潞聰盲录聽莽禄聼莽職聞猫庐隆莽庐聴忙聻露忙聻聞茂录職氓聧聲忙聦聡盲禄陇氓聧聲忙聲掳忙聧庐茂录聢SISD茂录聣茅隆潞氓潞聫忙聻露忙聻聞茂录聦盲禄禄忙聞聫忙聴露茅聴麓莽聜鹿氓聫陋忙聹聣盲赂聙忙聺隆忙聦聡盲禄陇盲陆聹莽聰篓盲潞聨盲赂聙忙聺隆忙聲掳忙聧庐忙碌聛茫聙聜氓娄聜忙聻聹忙聹聣忙聸麓氓庐陆莽職聞氓炉聞氓颅聵氓聶篓茂录聢猫露聟忙聹潞氓聶篓氓颅聴茅聲驴茂录聦忙炉聰氓娄聜256盲陆聧16氓颅聴猫聤聜茂录聣茂录聦盲赂聙忙卢隆忙聙搂盲禄聨忙潞聬氓聠聟氓颅聵氓聬聦忙聴露氓聤聽猫陆陆忙聸麓氓陇職莽職聞忙聲掳忙聧庐氓聢掳氓炉聞氓颅聵氓聶篓茂录聦盲赂聙忙聺隆忙聦聡盲禄陇盲陆聹莽聰篓盲潞聨氓炉聞氓颅聵氓聶篓x氓聮聦y茂录聦氓聹篓x氓聮聦y莽職聞忙炉聫盲赂陋氓聢聠茅聡聫茂录聢忙炉聰氓娄聜32盲陆聧4氓颅聴猫聤聜茂录聣盲赂聤氓鹿露猫隆聦猫驴聸猫隆聦氓聤聽茂录聦氓鹿露氓掳聠莽禄聯忙聻聹氓颅聵氓聟楼氓炉聞氓颅聵氓聶篓z莽職聞氓聬聞氓炉鹿氓潞聰氓聢聠茅聡聫茂录聦忙聹聙氓聬聨盲赂聙忙卢隆忙聙搂氓掳聠氓炉聞氓颅聵氓聶篓z茅聡聦莽職聞氓聠聟氓庐鹿氓颅聵氓聟楼莽聸庐忙聽聡氓聠聟氓颅聵茂录聦茅聜拢盲鹿聢氓掳卤猫聝陆氓庐聻莽聨掳氓聧聲忙聦聡盲禄陇氓鹿露猫隆聦氓陇聞莽聬聠忙聲掳忙聧庐莽職聞忙聲聢忙聻聹茂录聦猫驴聶氓掳卤忙聵炉氓聧聲忙聦聡盲禄陇氓陇職忙聲掳忙聧庐茂录聢SIMD茂录聣茫聙聜

![氓聸戮1茂录職氓聬聭茅聡聫氓聦聳猫庐隆莽庐聴芒聙聹忙聲掳莽禄聞a+b氓颅聵氓聟楼c芒聙聺](https://p0.meituan.net/travelcube/28cc423ccab290d315c483bf6461b939110800.png)

氓聧聲忙聦聡盲禄陇氓陇職忙聲掳忙聧庐氓炉鹿氓潞聰盲赂聙莽卤禄氓鹿露猫隆聦忙聻露忙聻聞茂录聢莽聨掳盲禄拢CPU盲赂聙猫聢卢茅聝陆忙聰炉忙聦聛SIMD忙聣搂猫隆聦茂录聣茂录聦氓聧聲忙聺隆忙聦聡盲禄陇氓聬聦忙聴露盲陆聹莽聰篓盲潞聨氓陇職忙聺隆忙聲掳忙聧庐忙碌聛茂录聦氓聫炉忙聢聬氓聙聧莽職聞忙聫聬氓聧聡氓聧聲忙聽赂猫庐隆莽庐聴猫聝陆氓聤聸茫聙聜SIMD茅聺聻氓赂赂茅聙聜氓聬聢猫庐隆莽庐聴氓炉聠茅聸聠氓聻聥盲禄禄氓聤隆茂录聦氓庐聝猫聝陆氓聤聽茅聙聼莽職聞忙聽鹿忙聹卢氓聨聼氓聸聽忙聵炉芒聙聹盲禄聨盲赂聙忙卢隆盲赂聙盲赂陋猫路篓猫露聤氓聢掳盲赂聙忙卢隆盲赂聙莽禄聞茂录聦盲禄聨猫聙聦氓庐聻莽聨掳莽聰篓忙聸麓氓掳聭莽職聞忙聦聡盲禄陇忙聲掳氓庐聦忙聢聬氓聬聦忙聽路莽職聞猫庐隆莽庐聴盲禄禄氓聤隆茫聙聜芒聙聺

1996氓鹿麓茂录聦Intel忙聨篓氓聡潞莽職聞X86 MMX茂录聢MultiMedia eXtension茂录聣忙聦聡盲禄陇茅聸聠忙聣漏氓卤聲氓聫炉猫搂聠盲赂潞SIMD莽職聞猫碌路莽聜鹿茂录聦茅職聫氓聬聨忙录聰猫驴聸氓聡潞SSE茂录聢1999氓鹿麓茂录聣SSE2/3/4/5茫聙聛AVX茂录聢2008茂录聣/AVX2茂录聢2013茂录聣茫聙聛AVX512茂录聢2017茂录聣莽颅聣忙聣漏氓卤聲忙聦聡盲禄陇茅聸聠茫聙聜氓聹篓linux莽鲁禄莽禄聼盲赂颅氓聫炉盲禄楼茅聙職猫驴聡lscpu忙聢聳cpuid氓聭陆盲禄陇忙聼楼猫炉垄CPU氓炉鹿氓聬聭茅聡聫氓聦聳忙聦聡盲禄陇莽職聞忙聰炉忙聦聛忙聝聟氓聠碌茫聙聜

### 1.2 氓聬聭茅聡聫氓聦聳忙聣搂猫隆聦忙隆聠忙聻露茂录職忙聲掳忙聧庐氓卤聙茅聝篓忙聙搂盲赂聨猫驴聬猫隆聦忙聴露氓录聙茅聰聙

忙聣搂猫隆聦氓录聲忙聯聨氓赂赂猫搂聞忙聦聣猫隆聦氓陇聞莽聬聠莽職聞忙聳鹿氓录聫茂录聦氓颅聵氓聹篓盲禄楼盲赂聥盲赂聣盲赂陋茅聴庐茅垄聵茂录職

1. CPU Cache氓聭陆盲赂颅莽聨聡氓路庐茫聙聜盲赂聙猫隆聦莽職聞氓陇職氓聢聴茂录聢氓颅聴忙庐碌茂录聣忙聲掳忙聧庐莽職聞氓聠聟氓颅聵莽麓搂忙聦篓氓聹篓盲赂聙猫碌路茂录聦氓聯陋忙聙聲氓聫陋氓炉鹿氓聟露盲赂颅莽職聞盲赂聙盲赂陋氓颅聴忙庐碌氓聛職忙聯聧盲陆聹茂录聦氓聟露盲禄聳氓颅聴忙庐碌忙聣聙氓聧聽莽職聞氓聠聟氓颅聵盲鹿聼茅聹聙猫娄聛氓聤聽猫陆陆猫驴聸忙聺楼茂录聦猫驴聶盲录職忙聤垄氓聧聽莽篓聙莽录潞莽職聞Cache猫碌聞忙潞聬茫聙聜Cache氓聭陆氓陇卤盲录職氓炉录猫聡麓猫垄芦猫炉路忙卤聜莽職聞忙聲掳忙聧庐盲禄聨氓聠聟氓颅聵氓聤聽猫陆陆猫驴聸Cache茂录聦莽颅聣氓戮聟氓聠聟氓颅聵忙聯聧盲陆聹氓庐聦忙聢聬盲录職氓炉录猫聡麓CPU忙聣搂猫隆聦忙聦聡盲禄陇忙職聜氓聛聹茂录聢Memory Stall茂录聣茂录聦猫驴聶盲录職氓垄聻氓聤聽氓禄露忙聴露茂录聦猫驴聵氓聫炉猫聝陆忙碌陋猫麓鹿氓聠聟氓颅聵氓赂娄氓庐陆茫聙聜
2. 氓聫聵茅聲驴氓颅聴忙庐碌氓陆卤氓聯聧猫庐隆莽庐聴忙聲聢莽聨聡茫聙聜氓聛聡猫庐戮盲赂聙猫隆聦氓聦聟忙聥卢int茫聙聛string茫聙聛int盲赂聣氓聢聴茂录聦氓聟露盲赂颅int莽卤禄氓聻聥忙聵炉氓聸潞氓庐職茅聲驴氓潞娄茂录聦猫聙聦string忙聵炉氓聫聵茅聲驴莽職聞茂录聢盲赂聙猫聢卢猫隆篓莽陇潞盲赂潞int len + bytes content茂录聣茂录聦氓聫聵茅聲驴氓聢聴莽職聞氓颅聵氓聹篓盲录職氓炉录猫聡麓忙聴聽忙鲁聲茅聙職猫驴聡猫隆聦氓聫路莽庐聴offset氓聛職氓驴芦茅聙聼氓庐職盲陆聧茫聙聜
3. 猫聶職氓聡陆忙聲掳猫掳聝莽聰篓氓赂娄忙聺楼茅垄聺氓陇聳氓录聙茅聰聙茫聙聜氓炉鹿盲赂聙猫隆聦莽職聞氓陇職氓聢聴猫驴聸猫隆聦氓陇聞莽聬聠茅聙職氓赂赂盲录職氓掳聛猫拢聟氓聹篓盲赂聙盲赂陋氓戮陋莽聨炉茅聡聦茂录聦盲录職忙聤陆猫卤隆氓聡潞盲赂聙盲赂陋莽卤禄盲录录handle莽職聞忙聨楼氓聫拢茂录聢C++猫聶職氓聡陆忙聲掳茂录聣莽聰篓盲潞聨氓陇聞莽聬聠忙聼聬莽卤禄氓聻聥忙聲掳忙聧庐茂录聦氓聬聞氓颅聴忙庐碌莽卤禄氓聻聥盲录職override猫炉楼handle忙聨楼氓聫拢茫聙聜猫聶職氓聡陆忙聲掳莽職聞猫掳聝莽聰篓氓陇職盲赂聙忙颅楼忙聼楼猫隆篓茂录聦盲赂聰忙聴聽忙鲁聲猫垄芦氓聠聟猫聛聰茂录聦氓戮陋莽聨炉氓聠聟茅芦聵茅垄聭猫掳聝莽聰篓猫聶職氓聡陆忙聲掳莽職聞忙聙搂猫聝陆氓陆卤氓聯聧盲赂聧氓聫炉氓驴陆猫搂聠茫聙聜

![氓聸戮2茂录職row by row VS blcok by block](https://p0.meituan.net/travelcube/6ebbf37d0e24ac3fbed523e512d40f9d118589.png)

氓聸聽忙颅陇茂录聦猫娄聛猫庐漏氓聬聭茅聡聫氓聦聳猫庐隆莽庐聴氓聫聭忙聦楼氓篓聛氓聤聸茂录聦氓聫陋盲陆驴莽聰篓SIMD忙聦聡盲禄陇猫驴聵盲赂聧氓陇聼茂录聦猫驴聵茅聹聙猫娄聛氓炉鹿忙聣搂猫隆聦忙隆聠忙聻露氓卤聜茅聺垄猫驴聸猫隆聦忙聰鹿茅聙聽茂录聦氓聫聵Row By Row盲赂潞Block By Block茂录職

1. 忙聲掳忙聧庐忙聦聣氓聢聴莽禄聞莽禄聡忙聸驴盲禄拢忙聦聣猫隆聦莽禄聞莽禄聡茂录聢氓聹篓Clickhouse氓聮聦Doris茅聡聦氓聫芦Block茂录聦Velox茅聡聦氓聫芦Vector茂录聣茂录聦猫驴聶氓掳聠忙聫聬茅芦聵忙聲掳忙聧庐氓卤聙茅聝篓忙聙搂茫聙聜氓聫聜盲赂聨猫庐隆莽庐聴莽職聞氓聢聴莽職聞氓陇職猫隆聦忙聲掳忙聧庐盲录職氓聠聟氓颅聵莽麓搂氓聡聭莽職聞盲驴聺氓颅聵氓聹篓盲赂聙猫碌路茂录聦CPU氓聫炉盲禄楼茅聙職猫驴聡茅垄聞氓聫聳忙聦聡盲禄陇氓掳聠忙聨楼盲赂聥忙聺楼猫娄聛氓陇聞莽聬聠莽職聞忙聲掳忙聧庐氓聤聽猫陆陆猫驴聸Cache茂录聦盲禄聨猫聙聦氓聡聫氓掳聭Memory Stall茫聙聜盲赂聧氓聫聜盲赂聨猫庐隆莽庐聴莽職聞氓聢聴莽職聞忙聲掳忙聧庐盲赂聧盲录職盲赂聨猫垄芦氓陇聞莽聬聠莽職聞氓聢聴莽芦聻盲潞聣Cache茂录聦猫驴聶莽搂聧氓聠聟氓颅聵盲潞陇盲潞聮莽職聞茅職聰莽娄禄猫聝陆忙聫聬茅芦聵Cache盲潞虏氓聮聦忙聙搂茫聙聜
2. 氓聬聦盲赂聙氓聢聴忙聲掳忙聧庐氓聹篓氓戮陋莽聨炉茅聡聦猫垄芦忙聳陆氓聤聽莽聸赂氓聬聦莽職聞猫庐隆莽庐聴茂录聦忙聣鹿茅聡聫猫驴颅盲禄拢氓掳聠氓聡聫氓掳聭氓聡陆忙聲掳猫掳聝莽聰篓忙卢隆忙聲掳茂录聦茅聙職猫驴聡忙篓隆莽聣聢猫聝陆氓聡聫氓掳聭猫聶職氓聡陆忙聲掳猫掳聝莽聰篓茂录聦茅聶聧盲陆聨猫驴聬猫隆聦忙聴露氓录聙茅聰聙茫聙聜茅聮聢氓炉鹿氓聸潞氓庐職茅聲驴氓潞娄莽卤禄氓聻聥莽職聞氓聢聴氓戮聢氓庐鹿忙聵聯猫垄芦氓鹿露猫隆聦氓陇聞莽聬聠茂录聢茅聙職猫驴聡猫隆聦氓聫路offset氓聢掳忙聲掳忙聧庐茂录聣茂录聦猫驴聶忙聽路莽職聞忙聣搂猫隆聦忙隆聠忙聻露盲鹿聼忙聹聣氓聢漏盲潞聨猫庐漏莽录聳猫炉聭氓聶篓氓聛職猫聡陋氓聤篓氓聬聭茅聡聫氓聦聳盲禄拢莽聽聛莽聰聼忙聢聬茂录聦忙聵戮猫聭聴氓聡聫氓掳聭氓聢聠忙聰炉茂录聦氓聡聫猫陆禄茅垄聞忙碌聥氓陇卤猫麓楼莽職聞忙聝漏莽陆職茫聙聜莽禄聯氓聬聢忙篓隆忙聺驴茂录聦莽录聳猫炉聭氓聶篓盲录職盲赂潞忙炉聫盲赂陋氓庐聻氓聫聜莽聰聼忙聢聬莽聣鹿氓庐職氓庐聻盲戮聥氓聦聳盲禄拢莽聽聛茂录聦茅聛驴氓聟聧猫驴聬猫隆聦忙聴露忙聼楼忙聣戮猫聶職氓聡陆忙聲掳猫隆篓茂录聦氓鹿露盲赂聰莽聰卤盲潞聨莽录聳猫炉聭氓聶篓莽聼楼茅聛聯盲潞聠氓聟路盲陆聯莽職聞莽卤禄氓聻聥盲驴隆忙聛炉茂录聦氓聫炉盲禄楼氓炉鹿忙篓隆忙聺驴氓聡陆忙聲掳猫驴聸猫隆聦氓聠聟猫聛聰氓卤聲氓录聙茫聙聜

![氓聸戮3茂录職氓聬聭茅聡聫氓聦聳忙聣搂猫隆聦忙隆聠忙聻露莽陇潞盲戮聥](https://p0.meituan.net/travelcube/967e549c622732b3b0677c0fb1e2be0b439300.png)

### 1.3 氓娄聜盲陆聲盲陆驴莽聰篓氓聬聭茅聡聫氓聦聳猫庐隆莽庐聴

1. 猫聡陋氓聤篓氓聬聭茅聡聫氓聦聳茂录聢Auto-Vectorization茂录聣茫聙聜氓陆聯氓戮陋莽聨炉氓聠聟忙虏隆忙聹聣氓陇聧忙聺聜莽職聞忙聺隆盲禄露氓聢聠忙聰炉茂录聦忙虏隆忙聹聣忙聲掳忙聧庐盲戮聺猫碌聳茂录聦氓聫陋猫掳聝莽聰篓莽庐聙氓聧聲氓聠聟猫聛聰氓聡陆忙聲掳忙聴露茂录聦茅聙職猫驴聡莽录聳猫炉聭茅聙聣茅隆鹿茂录聢氓娄聜`gcc -ftree-vectorize`茫聙聛-O3茂录聣茂录聦莽录聳猫炉聭氓聶篓氓聫炉盲禄楼氓掳聠茅隆潞氓潞聫忙聣搂猫隆聦盲禄拢莽聽聛莽驴禄猫炉聭忙聢聬氓聬聭茅聡聫氓聦聳忙聣搂猫隆聦盲禄拢莽聽聛茫聙聜氓聫炉盲禄楼茅聙職猫驴聡猫搂聜氓炉聼莽录聳猫炉聭hint猫戮聯氓聡潞氓聮聦氓聫聧忙卤聡莽录聳莽隆庐氓庐職忙聵炉氓聬娄莽聰聼盲潞搂盲潞聠氓聬聭茅聡聫氓聦聳盲禄拢莽聽聛茫聙聜

   * 莽录聳猫炉聭hint猫戮聯氓聡潞茂录聦莽录聳猫炉聭茂录職`g++ test.cpp -g -O3 -march=native -fopt-info-vec-optimized`茂录聦忙聣搂猫隆聦氓聬聨忙聹聣莽卤禄盲录录猫戮聯氓聡潞芒聙聹test.cpp:35:21: note: loop vectorized芒聙聺茫聙聜
   * 氓聫聧忙卤聡莽录聳茂录聦`gdb test + (gdb) disassemble /m function_name`茂录聦莽聹聥氓聢掳盲赂聙盲潞聸v忙聣聯氓陇麓莽職聞忙聦聡盲禄陇茂录聢盲戮聥氓娄聜vmovups茫聙聛vpaddd茫聙聛vmovups莽颅聣茂录聣茫聙聜
2. 盲陆驴莽聰篓氓掳聛猫拢聟氓楼陆莽職聞氓聡陆忙聲掳氓潞聯茂录聦氓娄聜Intel Intrinsic function茫聙聛xsimd莽颅聣茫聙聜猫驴聶盲潞聸猫陆炉盲禄露氓聦聟盲赂颅莽職聞氓聠聟莽陆庐氓聡陆忙聲掳氓庐聻莽聨掳茅聝陆盲陆驴莽聰篓盲潞聠SIMD忙聦聡盲禄陇猫驴聸猫隆聦盲录聵氓聦聳茂录聦莽聸赂氓陆聯盲潞聨high level氓聹掳盲陆驴莽聰篓盲潞聠氓聬聭茅聡聫氓聦聳忙聦聡盲禄陇莽職聞忙卤聡莽录聳茂录聦猫炉娄猫搂聛茂录職<https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html>茫聙聜
3. 茅聙職猫驴聡asm氓聠聟氓碌聦氓聬聭茅聡聫氓聦聳忙卤聡莽录聳茂录聦盲陆聠忙卤聡莽录聳忙聦聡盲禄陇猫路聼CPU忙聻露忙聻聞莽聸赂氓聟鲁茂录聦氓聫炉莽搂禄忙陇聧忙聙搂氓路庐茫聙聜
4. 莽录聳猫炉聭氓聶篓忙職聴莽陇潞茂录職

   * 盲陆驴莽聰篓莽录聳猫炉聭忙聦聡莽陇潞莽卢娄茂录聢Compiler Directive茂录聣茂录聦氓娄聜Cilk茂录聢MIT氓录聙氓聫聭莽職聞莽聰篓盲潞聨氓鹿露猫隆聦莽录聳莽篓聥莽職聞盲赂颅茅聴麓氓卤聜莽录聳莽篓聥猫炉颅猫篓聙氓聮聦氓潞聯茂录聦氓庐聝忙聣漏氓卤聲盲潞聠C猫炉颅猫篓聙茂录聣茅聡聦莽職聞#pragma simd氓聮聦OpenMP茅聡聦莽職聞#pragma omp simd茫聙聜
   * Compiler Hint茫聙聜茅聙職猫驴聡\_\_restrict氓聨禄盲驴庐茅楼掳忙聦聡茅聮聢氓聫聜忙聲掳茂录聦氓聭聤猫炉聣莽录聳猫炉聭氓聶篓氓陇職盲赂陋忙聦聡茅聮聢忙聦聡氓聬聭盲赂聧莽聸赂氓聬聦盲赂聧茅聡聧氓聫聽莽職聞氓聠聟氓颅聵茂录聦猫庐漏莽录聳猫炉聭氓聶篓忙聰戮氓驴聝氓陇搂猫聝聠莽職聞氓聨禄盲录聵氓聦聳茫聙聜
5. 氓娄聜忙聻聹氓戮陋莽聨炉氓聠聟忙聹聣氓陇聧忙聺聜莽職聞茅聙禄猫戮聭忙聢聳忙聺隆盲禄露氓聢聠忙聰炉茂录聦茅聜拢盲鹿聢氓掳聠茅職戮盲禄楼氓聬聭茅聡聫氓聦聳氓陇聞莽聬聠茫聙聜

盲禄楼盲赂聥忙聵炉盲赂聙盲赂陋氓聬聭茅聡聫氓聦聳莽聣聢忙聹卢忙聲掳莽禄聞莽聸赂氓聤聽莽職聞盲戮聥氓颅聬茂录聦盲陆驴莽聰篓Intel Intrinsic function茂录職

```
#include <immintrin.h> // 氓聦聟氓聬芦Intrinsic avx莽聣聢忙聹卢氓聡陆忙聲掳莽職聞氓陇麓忙聳聡盲禄露

void addArraysAVX(const int* a, const int* b, int* c, int num) {
  assert(num % 8 == 0); // 氓戮陋莽聨炉茅聛聧氓聨聠忙聲掳莽禄聞茂录聦忙颅楼茅聲驴盲赂潞8茂录聦氓聸聽盲赂潞忙炉聫盲赂陋__m256i氓聫炉盲禄楼氓颅聵氓聜篓8盲赂陋32盲陆聧忙聲麓忙聲掳
  for (int i = 0; i < num; i += 8) {
    __m256i v_a = _mm256_load_si256((__m256i*)&a[i]); // 氓聤聽猫陆陆忙聲掳莽禄聞a莽職聞盲赂聥盲赂聙盲赂陋8盲赂陋忙聲麓忙聲掳氓聢掳氓聬聭茅聡聫氓炉聞氓颅聵氓聶篓
    __m256i v_b = _mm256_load_si256((__m256i*)&b[i]); // 氓聤聽猫陆陆忙聲掳莽禄聞b莽職聞盲赂聥盲赂聙盲赂陋8盲赂陋忙聲麓忙聲掳氓聢掳氓聬聭茅聡聫氓炉聞氓颅聵氓聶篓
    __m256i v_c = _mm256_add_epi32(v_a, v_b); // 氓掳聠盲赂陇盲赂陋氓聬聭茅聡聫莽聸赂氓聤聽茂录聦莽禄聯忙聻聹氓颅聵忙聰戮氓聹篓氓聬聭茅聡聫氓炉聞氓颅聵氓聶篓
...