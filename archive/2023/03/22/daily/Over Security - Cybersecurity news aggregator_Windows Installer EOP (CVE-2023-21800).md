---
title: Windows Installer EOP (CVE-2023-21800)
url: https://blog.doyensec.com//2023/03/21/windows-installer.html
source: Over Security - Cybersecurity news aggregator
date: 2023-03-22
fetch_date: 2025-10-04T10:16:47.139832
---

# Windows Installer EOP (CVE-2023-21800)

[

](https://doyensec.com/img/home-video.mp4)

[![](/public/images/doyensec-logo.svg)](/index.html)

[![](/public/images/logo.svg)](/index.html)

#### ABOUT US

We are [**security engineers**](https://doyensec.com) who break bits and tell stories.

Visit us
[doyensec.com](https://doyensec.com)

Follow us
[@doyensec](https://twitter.com/doyensec)

Engage us
info@doyensec.com

#### Blog Archive

* 2025
* 2024
* 2023
* 2022
* 2021
* 2020
* 2019
* 2018
* 2017

© 2025 [Doyensec LLC](https://doyensec.com) [![](/public/images/rss.png)](/atom.xml "RSS")

# Windows Installer EOP (CVE-2023-21800)

21 Mar 2023 - Posted by Adrian Denkiewicz

**TL;DR**: This blog post describes the details and methodology of our research targeting the Windows Installer (MSI) installation technology. If youâre only interested in the vulnerability itself, then [jump right there](/#msi-vuln)

### Introduction

Recently, I decided to research a single common aspect of many popular Windows applications - their MSI installer packages.

Not every application is distributed this way. Some applications implement custom bootstrapping mechanisms, some are just meant to be dropped on the disk. However, in a typical enterprise environment, some form of control over the installed packages is often desired. Using the MSI packages simplifies the installation process for any number of systems and also provides additional benefits such as automatic repair, easy patching, and compatibility with GPO. A good example is Google Chrome, which is typically distributed as a standalone executable, but an enterprise package is offered on a dedicated [domain](https://chromeenterprise.google/).

Another interesting aspect of enterprise environments is a need for strict control over employee accounts. In particular, in a well-secured Windows environment, the rule of least privileges ensures no administrative rights are given unless thereâs a really good reason. This is bad news for malware or malicious attackers who would benefit from having additional privileges at hand.

During my research, I wanted to take a look at the security of popular MSI packages and understand whether they could be used by an attacker for any malicious purposes and, in particular, to elevate local privileges.

### Typical installation

Itâs very common for the MSI package to require administrative rights. As a result, running a malicious installer is a straightforward game-over. I wanted to look at legitimate, properly signed MSI packages. Asking someone to type an admin password, then somehow opening elevated cmd is also an option that I chose not to address in this blog post.

Letâs quickly look at how the installer files are generated. Turns out, there are several options to generate an MSI package. Some of the most popular ones are [WiX Toolset](https://wixtoolset.org/), [InstallShield](https://www.revenera.com/install/products/installshield), and [Advanced Installer](https://www.advancedinstaller.com/). The first one is free and open-source, but requires you to write dedicated XML files. The other two offer various sets of features, rich GUI interfaces, and customer support, but require an additional license. One could look for generic vulnerabilities in those products, however, itâs really hard to address all possible variations of offered features. On the other hand, itâs exactly where the actual bugs in the installation process might be introduced.

During the installation process, new files will be created. Some existing files might also be renamed or deleted. The access rights to various securable objects may be changed. The interesting question is what would happen if unexpected access rights are present. Would the installer fail or would it attempt to edit the permission lists? Most installers will also modify Windows registry keys, drop some shortcuts here and there, and finally log certain actions in the event log, database, or plain files.

The list of actions isnât really sealed. The MSI packages may implement the so-called [custom actions](https://learn.microsoft.com/en-us/windows/win32/msi/custom-actions) which are implemented in a dedicated DLL. If this is the case, itâs very reasonable to look for interesting bugs over there.

Once we have an installer package ready and installed, we can often observe a new copy being cached in the *C:\Windows\Installers* directory. This is a hidden system directory where unprivileged users cannot write. The copies of the MSI packages are renamed to random names matching the following regular expression: `^[0-9a-z]{7}\.msi$`. The name will be unique for every machine and even every new installation. To identify a specific package, we can look at file properties (but itâs up to the MSI creator to decide which properties are configured), search the Windows registry, or ask the WMI:

```
$ Get-WmiObject -class Win32_Product | ? { $_.Name -like "*Chrome*" } | select IdentifyingNumber,Name

IdentifyingNumber                      Name
-----------------                      ----
{B460110D-ACBF-34F1-883C-CC985072AF9E} Google Chrome
```

Referring to the package via its GUID is our safest bet. However, different versions of the same product may still have different identifiers.

Assuming weâre using an unprivileged user account, is there anything interesting we can do with that knowledge?

### Repair process

The builtin Windows tool, called `msiexec.exe`, is located in the `System32` and `SysWOW64` directories. It is used to manage the MSI packages. The tool is a core component of Windows with a long history of vulnerabilities. As a side note, I also happen to have found one such issue in the past ([CVE-2021-26415](https://nvd.nist.gov/vuln/detail/CVE-2021-26415)). The documented list of its options can be found on the [MSDN page](https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec) although some additional undocumented switches are also implemented.

The flags worth highlighting are:

* `/l*vx` to log any additional details and search for interesting events
* `/qn` to hide any UI interactions. This is extremely useful when attempting to develop an automated exploit. On the other hand, potential errors will result in new message boxes. Until the message is accepted, the process does not continue and can be frozen in an unexpected state. We might be able to modify some existing files before the original access rights are reintroduced.

The [repair options](https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec#repair-options) section lists flags we could use to trigger the repair actions. These actions would ensure the *bad* files are removed, and *good* files are reinstalled instead. The definition of *bad* is something we control, i.e., we can force the reinstallation of all files, all registry entries, or, say, only those with an invalid checksum.

| Parameter | Description |
| --- | --- |
| `/fp` | Repairs the package if a file is missing. |
| `/fo` | Repairs the package if a file is missing, or if an older version is installed. |
| `/fe` | Repairs the package if file is missing, or if an equal or older version is installed. |
| `/fd` | Repairs the package if file is missing, or if a different version is installed. |
| `/fc` | Repairs the package if file is missing, or if checksum does not match the calculated value. |
| `/fa` | Forces all files to be reinstalled. |
| `/fu` | Repairs all the required user-specific registry entries. |
| `/fm` | Repairs all the required computer-specific registry entries. |
| `/fs` | Repairs all existing shortcuts. |
| `/fv` | Runs from source and re-caches the local package. |

Most of the `msiexec` actions will require elevation. We cannot install or uninstall arbitrary packages (unless of course the system is badly misconfigured). However, the repair option might be an interesting exception! It might be, because not every package will work like this, but itâ...