---
title: 新型后门木马：专门针对钉钉和微信用户的网络攻击
url: https://mp.weixin.qq.com/s?__biz=MzI0MTE4ODY3Nw==&mid=2247492298&idx=1&sn=0b3b959c2397327bb9e16363fdf064e8&chksm=e90dc8e0de7a41f61bb94c4c602dd652ea2569cf37d18a441640a65fa388e7e8aca73e2e4e2b&scene=58&subscene=0#rd
source: 白泽安全实验室
date: 2024-08-30
fetch_date: 2025-10-06T18:07:53.238447
---

# 新型后门木马：专门针对钉钉和微信用户的网络攻击

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/NpPydsaAMIO544JSnpfZmIP1kA3oSNWBwv5Pg9s4o0qib1dcrDa9ZxowI95xuFxpic78yMxbTiagEKV4b8GPUJkFA/0?wx_fmt=jpeg)

# 新型后门木马：专门针对钉钉和微信用户的网络攻击

BaizeSec

白泽安全实验室

**1.事件概述：**

2024年6月，安全研究人员发现了一种针对macOS的HZ Rat后门木马，该木马主要针对国内的企业通讯软件钉钉和社交平台微信的用户。该木马几乎完全复制了Windows版本的功能，仅在接收攻击者服务器发送的shell脚本方面有所不同。部分版本的后门使用本地IP地址连接到C2服务器，表明该威胁可能具有针对性，并可能用于在受害者网络中的横向移动。HZ Rat后门最初于2022年11月被DCSO研究人员发现，当时主要针对Windows系统，并以PowerShell脚本的形式接收命令。

**2.攻击过程及技术细节分析：**

**恶意软件的伪装与分发：**

* 尽管不知道恶意软件的原始分发点，但研究人员找到了一个后门样本的安装包，名为“OpenVPNConnect.pkg”。
* 攻击者利用了名为“OpenVPNConnect.pkg”的安装包，该安装包在外观上模仿了合法的“OpenVPN Connect”应用程序，但实际上是一个包含恶意代码的包装器。
* 该安装包在2023年7月上传至VirusTotal时，未被任何安全厂商检测出恶意行为，这一现象突显了攻击者在规避安全检测方面的高超技巧。

**后门的执行与通信：**

* 安装过程中，一个名为“exe”的shell脚本首先被执行，该脚本负责启动“init”文件，随后启动OpenVPN应用，以此掩盖其真实恶意行为。
* “init”文件是后门的核心，它在启动时会根据后门内部指定的IP地址列表，通过端口8081（或其他端口）与C2服务器建立加密通信。

**加密与命令执行：**

* 所有与C2服务器的通信都通过XOR加密，使用0x42作为密钥，确保了通信的隐蔽性。
* 会话初始化时，后门发送一个随机的四字节值作为“cookie”，每个消息结构包括消息代码、长度和文本内容，其中文本内容的前四个字节包含数据大小信息。

**后门支持的命令：**

后门支持以下四个基本命令：

* execute\_cmdline：执行shell命令；
* write\_file：将文件写入磁盘；
* download\_file：从服务器下载文件；
* ping：检查受害者的可用性。

**恶意软件的代码分析：**

* 可执行文件是用C++编写的，并包含调试信息，这使得恶意行为容易被识别。

**数据收集与信息泄露：**

攻击者通过后门收集了大量敏感信息，包括但不限于：

* 系统完整性保护（SIP）状态；
* 系统和设备信息，如本地IP地址、蓝牙设备信息、Wi-Fi网络信息、硬件规格和数据存储信息；
* 用户在微信上的个人信息，如微信ID、电子邮箱、电话号码等，这些信息存储在明文的userinfo.data文件中；
* 钉钉用户的详细信息，包括组织和部门名称、用户名、企业邮箱地址、电话号码等，这些信息尝试从orgEmployeeModel文件中获取，如果失败，则从sAlimailLoginEmail文件或<date>.holmes.mapping缓存文件中搜索。

**基础设施分析：**

* 研究期间发现的C2服务器中，大多数位于国内，但也有部分位于美国和荷兰，这可能表明攻击者具有跨国操作的能力。
* 部分C2服务器的IP地址与2022年的HZ Rat攻击有关，显示了攻击者的长期活动和持续性。
* 根据VirusTotal的说法，上面提到的安装包之前是从属于中国视频游戏开发商MiHoYo的域中下载的:hxxp://vpn.mihoyo[.]com/uploads/OpenVPNConnect.zip.目前尚不清楚此文件是如何进入合法域的，以及该公司是否被黑客入侵。

**3.结论：**

研究人员发现的macOS版本的HZ Rat显示，之前攻击背后的威胁行为者仍然活跃。在调查期间，恶意软件仅收集了用户数据，但后来可能用于在受害者网络中进行横向移动，如某些样本中私有IP地址的存在所示。收集的有关受害者公司和联系信息的数据可能被用来监视有关人员并为未来的攻击奠定基础。值得注意的是，在研究时尚未遇到使用后门命令中的两个（将文件写入磁盘和发送文件到服务器），因此攻击者的完整意图尚不清楚。

**4.附录IOC指标**

**MD5 文件哈希**

Backdoor

0c3201d0743c63075b18023bb8071e73– Mach-O 64 位 x86\_64 可执行文件

6cc838049ece4fcb36386b7a3032171f– Mach-O 64 位 x86\_64 可执行文件

6d478c7f94d95981eb4b6508844050a6– Mach-O 64 位 x86\_64 可执行文件

7a66cd84e2d007664a66679e86832202– Mach-O 64 位 x86\_64 可执行文件

7ed3fc831922733d70fb08da7a244224– Mach-O 64 位 x86\_64 可执行文件

9cdb61a758afd9a893add4cef5608914– Mach-O 64 位 x86\_64 可执行文件

287ccbf005667b263e0e8a1ccfb8daec– Mach-O 64 位 x86\_64 可执行文件

7005c9c6e2502992017f1ffc8ef8a9b9– Mach-O 64 位 x86\_64 可执行文件

7355e0790c111a59af377babedee9018– Mach-O 64 位 x86\_64 可执行文件

a5af0471e31e5b11fd4d3671501dfc32– Mach-O 64 位 x86\_64 可执行文件

DA07B0608195A2D5481AD6DE3CC6F195– Mach-O 64 位 x86\_64 可执行文件

dd71b279a0bf618bbe9bb5d934ce9caa– Mach-O 64 位 x86\_64 可执行文件

**恶意安装包**

8d33f667ca135a88f5bf77a0fab209d4– 苹果软件包

C2 IP 地址

111.21.246[.]147

123.232.31[.]206

120.53.133[.]226

218.193.83[.]70

29.40.48[.]21

47.100.65[.]182

58.49.21[.]113

113.125.92[.]32

218.65.110[.]180

20.60.250[.]230

参考链接：

https://securelist.com/hz-rat-attacks-wechat-and-dingtalk/113513

预览时标签不可点

![]()

微信扫一扫
关注该公众号

继续滑动看下一个

轻触阅读原文

![](http://mmbiz.qpic.cn/mmbiz_png/NpPydsaAMIN7MdZNibeGNoAT8tqwpL0jiaadMrz99YH3koiadd3bCWZXicyNqlId4PnibcJCj8JabAOvibc5uBn4G7Ow/0?wx_fmt=png)

白泽安全实验室

向上滑动看下一个

知道了

![]()
微信扫一扫
使用小程序

取消
允许

取消
允许

取消
允许

×
分析

![跳转二维码]()

![作者头像](http://mmbiz.qpic.cn/mmbiz_png/NpPydsaAMIN7MdZNibeGNoAT8tqwpL0jiaadMrz99YH3koiadd3bCWZXicyNqlId4PnibcJCj8JabAOvibc5uBn4G7Ow/0?wx_fmt=png)

微信扫一扫可打开此内容，
使用完整服务

：
，
，
，
，
，
，
，
，
，
，
，
，
。

视频
小程序
赞
，轻点两下取消赞
在看
，轻点两下取消在看
分享
留言
收藏
听过