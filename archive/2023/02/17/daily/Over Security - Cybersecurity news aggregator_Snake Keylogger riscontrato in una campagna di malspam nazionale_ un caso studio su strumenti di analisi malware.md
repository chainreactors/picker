---
title: Snake Keylogger riscontrato in una campagna di malspam nazionale: un caso studio su strumenti di analisi malware
url: https://cert-agid.gov.it/news/snake-keylogger-riscontrato-in-una-campagna-di-malspam-nazionale-un-caso-studio-su-strumenti-di-analisi-malware/
source: Over Security - Cybersecurity news aggregator
date: 2023-02-17
fetch_date: 2025-10-04T06:53:29.995723
---

# Snake Keylogger riscontrato in una campagna di malspam nazionale: un caso studio su strumenti di analisi malware

* [Vai al contenuto](#main)
* [Vai alla navigazione del sito](#menu "accedi al menu")

[![Logo CERT-AGID](/wp-content/themes/cert-agid/assets/images/cert-agid-logo-white.svg)](https://cert-agid.gov.it/)

# [CERT-AGID Computer Emergency Response Team AGID](https://cert-agid.gov.it/)

[Agenzia per
l'Italia Digitale](https://www.agid.gov.it)

[![Logo AgID - Agenzia per l'Italia Digitale](/wp-content/themes/cert-agid/assets/images/logo-agid.svg)](https://www.agid.gov.it)

Seguici su

* [RSS](https://cert-agid.gov.it/feed/ "RSS")
* [Telegram](https://t.me/certagid "Telegram")
* [X / Twitter](https://twitter.com/agidcert "X / Twitter")

cerca nel sito

[Menu](#menu "accedi al menu")

![Logo del CERT-PA](/wp-content/themes/cert-agid/assets/images/cert-agid-logo-black.svg)
CERT-AGID

<https://cert-agid.gov.it/>

## Menu di navigazione

* Documentazione
  + [Documenti AGID](https://cert-agid.gov.it/documenti-agid/)
  + [Pillole informative](https://cert-agid.gov.it/pillole-informative/)
  + [Flusso IoC](https://cert-agid.gov.it/scarica-il-modulo-accreditamento-feed-ioc/)
* [Chi siamo](https://cert-agid.gov.it/chi-siamo/)
* [Contatti](https://cert-agid.gov.it/contatti/)
* [Strumenti](https://cert-agid.gov.it/strumenti/)
  + [hashr](https://cert-agid.gov.it/hashr/)
  + [Verifica HTTPS e CMS](https://cert-agid.gov.it/verifica-https-cms/)
  + [Statistiche sulle campagne italiane di malware e phishing](https://cert-agid.gov.it/statistiche/)
* [Glossario](https://cert-agid.gov.it/glossario/)
  + [0day](https://cert-agid.gov.it/glossario/0day/)
  + [Botnet](https://cert-agid.gov.it/glossario/botnet/)
  + [Data breach](https://cert-agid.gov.it/glossario/data-breach/)
  + [DDOS-DOS](https://cert-agid.gov.it/glossario/ddos-dos/)
  + [Deep-Dark web](https://cert-agid.gov.it/glossario/deep-dark-web/)
  + [Defacing](https://cert-agid.gov.it/glossario/defacing/)
  + [Exploit](https://cert-agid.gov.it/glossario/exploit/)
  + [MITM](https://cert-agid.gov.it/glossario/mitm/)
  + [OSINT-CLOSINT](https://cert-agid.gov.it/glossario/osint-closint/)
  + [Phishing](https://cert-agid.gov.it/glossario/phishing/)
  + [Privilege escalation](https://cert-agid.gov.it/glossario/privilege-escalation/)
  + [Spam](https://cert-agid.gov.it/glossario/spam/)
  + [Spoofing](https://cert-agid.gov.it/glossario/spoofing/)
  + [SQLi-SQL Injection](https://cert-agid.gov.it/glossario/sqli-sql-injection/)
  + [XSS](https://cert-agid.gov.it/glossario/xss/)
* Link utili
  + [Agenzia per l’Italia Digitale](https://www.agid.gov.it/)
  + [CSIRT Italia](https://csirt.gov.it)
  + [CERT-GARR](https://www.cert.garr.it/)
  + [CNAIPIC](https://www.commissariatodips.it/profilo/cnaipic/index.html)
  + [CERT-DIFESA](https://www.difesa.it/smd/cor/cert-difesa/25338.html)

* [Home](https://cert-agid.gov.it/)
* [Notizie](https://cert-agid.gov.it/category/news/)
* [Malware](https://cert-agid.gov.it/category/news/malware/)
* Snake Keylogger riscontrato in una campagna di malspam nazionale: un caso studio su strumenti di analisi malware

# Snake Keylogger riscontrato in una campagna di malspam nazionale: un caso studio su strumenti di analisi malware

16/02/2023

 [equation editor](https://cert-agid.gov.it/tag/equation-editor/)
[snake keylogger](https://cert-agid.gov.it/tag/snake-keylogger/)
[università](https://cert-agid.gov.it/tag/universita/)

Il CERT-AGID ha recentemente avuto evidenza di una campagna basata su **Snake Keylogger** che sfrutta il nome dell’Università di Bologna. L’infenzione inizia infatti da un file DOCX di nome “*Elenco richieste dall’Università di Bologna (BO XXXX)*“.

![](https://cert-agid.gov.it/wp-content/uploads/2023/02/snake_docx_unibo.png)

Si tratta probabilmente di un caso mirato di malspam di cui al momento non abbiamo maggiori informazioni. Il documento Word non contiene loghi della citata Università, nè testo significativo. Al suo interno è presente una sola parola senza senso compiuto:

![](https://cert-agid.gov.it/wp-content/uploads/2023/02/image-1024x357.png)

Dato che i documenti DOCX non possono contenere macro, come vettore d’infezione iniziale è stata usata una *external relationship* verso un documento DOC. Ci sono vari modi per rilevare le relationship in un documento Word.

Gli strumenti **oleid** e **oleobj** del pacchetto *oletools* sono di immediato utilizzo e mostrano l’URL al documento relazionato:

![](https://cert-agid.gov.it/wp-content/uploads/2023/02/image-1-1024x453.png)

Un altro metodo è quello di ricorrere al comando “*grep*” per recuperare tutte le occorrenze della stringa “*http*“. Trattandosi di un documento DOCX siamo in realtà davanti ad uno ZIP ed è quindi necessario usare li comando **zipgrep**:

`$ zipgrep -io 'http[^"]+' Elenco\ richieste\ dall_Universit_\ di\ Bologna\ \(BO_150223\).docx
...
word/_rels/webSettings.xml.rels:http://schemas.openxmlformats.org/package/2006/relationships
word/_rels/webSettings.xml.rels:http://schemas.openxmlformats.org/officeDocument/2006/relationships/frame
word/_rels/webSettings.xml.rels:http:/QQQQWWWWQWWWWQWWQWQWQWQQWQWQQWQWQWQWQWQWQWQQQQQQQQOQQQQQOOOOOOOOQOQQQQOQOQOQOQOQOQQWWWWQWQWQWQWQWQWQWQWQQWQ@1755848856/OO.DOC
...`

Un terzo metodo è quello dell’ispezione manuale dei file contenenti le relazioni esterne:

![](https://cert-agid.gov.it/wp-content/uploads/2023/02/snake_decimal_ip.png)

La URL utilizzata nella relazione è nel formato `http://<username>@<numero>/path`

Per quanto possa sembrare strano leggere un numero al posto di un IP, va chiarito che si tratta solo di una rappresentazione decimale di quella comunemente utilizzata con il valore di quattro ottetti separati da un punto. L’uso della rappresentazione decimale ed esadecimale è già stata utilizzata in passato in altre campagne malevole.

Gli IP seguono l’endianness (**ordine dei byte**) di rete, quindi big ending. Il numero `1755848856` è 0x68A82098 in esadecimale, base scelta per la comodità nel separare gli ottetti:

`0x68A82098 -> ottetti -> 68 a8 20 98 -> endianness di rete e base decimale -> 104.168.32.152`

Il file OO.DOC scaricato è in formato RTF con estensione DOC che sfrutta [il vecchio exploit Equation Editor](https://cert-agid.gov.it/news/una-vecchia-vulnerabilita-equation-editor-cve-2017-11882-nel-dettaglio/) (CVE-2017-11882) per scaricare ed eseguire un PE.

Gli RTF hanno vari encoding per le loro sezioni: uno strumento come **rtfobj** permette di fare il dump binario degli oggetti presenti in un RTF. Per analizzare lo shellcode è possibile usare **scdbg** ma è necessario indicargli l’offset di entry-point. Per tale scopo torna utile un terzo tool: **xorsearch**. Questo può infatti trovare le più note sequenze di istruzioni x86 per ottenere il valore del registro `EIP`. Di solito queste sequenze sono usate all’inizio di shellcode eseguiti direttamente dallo stack, come è questo il caso.

Quindi la sequenza di operazioni eseguite per l’analisi è la seguente:

1. **rftobj** per dumpare gli oggetti OLE in un RTF;
2. **xorsearch** per ottnere i possibili entry-point;
3. **scdbg** per simulare lo shellcode.

![](https://cert-agid.gov.it/wp-content/uploads/2023/02/image-2-1024x378.png)

![](https://cert-agid.gov.it/wp-content/uploads/2023/02/snake_cve-2017-11882.png)

Il file *vbc.exe* viene scaricato dallo stesso server che contiene il file OO.DOC. Questo server sembra essere una macchina dell’hosting provider ColoCrossing in cui è presente Windows e XAMPP.

L’eseguibile scaricato è un PE e, in particolare, un installer [NSIS](https://sourceforge.net/projects/nsis/) come si evince anche tramite il comando **file**:

`$ file vbc.exe
vbc.exe: PE32 executable (GUI) Intel 80386, for MS Windows, Nullsoft Installer self-extracting archive, 5 sections`

Questi installer possono essere estratti automaticamente dal software **7z** che fino alla versione 9.38 era anche in grado di estrarre lo script di installazione, motivo per cui risulta utile disporre di una versione vecchia di 7zip con cui scompattare gli installer:

![](https://cert-agid.gov.it/wp-content/u...