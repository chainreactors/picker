---
title: WPS Office从路径穿越到远程代码执行漏洞(CVE-2024-7262)分析与复现
url: https://www.4hou.com/posts/5MWx
source: 嘶吼 RoarTalk – 网络安全行业综合服务平台,4hou.com
date: 2024-10-09
fetch_date: 2025-10-06T18:50:27.931963
---

# WPS Office从路径穿越到远程代码执行漏洞(CVE-2024-7262)分析与复现

WPS Office从路径穿越到远程代码执行漏洞(CVE-2024-7262)分析与复现 - 嘶吼 RoarTalk – 网络安全行业综合服务平台,4hou.com

[![](https://www.4hou.com/sihou/images/new4hou/newlogoss.png)](https://www.4hou.com)

* [首页](https://www.4hou.com)
* [企业中心](https://www.4hou.com/corp/newindex)
* [产业研究院](https://www.4hou.com/real-time)

![](https://www.4hou.com/sihou/images/new4hou/search-icon.png)

[投稿](https://www.4hou.com/contribute)

[登录](https://www.4hou.com/login)
  |
[注册](https://www.4hou.com/register)

* 导读 ▾
* [活动](https://www.4hou.com/newticket)
* [专题](https://www.4hou.com/category/special)
* [图谱](https://www.4hou.com/atlas/index)
* [报告](https://www.4hou.com/new-report-info)
* [嘶票](https://www.4hou.com/tickets)
* [嘶货](https://www.4hou.com/shop)
* [企业查询](https://www.4hou.com/corp/new-search-company)
* [招聘](https://www.4hou.com/recruit)![](https://www.4hou.com/sihou/images/1561626446625934.png)

* [新闻](https://www.4hou.com/category/news)
* [行业](https://www.4hou.com/category/industry)
* [趋势](https://www.4hou.com/category/observation)
* [访谈](https://www.4hou.com/category/people)
* [漏洞](https://www.4hou.com/category/vulnerable)
* [WEB安全](https://www.4hou.com/category/web)
* [业务安全](https://www.4hou.com/category/business)
* [系统安全](https://www.4hou.com/category/system)
* [内网渗透](https://www.4hou.com/category/penetration)
* [勒索软件](https://www.4hou.com/category/typ)
* [安全工具](https://www.4hou.com/category/tools)

# WPS Office从路径穿越到远程代码执行漏洞(CVE-2024-7262)分析与复现

盛邦安全
[技术](https://www.4hou.com/category/technology)
2024-10-08 17:47:18

![](https://img.4hou.com/article/%E6%B5%8F%E8%A7%88.png)119741

收藏

导语：WPS Office从路径穿越到远程代码执行漏洞(CVE-2024-7262)分析与复现

**漏洞概述**

WPS Office程序promecefpluginhost.exe存在不当路径验证问题，允许攻击者在Windows上加载任意Windows库文件。该漏洞已被APT-C-60攻击者利用，当用户打开MHTML格式的文档时，只需单击一个恶意制作的超链接，即可执行攻击者指定的恶意库文件，实现远程代码执行。

**影响范围**

WPS Office版本12.2.0.13110-12.2.0.16412

**复现环境**

```
操作系统：Win10 10.0.18363.592
WPS Office版本：WPS Office 12.2.0.13110
```

**分析过程**

WPS程序安装后注册了一个名为 ksoqing 的自定义URL协议，注册表路径为：计算机\HKEY\_CLASSES\_ROOT\ksoqing\shell\open\command，其内容为"C:\Users\【用户名】\AppData\Local\Kingsoft\WPS Office\12.2.0.13110\office6\wps.exe" /qingbangong "%1"。即访问以ksoqing 开头的URL协议时，将启动wps.exe程序，并传递/qingbangong参数，%1则被替换为以ksoqing 开头的协议链接，一并作为wps启动的参数。

![1.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380376729452.png "1728380099150058.png")

此时wps.exe程序解析参数/qingbangong，并将ksoqing链接内容一并发送到 C:\Users\【用户名】\AppData\Local\Kingsoft\WPS Office\12.2.0.13110\office6\wpscloudsvr.exe

![2.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380377107167.png "1728380118161967.png")

wpscloudsvr.exe中的qingbangong.dll解析自定义URL链接内容。当type参数为ksolaunch时，将启动launchname参数指定的程序，参数使用base64编码。

![3.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380378110620.png "1728380132100884.png")

launchname参数指定的程序启动时，wpscloudsvr.exe会将URL链接中的cmd参数使用base64解码，然后传递给它。

![4.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380379110789.png "1728380173120298.png")

如果launchname参数指定的是promecefpluginhost.exe，该程序启动后，将加载ksojscore.dll，然后解析命令行中的-JSCefServicePath。

![5.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380379885284.png "1728380186116766.png")

这个参数可以指定一个文件名，这个文件会被kso\_qt::QLibrary::load函数加载到内存执行。默认情况下，如果只是指定一个文件名，会按照DLL搜索顺序搜索和加载这个文件，比如加载同EXE目录下指定的DLL文件。但是这个参数未做任何过滤，可以指定“..\”包含目录的路径，存在路径穿越漏洞，可以加载任意指定的DLL文件，最终实现任意代码执行。

![6.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380381370305.png "1728380202204052.png")

使用路径穿越的漏洞可以加载指定DLL文件，但这还不够。APT-C-60攻击者使用MHTML格式的xls电子表格文件，利用其特性，实现下载远程DLL文件的目的。WPS支持MHTML格式的文档，这种文档可以包含 HTML、CSS 和 JavaScript 等文件，方便在浏览器中显示文档。

文档中可以使用img标签，指定远程DLL文件。

![7.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380381760112.png "1728380214306832.png")

当文档被打开时，wps使用\_XUrlDownloadToCacheFile函数下载文件到temp目录下的wps\INetCache目录中。

![8.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380382112109.png "1728380226682575.png")

下载后的文件名，使用的是下载链接（UNICODE编码）的MD5值。

![9.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380383742043.png "1728380241131397.png")

最终配合上述路径穿越漏洞，在-JSCefServicePath参数中指定下载的文件名，实现远程代码执行。这里还有一个小技巧，因为下载后的文件名并没有.dll后缀，而在加载的时候如果没有指定.dll后缀，会自动补上该后缀再加载。为了避免在加载的时候找不到指定文件导致失败，在-JSCefServicePath参数中指定下载的文件名时，需要在文件名最后额外加个“.”。

![10.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380384197738.png "1728380261109357.png")

**漏洞复现**

新建xls格式的文档，添加超链接，超链接可任意，并另存为MHTML格式的文档。

![11.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380385256411.png "1728380275105299.png")

根据远程DLL的下载链接，使用poc.py计算下载后的文件名，并最终生成ksoqing协议链接。

![12.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380386182966.png "1728380290174686.png")

将ksoqing链接替换导出的MHTML格式文档中的超链接。

![15.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380386524027.png "1728380307212433.png")

再根据远程DLL的下载链接，添加img标签，实现远程下载DLL文件。

![13.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380387172154.png "1728380320146342.png")

开启远程DLL下载服务，然后打开MHTML文档，点击超链接，触发漏洞。

![14.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20241008/1728380388140494.png "1728380342151701.png")

**参考链接**

ddpoc链接：

<https://www.ddpoc.com/DVB-2024-8279.html>

<https://www.welivesecurity.com/en/eset-research/analysis-of-two-arbitrary-code-execution-vulnerabilities-affecting-wps-office/>

<https://nvd.nist.gov/vuln/detail/CVE-2024-7262>

<https://avd.aliyun.com/detail?id=AVD-2024-7262>

[原文链接](https://mp.weixin.qq.com/s?__biz=MzkyNzcxNTczNA==&mid=2247486748&idx=1&sn=46e2c665774918fd88693d73fdfb0a0c&chksm=c22295e5f5551cf3db16503a2dda80ff895aa21c9d20192e08efbba7a5120179ec3ffb5ac154&token=1199929117&lang=zh_CN#rd)

如若转载，请注明原文地址

* 分享至

![取消](https://www.4hou.com/sihou/images/close.jpg)
![嘶吼](https://www.4hou.com/sihou/images/logo.png)

感谢您的支持，我会继续努力的!

![扫码支持]( "扫一扫")

打开微信扫一扫后点击右上角即可分享哟

### 发表评论

评论

![](https://www.4hou.com/captcha/flat?rYDBoj3F)

#### 你可能感兴趣的

* [![]()

  新型钓鱼即服务平台VoidProxy：瞄准微软365与谷歌账户 可绕过第三方SSO防护](https://www.4hou.com/posts/om1K)
* [![]()

  ArmouryLoader加载器的全面分析——典型加载器家族系列分析五](https://www.4hou.com/posts/xyE9)
* [![]()

  Darka5恶意家族样本分析](https://www.4hou.com/posts/jBmR)
* [![]()

  NimDoor加密盗窃macOS恶意软件被删除后会自动恢复](https://www.4hou.com/posts/qoEG)
* [![]()

  前瞻对抗｜这大概是首次，AI挖出了Linux内核可利用0day](https://www.4hou.com/posts/6MAV)
* [![]()

  攻防速写｜一条微信消息，实现客户端持久化攻击](https://www.4hou.com/posts/5MzK)

![](https://img.4hou.com/portraits/3c8d3af7c49c95c16dd14518142759d6.png)

# [盛邦安全](https://www.4hou.com/member/9ZO4)

让网络空间更有序

#### 最新文章

* [新型钓鱼即服务平台VoidProxy：瞄准微软365与谷歌账户 可绕过第三方SSO防护](https://www.4hou.com/posts/om1K)
  2025-09-17 12:00:00
* [ArmouryLoader加载器的全面分析——典型加载器家族系列分析五](https://www.4hou.com/posts/xyE9)
  2025-07-28 11:41:32
* [Darka5恶意家族样本分析](https://www.4hou.com/posts/jBmR)
  2025-07-24 14:04:33
* [NimDoor加密盗窃macOS恶意软件被删除后会自动恢复](https://www.4hou.com/posts/qoEG)
  2025-07-15 12:00:00

[查看更多](https://www.4hou.com/member/9ZO4)

# 相关热文

* [新型钓鱼即服务平台VoidProxy：瞄准微软365与谷歌账户 可绕过第三方SSO防护](https://www.4hou.com/posts/om1K)

  胡金鱼
* [ArmouryLoader加载器的全面分析——典型加载器家族系列分析五](https://www.4hou.com/posts/xyE9)

  安天
* [Darka5恶意家族样本分析](https://www.4hou.com/posts/jBmR)

  企业资讯
* [NimDoor加密盗窃macOS恶意软件被删除后会自动恢复](https://www.4hou.com/posts/qoEG)

  胡金鱼
* [前瞻对抗｜这大概是首次，AI挖出了Linux内核可利用0day](https://www.4hou.com/posts/6MAV)

  企业资讯
* [攻防速写｜一条微信消息，实现客户端持久化攻击](https://www.4hou.com/posts/5MzK)

  企业资讯

![]()

[公司简介](https://www.4hou.com/about?title=公司简介)
|
[我要投稿](https://www.4hou.com/about?title=我要投稿)
|
[更新日志](https://www.4hou.com/about?title=更新日志)
|
[友情链接](https://www.4hou.com/about?title=友情链接)
|
[隐私政策](https://www.4hou.com/about?title=隐私政策)
|

[![](https://www.4hou.com/sihou/images/new4hou/weibo.png)](http://weibo.com/u/6069423878)
![](https://www.4hou.com/sihou/images/new4hou/wechat.png)

本站4hou.com，所使用的字体和图片文字等素材部分来源于原作者或互联网共享平台。如使用任何字体和图片文字有侵犯其版权所有方的，嘶吼将配合联系原作者核实，并做出删除处理。

[©2024 北京嘶吼文化传媒有限公司 京ICP备16063439号-1](https://beian.mi...