---
title: NAND存储器转储分析 - 使用ECC修复位错误与UBI镜像固件分析
url: https://www.4hou.com/posts/MKom
source: 嘶吼 RoarTalk – 网络安全行业综合服务平台,4hou.com
date: 2023-07-12
fetch_date: 2025-10-04T11:51:23.110851
---

# NAND存储器转储分析 - 使用ECC修复位错误与UBI镜像固件分析

NAND存储器转储分析 - 使用ECC修复位错误与UBI镜像固件分析 - 嘶吼 RoarTalk – 网络安全行业综合服务平台,4hou.com

[![](https://www.4hou.com/sihou/images/new4hou/newlogoss.png)](https://www.4hou.com)

* [首页](https://www.4hou.com)
* [企业中心](https://www.4hou.com/corp/newindex)
* [产业研究院](https://www.4hou.com/real-time)

![](https://www.4hou.com/sihou/images/new4hou/search-icon.png)

[投稿](https://www.4hou.com/contribute)

[登录](https://www.4hou.com/login)
  |
[注册](https://www.4hou.com/register)

* 导读 ▾
* [活动](https://www.4hou.com/newticket)
* [专题](https://www.4hou.com/category/special)
* [图谱](https://www.4hou.com/atlas/index)
* [报告](https://www.4hou.com/new-report-info)
* [嘶票](https://www.4hou.com/tickets)
* [嘶货](https://www.4hou.com/shop)
* [企业查询](https://www.4hou.com/corp/new-search-company)
* [招聘](https://www.4hou.com/recruit)![](https://www.4hou.com/sihou/images/1561626446625934.png)

* [新闻](https://www.4hou.com/category/news)
* [行业](https://www.4hou.com/category/industry)
* [趋势](https://www.4hou.com/category/observation)
* [访谈](https://www.4hou.com/category/people)
* [漏洞](https://www.4hou.com/category/vulnerable)
* [WEB安全](https://www.4hou.com/category/web)
* [业务安全](https://www.4hou.com/category/business)
* [系统安全](https://www.4hou.com/category/system)
* [内网渗透](https://www.4hou.com/category/penetration)
* [勒索软件](https://www.4hou.com/category/typ)
* [安全工具](https://www.4hou.com/category/tools)

# NAND存储器转储分析 - 使用ECC修复位错误与UBI镜像固件分析

LianSecurity
[技术](https://www.4hou.com/category/technology)
2023-07-11 15:14:11

![](https://img.4hou.com/article/%E6%B5%8F%E8%A7%88.png)148588

收藏

导语：这篇研究论文将通过黑客的视角，详细阐述如何操作 NAND dump 以及如何获取 dump 文件中的所有文件

**一、 简介**

这篇研究论文将通过黑客的视角，详细阐述如何操作 NAND dump 以及如何获取 dump 文件中的所有文件。每一步骤以及所使用的方法均会细致解析，并配以实例说明。本文主要关注的是物理 NAND dump，这是从通用编程器中提取出的 dump 文件。相对应地，从引导加载程序（如 u-boot）中获得的 dump 文件被称为逻辑 NAND dump。

对于逻辑 NAND dump，数据的正确性由 Flash Translation Layer (FTL)负责维护。也就是说，FTL 会借助 Error Correcting Code (ECC)自动修复所有的位错误。然而，物理 NAND dump 中的数据通常会携带 ECC，这就需要我们自行推断如何利用 ECC 确保数据的准确性。如果数据中存在位错误，理应使用 ECC 进行适当的纠错。然而，推断 ECC 与数据如何相关联并非易事。若无法确定 ECC 和数据的关联性，也就无法利用 ECC 修复数据中的位错误。因此，必须对 NAND dump 进行系统的深度分析，揭示 ECC 和数据之间的密切关联。在此情境下，盲目尝试暴力破解并非明智之举，但是如果能借助深度分析的结果，盲目的暴力破解可以转化为有目的性的暴力破解。这样，获取 ECC 和数据之间密切关联的可能性将得以最大化。

修复数据中的位错误并移除 ECC 之后，NAND dump 就由物理形态转化为逻辑形态，此时便可以开始对实际的固件图像进行分析。作为论文的实际案例，我们将处理一个 UBI 镜像，并对 UBI 镜像的分析进行详细的讨论。根据从 UBI 镜像分析中得到的关键信息，我们提出了一个创新性的方法来恢复文件系统并提取文件系统内部承载的所有文件。需要特别注意的是，本论文讨论的整个过程无法通过像 binwalk 或 unblob 这样的自动化工具复制。此外，整个分析过程都会以手动、逐步的方式呈现，以确保所有步骤和概念都能够得到清晰的解释。现在，我们将不再纠结于理论讨论，而是进入实际的 NAND dump 分析环节，进行详细的介绍。

# **二、 NAND 转储分析**

首先，让我们从一些基础的概念开始探讨。一个 NAND 闪存包含许多称为"页面"的单元，它们都是固定的大小，并以一定数量的"页面"组成一个"块"。鉴于我们的样本 NAND dump 是从一个实际的 NAND 芯片中获取的，型号为 MT29F2G08ABAEAWP，因此我们将以它为例，来介绍相关的硬件技术规范。

对于 MT29F2G08ABAEAWP 这款芯片，一个"页面"的大小是 2112 字节，其中包括 2048 字节的主数据和 64 字节的额外数据。64 个"页面"组成一个"块"，而 2048 个这样的"块"构成了整个 NAND 闪存的存储空间，总计有 2048\*64=131072 个"页面"。

对于每一个大小为 2112 字节的"页面"，前 2048 字节用于数据存储，剩余的 64 字节则作为备用区域，用于承载错误纠正代码（Error Correcting Code, ECC）或某些供应商特定的元数据。在一些文献中，这部分备用区域有时也被称为 Out Of Band（OOB）。

对于我们的样本 NAND dump，如果我们在十六进制模式下查看，会发现第一个"页面"中，地址从 0x0000 到 0x07ff 的部分是数据区，地址从 0x0800 到 0x083f 的部分是备用区或 OOB 区，具体示意如下。作为 NAND 转储样本的概述。

#

```
cawan% hexdump -C -n 2112 ./MT29F2G08ABAEAWP@TSOP48.BIN
00000000  20 54 56 4e 00 02 00 00  a0 ac 00 00 ff ff ff ff  | TVN............|
00000010  55 aa 55 aa 2e 00 00 00  20 02 00 b0 00 00 00 01  |U.U..... .......|
00000020  64 02 00 b0 18 00 00 c0  20 02 00 b0 18 00 00 01  |d....... .......|
00000030  aa 55 aa 55 01 00 00 00  aa 55 aa 55 01 00 00 00  |.U.U.....U.U....|
00000040  28 18 00 b0 4a d8 dc 53  08 18 00 b0 14 80 00 00  |(...J..S........|
00000050  aa 55 aa 55 01 00 00 00  aa 55 aa 55 01 00 00 00  |.U.U.....U.U....|
00000060  aa 55 aa 55 01 00 00 00  00 18 00 b0 76 04 03 00  |.U.U........v...|
00000070  aa 55 aa 55 01 00 00 00  04 18 00 b0 21 00 00 00  |.U.U........!...|
00000080  aa 55 aa 55 01 00 00 00  04 18 00 b0 23 00 00 00  |.U.U........#...|
00000090  aa 55 aa 55 01 00 00 00  aa 55 aa 55 01 00 00 00  |.U.U.....U.U....|
000000a0  aa 55 aa 55 01 00 00 00  04 18 00 b0 27 00 00 00  |.U.U........'...|
000000b0  aa 55 aa 55 01 00 00 00  aa 55 aa 55 01 00 00 00  |.U.U.....U.U....|
000000c0  aa 55 aa 55 01 00 00 00  20 18 00 b0 00 00 00 00  |.U.U.... .......|
000000d0  24 18 00 b0 00 00 00 00  1c 18 00 b0 00 40 00 00  |$............@..|
000000e0  18 18 00 b0 32 03 00 00  10 18 00 b0 06 00 00 00  |....2...........|
000000f0  04 18 00 b0 27 00 00 00  aa 55 aa 55 01 00 00 00  |....'....U.U....|
00000100  aa 55 aa 55 01 00 00 00  aa 55 aa 55 01 00 00 00  |.U.U.....U.U....|
00000110  04 18 00 b0 2b 00 00 00  04 18 00 b0 2b 00 00 00  |....+.......+...|
00000120  04 18 00 b0 2b 00 00 00  18 18 00 b0 32 02 00 00  |....+.......2...|
00000130  1c 18 00 b0 81 47 00 00  1c 18 00 b0 01 44 00 00  |.....G.......D..|
00000140  04 18 00 b0 20 00 00 00  34 18 00 b0 20 88 88 00  |.... ...4... ...|
00000150  aa 55 aa 55 01 00 00 00  18 02 00 b0 08 00 00 00  |.U.U............|
00000160  60 31 00 b8 00 80 00 00  a0 31 00 b8 00 80 00 00  |1.......1......|
00000170  2c 02 00 b0 00 01 00 00  2c 02 00 b0 00 01 00 00  |,.......,.......|
00000180  2c 02 00 b0 00 01 00 00  00 00 00 00 00 00 00 00  |,...............|
00000190  13 00 00 ea 14 f0 9f e5  10 f0 9f e5 0c f0 9f e5  |................|
000001a0  08 f0 9f e5 04 f0 9f e5  00 f0 9f e5 04 f0 1f e5  |................|
000001b0  20 03 00 00 78 56 34 12  78 56 34 12 78 56 34 12  | ...xV4.xV4.xV4.|
000001c0  78 56 34 12 78 56 34 12  78 56 34 12 78 56 34 12  |xV4.xV4.xV4.xV4.|
000001d0  00 02 00 00 a0 ac 00 00  80 b5 00 00 a0 ac 00 00  |................|
000001e0  de c0 ad 0b 00 00 0f e1  1f 00 c0 e3 d3 00 80 e3  |................|
000001f0  00 f0 29 e1 bc d0 9f e5  07 d0 cd e3 00 00 a0 e3  |..).............|
00000200  70 05 00 eb 00 40 a0 e1  01 50 a0 e1 02 60 a0 e1  |p....@...P.....|
00000210  04 d0 a0 e1 8c 00 4f e2  00 90 46 e0 06 00 50 e1  |......O...F...P.|
00000220  06 00 00 0a 06 10 a0 e1  5c 30 1f e5 03 20 80 e0  |........\0... ..|
00000230  00 06 b0 e8 00 06 a1 e8  02 00 50 e1 fb ff ff 3a  |..........P....:|
00000240  74 00 9f e5 74 10 9f e5  00 20 a0 e3 01 00 50 e1  |t...t.... ....P.|
00000250  02 00 00 2a 00 20 80 e5  04 00 80 e2 fa ff ff ea  |...*. ..........|
00000260  00 00 9f e5 00 f0 a0 e1  54 06 00 00 a0 ac 00 00  |........T.......|
00000270  a0 ac 00 00 a0 ac 00 00  00 00 a0 e3 17 0f 07 ee  |................|
00000280  17 0f 08 ee 10 0f 11 ee  23 0c c0 e3 87 00 c0 e3 |........#.......|
00000290  02 00 80 e3 01 0a 80 e3  10 0f 01 ee 0e c0 a0 e1  |................|
000002a0  0a 00 00 eb 0c e0 a0 e1  0e f0 a0 e1 00 00 a0 e1  |................|
000002b0  e8 d0 1f e5 fe ff ff eb  00 80 00 bc a0 ae 00 00 |................|
000002c0  80 b7 00 00 00 00 a0 e1  00 00 a0 e1 00 00 a0 e1  |................|
000002d0  68 00 9f e5 00 10 e0 e3  00 10 80 e5 00 00 0f e1  |h...............|
000002e0  c0 00 80 e3 00 f0 21 e1  54 00 9f e5 54 10 9f e5  |......!.T...T...|
000002f0  00 10 80 e5 50 00 9f e5  50 10 9f e5 00 10 80 e5  |....P...P.......|
00000300  4c 00 9f e5 05 14 a0 e3  00 10 80 e5 44 00 9f e5  |L...........D...|
00000310  44 10 9f e5 00 10 80 e5  03 2a a0 e3 01 20 52 e2  |D........*... R.|
00000320  fd ff ff 1a 20 00 9f e5  30 10 9f e5 00 10 80 e5  |.... ...0.......|
00000330  01 2b a0 e3 01 20 52 e2  fd ff ff 1a 0e f0 a0 e1 |.+... R.........|
00000340  24 21 00 b8 04 10 00 b0  84 00 04 40 04 02 00 b0  |$!.........@....|
00000350  ff 0f 00 00 08 02 00 b0  0c 02 00 b0 24 4f 00 00  |............$O..|
00000360  fc 0f 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000370  00 00 51 e3 1f 00 00 0a  01 30 a0 e3 00 20 a0 e3  |..Q......0... ..|
00000380  01 00 50 e1 19 00 00 3a  01 02 51 e3 00 00 51 31  |..P....:..Q...Q1|
00000390  01 12 a0 31 03 32 a0 31  fa ff ff 3a 02 01 51 e3  |...1.2.1...:..Q.|
000003a0  00 00 51 31 81 10 a0 31  83 30 a0 31 fa ff ff 3a  |..Q1...1.0.1...:|
000003b0  01 00 50 e1 01 00 40 20  03 20 82 21 a1 00 50 e1  |..P...@ . .!..P.|
000003c0  a1 00 40 20 a3 20 82 21  21 01 50 e1 21 01 40 20  |..@ . .!!.P.!.@ |
000003d...