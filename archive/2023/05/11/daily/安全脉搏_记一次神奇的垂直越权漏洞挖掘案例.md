---
title: 记一次神奇的垂直越权漏洞挖掘案例
url: https://www.secpulse.com/archives/200200.html
source: 安全脉搏
date: 2023-05-11
fetch_date: 2025-10-04T11:36:55.530405
---

# 记一次神奇的垂直越权漏洞挖掘案例

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 记一次神奇的垂直越权漏洞挖掘案例

[漏洞](https://www.secpulse.com/archives/category/vul)

[潇湘信安](https://www.secpulse.com/newpage/author?author_id=37983)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng3.png)

2023-05-10

11,430

|  |
| --- |
| **声明：**该公众号大部分文章来自作者日常学习笔记，也有部分文章是经过作者授权和其他公众号白名单转载，未经授权，严禁转载，如需转载，联系开白。  请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。 |

现在只对常读和星标的公众号才展示大图推送，建议大家把潇湘信安“设为星标”，否则可能看不到了！

这篇文章由群里某位师傅原创投稿，打码较为严重，主要分享的是一次垂直越权漏洞的挖掘思路，希望大家能够从中有所收获吧！

**0x01 背景**

某个阳光明媚的下午，技术组长安排了一个项目给我，本以为只是一个普普通通的渗透项目，没想到过程不普通，结果也不普通，算不上好，但是总归是收获了一个别致的越权漏洞。

**0x02 过程**

因为沟通不是很到位，开局直接被嘲讽、buff拉满（假装有图）。虽然很生气，但是作为安服仔的我只能吃包辣条消消火，手里不能放松，干他就完事儿了。

使用rad对网站JS简单爬取一下，爬到了许多js文件，其中一个名为common.js

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200200-1683706807.png)

尝试简单利用下，发现返回码大都是405或者302，405是使用的http方法不对，302是由于接口做了鉴权直接跳转至登录页面了。

客户提供了一个普通用户和管理员账户，先登录上管理员用户，然后调用接口：/user/getUserList?role=0

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200200-1683706808.png)

成功调用该接口使用get方法，并且无需添加其他参数即可成功。此时将接口路径复制到带有普通用户凭证的数据包中并且尝试请求，依然可以正常访问。

就挺开心的，发现了一个垂直越权漏洞，并且越权可以查看的内容包含700多个用户的信息。

分享给另一个测试的小伙伴：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200200-1683706809.png)

但是意外总是来的猝不及防，过了一段时间后再次测试，发现无法垂直越权查看了，直接返回状态码302，我重新登录普通用户获取新的用户凭证继续访问发现：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200200-16837068091.png)

淦，俺的垂直越权咋没了。重新登录了管理员用户，发现接口又可以正常使用。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200200-1683706810.png)

此时突发奇想，比对了管理员用户的SESSION值，发现普通用户和管理员的SESSION值一致。

联想前面管理员用户不在线，普通用户无法进行垂直越权，瞬间明白了这个特殊的垂直越权利用的最终奥义。

**原理：**

短时间内普通用户和管理员的用户凭证一致，当管理员在线的时候，普通用户可以直接越权，管理员不在线，无法越权。

回归到越权访问到的数据本身，发现了用户未加密的密码，尝试登录其中一个用户。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200200-1683706811.png)

整理出来770多条数据，也就是说拿到了770多个用户的账号和密码；得到的数据为json格式，这里我是用json5-to-table对数据进行处理。

json5-to-table是一个将json文件转化为html或者xlsx表格的工具，默认支持html表格，支持xlsx还需要额外安装扩展包。此次在kali 2021.2下测试安装：

**安装要求：**

```
npm版本为7
设置镜像仓库为淘宝的地址
```

**安装命令：**

```
npm config set registry https://registry.npm.taobao.org    # 配置淘宝镜像仓库
npm config get registry    # 有淘宝仓库地址即为配置成功

npm install --global json5-to-table    # 安装
json5-to-tablenpm install --global xlsx  # 安装支持json to xlsx的扩展包
```

**使用效果：**

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200200-16837068111.png)

整理过数据以后发现弱口令：123456的使用数量在722，占据所有用户比例的93%左右。

先将问题同步给甲方对应负责人（假装有图）；当场能给我笑死，然后在文字描述不行的时候，在电话里给负责人讲的时候牵扯到了这个特殊的垂直越权，然后他说这个洞之前就有了，并且询问能否更改数据？

然后我就从common.js文件里面掏出一个用户删除接口，当场创建个测试用户，然后用越权漏洞删除了那个测试用户。

**删除前：**

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200200-1683706817.png)

**删除后：**

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200200-1683706818.png)

除了这个垂直的越权以外，删除用户的时候也会返回所有用户的信息，就蛮离谱的，给到负责人：（假装有图）

**0x03 总结**

**1. 给开发大哥的建议：**

* 给用户生成凭证的时候一定要生成不一样，有问题及时修，拖着系统容易出大问题。

**2. 给各位好兄弟的建议：**

* 多观察、多想、多实践，总会挖出奇奇怪怪的漏洞。

**本文作者：[潇湘信安](newpage/author?author_id=37983)**

**本文为安全脉搏专栏作者发布，转载请注明：**[**https://www.secpulse.com/archives/200200.html**](https://www.secpulse.com/archives/200200.html)

Tags: [JS](https://www.secpulse.com/archives/tag/js)、[​Rad](https://www.secpulse.com/archives/tag/%E2%80%8Brad)、[垂直越权漏洞](https://www.secpulse.com/archives/tag/%E5%9E%82%E7%9B%B4%E8%B6%8A%E6%9D%83%E6%BC%8F%E6%B4%9E)、[越权漏洞](https://www.secpulse.com/archives/tag/%E8%B6%8A%E6%9D%83%E6%BC%8F%E6%B4%9E)

点赞：
1
[评论：0](#goComment)
收藏：
0

*新浪微博
QQ空间
微信扫一扫*

### 相关文章

* [![Java反序列化回显学习之Tomcat通用回显](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2023/05/1684907775563-300x214.png)

  Java反序列化回显学习之Tomcat通…](https://www.secpulse.com/archives/200930.html "详细阅读 Java反序列化回显学习之Tomcat通用回显")
* [![bypass！一个简单shellcode注入器](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2023/05/1683770184567-300x202.png)

  bypass！一个简单shellcode…](https://www.secpulse.com/archives/200219.html "详细阅读 bypass！一个简单shellcode注入器")
* [![从JS到内网横向](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2023/04/1682065936883-300x267.png)

  从JS到内网横向](https://www.secpulse.com/archives/199384.html "详细阅读 从JS到内网横向")

评论  (0)

昵称

必填
您当前尚未登录。
[登录？](https://www.secpulse.com/user_login "登录")
[注册](https://www.secpulse.com/user-register)

邮箱

必填（保密）

快来写下你的想法吧！

upload

|  |  |  |
| --- | --- | --- |
| [![]( https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2020/11/12/5abbd29a2ce13702d20784fb420161da-290x290.png)](https://www.secpulse.com/newpage/author?author_id=37983aaa) | [潇湘信安 ![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng3.png)](https://www.secpulse.com/newpage/author?author_id=37983) | |
| 文章数：57 | 积分： 15 |
| 关注微信公众号【潇湘信安】，一起学习网络安全知识！ | |

* [![阿波罗主机安全管理](/wp-content/themes/secpulse2017/img/product-agent.png)](https://linkage.duoyinsu.com)
* [![伏特漏洞扫描云平台](/wp-content/themes/secpulse2017/img/product-fute.png)](https://v.duoyinsu.com)

### 安全问答社区

![安全问答社区](https://www.secpulse.com/wp-content/themes/secpulse2017/img/xcx.png)

### 脉搏官方公众号

![脉搏公众号](https://www.secpulse.com/wp-content/themes/secpulse2017/img/SecPulse.png)

### 活动日程

[显示更多](https://www.secpulse.com/newpage/activity)

#### 2022-06-17

[Gdevops 全球敏捷运维峰会](https://www.bagevent.com/event/8022600?bag_track=AQMB)

#### 2022-05-12

[Mastering the Challenge！——来自The 3rd AutoCS 2022智能汽车信息安全大会的邀请函](https://autocs2022.artisan-event.com/)

#### 2021-11-18

[AutoSW 2021智能汽车软件开发大会](https://autosw2021.artisan-event.com)

#### 2021-06-27

[2021中国国际网络安全博览会暨高峰论坛](http://www.sins-expo.com)

#### 2021-05-27

[The 2nd Aut...