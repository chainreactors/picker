---
title: Dollar Signs in Attackers’ Eyes | How to Mitigate CVE-2022-26923
url: https://buaq.net/go-146550.html
source: unSafe.sh - 不安全
date: 2023-01-24
fetch_date: 2025-10-04T04:36:56.525956
---

# Dollar Signs in Attackers’ Eyes | How to Mitigate CVE-2022-26923

* [unSafe.sh - 不安全](https://unsafe.sh)
* [我的收藏](/user/collects)
* [今日热榜](/?hot=true)
* [公众号文章](/?gzh=true)
* [导航](/nav/index)
* [Github CVE](/cve)
* [Github Tools](/tools)
* [编码/解码](/encode)
* [文件传输](/share/index)
* [Twitter Bot](https://twitter.com/buaqbot)
* [Telegram Bot](https://t.me/aqinfo)
* [Search](/search/search)

[Rss](/rss.xml)

[ ]
黑夜模式

![](https://8aqnet.cdn.bcebos.com/1876654626fd4eb40b48bedf996cba28.jpg)

Dollar Signs in Attackers’ Eyes | How to Mitigate CVE-2022-26923

Microsoft released a Windows security update in May 2022, disclosing CVE-2022-26923 Active Director
*2023-1-23 22:37:29
Author: [www.sentinelone.com(查看原文)](/jump-146550.htm)
阅读量:30
收藏*

---

Microsoft released a Windows security update in May 2022, disclosing [CVE-2022-26923](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-26923) Active Directory Domain Services Elevation of privilege vulnerability. The CVE-2022-26923 allows a lower privileged user to acquire a certificate from Active Directory Certificate Services (AD CS) and escalate privileges to the domain controller. However, [issues with the update](https://threatpost.com/microsofts-may-patch-tuesday-updates-cause-windows-ad-authentication-errors/179631/) may have prevented some organizations from updating at the time, while others may have been unable to update due to local dependency or compatibility reasons.

In this post, we discuss AD CS misconfigurations that allow attackers to exploit this flaw and describe how security teams can mitigate this vulnerability.

![Dollar Signs in Attackers' Eyes How to Mitigate CVE-2022-26923 (2)](https://www.sentinelone.com/wp-content/uploads/2023/01/Dollar-Signs-in-Attackers-Eyes-How-to-Mitigate-CVE-2022-26923-2.jpg)

## What Is CVE-2022-26923?

According to Microsoft’s [advisory](https://support.microsoft.com/en-us/topic/kb5014754-certificate-based-authentication-changes-on-windows-domain-controllers-ad2c23b0-15d8-4340-a468-4d4f3b188f16), CVE-2022-26923 is one of three CVEs relating to an elevation of privilege vulnerability that can occur when the Kerberos Distribution Center (KDC) services a certificate-based authentication request. On unpatched systems, certificate-based authentication fails to account for a dollar sign ($) at the end of a machine name, allowing related certificates to be spoofed in various ways.

## What Is AD CS and Why Is It Important?

Before we dig deeper into the exposure, we will revise what Active Directory Certificate Services (AD CS) is and what it offers.

[AD CS](https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831740%28v%3Dws.11%29) is an identity technology in Windows Server that offers Public Key Infrastructure (PKI) functionality to facilitate capabilities such as Encrypting File System (EFS), domain authentication, digital signatures, and email security. AD CS is the Server Role that allows an organization to build Public Key Infrastructure (PKI) and provide public key cryptography, digital certificates, and digital signature capabilities.

While organizations plan to implement PKI by deploying AD CS in an Active Directory environment, they must manage configurations properly for issuing and revoking certificates, including ensuring that appropriate certificate trusts are in place.

Windows Server administrators are responsible for designing the certification authority hierarchy, implementing it, and managing the process of issuing and revoking certificates. It is essential to ensure that appropriate certificate trusts are in place. Any misconfigurations in AD CS role services can expose them to cyber attacks such as privilege escalation, [Golden Ticket Attacks](https://www.sentinelone.com/blog/how-kerberos-golden-ticket-attacks-are-signaling-a-greater-need-for-identity-based-security/), and AD Domain dominance.

## How Do Attackers Abuse AD CS and Exploit CVE-2022-26923?

Several security risks exist with AD CS misconfigurations. Let us discuss a couple of them. After running the command `certsrv.msc`, right-click on the [Certification Authority (CA)](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-csra/c6451297-197d-4b4b-b786-3f3187b67b8f#gt_c925d5d7-a442-4ba4-9586-5f94ccec847a) object, select Properties and navigate to the Security tab.

![](https://www.sentinelone.com/wp-content/uploads/2023/01/Properties-and-navigate-to-the-Security-tab.jpg)

Note that the “Request Certificates” permission is enabled by default. This setting will allow an authenticated user to request certificates from the AD CS server. As with the [CVE-2022-26923](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-26923), an authenticated user could manipulate attributes on computer accounts they own or manage and acquire a certificate from AD CS that would allow elevation of privilege to Domain Controller.

Another vulnerable misconfiguration exists with enrollment permissions of [certificate templates](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-csra/c6451297-197d-4b4b-b786-3f3187b67b8f#gt_9c47ca85-9343-4e01-96d4-53d96d3df60e). In Windows environments, certificate templates are stored as objects in the Active Directory and used by Microsoft enterprise CAs. A certificate template defines the content and purpose of a digital certificate, including issuing certificate policies and enrollment permissions. Enrollment permissions define the rules by which a certification authority (CA) will issue or deny certificate requests.

A standard User Certificate template may grant the Domain Users group with “*Enroll*“ permissions, as shown below.

![A standard User Certificate template may grant the Domain Users group with “Enroll“ permissions](https://www.sentinelone.com/wp-content/uploads/2023/01/A-standard-User-Certificate-template-may-grant-the-Domain-Users-group-with-Enroll-permissions.jpg)

Also, there are Enroll and Autoenroll permissions that are specific to certificate template objects, for example, the Workstation Authentication certificate template, as shown in the next image.

![](https://www.sentinelone.com/wp-content/uploads/2023/01/How-Do-Attackers-Abuse-AD-CS-and-Exploit-CVE-2022-26923.jpg)

An attacker can abuse these permissions on objects. If an attacker gains access to any template, it can be reconfigured to issue certificates and compromise the entire domain.

## Detection and Mitigation Factors for CVE-2022-26923

[Singularity™ Ranger® AD](https://www.sentinelone.com/platform/singularity-ranger-ad/) continuously monitors risks associated with misconfigurations, weak policies, credential harvesting, and privilege escalations at the domain, user, and device levels. The solution prevents attacks that attempt to exploit CVE-2022-26923 by detecting and remediating Active Directory Certificate Services exposures. As a mitigation strategy, the following best practices outline how to protect AD CS services from the exploitation of CVE-2022-26923.

## Exposure #1: Dangerous Access Rights That Expose Certificate Templates

Misconfigured permissions on certificate templates can allow an attacker to modify or request a certificate, and an attacker could use the certificate to elevate privileges.

![Dangerous Access Rights That Expose Certificate Templates](https://www.sentinelone.com/wp-content/uploads/2023/01/Dangerous-Access-Rights-That-Expose-Certificate-Templates.jpg)

To mitigate this:

1. Open the Certificate Authority Manager MMC from “Administrative Tools” or run the command “certsrv.msc”.
2. Expand the Certificate Authority.
3. Right Click “Certificate Templates” and Click “Manage”.
4. Select the Certificate Template listed in the Exposure.
5. Right Click on the Certificate Template and select “Properties”.
6. Select the “Security” tab.
7. Verify and remove the permissions listed in the exposure by [Singularity™ Ranger® AD](https://www.sentinelone.com/platform/singularity-ranger-ad/).
8. Click “Apply” and “Ok”.
9. Repeat the st...