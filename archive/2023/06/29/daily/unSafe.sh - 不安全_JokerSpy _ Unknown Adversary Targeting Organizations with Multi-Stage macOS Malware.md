---
title: JokerSpy | Unknown Adversary Targeting Organizations with Multi-Stage macOS Malware
url: https://buaq.net/go-170746.html
source: unSafe.sh - 不安全
date: 2023-06-29
fetch_date: 2025-10-04T11:46:26.853160
---

# JokerSpy | Unknown Adversary Targeting Organizations with Multi-Stage macOS Malware

* [unSafe.sh - 不安全](https://unsafe.sh)
* [我的收藏](/user/collects)
* [今日热榜](/?hot=true)
* [公众号文章](/?gzh=true)
* [导航](/nav/index)
* [Github CVE](/cve)
* [Github Tools](/tools)
* [编码/解码](/encode)
* [文件传输](/share/index)
* [Twitter Bot](https://twitter.com/buaqbot)
* [Telegram Bot](https://t.me/aqinfo)
* [Search](/search/search)

[Rss](/rss.xml)

[ ]
黑夜模式

![](https://8aqnet.cdn.bcebos.com/d51585e8ade7d251b0630f38189e9cf2.jpg)

JokerSpy | Unknown Adversary Targeting Organizations with Multi-Stage macOS Malware

Recent reports from researchers at BitDefender and Elastic have exposed an active adversary deployi
*2023-6-28 21:41:31
Author: [www.sentinelone.com(查看原文)](/jump-170746.htm)
阅读量:28
收藏*

---

Recent reports from researchers at [BitDefender](https://www.bitdefender.com/blog/labs/fragments-of-cross-platform-backdoor-hint-at-larger-mac-os-attack/) and [Elastic](https://www.elastic.co/de/security-labs/inital-research-of-jokerspy) have exposed an active adversary deploying novel spyware, cross-platform backdoors and an open-source reconnaissance tool to compromise organizations with macOS devices in their fleets. Although the number of known victims at this time is small, the nature of the tooling suggests that the threat actors have likely targeted other organizations.

In this post, we review the key components and indicators used in the campaign to help raise awareness and aid security teams and threat hunters.

![](https://www.sentinelone.com/wp-content/uploads/2023/06/JokerSpy-Unknown-Adversary-Targeting-Organizations-with-Multi-Stage-macOS-Malware-4-1024x536.jpg)

## QRLog | Suspected Infection Vector

There is little information about how initial compromise was achieved in the known compromises, but analysis of the known components provide a strong link to a trojanized QR code generator discovered in the wild in February 2023.

According to researcher [Mauro Eldritch](https://twitter.com/MauroEldritch/status/1624033133568876544), QRLog is a trojanized QR code generator written in Java that opens a reverse shell on the host device, allowing the attacker privileged access. The malicious code is hidden inside a file `QRCodeWriter.java`, buried in an otherwise legitimate open source QR code project.

![Base64 blob is an encoded Java file](https://www.sentinelone.com/wp-content/uploads/2023/06/jokerspy_10-1024x465.jpg)

Base64 blob is an encoded Java file

After determining the host device’s operating system, [QRLog](https://otx.alienvault.com/pulse/63e50c46063dd5d3a5992804) decodes an embedded base64 blob and writes it out to a temporary directory and executes it.

![QRLog changes the path separator to suit Windows or Posix-compatible systems like Linux and macOS](https://www.sentinelone.com/wp-content/uploads/2023/06/jokerspy_4-1024x424.jpg)

QRLog changes the path separator to suit Windows or Posix-compatible systems like Linux and macOS

The decoded blob is a `.java` file that reaches out to a C2 at `hxxps[:]//www[.]git-hub.me/view.php`. This is the same C2 as used in the compromise reported by BitDefender (see below).

![QRLog uses the same C2 seen in an ITW JokerSpy intrusion](https://www.sentinelone.com/wp-content/uploads/2023/06/jokerspy_2.jpg)

QRLog uses the same C2 later seen in an ITW JokerSpy intrusion

If the QRLog malware receives the right response from the C2, it then writes two further files – `p.dat` and a Java executable `prefTmp.java` – to the temp directory and executes the latter, which now opens the reverse shell from the victim to the attacker.

![The prefTmp.java files opens a reverse shell to the attacker](https://www.sentinelone.com/wp-content/uploads/2023/06/jokerspy_7-1024x302.jpg)

The *prefTmp.java* files opens a reverse shell to the attacker

## Shared.dat & sh.py | Cross-Platform Python Backdoors

In the intrusions seen to date, researchers identified two Python backdoors, `shared.dat` and `sh.py`. The former uses a simple [rot13](https://gchq.github.io/CyberChef/#recipe=ROT13(true,true,false,13)&input=J1BoZWVyYWcgR3Z6cjpcdCcKJ0hmcmVhbnpyOlx0JwonVWJmZ2FuenI6XHQnCidCRiBJcmVmdmJhOlx0JwonL3JncC9iZi1lcnlybmZyJwonVlFfWVZYUj1xcm92bmEnCidxcm92bmEnLCBoZGxfaW5wKQonVlE9cXJvdm5hJywgaGRsX2lucCkpICE9IC0xOgoncXJvdm5hJywgaGRsX2lucCkKJ1ZRPXNycWJlbicsIGhkbF9pbnApKSAhPSAtMToKJ3NycWJlbicsIGhkbF9pbnApCidiZ3VyZSB5dmFoaycsIGhkbF9pbnApCidwcCAtYiAvZ3pjLy5WUFItaGF2ay90dmcgJwoncXJvdm5hJwondHBwIC1iIC9nemMvLlZQUi1oYXZrL3R2ZyAnCicgLXlhZnkgLXljZ3Vlcm5xIC15ZXJmYnlpIC1mZ3E9dGFoOTknCicvZ3pjLy5WUFItaGF2ay90dmcgJwonL0hmcmVmL0Z1bmVycScKJy9OY2N5ck5wcGJoYWcuZ3RtJwonZ25lIG1raXMgJwonL0hmcmVmL0Z1bmVycScsCicvSGZyZWYvRnVuZXJxJwonL0dyemNIZnJlL05jY3lyTnBwYmhhZ05mZnZmZ25hZy5uY2MnCidKdmFxYmpmJwonWXZhaGsnCidRbmVqdmEnCg) string obfuscation technique.

![](https://www.sentinelone.com/wp-content/uploads/2023/06/jokerspy_1-1024x219.jpg)

![Deobfuscated strings found in shared.dat backdoor](https://www.sentinelone.com/wp-content/uploads/2023/06/jokerspy_3.jpg)

Deobfuscated strings found in *shared.dat* backdoor

The script’s behavior depends on the response from the server, whose address is hardcoded in plain text. In the intrusion seen by BitDefender, the C2 matched that seen in the QRLog malware. `shared.dat` also uses the same strings found in QRLog to identify packets sent and received from the C2, namely “GITHUB\_RES” and “GITHUB\_REQ”.

![C2 in shared.dat is the same as noted in QRLog malware](https://www.sentinelone.com/wp-content/uploads/2023/06/Screenshot-2023-06-28-at-2.21.22-PM.jpg)

C2 in *shared.dat* is the same as noted in QRLog malware

A simple conditional parses the responses.

![Parsing commands from the C2 in the shared.dat backdoor](https://www.sentinelone.com/wp-content/uploads/2023/06/jokerspy_11-1024x658.jpg)

Parsing commands from the C2 in the *shared.dat* backdoor

If the device is identified as a macOS device, the malware downloads and executes the next stage to `/Users/Shared/AppleAccount.tgz`, which in turn decodes a further stage to `/Users/Shared/TempUser/AppleAccountAssistant.app`.

The `sh.py` backdoor is also multi-platform and requires a separate configuration file stored at `~/Public/Safari/sar.dat`, likely containing the C2 as well as other parameters. The C2 observed by Elastic in an attack on an unnamed [Japanese cryptocurrency exchange](https://thehackernews.com/2023/06/japanese-cryptocurrency-exchange-falls.html) was `app.influmarket[.]org`.

The backdoor is capable of surveilling the host device and executing commands, exfiltrating data and deleting files.

![The sh.py script is a cross-platform backdoor](https://www.sentinelone.com/wp-content/uploads/2023/06/jokerspy_6-1024x774.jpg)

The *sh.py* script is a cross-platform backdoor

Depending on the value received from the configuration file, the backdoor will beacon out to the C2 at regular intervals, the default being 5 seconds. Information sent to the attacker includes:

* Current working directory
* Username
* Hostname
* Domain name
* OS version
* Python version
* Path to sh.py

According to researchers at Elastic, the `sh.py` script was seen dropping the open-source macOS red-teaming tool [SwiftBelt](https://github.com/cedowens/SwiftBelt) to the file path `/Users/shared/sb` and writing out to a file `sb.log` in the same directory.

```
/bin/sh -c /users/shared/sb > /users/shared/sb.log 2>&1
```

## JokerSpy | macOS Spyware Stager

In both intrusions seen to date, a further macOS only component was observed. The file, named “xcc”, attempts to hide as an XProtect component, and uses the Launch Services identifier `com.apple.xprotectcheck`.

```
Identifier=XProtectCheck-55554944f74096a836b73310bd55d97d1dff5cd4
Format=Mach-O universal (x86_64 arm64)
CodeDirectory v=20400 size=911 flags=0x2(adhoc) hashes=17+7 location=embedded
Hash type=sha256 size=32
CandidateCDHash sha256=89706d1258b6f1c165ff8d1d6d13346e02b48e22
CandidateCDHashFull sha256=89706d1258b6f1c165ff8d1d6d13346e02b48e22d1a741ff451d1cb6ba81bab2
Hash choices=sha256
CMSDigest=89706d1258b6f1c165ff8d1d6d13346e02b48e22d1a74...