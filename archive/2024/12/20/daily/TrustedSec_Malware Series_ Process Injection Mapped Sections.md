---
title: Malware Series: Process Injection Mapped Sections
url: https://trustedsec.com/blog/malware-series-process-injection-mapped-sections
source: TrustedSec
date: 2024-12-20
fetch_date: 2025-10-06T19:42:08.467427
---

# Malware Series: Process Injection Mapped Sections

[Skip to Main Content](#main)

All Trimarc services are now delivered through TrustedSec!
[Learn more](https://trustedsec.com/about-us/news/trimarc-joins-forces-with-trustedsec-to-strengthen-security-advisory-services)

Close

[TrustedSec](https://trustedsec.com/)

* [Solutions](https://trustedsec.com/solutions)

  ## Solutions

  Our custom solutions are tailored to address the unique challenges of different roles in security.

  [Solutions](https://trustedsec.com/solutions)

  + [01

    For Leadership

    We understand the challenges facing modern executives and develop solutions unique to leaders.](https://trustedsec.com/solutions/for-leadership)
  + [02

    For Operations

    We stay one step ahead to proactively safeguard our clients and partners.](https://trustedsec.com/solutions/for-operations)
  + [03

    For Infrastructure

    From architecture to resiliency and maintainability, we keep your tech aligned to best practices.](https://trustedsec.com/solutions/for-infrastructure)
  + [04

    For Assurance

    Our compliance experts guide partners through regulatory requirements to ensure standards are met.](https://trustedsec.com/solutions/for-assurance)
* [Services](https://trustedsec.com/services)

  ## Services

  From building to testing to hardening, our services support security at every stage.

  [Services](https://trustedsec.com/services)

  + [01

    Design

    Design an exceptional, custom security program alongside our security experts.](https://trustedsec.com/services/design)
  + [02

    Evaluate

    Evaluate your security program with proven assessment methodologies.](https://trustedsec.com/services/evaluate)
  + [03

    Harden

    Harden your security program with the help of our security experts.](https://trustedsec.com/services/harden)
  + [04

    Respond

    Respond to threats to your security program with the help of our security experts.](https://trustedsec.com/services/respond)
* [Research](https://trustedsec.com/research)
* [Blog](https://trustedsec.com/blog)
* [Resources](https://trustedsec.com/resources)
* [About Us](https://trustedsec.com/about-us)

  ## About Us

  Driven by purpose, fueled by experts.

  [About Us](https://trustedsec.com/about-us)

  + [01

    Our Team

    Meet our security experts.](https://trustedsec.com/about-us/our-team)
  + [02

    Our Partners

    Become a TrustedSec partner to help your customers anticipate and prepare for potential attacks.](https://trustedsec.com/about-us/our-partners)
  + [03

    News

    Our team is trusted by local and national media to be the subject matter experts for security news.](https://trustedsec.com/about-us/news)
  + [04

    Events

    See our upcoming webinars, conferences, talks, trainings, and more!](https://trustedsec.com/about-us/events)

Search

Menu

Search Input

Search

* [Contact Us](https://trustedsec.com/contact)
* [Report a breach](https://trustedsec.com/report-a-breach)

* [Solutions](https://trustedsec.com/solutions)
* [Services](https://trustedsec.com/services)
* [Research](https://trustedsec.com/research)
* [Blog](https://trustedsec.com/blog)
* [Resources](https://trustedsec.com/resources)
* [About Us](https://trustedsec.com/about-us)

Search

* [Contact Us](https://trustedsec.com/contact)
* [Report a breach](https://trustedsec.com/report-a-breach)

* [Blog](https://trustedsec.com/blog)
* [Malware Series: Process Injection Mapped Sections](https://trustedsec.com/blog/malware-series-process-injection-mapped-sections)

December 19, 2024

# Malware Series: Process Injection Mapped Sections

Written by
Scott Nusbaum

Malware Analysis

![](https://trusted-sec.transforms.svdcdn.com/production/images/Blog-Covers/ProcessInjectionMappedSections_WebHero.jpg?w=320&h=320&q=90&auto=format&fit=crop&dm=1734469269&s=ad9f10ae90a38826fb3d871d0118842b)

Table of contents

* [How does it work?](#HowWorks)
* [Code Demonstration in C# and C++](#CodeDemo)
* [Reversing the Executables](#Reversing)

Share

* Share URL
* [Share via Email](/cdn-cgi/l/email-protection#b689c5c3d4dcd3d5c28bf5ded3d5dd938486d9c3c2938486c2dedfc5938486d7c4c2dfd5dad3938486d0c4d9db938486e2c4c3c5c2d3d2e5d3d593848790d7dbc68dd4d9d2cf8bfbd7dac1d7c4d3938486e5d3c4dfd3c59385f7938486e6c4d9d5d3c5c5938486ffd8dcd3d5c2dfd9d8938486fbd7c6c6d3d2938486e5d3d5c2dfd9d8c59385f7938486dec2c2c6c59385f79384f09384f0c2c4c3c5c2d3d2c5d3d598d5d9db9384f0d4dad9d19384f0dbd7dac1d7c4d39bc5d3c4dfd3c59bc6c4d9d5d3c5c59bdfd8dcd3d5c2dfd9d89bdbd7c6c6d3d29bc5d3d5c2dfd9d8c5 "Share via Email")
* [Share on Facebook](http://www.facebook.com/sharer.php?u=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fmalware-series-process-injection-mapped-sections "Share on Facebook")
* [Share on X](http://twitter.com/share?text=Malware%20Series%3A%20Process%20Injection%20Mapped%20Sections%3A%20https%3A%2F%2Ftrustedsec.com%2Fblog%2Fmalware-series-process-injection-mapped-sections "Share on X")
* [Share on LinkedIn](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Ftrustedsec.com%2Fblog%2Fmalware-series-process-injection-mapped-sections&mini=true "Share on LinkedIn")

We're back with another post about common malware techniques. This time, we are talking about using shared memory sections to inject and execute code in a remote process. This method of process injection uses Windows Section Objects to create a memory region that can be shared between processes. In the process created by the attacker, a memory section is created with privileges to share with other processes. The shellcode is copied into this memory region, which is mirrored into all processes sharing the view of this memory section. The section is then mapped to the remote processes and a new thread is started in the remote processes to execute the code.

We will demonstrate this method in C and C#, like we have in previous posts.

## How does it work?

![](https://trusted-sec.files.svdcdn.com/production/images/Blog-assets/ProcessInjection_Nusbaum/Fig1_Nubaum.gif?dm=1734469434)

FIgure 1 – Illustration of the Injection process

The main goal of all injection methods is to execute code into the memory space of a remote process. This method uses the Windows API NtCreateSection function. The NtCreateSection will create a section of memory to share between processes. This memory doesn't live in the virtual memory region of the calling application but in the kernel. These memory spaces can be backed by files or pages (actual memory). When an application wants access to this memory area, it needs to create a view. The view is then mapped into the process's virtual memory using its memory management.

Depending on the way the memory is set up, the view can allow the process to read, write, or execute the memory view. This technique will create a Section Object (NtCreateSection) backed by memory and shared with other processes. Even though the malicious process created the Section Object, it will need to create a view in order to manipulate it. The view is created with the NtMapViewOfSection api call. The first view created will belong to the malicious process and only needs permissions to read and write to the Section Object, since we will not be executing the shellcode from this process.

After the local Section Object is mapped into the malicious process’s memory, we will then map the same Section Object into a remote target process's memory space using the same NtMapViewOfSection call.

It is worth noting that the address of the mapped sections will vary depending on the memory layout of each process, so don't expect the addresses to be the same. Instead of providing the handle to the malicious process, we will use OpenProcess Api to get a handle to a remote process. Note this process needs to be one that we have permission to access, i.e., a process owned by the same user.

The main difference between the local and remote mapped sections is that the remote section needs to have the read, write, and execute permissions. The write permission depends on the shellcode in use.

Metas...