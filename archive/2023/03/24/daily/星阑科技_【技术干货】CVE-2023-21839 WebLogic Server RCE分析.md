---
title: 【技术干货】CVE-2023-21839 WebLogic Server RCE分析
url: https://mp.weixin.qq.com/s?__biz=Mzg5NjEyMjA5OQ==&mid=2247497346&idx=1&sn=57cb4f410d05e0cac2a9374b7159bf5d&chksm=c0075b1ef770d2080581a836776027b29083afa95721a3cb4b66bae3ac3163d1a0a695d30ade&scene=58&subscene=0#rd
source: 星阑科技
date: 2023-03-24
fetch_date: 2025-10-04T10:30:03.103789
---

# 【技术干货】CVE-2023-21839 WebLogic Server RCE分析

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCtTPBiaGfgAwAvQ86SIwgHNvxR65PiaibaicANP7uOkQkkDQ3o6Km6ZGic8Q/0?wx_fmt=jpeg)

# 【技术干货】CVE-2023-21839 WebLogic Server RCE分析

星阑科技

以下文章来源于星阑实验室
，作者PortalLab

![](http://wx.qlogo.cn/mmhead/Q3auHgzwzM7I2gqBRVgAVpkPNqBsibrgE0DM5mTmZIRYzgFUNPjF59g/0)

**星阑实验室**
.

聚焦API安全最新资讯，分享API安全研究成果

![](https://mmbiz.qpic.cn/mmbiz_gif/Cc8QqLUKOeiaFHTFtiatmEIxZQcXOHfyr6GOBM88IeMm28ybjSAHEJKicuQxPxN5L5NFZ5mza2NOnuokf9ant2fUQ/640?wx_fmt=gif)

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1NSkNgX8voWSJmuSUlcQtsLKWSxBUmsxRCOqbNibhhXFuhtfXiak5ibYGMcEGD9yzzIy4qVq1Q5a63IQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1NSkNgX8voWSJmuSUlcQtsLgZE9TXJrsxHuabVS0UbocSyplzJJ0pxtQQZpAzIBdZwlByjZ3qUUAQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "好看的图.png")

**xxhzz**

**@PortalLab实验室**

**项目介绍**

WebLogic是美国Oracle公司出品的一个application server，确切的说是一个基于JAVAEE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器。将Java的动态功能和Java Enterprise标准的安全性引入大型网络应用的开发、集成、部署和管理之中。

**漏洞描述**

WebLogic存在远程代码执行漏洞，该漏洞允许未经身份验证的远程攻击者通过T3/IIOP协议网络访问并破坏易受攻击的WebLogic服务器，成功利用此漏洞可能导致Oracle WebLogic服务器被接管或敏感信息泄露。漏洞原理其实是通过Weblogic t3/iiop协议支持远程绑定对象bind到服务端，当远程对象继承自OpaqueReference时，lookup查看远程对象时，服务端调用远程对象getReferent方法，其中的remoteJNDIName参数可控，导致攻击者可利用rmi/ldap远程协议进行远程命令执行。

**利用范围**

Oracle WebLogic Server 12.2.1.3.0

Oracle WebLogic Server 12.2.1.4.0

Oracle WebLogic Server 14.1.1.0.0

**漏洞分析**

**环境搭建**

本次漏洞分析复现的版本为：Oracle WebLogic Server 12.2.1.3

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcC1ShusG4t8Wle9j1BxEulqVK3bUKwe0S6ibcgKicWMSz7xLeypfGIItsQ/640?wx_fmt=png)

weblogic10 及以后的版本，不能直接使用server/lib 目录下的 weblogic.jar 了，需要手动执行一个命令生成手动生成 wlfullclient.jar

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCkKYjlCVPGd8yWXd0foctTOLviad2zBg6HgjtyqoaKqibVKZfnJ9OBY8Q/640?wx_fmt=png)

新建JAVA项目，导入生成的wlfullclient.jar

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcC6nFdeeWjTW2OJGicM5HibUtibjTqvWo1BoQ2lZrjMMJoiajSMHAV7Ticn3g/640?wx_fmt=png)

POC如下图所示：

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcC2Jdq5ok0CKn2F0OeRfHZHntficsCulkyqFpdwr1vT15lsg7V8bYg88w/640?wx_fmt=png)

**动态分析**

漏洞POC

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCQPf8R2C3RjoBicRmSJxF2PwS88IEthx3zz0YNANDme1qicPvia43UCShA/640?wx_fmt=png)

从POC代码上来看，核心的部分是方法中将通过调用getInitialContext方法创建一个InitialContext对象；使用反射访问和修改ForeignOpaqueReference对象中的私有字段jndiEnvironment和emoteJNDIName，调用InitialContext对象的bind方法，将ForeignOpaqueReference对象绑定到JNDI服务，最后调用InitialContext对象的lookup方法，执行查找。

**漏洞利用类之一：**weblogic.deployment.jms.ForeignOpaqueReference

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCvXKHuicJIUzmMQAk4TQzSB4680AgYR4Z3sQHUqOoz8px8Zv9OEdWVkQ/640?wx_fmt=png)

分析ForeignOpaqueReference这个类，其实继承了QpaqueReference接口

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCmtN0vSzHgw4iatdjdfblv1HiaDmq0hTXzTgKIsOZnChjmabFzj6DKs2A/640?wx_fmt=png)

而QpaqueReference在官方文档中提示了当实现此接口的对象从 WLContext 中检索（通过查找或 listBindings）时，由 getReferent() 返回对象。

其实就也明白了为什么在POC中远程绑定了ForeignOpaqueReference对象，实际是因为ForeignOpaqueReference继承QpaqueReference，在远程查询该对象的时候，调用的将会是ForeignOpaqueReference.getReferent方法。

接下来就一步步分析一下weblogic.deployment.jms.ForeignOpaqueReference.getReferent（）方法。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCA0PV8gs5gXFParD5Y9xwYo4RMoIA38DibQCaicr02wicCXWu1GsiaxZN6g/640?wx_fmt=png)

在后续的进行lookup操作之前会检查 JNDI 环境是否已正确配置以访问远程资源，主要是对jndiEnvironment和remoteJNDIName的检测，如果在if中的任何一个条件为真，那么将调用对象的lookup方法，如果 if 语句中的所有条件都为假，则会进入检查cachedReferent字段的阶段。结合上面方框的代码其实可以发现，只要this.jndiEnvironment不为空，就可以对InitialContext进行初始化，this.jndiEnvironment也可以使用反射的方式进行赋值。

通过retVal = context.lookup(evalMacros(this.remoteJNDIName))的实现，便可以利用rmi/ldap远程协议进行命令执行。

后续调试，进入bind方法，可以看到绑定的对象中通过反射对remoteJNDIName 和 jndiEnvironment属性赋值。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCoEAFBGbzDk5IWqWY9ndiacdmNicOsiaXNAbrn8KqAbn3ZekwmJMsN1LUg/640?wx_fmt=png)

ClusteravleRemoteRef.invoke

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCpdzAHspEepZLfeHcqISdiaZwRWvW7QXbO2OQwtxYmPwyMZqwEq23fibw/640?wx_fmt=png)

后续调试其实发现已经远程获取并加载了恶意类。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCZkCvl8JwicmcnRlSywNhWMGte80n9RTLOguibuvCZMNDIMLicf0UB3fBw/640?wx_fmt=png)

并成功利用ldap协议进行远程命令执行。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCGw6l7yyjwic647VLuibibTeAb5tLNTjEI5W7r9lRdk6HTCo3NejFNmuXg/640?wx_fmt=png)

在weblogic.jndi.internal.ForeignOpaqueReference这个类下同样可以利用IIOP协议实现JNDI注入。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCibCasr77FbYC2xClvK2aickicHcicSSDTnTnVAU1cPqbncacfajVOpamaw/640?wx_fmt=png)

**漏洞复现**

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1M7uiaYiahpRicncn2JHbibBCcCnQwrfpm46JLzXsiaslCcBqhiby3nZibXbZcs1ibRAbjic5ic0cXCLO8jWtNQ/640?wx_fmt=png)

**漏洞建议**

1、目前Oracle已经修复该漏洞并发布补丁，受影响的用户可参考官方通告及时下载并更新补丁，下载地址：https://support.oracle.com/rs?type=doc&id=2917213.2。

2、通过控制T3协议的访问来阻断利用T3协议的漏洞攻击。

3、通过关闭IIOP协议来阻断利用IIOP协议的漏洞攻击。

**参考材料**

1.Oracle Critical Patch Update Advisory - January 2023

2.https://www.pingsafe.com/blog/cve-2023-21839-oracle-weblogic-server-core-patch-advisory

3.https://docs.oracle.com/html/E80373\_03/weblogic/jndi/OpaqueReference.html

https://docs.oracle.com/en/

**关于Portal Lab**

星阑科技 Portal Lab 致力于前沿安全技术研究及能力工具化。主要研究方向为API 安全、应用安全、攻防对抗等领域。实验室成员研究成果曾发表于BlackHat、HITB、BlueHat、KCon、XCon等国内外知名安全会议，并多次发布开源安全工具。未来，Portal Lab将继续以开放创新的态度积极投入各类安全技术研究，持续为安全社区及企业级客户提供高质量技术输出。

**往期 · 推荐**

[![](https://mmbiz.qpic.cn/mmbiz_jpg/Cc8QqLUKOegoGL5ScibX9RqY6PqMAtnoZfER1hSGkj87C4oXR4PqW7CM8tiavmQur8O7WZQyZgVLn1wKwHsibcvEg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=Mzg5NjEyMjA5OQ==&mid=2247492888&idx=1&sn=219ad26c37836f5cdefc5f41dea620c0&chksm=c0074884f770c192f60f651f3e0c6a0f293b38a59d9499a89cd1b9c2e2d8cbc4dd4620783ed1&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/Cc8QqLUKOegoGL5ScibX9RqY6PqMAtnoZQtEDMUM2CZ3jqhq9cO3DtWcP2KgvjlDJia2Arlsw9IrGfWPEO7RYl3w/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=Mzg5NjEyMjA5OQ==&mid=2247492771&idx=1&sn=5bc86cbf62a83db69b1b1919ad86273b&chksm=c007493ff770c0290f199daef6b03bd09f9f85e35c5179c3ca8fe062623ecc27522b45850f0a&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/Cc8QqLUKOegoGL5ScibX9RqY6PqMAtnoZ1qIhLiasDXUrUT4RWJ7zFYmTMVWz1ww66AqdvxjF9ynLOR7139xQib7Q/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=Mzg5NjEyMjA5OQ==&mid=2247492691&idx=1&sn=7f4fdf863953280d024c2ae7144badff&chksm=c00749cff770c0d98d9848f5415e2c7b395add84d39e4ab51172549c024d36cfc80af23ad43e&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/Cc8QqLUKOegoGL5ScibX9RqY6PqMAtnoZRibR6e5iawhrSuV4TM3ib9AssGQNZ9SPQGCic3G3M9PgpLt5GafnkEiaPmw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=Mzg5NjEyMjA5OQ==&mid=2247492617&idx=1&sn=103b4a185c02f1435ddcc1778bd038e6&chksm=c0074995f770c08374efe7cda4e53a8991a867e2b1b73fe05f0f4a32335756a56c77483ee75f&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_gif/Cc8QqLUKOehwcHoxicoOah5mxDjLHMZ9RHUxNeibERphRXOj3AEupxt7JyOt3LF1RmmWQibYmicTv2DxM93iaEJhLxw/640?wx_fmt=gif)

预览时标签不可点

![]()

微信扫一扫
关注该公众号

继续滑动看下一个

轻触阅读原文

![](http://mmbiz.qpic.cn/mmbiz_png/Cc8QqLUKOegqicSqJoUd8bSLhdEYnZt3HwOB3tQXas2d1T2xlXc1K1hVMIl1qLxY6qwm5kFbJ6YURBkoXUtPoiaA/0?wx_fmt=png)

星阑科技

向上滑动看下一个

知道了

![]()
微信扫一扫
使用小程序

取消
允许

取消
允许

取消
允许

×
分析

![跳转二维码]()

![作者头像](http://mmbiz.qpic.cn/mmbiz_png/Cc8QqLUKOegqicSqJoUd8bSLhdEYnZt3HwOB3tQXas2d1T2xlXc1K1hVMIl1qLxY6qwm5kFbJ6YURBkoXUtPoiaA/0?wx_fmt=png)

微信扫一扫可打开此内容，
使用完整服务

：
，
，
，
，
，
，
，
，
，
，
，
，
。

视频
小程序
赞
，轻点两下取消赞
在看
，轻点两下取消在看
分享
留言
收藏
听过