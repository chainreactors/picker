---
title: APT-C-20（APT28）使用复合攻击战术的攻击活动分析
url: https://mp.weixin.qq.com/s?__biz=MzUyMjk4NzExMA==&mid=2247501024&idx=1&sn=d93b1d195596dcc3d5fb41ca18006dfe&chksm=f9c1f7e9ceb67effd3a5e2bf3a5a6f1212e95dc748f6bd353890ab1454bfc53887caeb40bb6d&scene=58&subscene=0#rd
source: 360威胁情报中心
date: 2024-10-11
fetch_date: 2025-10-06T18:59:36.790919
---

# APT-C-20（APT28）使用复合攻击战术的攻击活动分析

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/6CNEHNicic4Pqn1ULO84QjnlGTNh9k2tUFtfpqicIGGWHJKOURJAvZxO7X6JqKuNvX1eribYRO2NEAYsRQibRcDGYtA/0?wx_fmt=jpeg)

# APT-C-20（APT28）使用复合攻击战术的攻击活动分析

高级威胁研究院

360威胁情报中心

**APT-C-20**

**APT28**

APT-C-20（APT28）也被称为Fancy Bear、Sofacy或Sednit，活跃于网络空间已有十多年，其攻击目标遍及全球多个国家和地区，涉及政府、军事、媒体、能源等多个关键领域。

APT-C-20（APT28)）以其高超的技术手段和复杂的攻击策略而闻名。他们善于利用多种攻击载体，如鱼叉式网络钓鱼邮件、水坑攻击、零日漏洞等，并结合多种技术手段，如恶意软件、远程控制工具、加密通信协议等，实现对目标系统的渗透和控制。同时，APT28也非常重视对攻击行为的掩盖和伪装，通过使用代理服务器、伪造文件属性等手段，增加了溯源和归因的难度。

360高级威胁研究院在对APT28的持续跟踪过程中发现,该组织运用了多种复杂的攻击手法发动网络攻击。本报告将重点分析和剖析其三类最为活跃的攻击战术，深入揭示APT28在近期攻击活动中的侵入路径、使用工具、技战术以及背后的战略意图。同时,本报告也将评估这些攻击活动的潜在影响，并提出相应的防御建议和对策。这项研究不仅有助于加深对APT28的理解和认识，也希望为应对日益复杂的网络威胁提供一些经验和启示。

# **一、攻击活动分析**

## **1.类别一\_Headlace**

### **1.1攻击流程分析**

在典型的攻击场景中,APT28的攻击者首先向目标用户发送精心构造的钓鱼邮件,邮件正文通常包含指向恶意压缩文件的链接。一旦用户下载并打开压缩文件, Headlace Dropper会使用一些伪装手段诱导用户执行例如文件名为Windows更新、网页链接或者图标伪装为文档的LNK文件等。在某些情况下,攻击者还会利用DLL劫持技术,在用户打开合法应用时加载Headlace Dropper。

除了恶意压缩文件,我们还发现APT28使用了LNK快捷方式文件和恶意URL等多种诱饵格式,以提高攻击的成功率。一旦Headlace Dropper成功执行,它会进一步释放功能更加强大的Headlace后门程序。该后门程序能够与攻击者的命令控制服务器建立通信,并在受害者的系统上执行各种恶意操作,如窃取敏感信息、下载额外的恶意组件等,最终实现对目标系统的长期控制。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWXiaK0OWgtxv3FSz0vyYwCwWq6MVq3ibNVrqIAVTtWuaEW5578NGfeAOQ/640?wx_fmt=png)

图1 攻击流程图

### **1.2 恶意载荷分析**

Headlace类型的攻击活动通常始于向目标发送包含恶意链接的电子邮件。攻击者精心设计邮件内容,以诱骗受害者点击恶意链接。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWDqImRUNFmjNhiamP4MVUS52rMvGCiacTK0hGicTs0rRdskoMT3xZ6IayA/640?wx_fmt=png)

图2 电子邮件示例

在向受害者投递恶意负载之前,攻击者会利用JavaScript进行一系列验证例如检查用户代理是否包含 "win",且不包含 "wow" (可能表示虚拟机)，或者检查渲染器名称是否包含 "vmware"、"virtual"、"google" 或 "engine"等要素,甚至在某些情况下还会确认受害者的地理位置,以实施地理围栏。这一步骤可以帮助攻击者筛选目标,提高攻击的精准度。

地理围栏是一种策略,通过该策略,攻击者使用定制的脚本或恶意软件,根据目标受害者的地理位置,有选择地对特定区域(如国家或地区)进行攻击和数据窃取。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWsfAHIQdnRMBjLhptdRgzCibCPJkZRkV9JoYK9CibibfmU2fd6uly5s5dQ/640?wx_fmt=png)

图3 浏览器检查代码示例

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWmAfDXcZYTliazRBUVQbDrz99n0nWOtwLsgVwtB5rDrfvxM78NFOl3UA/640?wx_fmt=png)

图4 地理围栏检查代码示例

一旦验证通过,攻击者便会向目标投放恶意压缩文件。这些文件经过精心伪装,往往以Windows更新或模特图片等诱人内容为幌子。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWWnJiaW4cI9qwPJMKp55HdjVvxf9bhYpe3BFpOKCGyicwicP51mYvaPQkw/640?wx_fmt=png)

图5 投递压缩文件代码示例

在Headlace攻击的早期阶段,压缩文件内包含恶意的CMD代码。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWVC4r4zF7gvjWYRvu6Wy2EWH7tDV81RjTeW3OujDz19FVs6hNB87kBQ/640?wx_fmt=png)

图6 Headlace压缩内文件示例

CMD代码的主要功能是创建一个BAT文件和一个VBS文件,并通过VBS文件来执行BAT文件。与此同时,攻击者还会打开相关的诱饵网站例如露骨的模特网站,或展示一个虚假的更新进度,以掩人耳目。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWPM3cH3ExUWXnQ9Hp7q2DErPlrGtKgZHJr28uAcIRROaoxKHemMzH4A/640?wx_fmt=png)

图7 cmd代码示例

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWvkZia0ndtoCBw9hy9iaNialbU7gI7Goqt8YEQoVjluM6nZ75F5tHYpI2Q/640?wx_fmt=png)

图8 诱饵网站示例

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWhY4qoFTbzEE80yvPg3gJDIeuLibbCCicU9U8KnDP8ia9ek2hgMIh0ybCA/640?wx_fmt=png)

图9 虚假更新进度示例

恶意BAT文件则利用Microsoft Edge浏览器的"headless"模式,访问指定的URL。它会在受害者的"%USERPROFILE%\Downloads"目录下创建一个扩展名为".css"的文件,随后将其移动到"%PROGRAMDATA%"目录,更改扩展名为".cmd",执行,并在执行完成后将其删除,以隐藏攻击痕迹。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWoqED0e65bjDIq2QrXjaiaGdpcw33e6WAOVUcGfJcD5P72FZdDlMqwIQ/640?wx_fmt=png)

图10 bat代码示例

在近期观察到的Headlace攻击中,攻击者还使用了DLL劫持技术来执行BAT文件。他们在压缩包内植入一个易受DLL劫持攻击的合法Calc.exe二进制文件,诱使用户点击执行,进而加载恶意DLL文件。而恶意DLL文件的功能,仍然是下载并执行CSS文件。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWKevrsjEiaibuvF0TdQnNNjVn3XHljW5WYOPUmQ8pox1snLlJu4SyjyWw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWET1fz6kxVqvuwe3pwwy3TLOEIP79ZONMYeRH8xSBzCLCYia0fBXhA1w/640?wx_fmt=png)

图11 DLL劫持文件示例

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWlV5Pfj0P7CQTXe9dNHlZzxxm3icZkJTaAwfATpmBUyTdiaiaLTmibJ3M0A/640?wx_fmt=png)

图12 恶意DLL代码示例

这个恶意脚本的目的,是收集用户计算机上的敏感信息,并将其发送到远程服务器。它主要窃取用户主目录、桌面、下载、文档等目录的文件列表,Program Files和Program Files (x86)目录的信息,以及用户的IP地址和地理位置等数据。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWy4iab6QEtxJ77x1JFgCEedicNOtlnMPkX74FJacgWMaNvd1vS8X2E8uA/640?wx_fmt=png)

图13 恶意bat代码示例

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWcrcOfjdh3qI4jN8icgTC6YX8VsstiavmyhiaNT7S3TjYAL4960sRJrd4g/640?wx_fmt=png)

图14 恶意CSS文件代码示例

通过持续监控Headlace的活动,我们还发现攻击者使用了URL和LNK等其他类型的初始载荷,以多管齐下,提高攻击成功率。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWa67FIlGkgW7VQkkzUsnPrKpFKYThxf8EX5T74zuaaqGXicUmpDLf5bg/640?wx_fmt=png)

图15 投递压缩文件代码示例

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWwVCR9ibxevRbg2YicEqEoNOvaibvy3ML9YgwbHfjow9IP6TxlaKuAJYsg/640?wx_fmt=png)

图16 Headlace压缩内文件示例

## **2.类别二\_Masepie**

### **2.1 攻击流程分析**

在APT28的另一种常见攻击手法中,攻击者通常会向目标用户发送包含恶意链接的钓鱼邮件。一旦用户点击链接,就会被重定向到攻击者精心设计的诱饵页面，并诱导用户点击特定的按钮或链接。

当用户上当受骗,点击了诱饵页面中的恶意按钮后,他们会被进一步引导到一个WebDAV服务器。在这个服务器上,攻击者预置了恶意的LNK快捷方式文件。受害者一旦双击这些LNK文件,就会在不知情的情况下触发一系列恶意活动。

通过LNK文件,攻击者会利用PowerShell命令释放多个恶意组件,包括用于迷惑用户的诱饵文档、用于执行恶意代码的Python解释器,以及名为MASEPIE的后门程序。

一旦MASEPIE后门在受害者系统上执行,攻击者就能够建立起一条稳定的远程控制通道。利用这个通道,攻击者可以根据需要,选择性地向受害者系统下发其他的攻击组件,如STEELHOOK或OCEANMAP,以进一步扩大对目标环境的控制。此外,MASEPIE后门还允许攻击者在受害者系统上执行任意命令,这使得APT28能够灵活地调整攻击策略,适应不同的目标环境和攻击需求。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWNNm5ERPZCVIADpWDF1iaRswaA68qwMUkuz8jJSIDXzuk2zFnT5sEs4Q/640?wx_fmt=png)

图17 攻击流程图

### **2.2 恶意载荷分析**

在攻击的初始阶段,攻击者会向目标发送包含虚假文件链接的电子邮件。当用户点击这些虚假链接后,他们会看到一个模糊的诱饵文档图像例如冒充欧盟太空计划署有关,诱使他们点击按钮以查看完整文档。

![](https://mmbiz.qpic.cn/mmbiz_jpg/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWian963fxsKsDqnRfFqj1j0HsCq77Fv3RV7aCaJVtiah11OflwvbALhJg/640?wx_fmt=jpeg)

图18 诱饵网址示例

然而,当用户点击按钮后,实际上恶意代码会利用JavaScript和search-ms应用协议的特性,在后台下载一个LNK文件。在用户看来,点击按钮后仅仅打开了一个文件资源管理器窗口,而实际上恶意活动已经开始。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWTXAFAAldD7uWJNQZQCTXokdU4a5wibfZVia747Zianq7kPpPFMV8WdKGg/640?wx_fmt=png)

图19 页面代码示例

这个LNK文件会加载一个远程诱饵文档,然后通过远程Python解释器执行恶意Python代码。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWIjwSOCtgZicXPQXsayibSiaBpuehupgpaic19EtPQWAwUOdQ1SIkWsR57A/640?wx_fmt=png)

图20 LNK文件代码示例

这个恶意Python文件属于Masepie恶意软件家族,它使用Python语言开发,具有文件上传、下载以及命令执行等功能。

样本首先连接远程C2服务器,发送一个随机生成的AES密钥和系统用户名。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWgJVKVJiagCKprZwHC3nzhd8N2FPvtf2pJaUeGyyL21IBXLK9mZRtWDw/640?wx_fmt=png)

图21 main函数代码示例

连接建立后,样本进入一个无限循环,持续接收并执行服务器下发的命令。这些命令包括:

* check:发送一个"check-ok"消息以确认连接状态
* send\_file:启动一个线程,调用receive\_file函数接收文件
* get\_file:从受害者计算机上传一个文件到服务器
* 其他命令:直接在受害者计算机上使用os.popen执行命令并返回结果

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWcFQwJgwDOSP9hOmECxIKiaZcwZF9ypnajtVnt8FhSd3If7lPoC3GZnA/640?wx_fmt=png)

图22 receive 函数代码示例

receive\_file函数负责连接C2服务器,随机生成AES密钥并发送给服务器,然后接收加密的文件名和大小,发送确认信息,最后接收加密的文件内容,解密并保存到本地。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGW8vBq051m7wCOVkZlvksaRPbBAZsIJ1IxM4ia8c0jyZomiaGFeXWVUbzQ/640?wx_fmt=png)

图23 receive\_file函数代码示例

在后续的攻击中,攻击者可以通过Masepie下发更多类型的恶意样本,例如OCEANMAP或STEELHOOK,以进一步扩大对受害者系统的控制。

通过对这个APT攻击的分析,我们可以看到攻击者是如何步步为营,从最初的诱饵邮件,到恶意LNK文件,再到Masepie恶意软件,最后可能还会投递其他恶意工具。这种多阶段、多工具的攻击方式,增加了攻击的隐蔽性和持久性,给防御和清除带来了很大挑战。

## **3.类别三\_钓鱼**

### **3.1 攻击流程分析**

在APT28的钓鱼攻击活动中,攻击者通常会向目标用户发送精心设计的钓鱼邮件,邮件附件通常是一个恶意的压缩文件。这些压缩文件内会包含诱人的PDF文档或HTML文件,以吸引用户的注意力并诱使其打开。

当好奇的用户打开压缩文件并访问其中的PDF文档时,他们会被进一步引导到一个恶意的HTML页面。在这个精心伪装的钓鱼页面上,用户会被一步步引诱填写自己的账户凭据,如用户名、密码等敏感信息。

一旦用户在钓鱼页面上输入了自己的账户凭据,这些敏感信息就会被攻击者悄无声息地窃取。攻击者可以利用这些窃取的凭据,以合法用户的身份访问组织内部的各种系统和资源,从而实现更广泛的渗透和情报收集。

![](https://mmbiz.qpic.cn/mmbiz_png/6CNEHNicic4PoSOIyrul0icpxbAfiaWjhRGWpF7lxhUgzArN4elLC8W8SiaLCjYPClXLzD82ZNRJEiaJfCMdicsJtIhww/640?wx_fmt=png)

图 24 攻击流程图

### **3.2 恶意载荷分析**

在我们的观察中,发现了多起针对乌克兰的钓鱼攻击活动。在这些活动中,攻击者向目标发送恶意邮件,邮件附件通常是一个恶意的压缩文件。这些压缩文件内可能包含钓鱼HTML文件或者诱饵PDF文档，内容伪装成ukr.net登录或密码修改。

当受害者点击诱饵PDF文档中的按...