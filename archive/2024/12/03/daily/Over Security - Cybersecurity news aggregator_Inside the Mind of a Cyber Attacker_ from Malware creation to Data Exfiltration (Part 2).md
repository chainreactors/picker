---
title: Inside the Mind of a Cyber Attacker: from Malware creation to Data Exfiltration (Part 2)
url: https://www.hacktivesecurity.com/index.php/2023/11/15/inside-the-mind-of-a-cyber-attacker-from-malware-creation-to-data-exfiltration-part-2/
source: Over Security - Cybersecurity news aggregator
date: 2024-12-03
fetch_date: 2025-10-06T19:41:13.830309
---

# Inside the Mind of a Cyber Attacker: from Malware creation to Data Exfiltration (Part 2)

* info@hacktivesecurity.com
* Mon - Fri: 9.00 am - 6.00 pm

Advanced Security Solutions to protect the Cyberspace.

[Twitter](https://x.com/hacktivesec)

[Facebook-f](https://www.facebook.com/hacktivesec)

[Linkedin-in](https://www.linkedin.com/company/hacktive-security/)

[Instagram](https://www.instagram.com/hacktivesec/)

[![Hacktive Security](https://www.hacktivesecurity.com/wp-content/uploads/2024/10/logo_hs-1.png)](https://www.hacktivesecurity.com/)

* [Home](https://www.hacktivesecurity.com/)
* [About Us](https://www.hacktivesecurity.com/about-us/)
* Services
  + [Penetration Testing](https://www.hacktivesecurity.com/penetration-testing/)
  + [Red Teaming](https://www.hacktivesecurity.com/red-teaming/)
  + [Secure Code Review](https://www.hacktivesecurity.com/secure-code-review/)
  + [Training](https://www.hacktivesecurity.com/training/)
  + [Compliance](https://www.hacktivesecurity.com/compliance/)
* [Blog](https://www.hacktivesecurity.com/blog/)
* [Careers](https://www.hacktivesecurity.com/careers/)
* [Contacts](https://www.hacktivesecurity.com/contacts/)

Search for:

### Have Any Questions?

+39-06-8773-8747

[free quote](https://www.hacktivesecurity.com/index.php/contacts/)

[![Hacktive Security](https://www.hacktivesecurity.com/wp-content/uploads/2024/10/logo_hs-1.png)](https://www.hacktivesecurity.com/)

Search for:

* [Home](https://www.hacktivesecurity.com/)
* [About Us](https://www.hacktivesecurity.com/about-us/)
* Services
  + [Penetration Testing](https://www.hacktivesecurity.com/penetration-testing/)
  + [Red Teaming](https://www.hacktivesecurity.com/red-teaming/)
  + [Secure Code Review](https://www.hacktivesecurity.com/secure-code-review/)
  + [Training](https://www.hacktivesecurity.com/training/)
  + [Compliance](https://www.hacktivesecurity.com/compliance/)
* [Blog](https://www.hacktivesecurity.com/blog/)
* [Careers](https://www.hacktivesecurity.com/careers/)
* [Contacts](https://www.hacktivesecurity.com/contacts/)

[![Hacktive Security](http://176.31.202.211/wp-content/uploads/2024/10/logo_hs-1.png)](https://www.hacktivesecurity.com/)

Over 10 years we help companies reach their financial and branding goals. Engitech is a values-driven technology agency dedicated.

#### Gallery

[![](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project11-720x720.jpg)](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project11.jpg)

[![](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project10-720x720.jpg)](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project10.jpg)

[![](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project4-720x720.jpg)](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project4.jpg)

[![](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project6-720x720.jpg)](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project6.jpg)

[![](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project2-720x720.jpg)](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project2.jpg)

[![](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project1-720x720.jpg)](https://www.hacktivesecurity.com/wp-content/uploads/2019/11/project1.jpg)

#### Contacts

Via Giosuè Carducci, 21 - Pomigliano d'Arco (Italy)
Paseo Montjuic, número 30 - Barcelona (Spain)

info@hacktivesecurity.com

+39 06 8773 8747

[Twitter](#hacktivesec)

Facebook-f

Pinterest-p

Instagram

# Hacktive Blog

* [Home](https://www.hacktivesecurity.com)
* [Blog](https://www.hacktivesecurity.com/blog/)
* [Active Directory](https://www.hacktivesecurity.com/blog/category/active-directory/)
* Inside the Mind of a Cyber Attacker: from Malware creation to Data Exfiltration (Part 2)

[Active Directory](https://www.hacktivesecurity.com/blog/category/active-directory/)

![](https://www.hacktivesecurity.com/wp-content/uploads/2023/11/new_empire-1.png)

\_ [November 15, 2023](https://www.hacktivesecurity.com/blog/2023/11/15/inside-the-mind-of-a-cyber-attacker-from-malware-creation-to-data-exfiltration-part-2/)\_ [calfcrusher](https://www.hacktivesecurity.com/blog/author/calfcrusher/)\_ [0 Comments](https://www.hacktivesecurity.com/blog/2023/11/15/inside-the-mind-of-a-cyber-attacker-from-malware-creation-to-data-exfiltration-part-2/#respond)

### Inside the Mind of a Cyber Attacker: from Malware creation to Data Exfiltration (Part 2)

**DISCLAIMER** – **This article is provided for educational and informational purposes only. The techniques, tools, and examples discussed are intended to promote a better understanding of cybersecurity and to enhance defensive measures. The usage of these techniques should strictly adhere to applicable laws, regulations, and ethical guidelines. The author and publisher of this article shall not be held responsible for any misuse or illegal activities conducted by individuals or entities based on the information provided.**

## Introduction

> Welcome back to Part 2 of the series ‘Inside the Mind of a Cyber Attacker.’
>
> In the fictional scenario, our cyber attacker has found himself in a precarious situation: leveraging **Ngrok** for Command & Control led to unintended consequences – **he got busted!** The vigilant Security Operations Center (**SOC**) successfully uncovered his tracks by analyzing the network traffic, which diverged from the norm of the target network’s usual behaviour: this discovery ultimately led to his detection !
>
> But our attacker refuses to be defeated. He is prepared to adopt an even more stringent **OPSEC** approach, offering a glimpse into his advanced repertoire of offensive techniques.
>
> In this article i’ll cover topics such as:
>
> 1. How to bypass Antimalware Scan Interface (AMSI)
> 2. Setting a stable Command and Control infrastructure
> 3. Setting up a dedicated relay / redirector to hide C&C infrastructure
> 4. Diving into PowerShell Empire malleable profiles’ capabilities
> 5. How to set a dedicated payload server using Nginx
> 6. How to land the perfect payload to evade Windows Defender
> 7. Exfiltration of sensitive data to Dropbox

> Let your plans be dark and impenetrable as night, and when you move, fall like a thunderbolt
>
> Sun Tzu, The Art of War

## How to bypass AMSI for fun and.. nah, just for fun !

**AMSI bypass** is not a new topic, and compared with bypassing EDR, is much easier.

Bypassing AMSI is like to play a cat-and-mouse game: as defenders enhance their detection mechanisms, attackers continuously devise new tactics to slip through the cracks.

Individual words and strings can act as triggers for AMSI. Often, a straightforward replacement of variable or function names, along with encoding and decoding values at runtime, proves effective in **bypassing** these triggers.

While some triggers take the form of **complex** **regex** **patterns**, altering a fixed portion of the regex value can reset AMSI to return a clean result. Here’s a concise overview of common methods for AMSI bypass, inspired by the works of **Matt** **Graeber** (<https://twitter.com/mattifestation>):

1. **Forced Error Technique:**
   * **Method:** Forcing the AMSI initialization to fail (amsiInitFailed) will result that no scan will be initiated for the current process.
   * **Example:** Introduce intentional errors within the script to divert AMSI’s attention.
2. **AMSI Patching:**
   * **Method:** Modify the AMSI initialization process to either disable its effectiveness.
   * **Example:** Usually the modification of `AmsiScanBuffer()` is performed on the memory of the PowerView process and the original `amsi.dll` is never touched on disk ([https://rastamouse.me/memory-patching-amsi-bypass](https://rastamouse.me/memory-patching-amsi-bypass/))
3. **Encrypted Payloads:**
   * **Method:** Encrypt or encode malicious payloads to evade detection during initial inspection.
   * **Example:** Use encryption techniques to conceal the true nature of the payload until runtime.
4. **Code Obfuscation:**
   * **Method:** ...