---
title: ProxmoxVE 下的 Windows 内核调试环境配置
url: https://www.anquanke.com/post/id/286802
source: 安全客-有思想的安全新媒体
date: 2023-03-02
fetch_date: 2025-10-04T08:24:59.047578
---

# ProxmoxVE 下的 Windows 内核调试环境配置

ждќжАх

жўЁУ»╗

* [т«ЅтЁеУхёУ«»](https://www.anquanke.com/news)
* [т«ЅтЁеуЪЦУ»є](https://www.anquanke.com/knowledge)
* [т«ЅтЁетиЦтЁи](https://www.anquanke.com/tool)

Т┤╗тіе

уцЙтї║

тГджЎб

т«ЅтЁет»╝Уѕф

тєЁт«╣у▓ЙжђЅ

* [СИЊТаЈ](/column/index.html)
* [у▓ЙжђЅСИЊжбў](https://www.anquanke.com/subject-list)
* [т«ЅтЁеKERтГБтѕі](https://www.anquanke.com/discovery)
* [360уйЉу╗ют«ЅтЁетЉеТіЦ](https://www.anquanke.com/week-list)

# ProxmoxVE СИІуџё Windows тєЁТаИУ░ЃУ»Ћуј»тбЃжЁЇуй«

жўЁУ»╗жЄЈ**324602**

тЈЉтИЃТЌХжЌ┤ : 2023-03-01 10:30:11

**x**

##### У»ЉТќЄтБ░Тўј

ТюгТќЄТў»у┐╗У»ЉТќЄуФа

У»ЉТќЄС╗ЁСЙЏтЈѓУђЃ№╝їтЁиСйЊтєЁт«╣УАеУЙЙС╗ЦтЈітљФС╣ЅтјЪТќЄСИ║тЄєсђѓ

![]()

┬а

**СйюУђЁ№╝џ0x7F@уЪЦжЂЊтѕЏт«Є404т«ъжфїт«ц
тјЪТќЄжЊЙТјЦ№╝џ<https://paper.seebug.org/2052/>**

## 0x00 тЅЇУеђ

windowsтєЁТаИУ░ЃУ»ЋтИИућеС║ј windows жЕ▒тіет╝ђтЈЉУ░ЃУ»ЋсђЂтєЁТаИтѕєТъљуГЅ№╝їСй┐уће WinDBG тЈ»С╗ЦтЙѕТќ╣СЙ┐уџёУ┐ЏУАїТюгтю░тєЁТаИУ░ЃУ»Ћ№╝їСйєТюгтю░тєЁТаИУ░ЃУ»ЋтГўтюеУЙЃтцџуџёжЎљтѕХ(тдѓСИЇУЃйСй┐ућет»╝УЄ┤СИ╗Тю║ТџѓтЂюУ┐љУАїуџёТїЄС╗ц)№╝їжђџтИИТѕЉС╗гжЃйС╝џжђџУ┐ЄУЎџТІЪТю║Уй»С╗ХТљГт╗║ windows тЈїТю║У░ЃУ»Ћуј»тбЃ№╝їтЁХСИГСИђтЈ░СйюСИ║У░ЃУ»ЋТю║(`debuger`)№╝їтЈдСИђтЈ░СйюСИ║УбФУ░ЃУ»ЋТю║(`debugee`)№╝їтЈїТю║У░ЃУ»ЋтЄаС╣јтЈ»С╗ЦТ╗АУХ│тцДжЃетѕєуџё windows тєЁТаИтѕєТъљсђЂУ░ЃУ»ЋуГЅтиЦСйюсђѓ

жђџУ┐Є `Vmware` УЎџТІЪТю║Уй»С╗ХТљГт╗║ windows тЈїТю║У░ЃУ»Ћуј»тбЃТў»ТюђтИИУДЂуџёТќ╣ТАѕ№╝їТљГт╗║ТГЦжфцтњїтЮЉуѓ╣тЪ║ТюгжЃйућ▒тЅЇУЙѕТб│уљєТѕљуФаС║є№╝їСйєТѕЉТЌЦтИИтиЦСйюжЃйућ▒ `ProxmoxVE` УЎџТІЪТю║Тћ»ТњЉУхиТЮЦ№╝їжЂѓТЃ│Сй┐уће ProxmoxVE жЁЇуй« windows уџётєЁТаИУ░ЃУ»Ћуј»тбЃ№╝їтюеТГцУ┐ЄуеІСИГжЂЄтѕ░С║єСИЇт░ЉжџЙуѓ╣сђѓ

ТюгТќЄт»╣ ProxmoxVE СИІуџё windows тєЁТаИУ░ЃУ»Ћуј»тбЃжЁЇуй«У┐ЏУАїС║єУ»ду╗єС╗Іу╗Їтњїт«ъжфїТ╝ћуц║№╝їт»╣тЁХСИГуџёжџЙуѓ╣У┐ЏУАїС║єу«ђТўЊтѕєТъљ№╝їтИїТюЏТюгТќЄУЃйт»╣ТюЅуЏИтљїжюђТ▒ѓуџёт░ЈС╝ЎС╝┤ТЈљСЙЏСИђС║ЏтИ«тіЕсђѓ

┬а

## 0x01 тЪ║Тюгуј»тбЃ

ТюгТќЄуј»тбЃтдѓСИІ№╝џ

```
ProxmoxVE 7.2-3
Windows10 1909 СИЊСИџуЅѕ
```

ProxmoxVE Тў»СИђтЦЌтЪ║С║ј KVM уџёУЎџТІЪтїќУДБтє│Тќ╣ТАѕ№╝їућ▒С║јтЁХт╝ђТ║љуЅ╣ТђДС╗ЦтЈі Linux уџёС║▓тњїТђД№╝їProxmoxVE жђџтИИтюеС╝ЂСИџтєЁжЃетцДжЄЈСй┐уће№╝їтљїТЌХС╣ЪтИИтИИСйюСИ║тЋєСИџУй»С╗Хуџёт║Ћт▒ѓТћ»ТњЉу╗ёС╗Хсђѓтљїу▒╗Уй»С╗ХУ┐ўТюЅтцДтљЇж╝јж╝јуџё Vmware тњї VirtualBox№╝їУ┐ЎС║ЏУй»С╗ХтюеСй┐ућеТќ╣жЮбжЃйтцДтљїт░Јт╝ѓсђѓ

ProxmoxVE т║Ћт▒ѓТў»СИђтЈ░ Debian СИ╗Тю║№╝їуёХтљјтЪ║С║ј KVM+Qemu т«ъуј░С║єУЎџТІЪтїќУй»С╗Х№╝їжЁЇуй«т«їТѕљтљјтЈ»жђџУ┐Є web ТјДтѕХтЈ░(`https://[ip]:8006`)У┐ЏУАїу«АуљєтњїСй┐уће№╝џ

![]()

[1.PVEуџёwebТјДтѕХтЈ░]

жђџтИИТЃЁтєхСИІ№╝їТѕЉС╗гСй┐уће Vmware ТљГт╗║ windows тЈїТю║У░ЃУ»Ћуј»тбЃ№╝їжЃйС╗Цт«┐СИ╗Тю║СйюСИ║У░ЃУ»ЋТю║(`debuger`)№╝їС╗ЦУЎџТІЪТю║СйюСИ║УбФУ░ЃУ»ЋТю║(`debugee`)№╝їжђџУ┐Є Vmware жЁЇуй«СИ▓тЈБУ«ЙтцЄ(`serial`) жђџС┐АУ┐ЏУАїУ░ЃУ»Ћ№╝Џ

Уђї ProxmoxVE Тў»СИђтЈ░ Linux СИ╗Тю║№╝їУдЂТљГт╗║ windows тЈїТю║У░ЃУ»Ћуј»тбЃт┐ЁжюђУдЂСИцтЈ░УЎџТІЪТю║ТЅЇУАїсђѓ

┬а

## 0x02 Тюгтю░тєЁТаИУ░ЃУ»Ћ

ТѕЉС╗гтЁѕС╗ју«ђтЇЋуџёТюгтю░тєЁТаИУ░ЃУ»Ћуј»тбЃт╝ђтДІ№╝їС╗ЦТГцТЮЦтЄєтцЄтЪ║ТюгуџёУ░ЃУ»Ћуј»тбЃ№╝Џтюе ProxmoxVE СИГт«ЅУБЁ windows10 у│╗у╗Ъ№╝їт╣Хт«їТѕљтЪ║ТюгуџёжЁЇуй«тдѓСИІ№╝џ

![]()

[2.Тюгтю░тєЁТаИУ░ЃУ»Ћуј»тбЃ]

ТѕЉС╗гС╗јт«ўуйЉСИІУйй [WinDBG](https://learn.microsoft.com/zh-cn/windows-hardware/drivers/debugger/debugger-download-tools) т╣Хтюе windows10 у│╗у╗ЪСИіУ┐ЏУАїт«ЅУБЁ№╝џ

![]()

[3.windbgт«ЅУБЁжЁЇуй«]

т╣Хтюеуј»тбЃтЈўжЄЈСИГ(у│╗у╗ЪтЈўжЄЈ)жЁЇуй«угдтЈиУАеУ«Йуй«№╝џ

```
_NT_SYMBOL_PATH
SRV*c:\symbols*http://msdl.microsoft.com/download/symbols
```

> жЁЇуй«т«їТѕљтљј№╝їWinDBGтюеУ░ЃУ»ЋУ┐ЄуеІСИГт░єУЄфтіеС╗јтЙ«Уй»угдтЈиУАеТюЇтіАтЎеСИІУййт»╣т║ћТЋ░ТЇ«№╝їт╣ХС┐ЮтГўУЄ│ `C:\symbols` СИІ№╝Џ
> С╣ЪтЈ»С╗Цтюе WinDBG СИГСй┐уће Ctrl+S жЁЇуй«угдтЈиУАе№╝їСИЇУ┐ЄжЄЄућеуј»тбЃтЈўжЄЈуџёТќ╣т╝ЈУ┐ўтЈ»С╗ЦТќ╣СЙ┐тЁХС╗ќт║ћућеСй┐ућеУ»ЦжЁЇуй«сђѓ

жџЈтљјТѕЉС╗гСй┐уће `bcdedit` С┐«Тћ╣ windows уџётљ»тіежЁЇуй«ТЋ░ТЇ«ТќЄС╗Х№╝їСй┐ућеу«АуљєтЉўТЮЃжЎљТЅЊт╝ђ powershell№╝џ

```
# т╝ђтљ» debug
$ bcdedit /debug on
# ТЪЦуюІ bcdedit жЁЇуй«
$ bcdedit
# ТЪЦуюІ dbgsettings жЁЇуй«(ж╗ўУ«цСИ║ local)
$ bcdedit /dbgsettings
```

ТЅДУАїтдѓСИІ№╝џ

![]()

[4.bcdeditжЁЇуй«Тюгтю░У░ЃУ»Ћ]

> жђџУ┐Є windows т╝ђТю║тљ»тіежА╣жђЅТІЕсђїтљ»ућеУ░ЃУ»ЋТеАт╝ЈсђЇС╣ЪТў»СИђТаиуџё№╝їСИЇУ┐ЄжђџУ┐Є bcdedit С┐«Тћ╣Тў»Т░ИС╣ЁТюЅТЋѕуџёсђѓ
> тдѓТъюСИЇТЃ│тй▒тЊЇуЏ«тЅЇуџёжЁЇуй«№╝їтЈ»С╗ЦжђџУ┐Є `bcdedit /copy "{current}" /d "debug test"` тцЇтѕХтйЊтЅЇжЁЇуй«№╝їжџЈтљјСй┐уће `bcdedit /set "{id}" debug on` У┐ЏУАїжЁЇуй«№╝їтюет╝ђТю║ТЌХтЈ»жђЅТІЕСИЇтљїуџётљ»тіежА╣У┐ЏтЁЦу│╗у╗Ъсђѓ

жџЈтљјжЄЇтљ» windows10 УЎџТІЪТю║ућЪТЋѕжЁЇуй«№╝їСй┐ућеу«АуљєтЉўТЮЃжЎљтљ»тіе WinDBG№╝їжђЅТІЕ `File - Kernel Debug`№╝їжђЅТІЕ `Local` Тюгтю░У░ЃУ»ЋТаЄуГЙ№╝џ

![]()

[5.windbg-localТаЄуГЙ]

жџЈтљјСЙ┐тЈ»С╗ЦТГБтИИУ┐ЏУАїТюгтю░тєЁТаИУ░ЃУ»Ћ№╝їТѕЉС╗гУЃйтцЪТЪЦуюІтєЁТаИСИГуџётљёжА╣ТЋ░ТЇ«№╝ЏСйєТюгтю░тєЁТаИУ░ЃУ»ЋСИЇУЃйтй▒тЊЇу│╗у╗ЪуџёУ┐љУАї№╝їТЅђС╗ЦСИЇУЃйТЅЊТќГуѓ╣сђЂтЇЋТГЦУ░ЃУ»ЋуГЅ№╝їтйЊуёХ `go` ТїЄС╗цС╣ЪТў»СИЇУЃйСй┐ућеуџё№╝џ

![]()

[6.windbgТюгтю░тєЁТаИУ░ЃУ»Ћ]

┬а

## 0x03 уйЉу╗ютЈїТю║У░ЃУ»Ћ

С╗ј windows8 т╝ђтДІтЙ«Уй»ТЈљСЙЏС║єуйЉу╗юУ░ЃУ»ЋтєЁТаИуџёТќ╣Т│Ћ№╝їтЁХу«ђуД░СИ║ `kdnet`№╝їтЏаСИ║жђџС┐АТЋѕујЄУдЂТ»ћСИ▓тЈБжФў№╝їТЅђС╗ЦСй┐ућеУхиТЮЦСйЊжфїТЏ┤тЦй№╝їТў»уЏ«тЅЇтЙ«Уй»ТјеУЇљуџётєЁТаИУ░ЃУ»ЋТќ╣Т│Ћсђѓ

уйЉу╗ютЈїТю║У░ЃУ»ЋжЎцС║єт»╣у│╗у╗ЪуЅѕТюгТюЅУдЂТ▒ѓ№╝їт»╣уйЉтЇАС╣ЪТюЅСИђт«џуџёУдЂТ▒ѓ№╝їТћ»ТїЂуџётјѓтЋєтњїтъІтЈитЈ»С╗ЦТЪЦжўЁ <https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/supported-ethernet-nics-for-network-kernel-debugging-in-windows-10> №╝ЏжЎцТГцС╣Ітцќ№╝їУ┐ўжюђУдЂСИцтЈ░СИ╗Тю║СйЇС║јтљїСИђтГљуйЉтєЁсђѓ

жѓБС╣ѕТѕЉС╗гжюђУдЂтюе ProxmoxVE тєЇТи╗тіаСИђтЈ░ windows10 УЎџТІЪТю║СйюСИ║УбФУ░ЃУ»ЋТю║(`debugee`)№╝їС╗ЦТѕЉС╗гСИіТќЄТюгтю░тєЁТаИУ░ЃУ»ЋСИГуџёСИ╗Тю║СйюСИ║У░ЃУ»ЋТю║(`debuger`)№╝їС╗ЦТГцућеСИцтЈ░УЎџТІЪТю║у╗ёТѕљ windows уйЉу╗ютЈїТю║У░ЃУ»Ћуџёуј»тбЃ№╝їтдѓСИІ№╝џ

> Тюгтю░тєЁТаИУ░ЃУ»ЋСИГуџёжЁЇуй« `bcdedit /debug on` СИЇС╝џтй▒тЊЇУ»ЦТГЦжфц№╝їС╣ЪтЈ»С╗ЦТЅІтіеУ«Йуй« `bcdedit /debug off` тЁ│жЌГУ░ЃУ»ЋтіЪУЃйсђѓ

![]()

[7.уйЉу╗ютЈїТю║У░ЃУ»Ћуј»тбЃ]

ТљГт╗║У┐ЎтЈ░УбФУ░ЃУ»ЋТю║(`debugee`)ТЌХжюђУдЂТ│еТёЈ№╝їтюежЁЇуй«ТЊЇСйюу│╗у╗Ъу▒╗тъІТЌХт║ћжђЅТІЕ `Other` у▒╗тъІ№╝їтдѓСИІ№╝џ(тдѓТъюжђЅТІЕ `windows` у▒╗тъІ№╝їProxmoxVE тюеУЎџТІЪтїќТЌХС╝џТЈљСЙЏ Hyper-V уџётљёжА╣Тћ»ТїЂ№╝їС╗ЦТГцТЮЦТЈљжФўУЎџТІЪТю║уџёТђДУЃй№╝їСйєУ┐ЎС║ЏжА╣т»╝УЄ┤уйЉу╗юУ░ЃУ»ЋТЌаТ│ЋТГБтИИУ┐љУАї№╝їТѕЉС╗гт░єтюе `### 0x05 kdnetжЌ«жбўТјњТЪЦ` У┐ЏУАїу«ђУдЂтѕєТъљ)

![]()

[8.у│╗у╗Ъу▒╗тъІжЁЇуй«СИ║other]

ућ▒С║јжЁЇуй«СИ║ `Other` у▒╗тъІ№╝їProxmoxVE тЈ»УЃйТЌаТ│ЋТЈљСЙЏ windows уџёТјеУЇљжЁЇуй«№╝їТюђу╗ѕт»╝УЄ┤ТЌаТ│ЋТГБуА«т«ЅУБЁ windows у│╗у╗Ъ№╝їУІЦжЂЄтѕ░У»ЦжЌ«жбўтЈ»ТјњТЪЦуБЂуЏўТў»тљдУ«Йуй«СИ║ `IDE` у▒╗тъІсђѓ

жЎцТГцС╣Ітцќ№╝їтюеуйЉтЇАжЁЇуй«жўХТ«хжюђУдЂжђЅТІЕ `Intel E1000`№╝їтдѓСИІ№╝џ

![]()

[9.уйЉтЇАжЁЇуй«СИ║intel e1000]

Та╣ТЇ«ТхІУ»Ћ e1000 уйЉтЇАтюеу│╗у╗ЪтєЁжЃеуџёуАгС╗Х id СИ║ `VEN_8086&DEV_100E`№╝їТ╗АУХ│уйЉу╗юУ░ЃУ»Ћт»╣уйЉтЇАуџёУдЂТ▒ѓ№╝ЏтЈдтцќ `Realtek RTL8139` СИЇТ╗АУХ│УдЂТ▒ѓ№╝їУђї`VirtIO` тњї `Vmware vmxnet3` жюђУдЂт«ЅУБЁуЅ╣т«џжЕ▒тіеТЅЇУЃйСй┐ућесђѓ

ТјЦСИІТЮЦт«їТѕљ windows10 у│╗у╗Ът«ЅУБЁтњїтЪ║уАђжЁЇуй«№╝їжџЈтљјУ┐ЏУАїуйЉу╗юУ░ЃУ»ЋуџёжЁЇуй«№╝Џт«ўТќ╣ТјеУЇљСй┐уће [kdnet тиЦтЁиУ┐ЏУАїУЄфтіежЁЇуй«](https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/setting-up-a-network-debugging-connection-automatically)№╝їСйєт╣ХСИЇУЃйжА║тѕЕжЁЇуй«№╝Џ

ТѕЉС╗гС╗јУ░ЃУ»ЋТю║(`debuger`) уџё WinDBG уЏ«тйЋСИГ(`C:\Program Files (x86)\Windows Kits\10\Debuggers\x64`) ТІиУ┤Ю `kdnet.exe` тњї `VerifiedNICList.xml` тѕ░УбФУ░ЃУ»ЋТю║СИі(`debugee`)№╝їТїЅт«ўТќ╣ТЋЎуеІТЊЇСйютдѓСИІ№╝џ

![]()

[10.kdnetУЄфтіежЁЇуй«тц▒У┤Ц]

УЎйуёХТѕЉС╗гуџёуйЉтЇАСйЇС║ј `VerifiedNICList` СИГ№╝їСйє `kdnet.exe` ТЌаТ│ЋТГБуА«УДБТъљсђѓТѕЉС╗гТїЅ[т«ўТќ╣ТЅІтіежЁЇуй«ТЋЎуеІ](https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/setting-up-a-network-debugging-connection)У┐ЏУАїУ«Йуй«№╝џ

```
# т╝ђтљ» debug
$ bcdedit /debug on
# У«Йуй«уйЉу╗юУ░ЃУ»ЋтЈѓТЋ░
# У«Йуй«У░ЃУ»ЋТю║(debuger)уџё ip тю░тЮђСИ║ 10.0.25.192
# У«Йуй«УбФУ░ЃУ»ЋТю║уџёуФ»тЈБСИ║ 50000 (т┐ЁжА╗>=49152)
# У«Йуй«УбФУ░ЃУ»ЋТю║уџёУ┐ъТјЦт»єуаЂСИ║ p.a.s.s (т┐ЁжА╗СИ║ x.x.x.x Та╝т╝Ј)
$ bcdedit /dbgsettings NET HOSTIP:10.0.25.192 PORT:50000 KEY:p.a.s.s
# ТЪЦуюІУ░ЃУ»ЋжЁЇуй«
$ bcdedit /dbgsettings
```

![]()

[11.ТЅІтіежЁЇуй«kdnet]

т«їТѕљжЁЇуй«тљјжЄЇтљ»ућЪТЋѕ№╝ЏжџЈтЇ│ТѕЉС╗гтюеУ░ЃУ»ЋТю║(`debuger`) Сй┐уће WinDBG У┐ЏУАїуйЉу╗юУ░ЃУ»ЋжЁЇуй«№╝їуФ»тЈБтЈиСИ║ `50000`№╝їт»єжњЦСИ║ `p.a.s.s`№...