---
title: 结合阿里云通义灵码辅助新手小白快速代码审计的最佳实践 - 渗透测试中心
url: https://www.cnblogs.com/backlion/p/18896454
source: 博客园 - 渗透测试中心
date: 2025-05-27
fetch_date: 2025-10-06T22:30:16.347911
---

# 结合阿里云通义灵码辅助新手小白快速代码审计的最佳实践 - 渗透测试中心

[![](https://img2024.cnblogs.com/blog/35695/202509/35695-20250929100304557-587378723.jpg)](https://qoder.com/)

* [![博客园logo](//assets.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园")
* [会员](https://cnblogs.vip/)
* [众包](https://www.cnblogs.com/cmt/p/18500368)
* [新闻](https://news.cnblogs.com/)
* [博问](https://q.cnblogs.com/)
* [闪存](https://ing.cnblogs.com/)
* [赞助商](https://www.cnblogs.com/cmt/p/19081960)
* [HarmonyOS](https://harmonyos.cnblogs.com/)
* [Chat2DB](https://chat2db-ai.com/)

* ![搜索](//assets.cnblogs.com/icons/search.svg)
  ![搜索](//assets.cnblogs.com/icons/enter.svg)
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    所有博客
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    当前博客
* [![写随笔](//assets.cnblogs.com/icons/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔")
  [![我的博客](//assets.cnblogs.com/icons/myblog.svg)](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客")
  [![短消息](//assets.cnblogs.com/icons/message.svg)](https://msg.cnblogs.com/ "短消息")
  ![简洁模式](//assets.cnblogs.com/icons/lite-mode-on.svg)

  [![用户头像](//assets.cnblogs.com/icons/avatar-default.svg)](https://home.cnblogs.com/)

  [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx)
  [我的园子](https://home.cnblogs.com/)
  [账号设置](https://account.cnblogs.com/settings/account)
  [会员中心](https://vip.cnblogs.com/my)
  简洁模式 ...
  退出登录

  [注册](https://account.cnblogs.com/signup)
  登录

[![返回主页](/skins/custom/images/logo.gif)](https://www.cnblogs.com/backlion/)

# [渗透测试中心](https://www.cnblogs.com/backlion)

##

* [博客园](https://www.cnblogs.com/)
* [首页](https://www.cnblogs.com/backlion/)
* [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
* [联系](https://msg.cnblogs.com/send/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%BF%83)
* [管理](https://i.cnblogs.com/)
* 订阅
  [![订阅](/skins/coffee/images/xml.gif)](https://www.cnblogs.com/backlion/rss/)

# [结合阿里云通义灵码辅助新手小白快速代码审计的最佳实践](https://www.cnblogs.com/backlion/p/18896454 "发布于 2025-05-26 10:19")

本文介绍了作者在数据安全比赛中遇到的一个开源框架的代码审计过程。作者使用了多种工具，特别是“通义灵码”，帮助发现了多个高危漏洞，包括路径遍历、文件上传、目录删除、SQL注入和XSS漏洞。文章详细描述了如何利用这些工具进行漏洞定位和验证，并分享了使用“通义灵码”的心得和体验。最后，作者总结了AI在代码审计中的优势和不足，并展望了未来的发展方向。

## 前言

已经有接近两个月没有更新文章了，给大家说声抱歉。这段时间因为个人原因一直在备赛，所以9月去参加云栖大会的观后感，以及之前兴致勃勃想测评大模型平台的文章也迟迟没有写出来。**争取在未来的两个月内把这些内容都补上**。

准备的比赛是数据安全相关的，由于队伍中有几位经验丰富的大佬带领，我们自然也是顺利入围了全国决赛。至于为什么要写这篇文章呢？说来也很巧，在半决赛时，有一个靶机直接把我们零封了，全场没有一个人能getshell。该靶机采用的是一个开源框架，而且网上并没有任何公开可用的漏洞信息，且由于比赛是在局域网环境下进行的，也没办法直接把代码拉下来审计。

赛后，我对这件事一直耿耿于怀，于是这两周就把这个框架好好地审计了一遍，确实找到了一些有趣且潜在的漏洞点。而在这一过程中，**“通义灵码”起到了较大的帮助**，帮助我节省了不少时间。这里，我想借这篇文章分享一下我的发现以及整个过程中的一些心得体会，姑且也算是个最佳实践了。

## 审计对象

本次审计的对象主要有两个：**某开源PHP最新版6.0** 和 **某开源OA最新版2.6.5**

借助通义灵码，共审计出开源PHP最新版6.0高危漏洞**4**个，某开源OA最新版2.6.5高危漏洞**1**个 , 目前已提交至CNVD平台且被归档。

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101814368-1268465230.png)

## 工具准备

## 环境搭建工具

**phpstudy\_pro(小皮面板)**：在国内比较流行的一键安装环境包，它集成了 PHP、MySQL、Apache/Nginx 等服务，方便开发者快速搭建 Web 开发和测试环境，用于上述两个靶场的搭建。

## 代码审计工具

**Seay源代码审计**：基于C#语言开发的一款针对PHP代码安全性审计的系统，主要运行于Windows系统上。这款软件能够发现SQL注入、代码执行、命令执行、文件包含、文件上传、绕过转义防护、拒绝服务、XSS跨站、信息泄露、任意URL跳转等漏洞，基本上覆盖常见PHP漏洞。另外，在功能上，它支持一键审计、代码调试、函数定位、插件扩展、自定义规则配置、代码高亮、编码调试转换、数据库执行监控等数十项强大功能，由于已经停止维护了，官网上也下载不到，百度云盘地址如下：<https://pan.baidu.com/s/1HHnniTNWzXhb-pn6OZgexA> 密码：75ji

**CodeScan**：基于GO语言的快速匹配Sink点的工具，使用起来还行，地址如下：<https://github.com/Zjackky/CodeScan>

\*\*RIPS ：\*\*Rips是一个用PHP编写的源代码分析工具，它采用了静态分析技术，能够自动化地检测PHP代码中的安全漏洞，如XSS（跨站脚本攻击）、SQL注入、文件泄露、Header Injection等。Rips不仅提供了直观的扫描结果展示，还集成了代码审计框架，方便渗透测试人员直接审阅分析结果，大大提高了代码审计的效率。地址如下：<https://rips-scanner.sourceforge.net/>

## 代码编写及辅助工具

**Visual Studio Code** ：(简称 VS Code) 是由微软开发的一款免费且开源的源代码编辑器，支持 Windows、macOS 和 Linux 平台。

**通义灵码**：本次的主角，基于通义大模型的 AI 研发辅助工具，包含 AI 编码助手和 AI 程序员。其中，AI 编码助手为开发者写代码、补代码、写注释、写单测、写代码优化和排查问题，是开发者的编码搭子； AI 程序员是一个 AI 编程智能体，可以模拟软件架构师、开发工程师、测试工程师等多种岗位能力，分钟级自主完成任务拆解、代码编写、缺陷修复、测试等编程相关任务，为企业软件研发降本增效。

遗憾的是，我这里没有申请到AI 程序员的试用资格，所以只能暂时以灵码为例了。

## 源码下载

由于是开源代码，在Github、gitee以及站长网站上都是可以免费下载到的，有些开源网站如果有定制服务的话也可能会有自己的主站。

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101816020-949861967.png)

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101817198-691299228.png)

## 环境搭建

将下载后的源码放在phpstudy的 www 目录下

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101818259-1361742629.png)

进入 phpstudy\_pro\WWW\cltopen-master\cltopen-master\config 目录下，修改数据库配置文件

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101819860-609907945.png)

修改之后可以进入数据库中，导入该开源项目的示例数据库

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101821053-761836339.png)

打开phpstudy ，设置域名和根目录

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101822101-1257155649.png)

设置伪静态（必须）

```
location / {
    if (!-e $request_filename){
        rewrite  ^(.*)$  /index.php?s=$1  last;   break;
    }
}
```

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101823349-726190523.png)

点击确认即可，打开浏览器访问域名即可看到

同理，对于某OA系统的搭建也是如此，只不过该OA里自带了一个初始化数据库的引导界面，所以不需要手动修改数据库配置文件

## 审计打点

在环境搭建好之后就可以开始准备代码审计了，正常来说代码审计的第一步应该是熟悉框架、通读代码，具体的方式与个人代码能力和编程语言的熟悉程度有关系，有时，为了快速审计，就会采用上述几个工具进行打点和标注，由于工具内置的正则不同，所以结果也会略有差异，如果想尽可能的找到所有漏洞点的话，应该以上述工具的结果之和为参考。

值得一说的是，有时候工具可能也会存在漏报和误报的情况，所以此处结果仅能做参考，还需要人工进行审核和验证。

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101825290-1345488984.png)

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101826645-390051147.png)

这套开源代码的漏洞确实比较多，后台随手一测就是一个SQL注入，所以我们这里只挑危害比较高的漏洞去挖掘，主要关注文件读取、文件包含、文件上传等方法。

在排除该代码5.5版本及之前存在且已修复的漏洞后，最终锁定到后台管理控制层下面的Template.php文件处（本次仅针对此处进行了挖掘和分析）

## 源码分析

打开源码，进入到Template.php页面下，可以看到代码如下：

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101828065-472309109.png)

主要是定义了一个 Template 控制类，用于管理模板文件的增删改查操作，以及图片文件的管理和删除。

按照往常，我们应该会结合上述审查工具提示的代码位置去进行分析和判断，但是，现在我们有了**通义灵码**，一切都变得不一样了。

首先我们全选代码，使用提示词如下：

> 已知该代码中存在安全漏洞，请你找出你能确定的漏洞，并简要分析该漏洞形成原因

这段 prompt 有几点比较关键：

1. 我们需要明确告知灵码，这里**确实存在**安全漏洞，同时也是确认主题，避免输出其他内容
2. 我们需要告知，找出它能**确定的**漏洞，减少误报和泛化判断
3. 明确最终结果是**分析该漏洞形成原因**，也便于安全工程师理解

随即，灵码会针对该段代码进行一次静态审查，并给出结果如下：

```
安全漏洞及分析

1.路径遍历漏洞

位置：insert, edit, update, delete, imgDel , Images方法
原因：用户输入的文件路径和文件名未进行严格验证，可能导致路径遍历攻击。例如，通过在文件名中包含 ../，攻击者可以访问或操作任意文件。
示例：
php
$filename = input('post.file'); // 用户输入未验证
$path = $type==$this->viewSuffix ?  $this->filepath : $this->publicpath.$type.'/';
$file = $path.$filename.'.'.$type; // 可能导致路径遍历

2.文件上传漏洞

位置：insert, update 方法
原因：用户上传的内容未进行严格验证，可能导致恶意代码注入。例如，攻击者可以通过上传恶意脚本文件来执行任意代码。
示例：
php
file_put_contents($file, stripslashes(input('post.content'))); // 未验证内容

3.目录删除漏洞

位置：imgDel 方法
原因：用户输入的目录路径未进行严格验证，可能导致任意目录被删除。
示例：
php
$path = $this->publicpath.'images/'.input('post.folder'); // 用户输入未验证
$file=$path.input('post.filename'); // 可能导致路径遍历
is_dir($file) ? dir_delete($file) : unlink($file); // 删除目录或文件

4.SQL 注入漏洞

位置：无明显 SQL 注入风险，但需要注意后续可能引入的数据库操作。
原因：虽然当前代码没有直接的 SQL 操作，但如果后续版本中引入了数据库操作，且用户输入未进行适当处理，可能会导致 SQL 注入。

5.XSS 漏洞

位置：edit, images 方法
原因：用户输入的内容未进行转义处理，可能导致跨站脚本攻击（XSS）。
示例：
php
$content = file_get_contents($file); // 未转义
$this->assign ( 'content',$content ); // 直接输出到页面
```

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101829589-302070820.png)

每一个漏洞下面都标明了存在该漏洞的方法和引发原因，并且对于不存在的漏洞也明确说明了（没有产生幻觉）

下面，我们需要做的就是进入到web界面中，找到调用此处方法的位置

## 路径遍历漏洞、任意文件删除漏洞

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101831079-638249660.png)

采用BP抓包，此处以edit方法为例，可以发现拼接方式是 **admin/模块/方法/操作对象类型/操作对象**

![image.png](https://img2023.cnblogs.com/blog/1049983/202505/1049983-20250526101832846-125361212.png)

观察到下面的update方法是在保存之后可以直接执行的，所以此处尝试直接替换成edit方法

其中请求包如下：

```
GET /admin/template/edit.html  HTTP/1.1
Host: xxx.xxx.xxx.xxx
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36 Edg/129.0.0.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apn...