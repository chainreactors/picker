---
title: Stealthy PHP Malware Uses ZIP Archive to Redirect WordPress Visitors
url: https://blog.sucuri.net/2025/07/stealthy-php-malware-uses-zip-archive-to-redirect-wordpress-visitors.html
source: Sucuri Blog
date: 2025-07-12
fetch_date: 2025-10-06T23:28:30.363619
---

# Stealthy PHP Malware Uses ZIP Archive to Redirect WordPress Visitors

[![Sucuri Blog](https://blog.sucuri.net/wp-content/uploads/2023/04/Sucuri_Blog_Header_Logo_342x60.png)](https://blog.sucuri.net/)

* Products
  + [Website Security Platform](https://sucuri.net/website-security-platform/)
  + [Website Firewall (WAF)](https://sucuri.net/website-firewall/)
  + [Multi-Site plans](https://sucuri.net/custom/agency/)
  + [Custom & Enterprise Plans](https://sucuri.net/custom/enterprise/)
  + [Partnerships](https://sucuri.net/partners/)
* Features
  + [Detection  Website Monitoring & Alerts](https://sucuri.net/malware-detection-scanning/)
  + [Protection  Future Website Hacks](https://sucuri.net/website-hack-protection/)
  + [Performance  Speed Up Your Website](https://sucuri.net/website-performance/)
  + [Response  Help For Hacked Websites](https://sucuri.net/website-malware-removal/)
  + [Backups  Disaster Recovery Plan](https://sucuri.net/website-backups/)
* Resources
  + [Guides](https://sucuri.net/guides/)
  + [Webinars](https://sucuri.net/webinars/)
  + [Infographics](https://sucuri.net/infographics/)
  + [Blog](/)
  + [SiteCheck](https://sitecheck.sucuri.net/)
  + [Reports](https://sucuri.net/reports/)
  + [Email Courses](https://sucuri.net/email-courses/)
* [Pricing](https://sucuri.net/website-security-platform/signup)
* [Immediate Help](https://sucuri.net/website-security-platform/help-now/)
* [Login](https://sucuri.net/website-security-platform/signup/)

[![Sucuri Blog](https://blog.sucuri.net/wp-content/uploads/2023/04/Sucuri_Blog_Header_Logo_342x60.png)](https://blog.sucuri.net/)

* Products
  + [Website Security Platform](https://sucuri.net/website-security-platform/)
  + [Website Firewall (WAF)](https://sucuri.net/website-firewall/)
  + [Multi-Site plans](https://sucuri.net/custom/agency/)
  + [Custom & Enterprise Plans](https://sucuri.net/custom/enterprise/)
  + [Partnerships](https://sucuri.net/partners/)
* Features
  + [Detection  Website Monitoring & Alerts](https://sucuri.net/malware-detection-scanning/)
  + [Protection  Future Website Hacks](https://sucuri.net/website-hack-protection/)
  + [Performance  Speed Up Your Website](https://sucuri.net/website-performance/)
  + [Response  Help For Hacked Websites](https://sucuri.net/website-malware-removal/)
  + [Backups  Disaster Recovery Plan](https://sucuri.net/website-backups/)
* Resources
  + [Guides](https://sucuri.net/guides/)
  + [Webinars](https://sucuri.net/webinars/)
  + [Infographics](https://sucuri.net/infographics/)
  + [Blog](/)
  + [SiteCheck](https://sitecheck.sucuri.net/)
  + [Reports](https://sucuri.net/reports/)
  + [Email Courses](https://sucuri.net/email-courses/)
* [Pricing](https://sucuri.net/website-security-platform/signup)
* [Immediate Help](https://sucuri.net/website-security-platform/help-now/)
* [Login](https://sucuri.net/website-security-platform/signup/)

* [Immediate Help](https://sucuri.net/website-security-platform/help-now/)

[Login](https://dashboard.sucuri.net/login/)

[Login](https://dashboard.sucuri.net/login)

New Customer?

[Sign up now.](https://sucuri.net/website-security-platform/signup/)

* [Submit a ticket](https://support.sucuri.net/support/?new)
* [Knowledge base](https://docs.sucuri.net/)
* [Chat now](https://sucuri.net/live-chat/)

Search for:

Search

* [Security Advisory](https://blog.sucuri.net/category/security-advisory)
* [Website Malware Infections](https://blog.sucuri.net/category/website-malware-infections)
* [WordPress Security](https://blog.sucuri.net/category/wordpress-security)

# Stealthy PHP Malware Uses ZIP Archive to Redirect WordPress Visitors

[![](https://secure.gravatar.com/avatar/3bb7fb42c6bf04c758d570c2f6bb217266c127e77766dc9d8e6754f15cdd5867?s=60&d=mm&r=g)](https://blog.sucuri.net/author/puja-srivastava)

[Puja Srivastava](https://blog.sucuri.net/author/puja-srivastava)

* July 11, 2025

![Stealthy PHP Malware Uses ZIP Archive to Redirect WordPress Visitors](https://blog.sucuri.net/wp-content/uploads/2025/07/Stealthy-PHP-Malware-Uses-ZIP-Archive-to-Redirect-WordPress-Visitors-820x385.png)

Last month, a customer contacted us, concerned about persistent and inexplicable redirects on their WordPress website. Our investigation quickly unearthed a sophisticated piece of malware deeply embedded within their site’s core files. This wasn’t just a simple redirect; it was a complex operation designed for search engine poisoning and unauthorized content injection.

## What Did We Find?

Our initial analysis led us to the **wp-settings.php** file, a critical WordPress core component. We discovered two highly suspicious lines of code that immediately stood out:

![suspicious code in wp-settings.php](https://blog.sucuri.net/wp-content/uploads/2025/07/suspicious-code-in-wp-settings.png)

This code snippet is the initial entry point for the malicious payload.

The first line extracts the bare domain name from the HTTP\_HOST header, removing “www.” if present. This is a common tactic to ensure the malware works consistently across different domain configurations.

The second line is the critical line. It attempts to include a file directly from inside a win.zip archive. The `zip://` wrapper in PHP allows accessing files within a ZIP archive as if they were regular files. The `#` symbol, followed by `$h` (the extracted domain name), indicates that a file named after the domain within win.zip should be included. This is a very stealthy way to hide malicious code within an otherwise innocuous-looking ZIP file.

Upon further investigation, we found the win.zip file. When extracted, it contained a single PHP file with highly obfuscated code. This file is the core malicious script.

## Attack Vector & IoCs

1. A zip://win.zip#<hostname> include in wp-settings.php.
2. Inside win.zip, a file (matched to the host) containing:
    ![attack vector & IoCs](https://blog.sucuri.net/wp-content/uploads/2025/07/attack-vector-iocs.png)
3. Visitor-specific redirect logic within the decoded payload.

## Analysis of the Malware

The file extracted from **win.zip** is designed to be executed, and it immediately sets about decoding and running its true malicious content.

### Initial Setup and Environment Detection

The malware begins by setting up its execution environment to ensure it runs without interruption and can detect the current protocol.

![setting up environment](https://blog.sucuri.net/wp-content/uploads/2025/07/setting-up-environment.png)

The malware checks if the current connection is secure (HTTPS) or not. This is important for fetching external resources correctly and avoiding mixed content warnings on the client side.

### Dynamic Command & Control (C2) Server Selection

One of the clever aspects of this malware is its ability to dynamically select its Command and Control (C2) server based on the requested URL. This makes it more resilient to takedowns and harder to block entirely, as different parts of the site might communicate with different C2s.

### What is a Command and Control (C2) server?

A Command and Control (C2) server is a system used by hackers to remotely control infected devices (like computers or websites). It sends commands to the malware and receives stolen data back.

![c2 server](https://blog.sucuri.net/wp-content/uploads/2025/07/c2-server.png)

This code allows the attacker to serve different malicious content or redirect users based on the specific page they are visiting, potentially targeting different SEO niches or user demographics.

### Anti-Bot and Stealth Mechanism

To avoid detection by search engine crawlers and security scanners, the malware includes a sophisticated anti-bot mechanism.

![Anti-Bot and Stealth Mechanism](https://blog.sucuri.net/wp-content/uploads/2025/07/Anti-Bot-and-Stealth-Mechanism.png)

When a bot like Googlebot, Bing, or Yahoo is detected, the malware typically disables its malicious output e.g., no redirects, no spam content. This prevents the compromised content from being indexed by search engines, helping the infection remain hidden from site owners who...