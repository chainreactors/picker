---
title: 记一次DarkKomet synaptics 病毒应急响应事件
url: https://www.anquanke.com/post/id/283990
source: 安全客-有思想的安全新媒体
date: 2022-12-03
fetch_date: 2025-10-04T00:22:03.530555
---

# 记一次DarkKomet synaptics 病毒应急响应事件

首页

阅读

* [安全资讯](https://www.anquanke.com/news)
* [安全知识](https://www.anquanke.com/knowledge)
* [安全工具](https://www.anquanke.com/tool)

活动

社区

学院

安全导航

内容精选

* [专栏](/column/index.html)
* [精选专题](https://www.anquanke.com/subject-list)
* [安全KER季刊](https://www.anquanke.com/discovery)
* [360网络安全周报](https://www.anquanke.com/week-list)

# 记一次DarkKomet synaptics 病毒应急响应事件

阅读量**565470**

发布时间 : 2022-12-02 16:00:49

**x**

##### 译文声明

本文是翻译文章

译文仅供参考，具体内容表达以及含义原文为准。

![]()

## 一、准备阶段

### 1.1 基本情况

DarkComet （暗黑彗星）是由 Jean-Pierre Lesueur（称为 DarkCoderSc）开发的远程访问木马（称为 RAT），在 2012 年初开始扩散，它用于许多有针对性的攻击，能够通过网络摄像头拍照，通过连接到 PC 的麦克风窃听对话，并获得对受感染机器的完全控制。该 RAT 还以其键盘记录和文件传输功能而闻名，因此，任何远程攻击者都可以将任何文件加载到受感染的机器上，甚至窃取管理员权限、计算机/用户名、语言/国家、操作系统信息、使用的内存、网络摄像头信息、文档等。它会禁用任务管理器、注册表编辑器和文件夹选项，修改注册表项以禁用 Windows 防火墙设置，此操作允许此恶意进程执行而不会被 Windows 防火墙检测到。别名有：Fynloski、Krademok、DarkKomet 等。

### 1.2 功能

DarkKomet 主要功能：远控，对用户行为进行监控并为攻击者开启 SYSTEM 后门，窃取用户信息并回传窃取的信息发送给攻击者，同时还可以下载其他恶意软件。

### 1.3 传播方式

DarkKomet 将自身伪装成笔记本电脑触控板的驱动程序 Synaptics Pointing Device Driver，启动后，会全盘遍历 exe 文件、xlsx 文件，并将目标文件更新到病毒资源中，将 shellcode 注入的图标资源替换为目标文件图标，然后用病毒文件覆盖目标文件，完成感染，实现不死及复生能力。并可通过U盘插入、xlsx 文件分享、远控软件捆绑实现横向扩散，具有极强传播能力。

## 二、检测阶段

![]()

货拉拉终端应急响应检测机制基于TTP驱动、离群数据驱动、杀毒事件驱动、威胁情报驱动混合。该次事件由EDR收集终端全量启动项数据，结合威胁情报接口，实现终端权限维持数据基线的分钟级扫描。高危事件通过webhook 实现IM告警，方便安全运营人员实时接入处置，并通过工单记录汇总。
聚合N day内 该病毒感染的终端量及感染者的账号、用户名、部门等信息，最终由多条alert形成单条完整incident。

![]()

通过 webhook/工单形式将消息推送给终端安全运营人员对事件进行下钻，IOC/TTP加入EDR实时检测阻断规则，完成由单次事件检测 —— 一类事件阻断的事件闭环。

## 三、抑制阶段

### 3.1 事件的处置

1、拦截回连c2域名、IP，中断连接。
2、远程接入应急溯源，获取TTP。

## 四、根除阶段

### 4.1 删维权

该病毒通过 Run 键实现到权限维持（开机自启动），删除启动项

![]()

### 4.2 清进程

结束 2 个Synaptics.exe进程

![]()

### 4.3 删文件

进入 DarkKomet 文件目录，只有WS文件夹，却找不到相关可执行文件

![]()

怀疑DarkKomet隐藏自身，取消勾选【隐藏受保护的操作系统文件】并选中【显示隐藏文件】

![]()

被隐藏的病毒文件 Synaptics.exe显形，

![]()

删除文件，提示需要SYSTEM权限（高于Administrator），病毒文件通过修改文件属主及文件权限实现强行驻留

![]()

修改文件属主为administrator并继承权限后，删除病毒文件

![]()

### 4.4 溯源头

清除威胁后，溯源入口点，从取证角度获取 2022-05-17 16:29:30 运行软件信息，发现可疑文件路径
F:\柯美黑白机64位系统\

![]()

可疑点：该文件位于F盘，且运行时间与病毒创建时间密切相关，但用户终端上却只有C、D、E盘。

![]()

猜测该盘为第三方便携插入式U盘，咨询用户后得到【安装打印机】细节。
由此推测：该病毒原本位于U盘中，安装打印机时插入U盘，U盘内的病毒自动感染终端位于C盘的文件，实现横向扩散。
由于该病毒具有感染性，推测还感染了其他文件。通过遍历NTFS文件系统 MFT-TIME，获取 2022-05-17 16:29:30 – 2022 – 05 -17 16:29:40 创建及修改的所有文件，获取被感染文件信息

![]()

通过日志回溯取证，发现 f:\京瓷复印机\Kx6111118\_en\setup.exe入驻Run键，创建病毒文件 C:\ProgramData\Synaptics\Synaptics.exe，并将Synatics.exe添加启动项 。由此映证猜测，C2病毒感染源头为安装打印机时插入U盘。

## 五、恢复阶段

1、清除被感染的”*cache*“文件
2、IOC / TTP 加入EDR、杀毒，复验攻击能被实时阻断。
3、受损用户更改密码

## 六、总结阶段

IOC：
DNS：xred.mooo.com
IP：69.42.215.252

TTP：

![]()

### 6.1 历史事件

某用户请第三方安装师傅安装打印机，插入 U 盘后，U 盘中已存在的 DarkKomet 组织 synaptics 病毒自动运行，进而感染终端位于 C 盘下的十余个进程及文件。
某员工下载被投毒的 todesk 进行远程办公【具有 todesk 功能，实为 synaptics 远控病毒新变种】，导致感染 synaptics 病毒。
某员工下载 CAD 破解软件，其中夹杂最新版 synaptics 病毒。
…
本轮 synaptics 应急响应，终端产生的威胁主要来自：U 盘扩散、软件投毒捆绑这两种形式。病毒最明显特征为：未签名进程 C:\ProgramData\Synaptics\Synaptics.exe 入驻Run键以权限维持。
当下阶段，利用人性弱点进行投毒的事件层出不穷。针对员工高频安装的浏览器类、IM类、运维工具类、远程控制类软件，需做好软件与对应签名的映射验证，并针对高危场景离群数据进行威胁狩猎。辅以外部/内生威胁情报，构建滤网机制，对启动项软件流水加以管控。实现启动项快照机制，对未知/离群/高危/权限维持数据定时清理，在提升攻击者成本的同时，也增加检测/阻断未知攻击的可能。

本文翻译自 原文链接。如若转载请注明出处。

商务合作，文章发布请联系 anquanke@360.cn

本文由**LLSRC**原创发布

转载，请参考[转载声明](https://www.anquanke.com/note/repost)，注明出处： [https://www.anquanke.com/post/id/283990](/post/id/283990)

安全KER - 有思想的安全新媒体

本文转载自:

如若转载,请注明出处：

安全KER - 有思想的安全新媒体

分享到：![微信](https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png)

* [应急响应](/tag/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94)

**+1**7赞

收藏

![](https://p5.ssl.qhimg.com/t011f2daffb9cd10c62.png)LLSRC

分享到：![微信](https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png)

## 发表评论

您还未登录，请先登录。

[登录](/login/index.html)

![](https://p0.ssl.qhimg.com/t01a7b03f8b12427ba3.png)

[![](https://p5.ssl.qhimg.com/t011f2daffb9cd10c62.png)](/member.html?memberId=158408)

[LLSRC](/member.html?memberId=158408)

货拉拉安全应急响应中心，简称LLSRC，是致力于保障货拉拉用户、业务和产品等安全，促进与安全专家的合作与交流，而建立的漏洞收集及响应平台。

* 文章
* **13**

* 粉丝
* **5**

### TA的文章

* ##### [货拉拉SRC翻倍活动来啦！开年兔飞猛涨，钱兔无量](/post/id/286201)

  2023-02-08 17:30:02
* ##### [记一次DarkKomet synaptics 病毒应急响应事件](/post/id/283990)

  2022-12-02 16:00:49
* ##### [网络入侵检测系统之suricata概要介绍](/post/id/283260)

  2022-11-29 15:00:41
* ##### [新形势下安全风险评估实践](/post/id/283536)

  2022-11-24 12:00:54
* ##### [活动 | 货拉拉信息安全技术沙龙来袭！与你相约8月19日](/post/id/277712)

  2022-08-09 18:00:48

### 相关文章

* ##### [如何在终端上定位发起恶意请求的进程？](/post/id/287604)

  2023-03-21 10:30:15
* ##### [windows应急响应](/post/id/287417)

  2023-03-15 15:30:13
* ##### [应急响应不“摇人”，好的EDR做对了哪些事？](/post/id/286737)

  2023-02-27 14:00:57
* ##### [年度盘点 | 安全范儿技术沙龙的八期干货都在这里！](/post/id/285399)

  2023-01-12 15:30:27
* ##### [应急事件检测 入门篇-Linux信息检测](/post/id/264087)

  2021-12-30 15:30:41
* ##### [应急事件检测 入门篇-windows信息检测](/post/id/261348)

  2021-12-08 10:30:36
* ##### [应急响应入门篇-应急响应流程及数据保护](/post/id/260061)

  2021-12-02 10:30:31

### 热门推荐

文章目录

* [一、准备阶段](#h2-0)
  + [1.1 基本情况](#h3-1)
  + [1.2 功能](#h3-2)
  + [1.3 传播方式](#h3-3)
* [二、检测阶段](#h2-4)
* [三、抑制阶段](#h2-5)
  + [3.1 事件的处置](#h3-6)
* [四、根除阶段](#h2-7)
  + [4.1 删维权](#h3-8)
  + [4.2 清进程](#h3-9)
  + [4.3 删文件](#h3-10)
  + [4.4 溯源头](#h3-11)
* [五、恢复阶段](#h2-12)
* [六、总结阶段](#h2-13)
  + [6.1 历史事件](#h3-14)

![](https://p0.qhimg.com/t11098f6bcd5614af4bf21ef9b5.png)

安全KER

* [关于我们](/about)
* [联系我们](/note/contact)
* [用户协议](/note/protocol)
* [隐私协议](/note/privacy)

商务合作

* [合作内容](/note/business)
* [联系方式](/note/contact)
* [友情链接](/link)

内容需知

* [投稿须知](https://www.anquanke.com/contribute/tips)
* [转载须知](/note/repost)
* 官网QQ群：568681302

合作单位

* [![安全KER](https://p0.ssl.qhimg.com/t01592a959354157bc0.png)](http://www.cert.org.cn/)
* [![安全KER](https://p0.ssl.qhimg.com/t014f76fcea94035e47.png)](http://www.cnnvd.org.cn/)

Copyright © 北京奇虎科技有限公司 三六零数字安全科技集团有限公司 安全KER All Rights Reserved [京ICP备08010314号-66](https://beian.miit.gov.cn/)[![](https://icon.cnzz.com/img/pic.gif)](https://www.cnzz.com/stat/website.php?web_id=1271278035 "站长统计")

微信二维码

**X**![安全KER](https://p0.ssl.qhimg.com/t0151209205b47f2270.jpg)