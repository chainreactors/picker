---
title: 记一次卑微的渗透测试
url: https://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247497069&idx=1&sn=5d1df54873a6a3a04185d317220298ba&chksm=e8a5ff0edfd27618b42c11f47bb9c4b8eefa860d92e11f43d70e0b01ec88987b5df820ef8ada&scene=58&subscene=0#rd
source: 迪哥讲事
date: 2025-02-12
fetch_date: 2025-10-06T20:37:43.801780
---

# 记一次卑微的渗透测试

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/YmmVSe19Qj762tjoRkx84V5VcJPtR1MBD2yicKUPcanZNfB6yzCsrpCia6XuQ9swaYt41dYeYiasloAbKcIzqy2Iw/0?wx_fmt=jpeg)

# 记一次卑微的渗透测试

迪哥讲事

以下文章来源于酒仙桥六号部队
，作者Strive

![](http://wx.qlogo.cn/mmhead/Q3auHgzwzM6h5jOvetH9FCV9SZjkg2PBbViaA8jlNfDJtZqedia3h3UQ/0)

**酒仙桥六号部队**
.

知其黑，守其白。 分享知识盛宴，闲聊大院趣事，备好酒肉等你！

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s56SCcicutqYiarKB82TYibkfpjSagSTADBichxZLfAwVG9sBfAbuy69DsxzuTVc7Yuxes0c5hnicTVTJLQ/640?wx_fmt=png)

本文约1800字，阅读约需5分钟。

随着攻防演练愈演愈烈，弱小的我也不得不加入攻防大军的队伍里，而本篇文章就记录了某次攻防演练中的getshell历程。在这次攻防演练中，初步利用工具批量打点无果，作为团队里卑微的撕口子工具人，只能选择一个站一个站硬啃。

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQfkwdscEgGsicSURibWSOuWeh8sMrIuIGBH19rrMXWwfRbXyEYyqQR4pw/640?wx_fmt=png)

**1**

**开始**

又是熟悉的“开局一个后台”系列，初期重点选择没有验证码机制的后台去进行爆破：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQgTREUuJuyOTKvU3sfvpLbY0We6wsianwt5O6RJJtNTiaXnbaNc4JhxmA/640?wx_fmt=png)

这里目录与账号密码同时进行爆破，然而不出意外，没有任何结果：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQNibhs5ibzcBCWumuwiaduTW4oqtyZFsbzOpniaMVicibc3ic2x0YBKkXwLpTQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQG1gjJEFlhEoDdP3lI1YHJ76icNBU806ANXgHz18sJBbBZ5zn8aKGd1A/640?wx_fmt=png)

既然爆破无果，只能再试试其他的思路。

一般URI中带#的js多为webpack模块打包。于是决定再次从前台webpack打包的js接口入手：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQlpMT8vh7QDj3SRiaNzQ2tJSEwDJib4u9FITiaHaswhrz9mKVUYS72bWHg/640?wx_fmt=png)

利用浏览器功能美化js文件，通过搜索path关键字，查找后台路由：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQQJTUP03CBFsibQZNpPJ6Mc2rY7icQ5vt1K7uFoqYRI37RWwvzq0OZoxw/640?wx_fmt=png)

通过构造路径进入后台，发现大部分接口存在二次验证。直接跳转至登录页，对path路径进行多次尝试，找到个人头像上传点。

测试直接上传jpg成功后，抓包尝试修改后缀上传webshell。但发现服务端直接对上传的文件进行了重命名，此条线索终止。

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQgENpMKks1iaX8zPpRLnaJsJJOkaLvvU8XgpIlIaejHMMM1S3meVoNyQ/640?wx_fmt=png)

随后，找到导入excel处尝试XXE：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQHAdOK7LmqeIBcus8aH3BWxBhAS7IS39Quueno4gdx8274r0K72K4Mw/640?wx_fmt=png)

下载模板，解压后修改其中xml文件的内容，加入payload：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQ4Kic1icicTrYZd13fXkbKVd4H1PrVQTKphNc4v5kHsnyRic6aalyFsEQHA/640?wx_fmt=png)

上传后发现所添加的ceye平台出现了请求：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQhbMABhsRtJ1uPEgQMFOtibaa3TIdyoS6hvTE1eFX02Y9hRtXBYQvGicg/640?wx_fmt=png)

其中有http请求,说明可以下载文件：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQTBLEkSB3CL2HMic0hp2wIU65T24HxIHXmOdhCu1BDVB8YG0VqfrJdkg/640?wx_fmt=png)

修改payload为访问外部实体的语句：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQicN5xg0NHG6VTsa0HuaMYQBEDBqSEicGrkw5Gm3VC61Sd8ctumPywDsA/640?wx_fmt=png)

在vps上预先放置外部实体：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQkdnicNwYSibffAbMWrXWTW5hxvJut7GWwenQTI0geUoyRvRraVC0gQIg/640?wx_fmt=png)

开启http服务等待下载：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQcH8BAdOs29sHWoxOvSaPwicHBTRckODgI18X39AtFt8kxf0EsplJxjQ/640?wx_fmt=png)

之后上传文件，会触发服务器请求vps下载dtd外部实体的命令，进而读取内容。另外开启ftp服务以实现文件内容外带，尝试读取/etc/passwd中的内容。

这里直接在网上寻找的脚本：

“https://github.com/ONsec-Lab/scripts/blob/master/xxe-ftp-server.rb”

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQgeVUNEAB95LECeYc3qqPkF9X4L2ogEYvBoicBstsrZmuP6mt0N66gIg/640?wx_fmt=png)

尝试读取ssh key，读取成功：

“/root/.ssh/id\_rsa.pub”

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQvWXllnz5Baf5Ye5icZK3zAP7e1riaXQDaNFcnDHgLKemxpiatoicwYCItg/640?wx_fmt=png)

对主机进行端口探测，发现22端口处于filtered状态，尝试连接发现超时，考虑到时间成本，暂时放弃这条路线。

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQWToIkicSh9BD92diao0PqsthiarZJSWvVtdEMY6A2OWsb2MYk0LSgbDibw/640?wx_fmt=png)

最后在个人中心处找到一个可下载的APP：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQJzgQIMtLIexSAfwXemJdY2ECk2l2M6ibUyibrHwiatVkwUS6kalAdL6aQ/640?wx_fmt=png)

打开app发现需要登录，且抓包发现与Web端登录接口一致，放弃尝试登录绕过，直接反编译apk，找到主界面的activity：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQIoichKHVzEU4DjZA6xib9HpsSibrMtJOOGBAEwZELtGSVLF5VtUiczEbqg/640?wx_fmt=png)

通过adb 的am指令绕过登录界面，到达MainActivity（Android端一些APP手势密码绕过也可以利用此方法步骤，直接跳转到设置手势密码的Activity界面，通过重新设置手势密码来进行绕过，但是同样需要通过AndroidManifest.xml来查找相应的Activity名称）。

“am start ｛包(package)名｝/｛包名｝.{活动(activity)名称}”

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQb5AQqfstvByQjR1AMgEYeVdAOR9EmJ7T7gyzxF4RXelwq1Iib6bUN6A/640?wx_fmt=png)

到达主界面后发现提示登录错误，仍然存在二次验证：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQWYYYMPRJSNDcEiacnrllqYUqic0YwcI4J9B5jiaT0XwddKO93jr1o7tUQ/640?wx_fmt=png)

仔细寻找功能点。这里很累，因为如果请求没有身份认证通过，便会直接退回登录界面，需要一直利用am指令进行主页跳转：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQdcVyMicHtXStU0ppyx7jVZCTHLx053qvfSslKono5R1YRpYnZRnmcsQ/640?wx_fmt=png)

在订单流程处找到一处上传附件的地方，发现其对后缀名进行了白名单校验，放弃。

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQhOG6Y8UzZQUicg0Hdlicdnd3F70cRzr9A1ibOs5Ohaxa6vu8cNicRTsAVg/640?wx_fmt=png)

最后发现app只有在网盘功能处，上传时不需要cookie认证，这里第一次进行上传时uri路径存在null参数，怀疑是用来获取用户昵称在服务端创建文件夹。

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQr1CIopMd2TgTYw49natV87Lbl4XScmkoa22ibKO8Te8j5eISHiaMtYjA/640?wx_fmt=png)

将null修改为admin，虽然再次成功上传，但是没有直接返回文件路径，即使找到路径也很有可能是上传到静态目录，无法对脚本文件进行解析。

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQ8vIGAp1TomXl5icUusaOrTZQtC8pHS5ghOLw5gaXQeSk9val5skWErQ/640?wx_fmt=png)

虽然网盘很大概率是静态目录，但撕口子的迫切感让我不得不把握住每一次可能的机会，遂开始尝试查找路径。

在此APP下，要想查找上传路径有两种方法，一种是通过网盘在下载文件时查看是否会有文件路径，第二种就是根据上传接口去构造猜测文件路径。

当打开网盘界面时，发现在网盘加载文件列表时需要用户会话认证，没有即为空。

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQMzJ7s7arn85gbBVbQd9TkUvLVHD7ww8iafPz67RuYGYNvYARkXicpzyQ/640?wx_fmt=png)

白茫茫的背景图，让本不富裕的我更加雪上加霜。

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQxxje7NqWbtR0V0SdHVFhWr9Psg9q15mkvojrkuNuvFriam5bjib5LoyQ/640?wx_fmt=png)

只能寄希望于最后一处更加渺茫的方法：猜测路径。

手工对URI逐级进行拆分：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQaNZRoISdnH7de4mia4MSevMDAxqaJba8ziaqQbdU7hXW4LKEbKszzp6g/640?wx_fmt=png)

结果拆到第二步，惊喜就出现了，没有提示404，证明文件存在：

![](https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQaCFtReRwK6UweUxYZD9gPmzvR8UAtcD6OKXJPRPqSVLbNeGl8B6G7A/640?wx_fmt=jpeg)

好家伙，我直接好家伙，这居然还是system权限，花光了我一年的运气：

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQXgkLhxAgIozfZ0gNY7jicayafw4Cx3YqRub1GUS7gheLrr9daEjzia3Q/640?wx_fmt=png)

shell已到手，打点工具人也该撤退了。

![](https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s54O1ic3ibJlFJz5FgKRGWcQMQMJb3BOf24SAX6OWDvlxIn5qibiboeDYxh0d0ShaDZQerZ7WxHKKK9aibw/640?wx_fmt=png)

**2**

**总结**

本文先从Web端入手进行渗透，在webpack模式下对后台查找未授权访问点，如上传跟XXE测试，测试无果后在后台发现apk安装包，转向防护相对薄弱的Android移动端进行渗透最终getshell。

因为初始目标明确，就是为了拿到webshell打开口子，所以进行渗透时都是奔着可以getshell的方式进行重点测试。
如果你是一个长期主义者，欢迎加入我的知识星球，我们一起往前走，每日都会更新，精细化运营，微信识别二维码付费即可加入，如不满意，72 小时内可在 App 内无条件自助退款

![](https://mmbiz.qpic.cn/mmbiz_png/YmmVSe19Qj5EMr3X76qdKBrhIIkBlVVyuiaiasseFZ9LqtibyKFk7gXvgTU2C2yEwKLaaqfX0DL3eoH6gTcNLJvDQ/640?wx_fmt=png&from=appmsg)

## 往期回顾

[一款bp神器](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247495880&idx=1&sn=65d42fbff5e198509e55072674ac5283&chksm=e8a5faabdfd273bd55df8f7db3d644d3102d7382020234741e37ca29e963eace13dd17fcabdd&scene=21#wechat_redirect)

[挖掘有回显ssrf的隐藏payload](https://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247496898&idx=1&sn=b6088e20a8b4fc9fbd887b900d8c5247&scene=21#wechat_redirect)

[ssrf绕过新思路](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247495841&idx=1&sn=bbf477afa30391b8072d23469645d026&chksm=e8a5fac2dfd273d42344f18c7c6f0f7a158cca94041c4c4db330c3adf2d1f77f062dcaf6c5e0&scene=21#wechat_redirect)

[一个辅助测试ssrf的工具](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247496380&idx=1&sn=78c0c4c67821f5ecbe4f3947b567eeec&chksm=e8a5f8dfdfd271c935aeb4444ea7e928c55cb4c823c51f1067f267699d71a1aad086cf203b99&scene=21#wechat_redirect)

[dom-xss精选文章](http://mp.weixin.qq.com/s?__biz=MzIz...