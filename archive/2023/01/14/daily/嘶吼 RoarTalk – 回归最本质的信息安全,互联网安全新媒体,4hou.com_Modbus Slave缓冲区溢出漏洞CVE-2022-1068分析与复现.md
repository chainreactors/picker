---
title: Modbus Slave缓冲区溢出漏洞CVE-2022-1068分析与复现
url: https://www.4hou.com/posts/jJpv
source: 嘶吼 RoarTalk – 回归最本质的信息安全,互联网安全新媒体,4hou.com
date: 2023-01-14
fetch_date: 2025-10-04T03:50:57.179684
---

# Modbus Slave缓冲区溢出漏洞CVE-2022-1068分析与复现

Modbus Slave缓冲区溢出漏洞CVE-2022-1068分析与复现 - 嘶吼 RoarTalk – 网络安全行业综合服务平台,4hou.com

[![](https://www.4hou.com/sihou/images/new4hou/newlogoss.png)](https://www.4hou.com)

* [首页](https://www.4hou.com)
* [企业中心](https://www.4hou.com/corp/newindex)
* [产业研究院](https://www.4hou.com/real-time)

![](https://www.4hou.com/sihou/images/new4hou/search-icon.png)

[投稿](https://www.4hou.com/contribute)

[登录](https://www.4hou.com/login)
  |
[注册](https://www.4hou.com/register)

* 导读 ▾
* [活动](https://www.4hou.com/newticket)
* [专题](https://www.4hou.com/category/special)
* [图谱](https://www.4hou.com/atlas/index)
* [报告](https://www.4hou.com/new-report-info)
* [嘶票](https://www.4hou.com/tickets)
* [嘶货](https://www.4hou.com/shop)
* [企业查询](https://www.4hou.com/corp/new-search-company)
* [招聘](https://www.4hou.com/recruit)![](https://www.4hou.com/sihou/images/1561626446625934.png)

* [新闻](https://www.4hou.com/category/news)
* [行业](https://www.4hou.com/category/industry)
* [趋势](https://www.4hou.com/category/observation)
* [访谈](https://www.4hou.com/category/people)
* [漏洞](https://www.4hou.com/category/vulnerable)
* [WEB安全](https://www.4hou.com/category/web)
* [业务安全](https://www.4hou.com/category/business)
* [系统安全](https://www.4hou.com/category/system)
* [内网渗透](https://www.4hou.com/category/penetration)
* [勒索软件](https://www.4hou.com/category/typ)
* [安全工具](https://www.4hou.com/category/tools)

# Modbus Slave缓冲区溢出漏洞CVE-2022-1068分析与复现

盛邦安全
[行业](https://www.4hou.com/category/industry)
2023-01-13 11:11:19

![](https://img.4hou.com/article/%E6%B5%8F%E8%A7%88.png)119715

收藏

导语：Modbus Slave缓冲区溢出漏洞CVE-2022-1068分析与复现

**漏洞概述**

Modbus Slave是一个模拟工业领域通信协议Modbus从站的上位机软件，主要用于测试和调试Modbus从设备。该软件7.4.2以及以前的版本，在注册时，未对注册码长度进行安全检查，存在缓冲区溢出漏洞，导致软件崩溃。

**影响范围**

Modbus Slave 7.4.2以及以前的版本

**复现环境**

操作系统：Win7 sp1 32位操作系统

分析工具：IDA、OD、Windbg、Procexp

**漏洞分析**

分析时使用的版本为7.1.2.1357。

首先安装modbusslavesetup32bit\_7.1.2.1357.exe程序，默认安装后主程序路径为C:\Program Files\Modbus Tools\Modbus Slave\mbslave.exe。

根据exploit-db上已公开的poc.py生成Modbus.txt，Poc比较简单，Modbus.txt的内容为736个字符“A”，如下图所示：

![1.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230112/1673501736784832.png "1673501706184374.png")

使用Windbg调试器调试主程序mbslave.exe，然后点击mbslave.exe菜单栏的“Connection”按钮，在弹出的菜单中选择“Connect”，此时将弹出注册对话框，如下图所示：

![2.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230112/1673501737205005.png "1673501418192221.png")

复制poc文件Modbus.txt中的字符串内容，粘贴到注册对话框中，最后点击“OK”按钮，验证是否触发漏洞，如果poc验证成功，Windbg将捕获到异常，如下图所示：

![3.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230112/1673501738173656.png "1673501722116018.png")

在Windbg中使用k命令查看调用函数调用栈，发现栈中函数的返回地址已被覆盖为一个非常规值0x92989d93，说明发生了栈溢出，如下图所示：

![4.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230112/1673501739293992.png "1673501739293992.png")

接下来查找栈溢出的原因。

为更方便和直观，使用调试器OD重新调试程序mbslave.exe，在异常发生地址所在函数0x426B40下断点，再次将poc内容复制到注册对话框中，触发漏洞，调试OD将停止在断点处，此时，栈中的函数返回地址为正常值0x426141，如下图所示：

![1673501747943276.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230112/1673501747943276.png "1673501747943276.png")

为了定位栈中函数返回地址被覆盖的代码，需要对保存函数返回地址的栈地址0x12f07c下硬件写断点，然后继续运行，程序将停止在0x426e00代码处，此时，栈中的返回地址已被覆盖为0x426193，如下图所示：

![1673501763794857.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230112/1673501763794857.png "1673501763794857.png")

根据上图，可以看出，正是地址0x426DF9处的汇编代码，将EAX最低字节AL的值0x93覆盖栈中的函数返回地址的最低字节，说明导致栈溢出的代码就是该条汇编代码，当前除了覆盖栈中返回地址，栈溢出还覆盖了栈中结构化异常处理地址（SEH）等内容。

在反编译工具IDA中可以看到漏洞产生处的伪指令为 MultiByteStr[v52] = \*(\_WORD \*)v59，此时缓冲区的大小为300个字节，长度太小导致了溢出，覆盖了栈中函数返回地址和正常变量值，导致后续指令执行错误，使程序崩溃，如下图所示：

![7.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230112/1673501778142333.png "1673501778142333.png")

从上述的分析可知，溢出产生时，覆盖的数据并不是poc中的”A”字符，那么覆盖的数据是否来源于poc中，经过运算后的数据呢？

在IDA中查找数据来源，结合OD中动态调试分析，发现覆盖的数据是地址0x00426CFA处的代码运算后的结果，这是一条异或运算的汇编代码，按字节异或，如下图所示：

![1673501794167857.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230112/1673501794167857.png "1673501794167857.png")

异或的源数据是poc中字符串按两位一组转化为十六进制的值，异或的KEY为“97280132”，比如第一轮循环时，将poc中的前两位字符串“AA”转换为0xAA，然后与KEY的第一位字符“9”，十六进制为0x39进行异或，最后将异或的结果放到栈中缓冲区MultiByteStr[v52]进行保存，如果poc中的字符串个数大于600个字符（600=300\*2，poc中为736个字符“A”），将发生栈溢出，可以覆盖栈中SEH地址，函数返回地址和局部变量等，导致程序崩溃。

既然发生了栈溢出，并且数据可控，那么是否能执行任意shellcode呢？

**漏洞利用**

常见的栈溢出利用可以利用被覆盖的函数返回地址执行任意shellcode，即漏洞发生后，覆盖了栈中函数返回地址，当当前函数执行完毕后，将跳转到函数返回地址执行代码，但是该程序中开启了Security Cookie栈保护安全机制，位于0x00427237地址处，在函数返回前，Cookie检验失败，无法利用该方法。

![9.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230112/1673501815120289.png "1673501815120289.png")

除此之外，溢出还覆盖了栈中结构化溢出处理（SEH）函数地址，当异常发生时，将跳转到异常处理函数执行代码，但是该程序中开启了Safe SEH安全保护机制，简单来讲，不是预定义的异常处理函数地址，不予执行，使用 dumpbin /loadconfig  mbslave.exe命令可以查看Safe SEH 表，如下图所示：

![10.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230112/1673501820167836.png "1673501820167836.png")

既然开启了Safe SEH，是否有办法绕过呢？常见的绕过方法如下：

1、攻击返回地址绕过，该程序开启了Security Cookie，无法绕过。

2、虚函数绕过，溢出覆盖范围有限，无法覆盖虚函数。

3、从堆中绕过，将shellcode布置在堆中 ，SEH处理函数指向这个地址即可，该程序开启数据执行保护（DEP），无法将数据作为代码执行。

4、利用未启用Safe SEH模块绕过，可以把这个模块的指令作为跳板，去执行shellcode，该程序没有未启用Safe SEH的模块。

5、加载模块之外的地址绕过，内存中有一些Map类型的映射文件，在这些文件中找到跳板指令覆盖SEH处理函数地址即可绕过，该程序开启数据执行保护（DEP），无法将数据作为代码执行。

总的来说，该程序在测试系统win7 sp1上，无法绕过Safe SEH执行shellcode，如果使用低版本的系统，比如Windows XP低版本系统，可以实现执行任意shellcode，因为Safe SEH是Windows XP sp2以及之后的版本中加入的安全特性。

poc

https://github.com/webraybtl/CVE-2022-1068

参考链接

https://www.exploit-db.com/exploits/50536

https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1068

如若转载，请注明原文地址

* 分享至

![取消](https://www.4hou.com/sihou/images/close.jpg)
![嘶吼](https://www.4hou.com/sihou/images/logo.png)

感谢您的支持，我会继续努力的!

![扫码支持]( "扫一扫")

打开微信扫一扫后点击右上角即可分享哟

### 发表评论

评论

![](https://www.4hou.com/captcha/flat?AVKqZDAm)

#### 你可能感兴趣的

* [![]()

  Exchange/M365最新防范攻略！CACTER三步补齐原生防护短板](https://www.4hou.com/posts/l03l)
* [![]()

  【附下载】2025我们身边的 网信安全 典型案例等 官方视频汇编](https://www.4hou.com/posts/kg3x)
* [![]()

  蝉联荣誉！梆梆安全再度获选 “北京市委网信办第二届网络安全技术支撑单位”](https://www.4hou.com/posts/9jKP)
* [![]()

  聚焦可信AI安全！SDC2025 议题重磅揭晓](https://www.4hou.com/posts/gy39)
* [![]()

  2025第五届太原网络安全高峰论坛成功举办](https://www.4hou.com/posts/8gJl)
* [![]()

  特勤局手册 | 监听办公室](https://www.4hou.com/posts/42B2)

![](https://img.4hou.com/portraits/3c8d3af7c49c95c16dd14518142759d6.png)

# [盛邦安全](https://www.4hou.com/member/9ZO4)

让网络空间更有序

#### 最新文章

* [Exchange/M365最新防范攻略！CACTER三步补齐原生防护短板](https://www.4hou.com/posts/l03l)
  2025-09-29 17:48:04
* [【附下载】2025我们身边的 网信安全 典型案例等 官方视频汇编](https://www.4hou.com/posts/kg3x)
  2025-09-29 14:55:37
* [蝉联荣誉！梆梆安全再度获选 “北京市委网信办第二届网络安全技术支撑单位”](https://www.4hou.com/posts/9jKP)
  2025-09-29 14:23:50
* [聚焦可信AI安全！SDC2025 议题重磅揭晓](https://www.4hou.com/posts/gy39)
  2025-09-28 17:20:40

[查看更多](https://www.4hou.com/member/9ZO4)

# 相关热文

* [Exchange/M365最新防范攻略！CACTER三步补齐原生防护短板](https://www.4hou.com/posts/l03l)

  CACTER
* [【附下载】2025我们身边的 网信安全 典型案例等 官方视频汇编](https://www.4hou.com/posts/kg3x)

  网络伍豪
* [蝉联荣誉！梆梆安全再度获选 “北京市委网信办第二届网络安全技术支撑单位”](https://www.4hou.com/posts/9jKP)

  梆梆安全
* [聚焦可信AI安全！SDC2025 议题重磅揭晓](https://www.4hou.com/posts/gy39)

  企业资讯
* [2025第五届太原网络安全高峰论坛成功举办](https://www.4hou.com/posts/8gJl)

  企业资讯
* [特勤局手册 | 监听办公室](https://www.4hou.com/posts/42B2)

  RC2反窃密实验室

![]()

[公司简介](https://www.4hou.com/about?title=公司简介)
|
[我要投稿](https://www.4hou.com/about?title=我要投稿)
|
[更新日志](https://www.4hou.com/about?title=更新日志)
|
[友情链接](https://www.4hou.com/about?title=友情链接)
|
[隐私政策](https://www.4hou.com/about?title=隐私政策)
|

[![](https://www.4hou.com/sihou/images/new4hou/weibo.png)](http://weibo.com/u/6069423878)
![](https://www.4hou.com/sihou/images/new4hou/wechat.png)

本站4hou.com，所使用的字体和图片文字等素材部分来源于原作者或互联网共享平台。如使用任何字体和图片文字有侵犯其版权所有方的，嘶吼将配合联系原作者核实，并做出删除处理。

[©2024 北京嘶吼文化传媒有限公司 京ICP备16063439号-1](https://beian.miit.gov.cn/)
本站由 ![](https://www.4hou.com/sihou/images/new4hou/txcloud.png) ![](https://www.4hou.com/sihou/images/new4hou/bdcloud.png) ![](https://www.4hou.com/sihou/images/new4hou/ucloud.png) 提供云计算服务

微信

[微博](http://weibo.com/u/6069423878)
[RSS](https://www.4hou.com/feed)
[知乎](https://zhuanlan.zhihu.com/roartalk)