---
title: 漏洞深度分析｜CVE-2023-25141 sling-org-apache-sling-jcr-base存在JNDI注入漏洞
url: https://www.4hou.com/posts/7JEr
source: 嘶吼 RoarTalk – 回归最本质的信息安全,互联网安全新媒体,4hou.com
date: 2023-02-21
fetch_date: 2025-10-04T07:34:48.059127
---

# 漏洞深度分析｜CVE-2023-25141 sling-org-apache-sling-jcr-base存在JNDI注入漏洞

漏洞深度分析｜CVE-2023-25141 sling-org-apache-sling-jcr-base存在JNDI注入漏洞 - 嘶吼 RoarTalk – 网络安全行业综合服务平台,4hou.com

[![](https://www.4hou.com/sihou/images/new4hou/newlogoss.png)](https://www.4hou.com)

* [首页](https://www.4hou.com)
* [企业中心](https://www.4hou.com/corp/newindex)
* [产业研究院](https://www.4hou.com/real-time)

![](https://www.4hou.com/sihou/images/new4hou/search-icon.png)

[投稿](https://www.4hou.com/contribute)

[登录](https://www.4hou.com/login)
  |
[注册](https://www.4hou.com/register)

* 导读 ▾
* [活动](https://www.4hou.com/newticket)
* [专题](https://www.4hou.com/category/special)
* [图谱](https://www.4hou.com/atlas/index)
* [报告](https://www.4hou.com/new-report-info)
* [嘶票](https://www.4hou.com/tickets)
* [嘶货](https://www.4hou.com/shop)
* [企业查询](https://www.4hou.com/corp/new-search-company)
* [招聘](https://www.4hou.com/recruit)![](https://www.4hou.com/sihou/images/1561626446625934.png)

* [新闻](https://www.4hou.com/category/news)
* [行业](https://www.4hou.com/category/industry)
* [趋势](https://www.4hou.com/category/observation)
* [访谈](https://www.4hou.com/category/people)
* [漏洞](https://www.4hou.com/category/vulnerable)
* [WEB安全](https://www.4hou.com/category/web)
* [业务安全](https://www.4hou.com/category/business)
* [系统安全](https://www.4hou.com/category/system)
* [内网渗透](https://www.4hou.com/category/penetration)
* [勒索软件](https://www.4hou.com/category/typ)
* [安全工具](https://www.4hou.com/category/tools)

# 漏洞深度分析｜CVE-2023-25141 sling-org-apache-sling-jcr-base存在JNDI注入漏洞

棱镜七彩
[行业](https://www.4hou.com/category/industry)
2023-02-20 14:10:42

![](https://img.4hou.com/article/%E6%B5%8F%E8%A7%88.png)125503

收藏

导语：CVE-2023-25141 sling-org-apache-sling-jcr-base存在JNDI注入漏洞

**项目介绍**

Apache Sling提供对可插入资源提供程序的支持。虽然这允许将自定义数据提供程序非常灵活和高效地集成到Sling中，但这种集成是在Sling的资源 API 级别上完成的。可能依赖于能够将资源适配到JCR节点并继续使用JCR API的遗留代码将不适用于此类资源提供者。

为了支持遗留代码，这个包提供了一个SPI接口org.apache.sling.jcr.base.spi.RepositoryMount，它扩展了JackrabbitRepository（并通过这个javax.jcr.Repository）。注册为RepositoryMount的服务使用服务注册属性RepositoryMount.MOUNT\_POINTS\_KEY 注册自己，这是一个 String+ 属性，包含 JCR 树中的路径，其中挂载接管 JCR 节点的控制。RepositoryMount可以注册在一个或多个路径。

由于RepositoryMount扩展了JackrabbitRepository挂载的实现需要实现整个 JCR API。与ResourceProvider相比，这是很多工作，因此只有在需要支持使用 JCR API 的遗留代码时才应使用RepositoryMount 。

JCR 基础包提供 JCR 实用程序类和对存储库安装的支持。

**项目地址**

<https://github.com/apache/sling-org-apache-sling-jcr-base>

<https://sling.apache.org/>

**漏洞概述**

在 JDK 1.8.191 或更低版本中运行 Apache Sling JCR Base 且项目版本小于 3.1.12 时可能存在注入漏洞，由于 RepositoryAccessor.java 中的 getRepository 方法和 getRepositoryFromURL 方法对传入的参数验证不当导致 JNDI 或 RMI 注入漏洞。远程攻击者可以通过 JDNI 和 RMI 连接访问存储在服务器上的任意数据。

**影响版本**

org.apache.sling:org.apache.sling.jcr.base@(-∞, 3.1.12)

**环境搭建**

下载源码，运行构建即可。

**漏洞分析**

sling 项目的jcr基础库（/sling-org-apache-sling-jcr-base）提供两个函数

RepositoryAccessor#getRepository 和 RepositoryAccessor#getRepositoryFromURL

其中 RepositoryAccessor#getRepositoryFromURL

这个函数的功能是根据给定的 URL 获取仓库对象 Repository，这个函数可能是为应用程序提供访问存储在远程位置的数据的方法

![图片1.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230216/1676547497203752.png "1676547199166404.png")

该函数将传入的 jndi name 和 内容传给类里的另一个函数 RepositoryAccessor#getRepository

![图片2.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230216/1676547501135812.png "1676547225548337.png")

这个函数的作用是根据给定的 URL 获取仓库对象 Repository。

函数的参数：

* url：一个字符串，表示仓库对象的 URL。

函数的返回值：

* 如果成功获取仓库对象，则返回仓库对象。
* 如果无法获取仓库对象，则抛出异常。

如果 URL 的前缀是 "jndi://"，则函数会尝试从 JNDI 环境获取仓库对象。否则，它会使用 getRepository 函数尝试从 JNDI 和 RMI 两种途径获取仓库对象。

但是存在直接使用 initialContext.lookup(repositoryName) 的漏洞点，

仅存在一个if判断 jndiContext 是否为空或大小是否为 0，并未对用户可控的值进行检查

source点如下所示

![图片3.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230216/1676547502179651.png "1676547275596160.png")

lookup存在两个重载

![图片4.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230216/1676547503150970.png "1676547296597032.png")

看一下 lookup 的调用方法，传进 InitialContext#getURLOrDefaultInitCtx

![图片5.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230216/1676547505113008.png "1676547316151199.png")

lookup 拿到 name ，getURLScheme匹配 ：和 /；之后获取链接内容，getURLContext 解释包含样例

For example, if the scheme id is "ldap", and the Context. URL\_PKG\_PREFIXES property contains "com.widget:com.wiz. jndi", the naming manager would attempt to load the following classes until one is successfully instantiated:
· com.widget.ldap.ldapURLContextFactory
· com.wiz.jndi.ldap.ldapURLContextFactory
· com.sun.jndi.url.ldap.ldapURLContextFactory

而我们可以控制 lookup 函数的参数，使客户端访问提前设置好的恶意的 RMI 服务链接来加载恶意的对象class 字节码文件来实例化，从而执行代码，完成利用。

该类并不存在任何黑/白名单对用户传入进行过滤，用户可直接传入rmi 恶意链接执行命令。确定该处存在 jndi注入，可被利用导致命令执行

**修复方式**

组件 org.apache.sling:org.apache.sling.jcr.base 升级至 3.1.12 及以上版本

**参考链接**

<https://nvd.nist.gov/vuln/detail/CVE-2023-25141>

查看更多安全漏洞：[快速查询安全漏洞｜柒巧板](https://weibo.cn/sinaurl?u=https%3A%2F%2Fspdx.cn%2Fsafety)

如若转载，请注明原文地址

* 分享至

![取消](https://www.4hou.com/sihou/images/close.jpg)
![嘶吼](https://www.4hou.com/sihou/images/logo.png)

感谢您的支持，我会继续努力的!

![扫码支持]( "扫一扫")

打开微信扫一扫后点击右上角即可分享哟

### 发表评论

评论

![](https://www.4hou.com/captcha/flat?CCxfR5mB)

#### 你可能感兴趣的

* [![]()

  Exchange/M365最新防范攻略！CACTER三步补齐原生防护短板](https://www.4hou.com/posts/l03l)
* [![]()

  【附下载】2025我们身边的 网信安全 典型案例等 官方视频汇编](https://www.4hou.com/posts/kg3x)
* [![]()

  蝉联荣誉！梆梆安全再度获选 “北京市委网信办第二届网络安全技术支撑单位”](https://www.4hou.com/posts/9jKP)
* [![]()

  聚焦可信AI安全！SDC2025 议题重磅揭晓](https://www.4hou.com/posts/gy39)
* [![]()

  2025第五届太原网络安全高峰论坛成功举办](https://www.4hou.com/posts/8gJl)
* [![]()

  特勤局手册 | 监听办公室](https://www.4hou.com/posts/42B2)

![](https://img.4hou.com/portraits/4fb31b21420c34b053939ec1fc0a9646.png)

# [棱镜七彩](https://www.4hou.com/member/VGo9)

专注开源安全合规，专注供应链安全

#### 最新文章

* [Exchange/M365最新防范攻略！CACTER三步补齐原生防护短板](https://www.4hou.com/posts/l03l)
  2025-09-29 17:48:04
* [【附下载】2025我们身边的 网信安全 典型案例等 官方视频汇编](https://www.4hou.com/posts/kg3x)
  2025-09-29 14:55:37
* [蝉联荣誉！梆梆安全再度获选 “北京市委网信办第二届网络安全技术支撑单位”](https://www.4hou.com/posts/9jKP)
  2025-09-29 14:23:50
* [聚焦可信AI安全！SDC2025 议题重磅揭晓](https://www.4hou.com/posts/gy39)
  2025-09-28 17:20:40

[查看更多](https://www.4hou.com/member/VGo9)

# 相关热文

* [Exchange/M365最新防范攻略！CACTER三步补齐原生防护短板](https://www.4hou.com/posts/l03l)

  CACTER
* [【附下载】2025我们身边的 网信安全 典型案例等 官方视频汇编](https://www.4hou.com/posts/kg3x)

  网络伍豪
* [蝉联荣誉！梆梆安全再度获选 “北京市委网信办第二届网络安全技术支撑单位”](https://www.4hou.com/posts/9jKP)

  梆梆安全
* [聚焦可信AI安全！SDC2025 议题重磅揭晓](https://www.4hou.com/posts/gy39)

  企业资讯
* [2025第五届太原网络安全高峰论坛成功举办](https://www.4hou.com/posts/8gJl)

  企业资讯
* [特勤局手册 | 监听办公室](https://www.4hou.com/posts/42B2)

  RC2反窃密实验室

![]()

[公司简介](https://www.4hou.com/about?title=公司简介)
|
[我要投稿](https://www.4hou.com/about?title=我要投稿)
|
[更新日志](https://www.4hou.com/about?title=更新日志)
|
[友情链接](https://www.4hou.com/about?title=友情链接)
|
[隐私政策](https://www.4hou.com/about?title=隐私政策)
|

[![](https://www.4hou.com/sihou/images/new4hou/weibo.png)](http://weibo.com/u/6069423878)
![](https://www.4hou.com/sihou/images/new4hou/wechat.png)

本站4hou.com，所使用的字体和图片文字等素材部分来源于原作者或互联网共享平台。如使用任何字体和图片文字有侵犯其版权所有方的，嘶吼将配合联系原作者核实，并做出删除处理。

[©2024 北京嘶吼文化传媒有限公司 京ICP备16063439号-1](https://beian.miit.gov.cn/)
本站由 ![](https://www.4hou.com/sihou/images/new4hou/txcloud.png) ![](https://www.4hou.com/sihou/images/new4hou/bdcloud.png) ![](https://www.4hou.com/sihou/images/new4hou/ucloud.png) 提供云计算服务

微信

[微博](http://weibo.com/u/6069423878)
[RSS](https://www.4hou.com/feed)
[知乎](https://zhuanlan.zhihu.com/roartalk)