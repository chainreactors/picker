---
title: Deception & Inspection: Gathering intelligence & increasing the red team infrastructure resiliency
url: https://c99.sh/deception-inspection-gathering-intelligence-increasing-the-red-team-infrastructure-resiliency/
source: C99.sh
date: 2022-11-12
fetch_date: 2025-10-03T22:31:52.861973
---

# Deception & Inspection: Gathering intelligence & increasing the red team infrastructure resiliency

# [C99.sh](https://c99.sh/)

## . . . Security Focus . . .

* [Home](https://c99.sh/)
* Categories
  + [Application Security](https://c99.sh/category/application-security/)
  + [Red Team](https://c99.sh/category/red-team/)
  + [Security Tools](https://c99.sh/category/security-tools/)
  + [Cryptography](https://c99.sh/category/cryptography/)
  + [Threat Hunting](https://c99.sh/category/threat-hunting/)
  + [Abstract](https://c99.sh/category/abstract/)
* [Archives](https://c99.sh/archives/)
* [Contact](https://c99.sh/contact/)
* [GitHub](https://github.com/iomoath)
* [Proxy Detection Test](https://proxyscore.c99.sh)
* [‚èØÔ∏é ŸÇŸÜÿßÿ© ŸäŸàÿ™ŸäŸàÿ®](https://www.youtube.com/%40moath.maharmeh/)

# Deception & Inspection: Gathering intelligence & increasing the red team infrastructure resiliency

posted in [Red Team](https://c99.sh/category/red-team/)

on
[November 11, 2022](https://c99.sh/deception-inspection-gathering-intelligence-increasing-the-red-team-infrastructure-resiliency/ "6:07 pm")
 by
[Moath Maharmeh](https://c99.sh/author/core/ "View all posts by Moath Maharmeh")

SHARE

[Tweet](https://twitter.com/share)

[![Pin It](//assets.pinterest.com/images/PinExt.png "Pin It")](http://pinterest.com/pin/create/button/?url=https://c99.sh/deception-inspection-gathering-intelligence-increasing-the-red-team-infrastructure-resiliency/&media=https://c99.sh/wp-content/uploads/2022/11/Deception_Inspection.jpg&description=Deception & Inspection: Gathering intelligence & increasing the red team infrastructure resiliency)

![](https://c99.sh/wp-content/uploads/2022/11/Deception_Inspection.jpg)

## Introduction

Table of Contents

Toggle

* [Introduction](#Introduction "Introduction")
  + [Objectives](#Objectives "Objectives")
* [How to achieve that?](#How_to_achieve_that "How to achieve that?")
* [The Process](#The_Process "The Process")
* [HTTP Request Logger](#HTTP_Request_Logger "HTTP Request Logger")
* [Fake Malware](#Fake_Malware "Fake Malware")
* [Next: A Kind invitation üôÇ](#Next_A_Kind_invitation_%F0%9F%99%82 "Next: A Kind invitation üôÇ")
* [Samples of the collected logs](#Samples_of_the_collected_logs "Samples of the collected logs")
* [Black-hole. Redirector. Filter unwanted HTTP requests](#Black-hole_Redirector_Filter_unwanted_HTTP_requests "Black-hole. Redirector. Filter unwanted HTTP requests")
* [Final Recommendations](#Final_Recommendations "Final Recommendations")

This article primarily targets the red teams. It demonstrates several ways of gathering intelligence about the public security scanners & analyzers and the security platforms and tools used by the target organization.

**Keywords**: C2 Infrastructure resiliency | Cyber Intelligence | Dynamic URL & executable Analyzers | Security Defense Tooling Behavior Benchmark

### Objectives

Whether you‚Äôre a red team, blue team member, or in between, you may have different objectives:

* **Red team**: Collecting intelligence about the security platforms and tools used in the target organization. Use the collected intelligence to increase the resiliency of the Red team infra. E.g., C2 & phishing sites.
* **Blue team**: Benchmark the existing security tooling and platforms and analyzing their behavior. Optimize!

## How to achieve that?

1. Prepare an HTTP Request logger.
2. Make a fake malicious URL and submit it to online URL scanners, a non-existing and existing email address of the target organization.
3. Prepare a fake malicious executable and submit it to online scanners such as [Virustotal.com](https://www.virustotal.com).
4. Analyze the incoming HTTP requests and make an HTTP requests filter for protecting our C2 or phishing links.
5. Based on the logs collected, build, and improve a ‚Äúrequest filter, Firewall!‚Äù

## The Process

![](https://c99.sh/wp-content/uploads/2022/11/Collecting_Intel_Security_Platforms_Dynamic-1024x677.png)

**Image-1 ‚Äî Collecting intelligence about the security platforms, scanners, analyzers, behavior.**

![](https://c99.sh/wp-content/uploads/2022/11/Blackhole_Redirector-1024x683.png)

**Image-2 ‚Äî Blackhole script, acting as a firewall. Redirect/Block unwanted HTTP requests.**

## HTTP Request Logger

We just need to have a simple HTTP request logger (you can also relay on the web server ‚Äúaccess\_logs‚Äù, however you may have your own HTTP request logger so you can have more information like screen resolution, browser language, hostname and more. I already made a simple PHP logger script, feel free to customize it to fit your needs.

<https://github.com/iomoath/php-weblogger>

![](https://c99.sh/wp-content/uploads/2022/11/php_logger_snippet.png)

**Image-3 ‚Äî A Simple PHP HTTP Request Logger script**

## Fake Malware

The following image is a C# code snippet. It fetches some content from a URL which in this case will be the URL of our HTTP Logger. The code then invokes the fetched content; in this case, there will be no content or an actual code to be executed. The goal is to drop our HTTP Logger URL in the executable so the security analysts and the automated dynamic analyzers can parse and access it.

![](https://c99.sh/wp-content/uploads/2022/11/Sample_fake_malware-1024x475.png)

**Image-4 ‚Äî A fake malware source code**

![](https://c99.sh/wp-content/uploads/2022/11/Sample_fake_malware_exe.png)

**Image-5 ‚Äî M**alware**** **Compiled**

## Next: A Kind invitation üôÇ

At this point, we should have a web server that hosts our PHP Logger script and fake malware containing our Logger URL. It‚Äôs time to submit the sample malware and the link to the following:

* **Online malware scanners, such as virustotal.com**
* **Submit to security companies via online sample submission forms.**
* **Send the HTTP logger URL by email to some SOC emails**
* **Optional? Send the HTTP logger URL by email to an existing and non-existing target organization.**

## Samples of the collected logs

I submitted both the fake malware and the fake phishing link to Virustotal, Symantec, DrWeb, and jotti.org.

These are samples of the logs I received from the link that was embedded in the fake malware assembly:

```
20.99.160.173 | 20.99.160.173 | 11/11/2022 04:33:47pm | "GET /payload/payload.php HTTP/1.1" | | | Unknown | |
34.145.188.48 | 48.188.145.34.bc.googleusercontent.com | 11/11/2022 04:34:02pm | "GET /payload/payload.php HTTP/1.1" | | | Unknown | |
34.141.245.25 | 25.245.141.34.bc.googleusercontent.com | 11/11/2022 04:34:41pm | "GET /payload/payload.php HTTP/1.1" | | | Unknown | |
194.154.78.239 | 194.154.78.239 | 11/11/2022 04:35:41pm | "GET /payload/payload.php HTTP/1.1" | | | Unknown | |
212.119.227.185 | 212.119.227.185 | 11/11/2022 04:35:47pm | "GET /payload/payload.php HTTP/1.1" | | | Unknown | |
194.154.78.239 | 194.154.78.239 | 11/11/2022 04:35:47pm | "GET /payload/payload.php HTTP/1.1" | | | Unknown | |
95.25.71.11 | 95-25-71-11.broadband.corbina.ru | 11/11/2022 04:35:52pm | "GET /payload/payload.php HTTP/1.1" | | | Unknown | |
72.37.157.82 | 72.37.157.82 | 11/11/2022 04:38:57pm | "GET /payload/payload.php HTTP/1.1" | | | Unknown | |
35.185.241.102 | 102.241.185.35.bc.googleusercontent.com | 11/11/2022 04:39:02pm | "GET /payload/payload.php HTTP/1.1" | Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko | | Internet Explorer | Windows | en, *;q=0.7
107.178.232.224 | 224.232.178.107.gae.googleusercontent.com | 11/11/2022 04:39:18pm | "HEAD /payload/payload.php HTTP/1.1" | Mozilla/5.0 (Linux; Android 10) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Focus/1.0 Chrome/59.0.3029.83 Mobile Safari/537.36 | http://example.org | Chrome | Android | en-us,en;q=0.5
107.178.232.224 | 224.232.178.107.gae.googleusercontent.com | 11/11/2022 04:39:18pm | "GET /payload/payload.php HTTP/1.1" | Mozilla/5.0 (Linux; Android 10) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Focus/1.0 Chrome/59.0.3029.83 Mobile Safari/537.36 | http://example.org | Chrome | Android | en-us,en;q=0.5
3.232.207.53 | ec2-3-232-207-53.compute-1.amazonaws.com | 11/11/2022 04:39:19pm | "GET /payload/payload.php HTTP/1.1" | M...