---
title: Thales SafeNet Sentinel HASP LDK本地提权漏洞（CVE-2024-0197）分析与复现
url: https://www.4hou.com/posts/jgzy
source: 嘶吼 RoarTalk – 网络安全行业综合服务平台,4hou.com
date: 2024-03-27
fetch_date: 2025-10-04T12:07:58.252089
---

# Thales SafeNet Sentinel HASP LDK本地提权漏洞（CVE-2024-0197）分析与复现

Thales SafeNet Sentinel HASP LDK本地提权漏洞（CVE-2024-0197）分析与复现 - 嘶吼 RoarTalk – 网络安全行业综合服务平台,4hou.com

[![](https://www.4hou.com/sihou/images/new4hou/newlogoss.png)](https://www.4hou.com)

* [首页](https://www.4hou.com)
* [企业中心](https://www.4hou.com/corp/newindex)
* [产业研究院](https://www.4hou.com/real-time)

![](https://www.4hou.com/sihou/images/new4hou/search-icon.png)

[投稿](https://www.4hou.com/contribute)

[登录](https://www.4hou.com/login)
  |
[注册](https://www.4hou.com/register)

* 导读 ▾
* [活动](https://www.4hou.com/newticket)
* [专题](https://www.4hou.com/category/special)
* [图谱](https://www.4hou.com/atlas/index)
* [报告](https://www.4hou.com/new-report-info)
* [嘶票](https://www.4hou.com/tickets)
* [嘶货](https://www.4hou.com/shop)
* [企业查询](https://www.4hou.com/corp/new-search-company)
* [招聘](https://www.4hou.com/recruit)![](https://www.4hou.com/sihou/images/1561626446625934.png)

* [新闻](https://www.4hou.com/category/news)
* [行业](https://www.4hou.com/category/industry)
* [趋势](https://www.4hou.com/category/observation)
* [访谈](https://www.4hou.com/category/people)
* [漏洞](https://www.4hou.com/category/vulnerable)
* [WEB安全](https://www.4hou.com/category/web)
* [业务安全](https://www.4hou.com/category/business)
* [系统安全](https://www.4hou.com/category/system)
* [内网渗透](https://www.4hou.com/category/penetration)
* [勒索软件](https://www.4hou.com/category/typ)
* [安全工具](https://www.4hou.com/category/tools)

# Thales SafeNet Sentinel HASP LDK本地提权漏洞（CVE-2024-0197）分析与复现

盛邦安全
[行业](https://www.4hou.com/category/industry)
2024-03-26 16:57:07

![](https://img.4hou.com/article/%E6%B5%8F%E8%A7%88.png)130253

收藏

导语：Thales SafeNet Sentinel HASP LDK本地提权漏洞（CVE-2024-0197）分析与复现

**漏洞描述**

Thales SafeNetSentinel HASP LDK是一个软件保护和许可管理解决方案，用于帮助软件开发者保护其应用程序免受盗版和未经授权使用，由Thales SafeNet公司开发并提供支持。

该工具的msi安装程序在执行修复模式/fa时，存在DLL劫持漏洞。导致本地普通用户可以劫持%temp%下的安装程序，以system权限执行任意代码，实现本地权限提升。

**影响范围**

Thales SafeNet Sentinel HASP LDK < 9.16

**复现环境**

操作系统：Win7x64 sp1

分析工具：Procmon、Procexp

**初识MSI文件**

MSI 文件是 Windows Installer 包的文件扩展名，它通常用于安装、升级和卸载 Windows 程序。MSI 文件包含了程序安装所需的所有信息，如文件、注册表项、启动服务等。

 MSI 文件运行时，Windows Installer 服务会以系统权限启动msiexec.exe 程序。然后msiexec.exe 将根据 MSI 文件中指定的安装步骤和条件，可能会多次以系统权限或用户权限启动其他程序或脚本来完成安装或卸载操作。这些额外的程序或脚本可能包含在 MSI 文件中，也可能来自外部引用。

**漏洞分析**

Windows Installer程序msiexec.exe，运行时支持多个参数。比如这个漏洞相关的参数：/fa，这是修复选项，表示强制重新安装所有文件，如下图所示。

![1.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361710960561.png "1711361408185978.png")

下载安装包Sentinel HASP LDK，下载地址：

[https://archive.org/details/isocd-sentinel\_ldk\_msi\_run-time\_install\_api.rar，此安装包的版本为6.25。根据公开的漏洞描述，尝试使用修复选项“/fa”执行安装程序，但是提示错误，如下图所示。](https://archive.org/details/isocd-sentinel_ldk_msi_run-time_install_api.rar%EF%BC%8C%E6%AD%A4%E5%AE%89%E8%A3%85%E5%8C%85%E7%9A%84%E7%89%88%E6%9C%AC%E4%B8%BA6.25%E3%80%82%E6%A0%B9%E6%8D%AE%E5%85%AC%E5%BC%80%E7%9A%84%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0%EF%BC%8C%E5%B0%9D%E8%AF%95%E4%BD%BF%E7%94%A8%E4%BF%AE%E5%A4%8D%E9%80%89%E9%A1%B9%E2%80%9C/fa%E2%80%9D%E6%89%A7%E8%A1%8C%E5%AE%89%E8%A3%85%E7%A8%8B%E5%BA%8F%EF%BC%8C%E4%BD%86%E6%98%AF%E6%8F%90%E7%A4%BA%E9%94%99%E8%AF%AF%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%E6%89%80%E7%A4%BA%E3%80%82)

![2.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361710699993.png "1711361420113507.png")

此错误提示执行修复选项前需要先安装。所以先双击安装包文件HASP\_Setup.msi进行安装。

![3.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361711672129.png "1711361449615592.png")

安装成功后，使用Procmon监控msiexec.exe的行为，然后再次执行修复选项。从Procmon监控日志中可以看出，执行修复选项时，msiexec.exe在%temp%目录下释放了haspdinst\_x64.exe程序，并创建进程运行，如下图所示。

![4.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361712926389.png "1711361472145741.png")

此时从procexp进程管理工具中可以看出，haspdinst\_x64.exe进程的用户名为SYSTEM。

![5.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361713191711.png "1711361497520165.png")

查看haspdinst\_x64.exe加载DLL的监控日志，发现存在fltlib.dll，newdev.dll等DLL劫持，如下图所示。

![6.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361714218724.png "1711361530856165.png")

![7.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361716160297.png "1711361536187448.png")

利用haspdinst\_x64.exe存在的DLL劫持，可以实现本地权限提升。

**复现步骤**

isocd-sentinel\_ldk\_msi\_run-time\_install\_api.rar安装包解压后双击HASP\_Setup.msi文件进行安装。

![8.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361716510536.png "1711361603562198.png")

编写DLL劫持程序，在DllMain中将当前进程名，命令行参数，用户名等信息记录到C:\users\Public\poc.txt文件中，如下图所示。

![9.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361718554785.png "1711361628114922.png")

编译成功后将得到的DLL文件重命名fltlib.dll，复制到%temp%目录下，运行修复选项命令：msiexec.exe /fa HASP\_Setup.msi，如下图所示。

![10.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361719168991.png "1711361653133900.png")

从生成的文件C:\users\Public\poc.txt可以看出，运行haspdinst\_x64.exe时的用户为SYSTEM，提权漏洞复现成功，如下图所示。

![11.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361720210455.png "1711361676537384.png")

当然也可以在DllMain中创建cmd进程，利用此漏洞获取SYSTEM权限的cmd，如下图所示。

![12.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20240325/1711361721110919.png "1711361701445388.png")

**参考链接**

<https://www.ddpoc.com/DVB-2024-6338.html>

<https://github.com/ewilded/CVE-2024-0197-POC>

[知乎技术专栏](https://www.zhihu.com/column/c_1459205330744266753)

如若转载，请注明原文地址

* 分享至

![取消](https://www.4hou.com/sihou/images/close.jpg)
![嘶吼](https://www.4hou.com/sihou/images/logo.png)

感谢您的支持，我会继续努力的!

![扫码支持]( "扫一扫")

打开微信扫一扫后点击右上角即可分享哟

### 发表评论

评论

![](https://www.4hou.com/captcha/flat?mYOY1KMF)

#### 你可能感兴趣的

* [![]()

  Exchange/M365最新防范攻略！CACTER三步补齐原生防护短板](https://www.4hou.com/posts/l03l)
* [![]()

  【附下载】2025我们身边的 网信安全 典型案例等 官方视频汇编](https://www.4hou.com/posts/kg3x)
* [![]()

  蝉联荣誉！梆梆安全再度获选 “北京市委网信办第二届网络安全技术支撑单位”](https://www.4hou.com/posts/9jKP)
* [![]()

  聚焦可信AI安全！SDC2025 议题重磅揭晓](https://www.4hou.com/posts/gy39)
* [![]()

  2025第五届太原网络安全高峰论坛成功举办](https://www.4hou.com/posts/8gJl)
* [![]()

  特勤局手册 | 监听办公室](https://www.4hou.com/posts/42B2)

![](https://img.4hou.com/portraits/3c8d3af7c49c95c16dd14518142759d6.png)

# [盛邦安全](https://www.4hou.com/member/9ZO4)

让网络空间更有序

#### 最新文章

* [Exchange/M365最新防范攻略！CACTER三步补齐原生防护短板](https://www.4hou.com/posts/l03l)
  2025-09-29 17:48:04
* [【附下载】2025我们身边的 网信安全 典型案例等 官方视频汇编](https://www.4hou.com/posts/kg3x)
  2025-09-29 14:55:37
* [蝉联荣誉！梆梆安全再度获选 “北京市委网信办第二届网络安全技术支撑单位”](https://www.4hou.com/posts/9jKP)
  2025-09-29 14:23:50
* [聚焦可信AI安全！SDC2025 议题重磅揭晓](https://www.4hou.com/posts/gy39)
  2025-09-28 17:20:40

[查看更多](https://www.4hou.com/member/9ZO4)

# 相关热文

* [Exchange/M365最新防范攻略！CACTER三步补齐原生防护短板](https://www.4hou.com/posts/l03l)

  CACTER
* [【附下载】2025我们身边的 网信安全 典型案例等 官方视频汇编](https://www.4hou.com/posts/kg3x)

  网络伍豪
* [蝉联荣誉！梆梆安全再度获选 “北京市委网信办第二届网络安全技术支撑单位”](https://www.4hou.com/posts/9jKP)

  梆梆安全
* [聚焦可信AI安全！SDC2025 议题重磅揭晓](https://www.4hou.com/posts/gy39)

  企业资讯
* [2025第五届太原网络安全高峰论坛成功举办](https://www.4hou.com/posts/8gJl)

  企业资讯
* [特勤局手册 | 监听办公室](https://www.4hou.com/posts/42B2)

  RC2反窃密实验室

![]()

[公司简介](https://www.4hou.com/about?title=公司简介)
|
[我要投稿](https://www.4hou.com/about?title=我要投稿)
|
[更新日志](https://www.4hou.com/about?title=更新日志)
|
[友情链接](https://www.4hou.com/about?title=友情链接)
|
[隐私政策](https://www.4hou.com/about?title=隐私政策)
|

[![](https://www.4hou.com/sihou/images/new4hou/weibo.png)](http://weibo.com/u/6069423878)
![](https://www.4hou.com/sihou/images/new4hou/wechat.png)

本站4hou.com，所使用的字体和图片文字等素材部分来源于原作者或互联网共享平台。如使用任何字体和图片文字有侵犯其版权所有方的，嘶吼将配合联系原作者核实，并做出删除处理。

[©2024 北京嘶吼文化传媒有限公司 京ICP备16063439号-1](https://beian.miit.gov.cn/)
本站由 ![](https://www.4hou.com/sihou/images/new4hou/txcloud.png) ![](https://www.4hou.com/sihou/images/new4hou/bdcloud.png) ![](https://www.4hou.com/sihou/images/new4hou/ucloud.png) 提供云计算服务

微信

[微博](http://weibo.com/u/6069423878)
[RSS](https://www.4hou.com/feed)
[知乎](https://zhuanlan.zhihu.com/roartalk)