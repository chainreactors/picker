---
title: Exploiting CVE-2023-23397: Microsoft Outlook Elevation of Privilege Vulnerability
url: https://www.mdsec.co.uk/2023/03/exploiting-cve-2023-23397-microsoft-outlook-elevation-of-privilege-vulnerability/
source: Penetration testing Archives - MDSec
date: 2023-03-15
fetch_date: 2025-10-04T09:38:57.392748
---

# Exploiting CVE-2023-23397: Microsoft Outlook Elevation of Privilege Vulnerability

* Our Services
* Knowledge Centre
* [About](https://www.mdsec.co.uk/about/)
* [Contact](https://www.mdsec.co.uk/contact/)

* Our Services
  + [Adversary Simulation](https://www.mdsec.co.uk/our-services/adversary-simulation/)
  + [Application Security](https://www.mdsec.co.uk/our-services/application-security/)
  + [Penetration Testing](https://www.mdsec.co.uk/our-services/penetration-testing/)
  + [Response](https://www.mdsec.co.uk/our-services/response/)
* Knowledge Centre
  + [Insights](https://www.mdsec.co.uk/knowledge-centre/insights/)
  + [Research](https://www.mdsec.co.uk/knowledge-centre/research/)
  + [Training](https://www.mdsec.co.uk/knowledge-centre/training/)
* [About](https://www.mdsec.co.uk/about/)
* [Contact](https://www.mdsec.co.uk/contact/)

* [![Adversary](https://www.mdsec.co.uk/wp-content/themes/mdsec/img/icons/icon-adversary.svg)

  ## Adversary Simulation

  Our best in class red team can deliver a holistic cyber attack simulation to provide a true evaluation of your organisation’s cyber resilience.](https://www.mdsec.co.uk/our-services/adversary-simulation/)
* [![Application Security](https://www.mdsec.co.uk/wp-content/themes/mdsec/img/icons/icon-application-security.svg)

  ## Application Security

  Leverage the team behind the industry-leading Web Application and Mobile Hacker’s Handbook series.](https://www.mdsec.co.uk/our-services/applicaton-security/)
* [![Penetration Testing](https://www.mdsec.co.uk/wp-content/themes/mdsec/img/icons/icon-penetration-testing.svg)

  ## Penetration Testing

  MDSec’s penetration testing team is trusted by companies from the world’s leading technology firms to global financial institutions.](https://www.mdsec.co.uk/our-services/penetration-testing/)
* [![Response](https://www.mdsec.co.uk/wp-content/themes/mdsec/img/icons/icon-response.svg)

  ## Response

  Our certified team work with customers at all stages of the Incident Response lifecycle through our range of proactive and reactive services.](https://www.mdsec.co.uk/our-services/response/)

* [## Research

  MDSec’s dedicated research team periodically releases white papers, blog posts, and tooling.](https://www.mdsec.co.uk/knowledge-centre/research/)
* [## Training

  MDSec’s training courses are informed by our security consultancy and research functions, ensuring you benefit from the latest and most applicable trends in the field.](https://www.mdsec.co.uk/knowledge-centre/training/)
* [## Insights

  View insights from MDSec’s consultancy and research teams.](https://www.mdsec.co.uk/knowledge-centre/insights/)

ActiveBreach

# Exploiting CVE-2023-23397: Microsoft Outlook Elevation of Privilege Vulnerability

[Home](https://www.mdsec.co.uk/) >
[Knowledge Centre](https://www.mdsec.co.uk/knowledge-centre/) >
[Insights](https://www.mdsec.co.uk/knowledge-centre/insights) >
Exploiting CVE-2023-23397: Microsoft Outlook Elevation of Privilege Vulnerability

**Date: 14th March 2023**

Today saw Microsoft patch an interesting vulnerability in Microsoft Outlook. The vulnerability is described as follows:

> Microsoft Office Outlook contains a privilege escalation vulnerability that allows for a NTLM Relay attack against another service to authenticate as the user.

However, no specific details were provided on how to exploit the vulnerability.

At MDSec, we’re continually looking to weaponise both private and public vulnerabilities to assist us during our red team operations. Having recently given a talk on leveraging NTLM relaying during red team engagements at [FiestaCon](https://fiestacon.org/agenda/), this vulnerability particularly stood out to me and warranted further analysis.

While no particular details were provided, Microsoft did provide a [script](https://github.com/microsoft/CSS-Exchange/blob/a4c096e8b6e6eddeba2f42910f165681ed64adf7/docs/Security/CVE-2023-23397.md) to audit your Exchange server for mail items that might be being used to exploit the issue.

Review of the audit script reveals it is specifically looking for the *PidLidReminderFileParameter* property inside the mail items and offers the option to “clean” it if found:

![](https://www.mdsec.co.uk/wp-content/uploads/2023/03/image-960x190.png)

Diving in to what this property is, we find the following [definition](https://learn.microsoft.com/en-us/office/client-developer/outlook/mapi/pidlidreminderfileparameter-canonical-property):

![](https://www.mdsec.co.uk/wp-content/uploads/2023/03/image-5-960x490.png)

This property controls what filename should be played by the Outlook client when the reminder for the mail item is triggered. This is of course particularly interesting as it implies that the property accepts a filename, which of could potentially be a UNC path in order to trigger the NTLM authentication.

Following further analysis of the available properties, we also note the [PidLidReminderOverride](https://learn.microsoft.com/en-us/office/client-developer/outlook/mapi/pidlidreminderoverride-canonical-property) property which is described as follows:

![](https://www.mdsec.co.uk/wp-content/uploads/2023/03/image-2-960x511.png)

With this in mind, we should likely set the *PidLidReminderOverride* property in order to trigger Outlook to parse our malicious UNC inside *PidLidReminderFileParameter*.

Let’s begin to build an exploit….

The first step to exploit this issue is to create an Outlook MSG file; these files are compound files in CFB format. To speed up the generation of these files, I leveraged the .NET [MsgKit](https://github.com/Sicos1977/MsgKit) library.

Reviewing the MsgKit library, we find that the *Appointment* class defines a number of properties to add to the mail item before the MSG file is saved:

![](https://www.mdsec.co.uk/wp-content/uploads/2023/03/image-3-960x353.png)

To create our malicious calendar appointment, I extended the Appointment class to add our required *PidLidReminderOverride* and *PidLidReminderFileParameter* properties, as shown above.

From that point, we simply need to create a new appointment and save it, before sending to our victim:

![](https://www.mdsec.co.uk/wp-content/uploads/2023/03/image-4-960x435.png)

This vulnerability is particularly interesting as it will trigger NTLM authentication to an IP address (i.e. a system outside of the Trusted Intranet Zone or Trusted Sites) and this occurs immediately on opening the e-mail, irrespective of whether the user has selected the option to load remote images or not.

*This one is worth patching as a priority as its incredibly easy to exploit and will no doubt be adopted by adversaries fast*.

Here’s a demonstration of our exploit which will relay the incoming request to LDAP to obtain a shadow credential:

This blog post was written by [Dominic Chell](https://twitter.com/domchell).

![](https://secure.gravatar.com/avatar/9cb7b62409a4b5ef00769dca4ba852fc49229c9729d600fc2637daf77068c31c?s=96&d=wp_user_avatar&r=g)

written by

#### MDSec Research

## Ready to engage with MDSec?

[Get in touch](https://www.mdsec.co.uk/contact)

Stay updated with the latest
news from MDSec.

Newsletter Signup Form

Email

If you are human, leave this field blank.

Submit

[![MDsec](https://www.mdsec.co.uk/wp-content/themes/mdsec/img/mdsec-logo.svg)](https://www.mdsec.co.uk "MDSec")

### Services

* [Adversary Simulation](https://www.mdsec.co.uk/our-services/adversary-simulation/)
* [Application Security](https://www.mdsec.co.uk/our-services/applicaton-security/)
* [Penetration Testing](https://www.mdsec.co.uk/our-services/penetration-testing/)
* [Response](https://www.mdsec.co.uk/our-services/response/)

### Resource Centre

* [Research](https://www.mdsec.co.uk/knowledge-centre/research/)
* [Training](https://www.mdsec.co.uk/knowledge-centre/training/)
* [Insights](https://www.mdsec.co.uk/knowledge-centre/insights/)

### Company

* [About](https://www.mdsec.co.uk/about/)
* [Contact](https://www.mdsec.co.uk/contact/)
* [Careers](https://www.mdsec.co.uk/careers/)
* [Privacy](https://www.mdsec.co.uk...