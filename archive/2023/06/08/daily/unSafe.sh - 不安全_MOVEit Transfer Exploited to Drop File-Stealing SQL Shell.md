---
title: MOVEit Transfer Exploited to Drop File-Stealing SQL Shell
url: https://buaq.net/go-167727.html
source: unSafe.sh - 不安全
date: 2023-06-08
fetch_date: 2025-10-04T11:46:21.231310
---

# MOVEit Transfer Exploited to Drop File-Stealing SQL Shell

* [unSafe.sh - 不安全](https://unsafe.sh)
* [我的收藏](/user/collects)
* [今日热榜](/?hot=true)
* [公众号文章](/?gzh=true)
* [导航](/nav/index)
* [Github CVE](/cve)
* [Github Tools](/tools)
* [编码/解码](/encode)
* [文件传输](/share/index)
* [Twitter Bot](https://twitter.com/buaqbot)
* [Telegram Bot](https://t.me/aqinfo)
* [Search](/search/search)

[Rss](/rss.xml)

[ ]
黑夜模式

![](https://8aqnet.cdn.bcebos.com/7ae1bd1a508e9d950550f98e9d0b0e19.jpg)

MOVEit Transfer Exploited to Drop File-Stealing SQL Shell

By Alex Delamotte and James HaughomSentinelOne has observed in-the-wild (ITW) exploitation of CVE-
*2023-6-7 21:55:2
Author: [www.sentinelone.com(查看原文)](/jump-167727.htm)
阅读量:34
收藏*

---

**By Alex Delamotte and James Haughom**

SentinelOne has observed in-the-wild (ITW) exploitation of CVE-2023-34362, a vulnerability in the MOVEit file transfer server application. The attack delivers a Microsoft IIS `.aspx` payload that enables limited interaction between the affected web server and connected Azure blob storage. On June 5, the Cl0p ransomware group claimed responsibility for these attacks, though SentinelOne notes the targeting of a file transfer application vulnerability resembles other exploitation conducted by financially motivated actors throughout early 2023.

In this post, we provide technical details of the attack chain along with hunting queries and a PowerShell script that can be used to scan for potential exploitation of the MOVEit Transfer vulnerability.

![](https://www.sentinelone.com/wp-content/uploads/2023/06/MOVEit-Transfer-Exploited-to-Drop-File-Stealing-SQL-Shell-3.jpg)

## Overview

Through the last week of May and early June 2023, SentinelOne observed active exploitation of Windows servers running a vulnerable version of Progress Software’s [MOVEit](https://www.progress.com/moveit) Transfer file server application. The attack delivers a minimal webshell that the attacker can use to exfiltrate the contents of files, including files hosted in Microsoft Azure when the targeted MOVEit instance is configured to use Azure’s blob storage service. As of June 5, the [Cl0p](https://www.bleepingcomputer.com/news/security/clop-ransomware-claims-responsibility-for-moveit-extortion-attacks/) ransomware group claimed responsibility for these campaigns.

While exploitation is likely opportunistic, SentinelOne observed attacks against more than 20 organizations in the following sectors, with Managed Security Service Providers (MSSP) and Managed Information Technology Service Providers (MSP) impacted most frequently:

* Aviation, Transportation & Logistics
* Entertainment
* Financial Services & Insurance
* Healthcare, Pharmaceuticals & Biotechnology
* Managed Information Technology Service Providers (MSP)
* Managed Security Service Providers (MSSP)
* Manufacturing & Building Materials
* Mechanical Engineering
* Print & Digital Media
* Technology
* Utilities & Public Services

The vulnerability impacts the following versions of MOVEit Transfer:

* MOVEit Transfer 2023.0.0: fixed in 2023.0.1
* MOVEit Transfer 2022.1.x: fixed in 2022.1.5
* MOVEit Transfer 2022.0.x: fixed in 2022.0.4
* MOVEit Transfer 2021.1.x: fixed in 2021.1.4
* MOVEit Transfer 2021.0.x: fixed in 2021.0.6

## Technical Details

These attacks are conducted against Windows servers running a vulnerable version of the MOVEit file transfer application, which attackers can identify through port scanning or internet indexing services like [Shodan](https://www.shodan.io/search?query=moveit).

Progress Software recently published an [advisory](https://community.progress.com/s/article/MOVEit-Transfer-Critical-Vulnerability-31May2023) detailing a vulnerability in MOVEit Transfer that could enable privilege escalation and unauthorized access to the targeted environment. The advisory details the issue as a SQL injection vulnerability-reported as CVE-2023-34362–which can allow an unauthorized attacker to inject SQL commands and obtain information from the targeted database.

The attack chain leverages this vulnerability to conduct an arbitrary file upload via the `moveitsvc` service account to the server’s `\MOVEitTransfer\wwwroot\` directory. The system’s svchost.exe process launches `w3wp.exe`, a Microsoft Internet Information Service (IIS) worker process, which then writes several files to a new working directory in `Temp`. The working directory and subsequent files share the same 8-character, pseudo-random naming syntax, with one example writing the following files:

```
C:\Windows\Temp\royq2cir
C:\Windows\Temp\royq2cir\royq2cir.tmp
C:\Windows\Temp\royq2cir\royq2cir.0.cs
C:\Windows\Temp\royq2cir\royq2cir.dll
C:\Windows\Temp\royq2cir\royq2cir.cmdline
C:\Windows\Temp\royq2cir\royq2cir.out
C:\Windows\Temp\royq2cir\royq2cir.err
```

The `w3wp.exe` process launches `csc.exe` to compile the C# code into the payload, which is saved as `human2.aspx`. The payload is a minimal webshell that queries information about the database configuration, enabling the actor to:

* Connect to specified SQL databases
* Exfiltrate the contents of files hosted by MOVEit Transfer
* When MOVEit Transfer is connected to Azure blob storage, exfiltrate contents of specific files in Azure’s blob storage service

To exfiltrate files, the attacker can specify the targeted object’s File ID and Folder ID in HTTP headers of a request made to the webshell. The shell then returns the specified file’s content as a Gzip object in the server’s HTTP response. The shell also deletes the existing user named “Health Check Service” and creates a new user with the same username, likely as a means of persistence.

At the time of writing, SentinelOne has not observed subsequent activity following placement of the webshell.

## Mitigation & Prevention

Organizations using MOVEit Transfer should upgrade affected systems immediately. In situations where upgrades cannot be performed, the system should be taken offline until it can be upgraded. Ensure your security team can access and analyze application logs from servers that run MOVEit Transfer, including Microsoft IIS logs.

Because exploitation occurs through interaction with MOVEit Transfer at the application level, detection opportunities for Endpoint Detection & Response (EDR) tooling are limited to later-stage activity. SentinelOne notes that each payload is dynamically compiled at runtime, resulting in a unique hash for each victim. While we are providing a list of hashes associated with payloads delivered through these campaigns, organizations should not rely on hashes alone to detect these attacks.

We recommend that organizations using MOVEit Transfer conduct threat hunts and log analysis using the resources provided below.

## Hunting Queries

SentinelOne is providing the following queries that organizations can use to hunt for activity associated with these attacks. While these queries are not necessarily inclusive of all attack scenarios, the results should be investigated and triaged. Additionally, defenders should look for unusual activity initiated by the MOVEit Transfer service account: the default value is `moveitsvc`, though some instances may have a custom account name.

|  |  |
| --- | --- |
| **Query** | **Description** |
| S1QL: SrcProcName = “w3wp.exe” AND TgtProcName = “csc.exe” AND SrcProcCmdLine Contains Anycase “moveitdmz pool” | Identify instances of the compilation of DLLs related to MOVEit’s app pool |
| S1QL: IndicatorName = “LoadUnreleatedLibrary” AND IndicatorMetadata Contains “w3wp.exe” AND SrcProcName StartsWith “DMZ” | Identify potential anomalous library loads by IIS worker process |
| S1QL: EventType In (“File Creation”, “File Modification”) AND SrcProcName Contains Anycase “w3wp.exe” And TgtFilePath RegExp “\\moveit[^\\]+” And TgtFilePath Contains Anycase “wwwroot” And TgtFileExtension = “aspx” | Identify IIS worker process writing a new or modifying an existing ASPX file in the MoveIT web folder |
| S1PQ: src.process.parent.name = “w3wp.exe” AND src.process.parent.cmdline conta...