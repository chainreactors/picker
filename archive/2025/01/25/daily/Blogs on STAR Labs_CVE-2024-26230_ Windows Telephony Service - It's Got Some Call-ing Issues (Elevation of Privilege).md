---
title: CVE-2024-26230: Windows Telephony Service - It's Got Some Call-ing Issues (Elevation of Privilege)
url: https://starlabs.sg/blog/2025/cve-2024-26230-windows-telephony-service-its-got-some-call-ing-issues/
source: Blogs on STAR Labs
date: 2025-01-25
fetch_date: 2025-10-06T20:08:28.604687
---

# CVE-2024-26230: Windows Telephony Service - It's Got Some Call-ing Issues (Elevation of Privilege)

[![logo](https://starlabs.sg/logo-white.png)](https://starlabs.sg/ "  (Alt + H)")

* [Home](https://starlabs.sg/ "Home")
* [About](https://starlabs.sg/about/ "About")
* [Advisories](https://starlabs.sg/advisories/ "Advisories")
* [Blog](https://starlabs.sg/blog/ "Blog")
* [Achievements](https://starlabs.sg/achievements/ "Achievements")
* [Publications](https://starlabs.sg/publications/ "Publications")
* [Search](https://starlabs.sg/search/ "Search (Alt + /)")

[Home](https://starlabs.sg/) » [Blogs](https://starlabs.sg/blog/)

# CVE-2024-26230: Windows Telephony Service - It's Got Some Call-ing Issues (Elevation of Privilege)

January 24, 2025 · 11 min · Đào Tuấn Linh

Table of Contents

* [Executive Summary](#executive-summary)
* [Vulnerability Overview](#vulnerability-overview)
  + [Affected Products](#affected-products)
  + [CVSS3.1 Score](#cvss31-score)
  + [Affected Software](#affected-software)
* [Description of Vulnerability](#description-of-vulnerability)
* [Windows Telephony Service](#windows-telephony-service)
  + [Interface Definition Language (IDL)](#interface-definition-language-idl)
  + [ClientRequest](#clientrequest)
* [Steps to Exploitation](#steps-to-exploitation)
* [CVE-2024-43626 - An Out-of-Bound Write bug in GetPriorityList leads to Information Leak in SetPriorityList](#cve-2024-43626---an-out-of-bound-write-bug-in-getprioritylist-leads-to-information-leak-in-setprioritylist)
* [Exploit Reproduction (Optional)](#exploit-reproduction-optional)
* [Detection Guidance](#detection-guidance)
* [Suggested Mitigations](#suggested-mitigations)
* [Proof-of-Concept](#proof-of-concept)
* [Demo](#demo)
* [References](#references)

## Executive Summary[#](#executive-summary)

`CVE-2024-26230` is a critical vulnerability found in the Windows Telephony Service (TapiSrv), which can lead to an elevation of privilege on affected systems. The exploit leverages a use-after-free in `FreeDialogInstance`. By manipulating the registry, an attacker controls memory allocation to create a fake object, triggering the UAF in `TUISPIDLLCallback` to gain code execution. This is further chained with techniques to bypass mitigations like CFG and ultimately load a malicious DLL, escalating privileges to SYSTEM via [PrintSpoofer](https://github.com/itm4n/PrintSpoofer). In this blog post, we will take an in-depth look at how this vulnerability works, how it can be exploited, and the mitigation strategies that can help defend against it.

## Vulnerability Overview[#](#vulnerability-overview)

### Affected Products[#](#affected-products)

| **Product** | Windows Telephony Service (TapiSrv) |
| --- | --- |
| **Vendor** | Microsoft |
| **Security Impact** | Elevation of Privilege |
| **CVE ID** | CVE-2024-26230 |
| **CWE(s)** | CWE-416 - Use After Free |

### CVSS3.1 Score[#](#cvss31-score)

* **Base Score:** 7.8
* **Vector String:** `CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H`

### Affected Software[#](#affected-software)

* Version: `Microsoft Windows 10 Version 22H2 Build 19045.3803 AMD64`

## Description of Vulnerability[#](#description-of-vulnerability)

The vulnerability exists within the `FreeDialogInstance` function in `C:\Windows\System32\tapisrv.dll`. Specifically, it occurs when the function deallocates the `GOLD` object while the original context handle retains a pointer to it, leading to a use-after-free condition.

Here are the primary reasons for the occurrence of this bug and how it can be exploited:

1. The `FreeDialogInstance` function deallocates the `GOLD` object (identified by the magic number `0x474F4C44`) without ensuring that the context handle object no longer references it. This issue is evident at both **Line 1** and **Line 2**.

![FreeDialogInstance frees GOLD object](/blog/2025/images/CVE-2024-26230-0001.png)

2. The `TUISPIDLLCallBack` function attempts to use the freed `GOLD` object, which is now a dangling pointer. It accesses a virtual function at `v12 + 0x20` and subsequently invokes it, triggering the use-after-free vulnerability.

![UAF in TUISPIDLLCallBack](/blog/2025/images/CVE-2024-26230-0002.png)

In typical use-after-free exploitation scenarios, we seek a suitable object to serve as an exploit primitive. In kernel mode, a variety of objects can be leveraged for this purpose. However, in user mode—where `TAPISrv` operates as an RPC service—the vulnerability can only be exploited with objects within the same process. As such, without an appropriate object already present in the target process, direct exploitation of the vulnerability is not possible.

In this case, we need to think outside the box. Instead of searching for a suitable object to serve as an exploit primitive, the goal is to find a primitive that allows us to create a memory allocation where both the size and content can be fully controlled. With this approach, we can craft a fake object that can be used to exploit the vulnerability.

One such primitive is a dispatch function named `TRequestMakeCall`, which opens the registry key `Software\\Microsoft\\Windows\\CurrentVersion\\Telephony\\HandoffPriorities` and allocates memory to store the key values.

![TRequestMakeCall](/blog/2025/images/CVE-2024-26230-0003.png)

By inspecting the registry with `Registry Editor`, we can confirm that this registry key is configured with `Full Control` permissions for the user.

Since this key is fully user-controlled, it allows us to manipulate the value of the `RequestMakeCall` key. This gives us control over both the allocated heap size and the content of the memory.

![RequestMakeCall registry key privilege](/blog/2025/images/CVE-2024-26230-0004.png)

## Windows Telephony Service[#](#windows-telephony-service)

The Windows Telephony Service is a component of Windows RPC (Remote Procedure Call), allowing us to interact with it as we would with any standard RPC service.

To utilize RPC, some knowledge with [Interface Definition Language (IDL)](https://learn.microsoft.com/en-us/windows/win32/midl/midl-start-page) is required.

### Interface Definition Language (IDL)[#](#interface-definition-language-idl)

IDL stands for Interface Definition Language, which is used to define the interfaces of an RPC server. It is an attributed programming language and is similar to a C header file. Understanding IDL is important because it helps you know the interfaces that `Telephony` provides and understand how we can communicate with `Telephony` services. But don’t worry—it’s quite simple. Let’s take a deep dive together!

The telephony service provides three interfaces, which can be defined as follows:

```
interface tapsrv {
    typedef [context_handle] void* PCONTEXT_HANDLE_TYPE;

    long ClientAttach(
        [out][context_handle] PCONTEXT_HANDLE_TYPE* pphContext,
        [in] long lProcessID,
        [out]long* phAsyncEventsEvent,
        [in, string] const wchar_t* pszDomainUser,
        [in, string] wchar_t* pszMachine
    );

    void ClientRequest(
        [in] PCONTEXT_HANDLE_TYPE phContext,
        [in, out, length_is(*plUsedSize), size_is(lNeededSize)] unsigned char* pBuffer,
        [in] long lNeededSize,
        [in, out] long* plUsedSize
    );

    void ClientDetach(
        [in, out] PCONTEXT_HANDLE_TYPE* pphContext
    );

};
```

### ClientRequest[#](#clientrequest)

The most important interface here, is the `ClientRequest`. It allows you to communicate, or in other terms, use various functions that Telephony offers in `gaFuncs` table.

![Client Request](/blog/2025/images/CVE-2024-26230-0005.png)

`gaFuncs` in IDA.

![gaFuncs table](/blog/2025/images/CVE-2024-26230-0006.png)

As you can see, the `ClientRequest` function takes a buffer, `pBuffer`, as its second argument. The `pBuffer` structure is defined as follows:

* The first element (at index 0) is always the offset to the functions in the `gaFuncs` table. For example:

  + To invoke `GetUIDllName`, the offset is 0x1.
  + To invoke `TUISPIDLLCallback`, the offset is 0x2, and so on.
* The second element in the buffer repres...