---
title: 典型挖矿家族系列分析三 |Sysrv-hello挖矿蠕虫
url: https://www.freebuf.com/articles/network/355182.html
source: FreeBuf网络安全行业门户
date: 2023-01-14
fetch_date: 2025-10-04T03:53:17.219691
---

# 典型挖矿家族系列分析三 |Sysrv-hello挖矿蠕虫

[![freeBuf](/images/logoMax.png)](/)

主站

分类

云安全

AI安全

开发安全

终端安全

数据安全

Web安全

基础安全

企业安全

关基安全

移动安全

系统安全

其他安全

特色

热点

工具

漏洞

人物志

活动

安全招聘

攻防演练

政策法规

[报告](https://www.freebuf.com/report)[专辑](/column)

* ···
* [公开课](https://live.freebuf.com)
* ···
* [商城](https://shop.freebuf.com)
* ···
* 用户服务
* ···

行业服务

政 府

CNCERT
CNNVD

会员体系（甲方）
会员体系（厂商）
产品名录
企业空间

[知识大陆](https://wiki.freebuf.com/page)

搜索

![](/freebuf/img/7aa3bf7.svg) ![](/freebuf/img/181d733.svg)

创作中心

[登录](https://www.freebuf.com/oauth)[注册](https://www.freebuf.com/oauth)

官方公众号企业安全新浪微博

![](/images/gzh_code.jpg)

FreeBuf.COM网络安全行业门户，每日发布专业的安全资讯、技术剖析。

![FreeBuf+小程序](/images/xcx-code.jpg)

FreeBuf+小程序把安全装进口袋

[![](https://image.3001.net/images/20231020/1697804527_653270ef7570cc7356ba8.png)](https://wiki.freebuf.com)

典型挖矿家族系列分析三 |Sysrv-hello挖矿蠕虫

* ![]()
* 关注

* [基础安全](https://www.freebuf.com/articles/network)

典型挖矿家族系列分析三 |Sysrv-hello挖矿蠕虫

2023-01-13 16:11:33

所属地 北京

# 1、引言

随着近几年区块链技术和加密货币等虚拟货币的兴起，挖矿木马的开源导致获取挖矿木马的门槛降低，除大量黑产组织持续运营挖矿木马之外，更有其他非运营挖矿木马的黑产组织将运营方向转为挖矿木马，导致挖矿木马的持续活跃。2021年9月3日，国家发展改革委等部门发布关于整治虚拟货币“挖矿”活动的通知[1]，明确要求整治虚拟货币挖矿活动，打击挖矿活动已然势在必行。在发文后的这一年里挖矿整治活动效果显著，政企校等组织单位所遭遇的挖矿木马数量持续降低。依据有关数据，2022年加密货币价格多次下跌、市场价值整体呈现下降趋势，但传播挖矿木马对于攻击者而言仍有利可图，因此，在2022年中还是有很多小型挖矿木马家族兴起。例如Hezb、“1337”和Kthmimu等挖矿木马家族等。

**安天CERT将近几年历史跟踪储备的典型流行挖矿木马家族组织梳理形成专题报告，在未来几个月依次发布，并持续追踪新的流行挖矿家族。专题报告将详细介绍挖矿木马家族历史演进、详细分析家族样本迭代版本、梳理历史攻击事件、提供感染后排查手段以及公布更多的IoCs。**

## 2、挖矿木马简介

### 2.1 什么是挖矿

“挖矿”是指通过执行工作量证明或其他类似的电脑算法来获取虚拟货币，“矿”代表的是虚拟货币，挖矿的工人通常称为“矿工”。而“挖矿木马”是一种集成化恶意代码，能够通过各种手段将挖矿程序植入受害者的计算机中，在用户不知情的情况下，利用受害者计算机的运算力进行挖矿，从而获取非法收益。**这类非法入侵用户计算机的挖矿程序被称作挖矿木马。**

挖矿方式有两种：一种是solo式（直接连入中心网络工作），产出收益均归自己所有；另一种是连入矿池，收益与矿池分成。由于连入矿池的技术难度较低并且收益相对稳定，所以挖矿木马通常会采用这种方式。挖矿类型也有两种：一种是被动型挖矿，在用户不知情的情况下被植入挖矿程序，获取的虚拟货币归植入挖矿程序的入侵者所有；另一种是主动型挖矿，人员主动利用计算资产运行挖矿程序，获取的虚拟货币归计算资产所有者或使用者所有。挖矿的本质是计算符合条件的hash值并返回，采用的方式为暴力破解式计算，主要特征表现为消耗主机资源，浪费用户电力资源。

### 2.2 为什么挖矿活动会日益猖獗？

将其与同样很流行的勒索活动进行对比可以发现，相对于勒索软件，挖矿活动收入更加稳定。在勒索事件中，一方面很难精确定位加密到有重要内容的主机，另一方面受害者交付赎金后又不能保证一定得到解锁服务，这就导致了勒索活动的规模和获得的赎金严重不成正比。

而在挖矿活动中，挖矿木马只要运行在计算机上就可以在矿池中获得shares（具体情况要根据矿池的分配模式）并转换成收益。挖矿的难度也比勒索活动要低，其大部分会使用开源的程序并注册一个钱包地址，挖矿过程中不需要投入其他精力便可坐享其成。

另外，虚拟货币的增值性和匿名性也是促使挖矿木马日益猖獗的原因之一。通过虚拟货币不仅可以逃避现实世界的金融追查手段而且还获得了具有增值潜力的货币，可谓一箭双雕，这也是挖矿木马更喜欢匿名货币（例：门罗币）的原因。

### 2.3 挖矿木马的危害

通常情况下，受害者会认为挖矿木马只是会让系统卡顿，并不会对自身造成太大的影响，但是挖矿木马除了会让系统卡顿之外，还会降低计算机设备性能和使用寿命，危害组织运营，浪费组织电力能源。不仅如此，现在的挖矿木马普遍会留置后门，导致受害者主机沦为攻击者的控制节点，以此组建僵尸网络，继而下发命令攻击其他计算机，因此，现阶段的挖矿木马已经不单单是执行挖矿这一简单操作，而是逐步开始利用入侵能力谋取更多非法利益。

## 3、Sysrv-hello挖矿蠕虫概述

Sysrv-hello是一个利用多种漏洞传播的Windows和Linux双平台挖矿蠕虫，主要目的在于传播挖矿蠕虫，继而实现挖矿获利。该挖矿蠕虫于2020年12月31日被首次披露，由于捕获的大量样本原始文件名以“sysrv”字符串为主，且样本内使用的函数或模块路径中均包含“hello”字符串，研究人员将其命名为Sysrv-hello[2]。Sysrv-hello挖矿蠕虫传播的文件主要有核心脚本、蠕虫母体及挖矿程序。其中核心脚本文件类型有Shell和PowerShell，主要承担下载并执行蠕虫，Linux脚本功能包括结束竞品、防御规避、持久化、横向传播等功能，PowerShell脚本更聚焦在防御规避和持久化上；蠕虫母体是由GO语言编写，利用各种漏洞进行核心脚本的传播，进而实现自身的间接传播；挖矿程序负责劫持目标主机计算资源以此实施挖矿，该程序主要通过蠕虫母体释放并执行，但存在一段时间由核心脚本负责下载和执行。

Sysrv-hello挖矿蠕虫的更新主要体现在核心脚本和蠕虫母体上，其中蠕虫母体的迭代以漏洞利用组件的数量最为明显，且存在尝试部分漏洞并淘汰的现象，截至目前其使用过的漏洞达20个以上，常用的在18个以上，而可明显观察的核心脚本的迭代就达13次以上。

Sysrv-hello挖矿蠕虫有别于其他挖矿木马，不注重在传播时维持对目标系统的访问，而是更注重通过新增漏洞利用组件提高传播能力，实现持续增长和维持高稳定的挖矿收益。

# 4、Sysrv-hello挖矿蠕虫介绍

Sysrv-hello挖矿蠕虫于2020年12月31日被首次披露，通过漏洞传播，无针对性目标，蠕虫样本更新频繁，是一个活跃在Windows和Linux的双平台挖矿蠕虫。根据其近两年的活动，可将其发展分为三个阶段：前期尝试传播、中期扩大传播和后期注重防御规避并维持传播力度。从三个阶段的样本分析看，其背后黑产组织并不重视维持对目标主机的访问权限，只在中期和后期的Redis漏洞利用中添加了在目标系统中植入SSH公钥的功能；其更加注重收益，尽可能扩展和维持传播能力，由于其后期矿池连接方式采用矿池代理，无法获取其全面的收益情况，但在2021年3月份期间平均每两天收益一个门罗币[3]，按当时市价，即平均每天收益100美元。

表 4‑1 Sysrv-hello挖矿蠕虫基本信息：

|  |  |  |
| --- | --- | --- |
| **家族名称** | Sysrv-hello | |
| **首次披露时间** | 2020年12月31日 | |
| **命名原因** | 捕获的大量样本原始文件名以“sysrv“字符串为主，且样本内使用的函数或模块路径中均包含“hello”字符串[2]。 | |
| **威胁类型** | 挖矿、蠕虫 | |
| **针对目标** | 无特殊针对目标、蠕虫传播目标随机化，针对包括云主机在内的目标 | |
| **传播方式** | 漏洞利用、暴力破解、受害主机上存储的SSH私钥 | |
| **传播组件** | Laravel Debug mode RCE (CVE-2021-3129) | XXL-JOB executor 未授权访问漏洞 |
| Jenkins RCE漏洞（CVE-2018-1000861) | Jupyter 未授权访问漏洞 |
| Nexus Repository Manager 3 RCE漏洞  （CVE-2019-7238) | ThinkPHP5 RCE漏洞 |
| WebLogic RCE漏洞（CVE-2020-14882) | Hadoop YARN REST API未授权漏洞 |
| Supervisord RCE漏洞（CVE-2017-11610) | Wordpress-XMLRPC暴力破解 |
| JBOOS反序列化漏洞（CVE-2017-12149) | SSH弱口令暴力破解 |
| PostgreSQL RCE漏洞（CVE-2019-9193) | Tomcat弱口令暴力破解 |
| Confluence未授权RCE漏洞（CVE-2019-3396) | Redis弱口令暴力破解 |
| Apache Struts2 RCE漏洞（CVE-2017-5638) | Nexus弱口令暴力破解 |
| PHPUnit RCE漏洞（CVE-2017-9841) | Jupyter弱口令暴力破解 |
| Spring Cloud Gateway Actuator RCE漏洞  （CVE-2022-22947 ） | Jenkins弱口令暴力破解 |
| GitLab CE/EE RCE漏洞（CVE-2021-22205） | MySQL弱口令暴力破解 |

Sysrv-hello挖矿蠕虫的传播阶段依据其近两年的更新、样本功能、挖矿模式，可将其传播过程分为三个阶段，前期传播为主，此时应是攻击者的蠕虫传播尝试阶段；中期扩大传播力度，漏洞数量也有很大提升，具体感染范围也可通过3月份的收益进行推测；后期注重规避并维持传播能力，进一步提升漏洞数量，同时注重从矿池地址、漏洞模块名称、样本落地名称等方面的防御规避。

## 5、Sysrv-hello挖矿蠕虫对应的ATT&CK映射图谱

Sysrv-hello挖矿蠕虫对应的技术特点分布图：![](https://image.3001.net/images/20230113/1673597138_63c110d26dc46536eaea3.png!small)

图 5‑1 技术特点对应ATT&CK的映射

具体ATT&CK技术行为描述表：

表 5‑1 事件对应的ATT&CK技术行为描述表

|  |  |  |
| --- | --- | --- |
| **ATT&CK****阶段****/****类别** | **具体行为** | **注释** |
| **侦察** | 主动扫描 | 扫描端口 |
| **资源开发** | 获取基础设施 | 组建托管母体蠕虫的服务器 |
| **初始访问** | 利用面向公众的应用程序 | 目标主机Web应用漏洞利用 |
| **执行** | 利用命令和脚本解释器 | PowerShell和shell脚本执行 |
| **持久化** | 修改身份验证过程 | 植入SSH公钥 |
| 事件触发执行 | 通过创建WMI对象执行载荷 |
| 利用计划任务/工作 | 创建计划任务执行载荷 |
| **防御规避** | 混淆文件或信息 | 母体样本加UPX壳 |
| 削弱防御机制 | 卸载云主机安全组件和服务 |
| 删除主机中的信标 | 清除主机中的相关日志 |
| 修改文件和目录权限 | 使用chattr命令修改文件权限 |
| **凭证访问** | 暴力破解 | SSH、Redis暴力破解 |
| **发现** | 发件文件和目录 | 查看其他挖矿木马相关文件 |
| 发现进程 | 查看系统中其他挖矿木马相关进程 |
| 发现系统信息 | 查看系统处理器架构 |
| **横向移动** | 使用备份身份验证材料 | 利用目标主机的SSH私钥横向传播 |
| **影响** | 资源劫持 | 劫持受害主机CPU资源挖矿 |

## 6、防护建议

针对非法挖矿，安天建议企业采取如下防护措施：

1. 安装终端防护：安装反病毒软件；
2. 加强SSH口令强度：避免使用弱口令，建议使用16位或更长的密码，包括大小写字母、数字和符号在内的组合，同时避免多个服务器使用相同口令；
3. 及时更新补丁：建议开启自动更新功能安装系统补丁，服务器应及时更新系统补丁；
4. 及时更新第三方应用程序补丁：建议及时更新第三方应用程序，特别是与业务相关的，如Redis、WebLogic、JBOOS等应用程序补丁；
5. 开启日志：开启关键日志收集功能（安全日志、系统日志、错误日志、访问日志、传输日志和Cookie日志），为安全事件的追踪溯源提供基础；
6. 主机加固：对系统进行渗透测试及安全加固；
7. 部署入侵检测系统（IDS）：部署流量监控类软件或设备，便于对恶意代码的发现与追踪溯源。

## 7、样本分析

以下样本分析的对象是截至本报告发布时的最新样本，其中母体样本由于双平台，样本功能一致性原因，仅分析了Linux平台样本。与上一版本的区别在于改变C2地址和矿池代理地址。

### 7.1 ldr.ps1核心脚本分析

**7.1.1 样本标签**

表 7‑1 ldr.ps1样本标签：

|  |  |
| --- | --- |
| **病毒名称** | Trojan[Downloader]/PowerShell.sysrv-hello |
| **原始文件名** | ldr.ps1 |
| **MD5** | 71D473E09C8A0F3B61028409207B445B |
| **文件大小** | 870 B（870 字节） |
| **文件格式** | Script/Microsoft.PowerShell |
| **编写语言** | PowerShell |
| **VT****首次上传时间** | 2022-12-10 11:27:14 |
| **VT****检测结果** | 20 / 61 |

**7.1.2脚本初始化**

脚本在开头定义C2地址、挖矿蠕虫落地后的随机字符串文件名及存储路径。![](https://image.3001.net/images/20230113/1673597008_63c110500b8dd7be8f74a.png!small)

图 7‑1 脚本初始化

**7.1.3 防御规避**

通过netsh命令关闭所有防火墙配置文件启用状态，确保后期C2和矿池的正常连接。![](https://image.3001.net/images/20230113/1673596988_63c1103c883d0be717bbc.png!small)

图 7‑2 防御规避

**7.1.4结束自身和其他可疑进程**

以挖矿蠕虫历史进程名和挖矿程序历史进程名结束自身在目标主机的相关进程，同时以端口号为依据结束目标主机上可疑矿池连接的进程。![](https://image.3001.net/images/20230113/1673596965_63c11025b47f17a07f3dd.png!small)

图 7‑3 结束进程

**7.1.5 投放挖矿蠕虫并建立持久化驻留**

在无“kthreaddk”进程的情况下，下载并执行挖矿蠕虫，同时以该蠕虫为载体创建名为“BrowserUpdate”的计划任务和注册表自启动。![](https://image.3001.net/images/20230113/1673596949_63c110158c45ec920c387.png!small)

图 7‑4 投放蠕虫并建立持久化

### 7.2 ldr.sh核心脚本分析

**7.2.1样本标签**

表 7‑2 ldr.sh样本标签：

|  |  |
| --- | --- |
| **病毒名称** | Trojan[Downloader]/Shell.sysrv-hello |
| **原始文件名** | ldr.sh |
| **MD5** | AE6CAA7B2A81738F3287E202F0E132E1 |
| **文件大小** | 5.20 KB (5,334 字节) |
| **文件格式** | Script/Linux.SH |
| **编写语言** | Shell |
| **VT****首次上传时间** | 2022-12-12 06:30:32 |
| **VT****检测结果** | 25 / 61 |

**7.2.2 脚本初始化**

默认设置各类shell解释器执行本脚、定义C2地址、蠕虫母体样本文件名随机化方式。![](https://image.3001.net/images/20230113/1673596900_63c10fe4b03f8137e17bc.png!small)

图 7‑5 脚本初始化

**7.2.3 封装下载函数**

封装下载函数，设置各种下载方式，确保蠕虫母体能够正常下载，并完成执行权限的赋权。![](https://image.3001.net/images/20230113/1673596883_63c10fd307b92768151c3.png!small)

图 7‑6 下载功能封装

**7.2.4 防御规避**

关闭受害系统防火墙并开放所有网络访问。![](https://image.3001.net/images/20230113/1673596864_63c10fc0664660dc40348.png!small)

图 7‑7 开放网络连接和访问

卸载云主机安全组件和服务。![](https://image.3001.net/images/20230113/1673596837_63c10fa50a437c3cfc468.png!small)

图 7‑8 卸载云主机安全组件和服务

擦除相关日...