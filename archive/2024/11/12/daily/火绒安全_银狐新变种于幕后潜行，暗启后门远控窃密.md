---
title: 银狐新变种于幕后潜行，暗启后门远控窃密
url: https://mp.weixin.qq.com/s?__biz=MzI3NjYzMDM1Mg==&mid=2247520495&idx=1&sn=f1aa972d50bf36b7d8066555d57e6e94&chksm=eb704ed0dc07c7c697db152a1f7d456bd4afd2c3d8fe92b64c519a69f91cf65c458a68f7fe0c&scene=58&subscene=0#rd
source: 火绒安全
date: 2024-11-12
fetch_date: 2025-10-06T19:19:54.989988
---

# 银狐新变种于幕后潜行，暗启后门远控窃密

![cover_image](https://mmbiz.qpic.cn/sz_mmbiz_jpg/0icdicRft8tz6TbQwItwrRErWA17YjGNleVVs6LK4Tv3SQRyr9ClibzmuyS5cYvmvh9Hkia0Ia0NaUv8rtX22OgvibQ/0?wx_fmt=jpeg)

# 银狐新变种于幕后潜行，暗启后门远控窃密

原创

火绒安全

火绒安全

![](https://mmbiz.qpic.cn/sz_mmbiz_gif/0icdicRft8tz4nrnOI1emtFr0UYnrLKytAvy2gia6ZuIUJs14h2pEIwpiaWPCTTuCQIDibx9dlfXoyrNyVEWb8DVUUA/640?wx_fmt=gif&from=appmsg)

近期，火绒威胁情报中心监测到一批相对更加活跃的“银狐”系列变种木马，火绒安全工程师第一时间提取样本进行分析。分析发现样本具有检测并利用多种系统特性实现持久化与绕过沙箱的行为，通过释放白加黑文件，利用 svchost 内存加载后门模块实现远程控制。目前，火绒安全产品能够有效拦截和查杀上述病毒，火绒6.0的内存防护功能具备精准处理此类内存加载病毒的能力，能够及时识别和阻止恶意代码在内存中的执行，从而保护用户系统的安全，欢迎广大用户下载安装火绒安全6.0产品并及时更新病毒库以提高防御能力。（文末有彩蛋掉落）

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNle094meTNXvAdxF0glQ0600ibbibVLoO9llzCANN8EZwZydP5p03Nib8RcQ/640?wx_fmt=png&from=appmsg)

查杀图

样本执行流程如下所示：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNle5aq7jpocrY585ZhuQDCspHfpJ3RuGQC3Qk19Ll2bIlBu69mdkcU27A/640?wx_fmt=png&from=appmsg)

流程图

**一**

**样本分析**

**样本信息**

该样本是一个携带恶意 Gh0st 后门病毒的 QT 程序，将加密的恶意代码以资源的形式嵌入 PE 文件。当程序执行时，这些恶意代码会被释放并利用 RPC 和 COM 等系统特性实现后门的持久化，从而在用户不知情的情况下监控电脑活动，持续收集信息并执行恶意操作。

样本的执行分为三个阶段。第一阶段，初始样本通过自解压存储在资源中的 shellcode ，执行恶意代码，随后释放 ggaa.exe 、zf\_cef.dll 、cef.dat 三个白加黑文件；第二阶段，样本通过 RPC 调用来启动 ggaa.exe，利用 COM 接口系统回调执行 shellcode ，之后通过创建挂起进程和多次注入 svchost ，实现计划任务持久化和后门功能；第三阶段，样本基于 IOCP 框架实现 Gh0st 远程控制功能，包括读取计算机信息、进程注入、文件管理、屏幕查看、远程 shell-CMD 、下载执行、键盘监听、关闭计算机、内网socket代理和回复心跳包功能。

**Loader 动静态分析**

通过分析初始样本 demo.exe ，定位到恶意代码加载函数 shellcode\_Exec() 。该样本采用时间判断进行退出，并通过 CMD 命令行实现延迟自我删除后，执行恶意代码的解压与运行。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNle3eSRZhvByYRUlgEibxpiba9iaqTUIYInTIRE3FlVNicITOQL3E8V6KDOmw/640?wx_fmt=png&from=appmsg)

main logic

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleYuo8boq3neQooM3NpxRygv4VraIUX9X1dCcogfdGOu04G2D4VNkicvA/640?wx_fmt=png&from=appmsg)

时间判断

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNlefd85wXreTDXqpSCXN3dnp3SjovTW0OziaKa36zzceKBVXqLg75TcDfw/640?wx_fmt=png&from=appmsg)

自删除

在执行延迟自删除命令后，初始样本采用 lz4 快速解压算法解压恶意代码，分配可执行内存以实现恶意代码调用。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleF0HNcaeW7UAWxXmPRdQcfNJHgutVPicF8oyagos5jfDGyDwsd00AmLA/640?wx_fmt=png&from=appmsg)

执行恶意代码

分析发现，恶意代码采用修复IAT，重定位表的方式执行内存加载PE 。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNlebaXESVPiasrwnrMlMsNwmur9CfEbsoUPg1k627Uy4BPtJGKdlu2aczQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNlewZ7y6HWDNHiaktEaJSBAAUD4MSGnORGibK0vrTOYeibGnW7ER6woEPic2g/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleS5vicxY89ARK1WBkSCKzlGzRGRtxicbWpR87ibFfDo3WYuJfxcdztoQ4A/640?wx_fmt=png&from=appmsg)

内存加载PE

对静态分析内存中的恶意 PE 文件进行分析后发现，其核心逻辑 main\_logic 函数通过 COM 组件改写防火墙规则，实现断网并阻止样本上传。此外，样本会检测系统进程中是否存在杀毒软件，虽检测后未执行实际行为，但推测其之后可能会出现新的变种。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleu74lWn9DOUYabEKY13ia1KHMpuYeLZVACfBreLicOX2L7YZD1A0xNVfA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleqnMHfQafKHdjfHNsbjnly3T9f4WibsvXCRHicKiaqoyTICucsdibaibGz3A/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNle5UKxgoMw3j2KpwXXyiaorMkT22J9aUpKt2ZkpicN6GhIwNzh0cyviaJUA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNle0mwjWzOLGZYWxYkPiaNgrTgpicMhGF1obOd5TtnQUm52RKG3y0E4Bj2Q/640?wx_fmt=png&from=appmsg)

防火墙策略

随后，样本将“白加黑”后门文件释放到本地磁盘，并以相同方式删除先前修改的防火墙规则以恢复网络连接，同时调用 INetFwProfile 接口关闭防火墙。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleF2u7rHg2bKMV1mT2rPwG9zan0MrzD7DfOnwqGdmc4D7OCydviawOOqw/640?wx_fmt=png&from=appmsg)

释放白加黑文件

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleYIDcraRTfU40S0g8GbceuwNaic37ArQZS9BM2ic2hn4wGRJiabYTwQVibg/640?wx_fmt=png&from=appmsg)

创建 RPC 启动进程

之后，通过 RPC 调用 services.exe 并以 system 权限执行ggaa.exe ，实现进程链全白，从而绕过父进程检测。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNlehWml6tTicRy6pJibSnII2gXd3ugKw9fbJupjouQ2f2XaAAoNKhHAYv5A/640?wx_fmt=png&from=appmsg)

RPC 调用 GUID

接着，样本通过 ntsvcs 管道通信进行 RPC 调用，仅需使用 WriteFile 和 CreateFile 函数对管道读写，即可实现 Windows 服务的创建和加载。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleLHKv9ViaO3jhIaYmoib8VU4D9321m9oibcTamswHGqPfFy8XRCOtDA18Q/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNle1KQpa5bRYO9BXmE2cgf4jCXpOKGv3yoGZdhHfmvFKxbOf7BjSTmiaSA/640?wx_fmt=png&from=appmsg)

调用 RPC

利用 RPCView 工具对 RPC 调用进行监控，发现 RPC GUID {367abb81-9844-35f1-ad32-98f038001003} 由 services.exe 注册，之后启动 ggaa.exe 。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNlezsoN8rbRia7TC7APsR196fjCSpribAwsVEsVwPeiaMQ35X0twRgVDV9Ew/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleU0yZy9Qib9XV5ISuqFSictmdicdiawK3IcxxmLh72jJo3JkiaQHpgYUVcMQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleEVM25ibMBic9x4h8M7RBWbGM0aX7Y2C9jM2jRRz1Mic1EDdF4JuX09HYg/640?wx_fmt=png&from=appmsg)

RPC 调用过程

本地复现样本对 Notepad.exe 的 system 权限执行如下。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNle9S9ia4S2cJ6oZvVE6Lv4xaHCKibqctPuQ6VwlZGTpD4J8fYJOR8Z4sCA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNlelLI8xjAmx6JHB69icb5JaeYIic06JsBjggxWQ8OoiaHFrkSRoCvqLo7cQ/640?wx_fmt=png&from=appmsg)

本地复现

样本以 SYSTEM 权限执行白文件 ggaa.exe 并加载恶意文件 zf\_cef.dll ，实现“白加黑”利用。其中，恶意 DLL 的导出函数 cef\_api\_hash 加载并执行恶意代码。该恶意DLL通过读取 cef.dat 文件加载代码，使用内存异或 0x3A 的方式解密并执行恶意行为。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleovEBDG6oUtvz2ibL7WLGPXdX6TLQHdEyHlDFNImsws0M3OK5BMscVnA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNlejicnBcP7b6RQb8TpzvsyydDVfEFFNjboKXwAU2743FzcrZibS2xPAY2w/640?wx_fmt=png&from=appmsg)

加载 zf\_cef.dll

将本地 cef.dat 文件加载到内存后，开辟可执行内存区域，并通过 COM 系统回调函数跳转执行恶意代码，以绕过沙箱检测机制。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleKbBNTUmnkU2EZh88UuUd55oEECQ1nsDIiczj9eRiaxkRKfHmgHG1MmyA/640?wx_fmt=png&from=appmsg)

COM 系统回调

通过 CLSID {000001c6-0000-0000-C000-000000000046} ,对combase进行分析，发现参数中存在回调函数地址。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleaRJSribTkZheaLiclERAicXqOKZtSWJZibgw0OOQ9DPdL3WzVY9MJTzCQQ/640?wx_fmt=png&from=appmsg)

分析 Combase

随后，本地复现对 COM 组件系统回调接口的回调执行 shellcode (执行 calc.exe )。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleiaqdJj9b3T7ltrGZkaojHtYiaib7cAlZY6dKMEgykYMBCvyk5jmtoXdew/640?wx_fmt=png&from=appmsg)

本地复现

之后，对恶意代码分析发现，该过程仍为内存加载 PE 的过程。恶意 PE 利用 UPX3.96 压缩壳进行伪装保护。手动脱壳分析后，确认该文件为一个古老的 Gh0st 后门 DLL 。

同时，恶意程序再次创建 dllhost 进程，命令为：dllhost.exe /Processid:{F8284233-48F4-4680-ADDD-F8284233} 。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleO9noJ7ITa2lT1OAT98Qiaj8vldIpFibLfHAtCblkXmkqMhzqlpz2ic6AQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNleWuJKEQc3sn9OWVVKOwiaPyUgqos6lHwLCicmh9Z0iazpSTjYwE6j8crfA/640?wx_fmt=png&from=appmsg)

注入 dllhost

**后门分析**

首先，该后门 DLL 复制并解密恶意 shellcode 到内存中，同时复制 ntdll 到内存以绕过 R3 的 Hook 。随后，通过判断进程名称和命令行参数执行不同的恶意行为。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNlenVooibeHP4sr2AZX2lVVkzhKhTSgTrXnzhDJo0OpCjlky2SHlzvPbWQ/640?wx_fmt=png&from=appmsg)

病毒参数执行逻辑

病毒会先通过 C:\\Windows\\ggaa.exe 启动，进行进程名称对比。未匹配到 taskmgr.exe、perfmon.exe 或 svchost.exe 时，开始执行注入 svchost.exe -Install 操作，并通过 svchost.exe -Install 实现安装计划任务 C:\\Windows\\ggaa.exe -svc 。

随后，该计划任务执行 C:\\Windows\\ggaa.exe -svc 对 svchost.exe -k netsvcs 进行二次注入，开启后门功能。同时，它还对 taskmgr.exe 进行内存属性修改，并注入 perfmon.exe 以关闭Windows性能监视程序。

详细分析如下：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz6TbQwItwrRErWA17YjGNledkRk3C8VvYb63KwKKoicmoEicNTSPDsN...