---
title: 记一次有点抽象的渗透经历
url: https://www.secpulse.com/archives/205044.html
source: 安全脉搏
date: 2025-01-23
fetch_date: 2025-10-06T20:07:07.094041
---

# 记一次有点抽象的渗透经历

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 记一次有点抽象的渗透经历

[内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)

[蚁景网安实验室](https://www.secpulse.com/newpage/author?author_id=37244)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng2.png)

2025-01-22

34,159

## 0x01 获取webshell

在各种信息搜集中，发现某个ip的端口挂着一个比较老的服务。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528145.png)

首先看到了员工工号和手机号的双重验证，也不知道账号是什么结构组成的，基本上放弃字典爆破这一条路。于是乎打开之前用灯塔的扫描结果，看看文件泄露是否有什么可用的点。发现其中有一个略显突出的help.html。可能是系统的帮助文档

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528147.png)

看得出来也是一个年久失修的系统了，图片的链接都已经404了。但是这里得到了一个示例账号zs001，也知道了初始密码是123456（吐槽：果然年久失修了，这个系统就没有输入密码的input，只有一个手机号验证码）。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528148.png)

知道了账号，这里还缺一个手机号。感觉这个系统应该没做验证，毕竟看上去是一个老旧的系统，估计有没有人用用都不好说，可能是单位那种废弃了但是还没下架的边缘资产。然后随便输入一个手机号上去。果然！

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528149.png)

然后随便找个手机接码平台等待验证码发过来，然后过了十几分钟无果，想到可能是废弃资产的原因验证码接口早就失效了。于是没办法只能掏出burp开始爆破，估计验证码也是四位数，如果是六位数验证码大概率没系了。但是这波运气还算可以。也是成功爆破出来了。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528150.png)

然后登录后台直接上传一个木马，没有任何过滤。emmmmmmm开始怀念过去。那时候的洞是真好挖啊。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528151.png)

但是访问的时候出现了一个坏消息。404了，404了怎么办呢。想到了可能目标服务器上有杀软之类的东西。木马可能是上传到服务器上了，然后再上传到服务器之后被杀软自动隔离，那么这时候访问就会出现404。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528152.png)

## 0x02 webshell免杀

这里中途又替换了几个github上的免杀木马，均无效。ps:我是懒狗，免杀什么的能不写代码就不写代码。php这玩意有个好处，就是语法特别脏，各种免杀手法层出不穷，花里胡哨。这里就简单的介绍几种比较偷懒的方法。

### 2.1 无字母webshell

个人在实际渗透过程中还算挺好用的，无字母webshell本来是ctf的一些题目，但是事实上免杀效果确实也挺强，而且适应性也比较高，适合一句话木马。之后可以直接上蚁剑链接。

举例：

ps：当然都说了偷懒，肯定不是我写的，直接去ctf平台的题目的writeup偷一个就好了。或者直接百度搜索无字母webshell。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528154.png)

免杀效果如下：

ps: emmmmmmm，我只能说，无敌好吧。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528155.png)

### 2.2 一键免杀工具免杀

这里不多说了，去github直接找就是，但是github特征过于明显，以至于被多个杀软厂商标记。现在感觉免杀的效果也不太好了。基本上start高一些的工具生成的webshell都是秒杀。但是可以找一些start数量少的，效果也还不错。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528156.png)

### 2.3 混淆免杀

混淆免杀，php有很多在线混淆的网站，也就是在不改变代码的功能情况下打乱语法的结构使得代码变为不可读或者可读性很差的代码防止其他人去修改。

可以直接去网上搜索php混淆

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528157.png)

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528158.png)

这里就是用的就是在线混淆php代码的方式直接过了目标主机上的杀软。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528159.png)

## 0x03 绕过杀软上线

接下来就是传frp代理，上cs的操作了。这里先上一个cs，但是由于目标机器上有杀软，所以采用shellcode加加载器的方式去进行绕过。众所周知，cs的特征较为明显，很容易就会被杀软拦截。

首先是shellcode免杀，shellcode免杀可以使用github上的sgn加密工具，免杀效果能达到vt0检测。github链接:<https://github.com/EgeBalci/sgn>

使用方法也很简单，把cs生成的shellcode放在sgn文件夹中执行 ,\*\*\*.sgn就是免杀之后的shellcode了。

sgn.exe shellcode文件名

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528160.png)

免杀前效果

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528161.png)

免杀后效果

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528162.png)

剩下的就是加载器本身的免杀了，这里我就用github随便clone下来的加载器。可以看到编译完成都没来得及运行就直接被杀了。那么怎么在不动加载器的源代码的情况下。完成免杀效果呢。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528163.png)

其实有一个比较抽象的技巧，就是当文件足够大之后，杀软的沙箱就不会去运行该程序，从而实现绕过杀软的检测。比如一个几百m的exe杀软就不会去检测。

那么怎么能让文件变得足够大呢？就是不断往文件后面填充垃圾字符，比如\x00这样既不会影响exe执行，又能够让exe变得足够大。比如我用python不断往文件后面追加\x00字符。

这里上代码

with open('1.exe', 'ab') as f:\f.write(b'\x00' \* 1024 \* 1024 \* 100)

可以看到每次运行add.py 1.exe就大了100m。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528165.png)

然后多次运行，当1.exe达到2g的时候，根据每个杀毒软件版本不一定能用。有些新的杀软不会检测文件大小判断是否运行。（这个方法很玄学，不是很稳定，有时候能有有时候不能用。但是还是值得一试，毕竟是老前辈传承下来的经典免杀手法。）

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528166.png)

但是问题来了，2个g的文件怎么上传到服务器又是一个问题，这里就要说明一下\x00的好处了，可以通过压缩成zip的方式把exe压缩，压缩文件的体积其实还是和之前编译好的文件差不多大。然后只能很方便的就能够把压缩包上传到服务器，然后通过服务器的命令去进行解压。也可以通过webshell去实现解压文件的功能。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528167.png)

## 0x04 内网移动

之后便是熟悉的内网横向环节了。首先是看到了一个弱口令，然后直接链接数据库然后getshell。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528168.png)

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528169.png)

然后直接net user add，之后3389链接上服务器，翻出了一个密码本。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528170.png)

找到一个双网卡的sql server服务器，然后上线，扫一波SMB

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528171.png)

最后找到重要系统10.x.x.x 这个系统，看着是java写的后端,也是一个看起来很老的界面了。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528172.png)

扫了一下路径发现存在druid。

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528173.png)

原本想找session登录的，然后想了一下试一下运气直接怼一波st2，成功拿下（也是运气爆棚）

![](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202405171528174.png)

**本文作者：[蚁景网安实验室](newpage/author?author_id=37244)**

**本文为安全脉搏专栏作者发布，转载请注明：**[**https://www.secpulse.com/archives/205044.html**](https://www.secpulse.com/archives/205044.html)

点赞：
5
[评论：0](#goComment)
收藏：
1

*新浪微博
QQ空间
微信扫一扫*

### 相关文章

* [![浅谈内联钩取原理与实现](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2024/06/VCG211415001580-210x140.jpg)

  浅谈内联钩取原理与实现](https://www.secpulse.com/archives/205124.html "详细阅读 浅谈内联钩取原理与实现")
* [![浅谈进程隐藏技术](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2025/01/vcg.png)

  浅谈进程隐藏技术](https://www.secpulse.com/archives/205188.html "详细阅读 浅谈进程隐藏技术")
* [![利用子域的System权限通往父域](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2024/12/VCG41200362007-001.png)

  利用子域的System权限通往父域](https://www.secpulse.com/archives/205369.html "详细阅读 利用子域的System权限通往父域")

评论  (0)

昵称

必填
您当前尚未登录。
[登录？](https://www.secpulse.com/user_login "登录")
[注册](https://www.secpulse.com/user-register)

邮箱

必填（保密）

快来写下你的想法吧！

upload

|  |  |  |
| --- | ---...