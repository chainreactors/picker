---
title: 原创 Paper | Zyxel Telnet 漏洞分析(CVE-2025-0890、CVE‑2024‑40891)
url: https://mp.weixin.qq.com/s?__biz=MzAxNDY2MTQ2OQ==&mid=2650990591&idx=1&sn=a1f162313bc06603add4797b30daeba3&chksm=8079a5cdb70e2cdbf24d9224c9e37cd8f28d322fd0c0105e52a6df2eb03d42b32330d0deef5b&scene=58&subscene=0#rd
source: 知道创宇404实验室
date: 2025-02-18
fetch_date: 2025-10-06T20:39:41.838410
---

# 原创 Paper | Zyxel Telnet 漏洞分析(CVE-2025-0890、CVE‑2024‑40891)

![cover_image](https://mmbiz.qpic.cn/sz_mmbiz_jpg/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicT4SmLOOczwMuJia6BRoDeqXr2Om1Cwl4RQcNxNrXNxvnsmLp0795E5g/0?wx_fmt=jpeg)

# 原创 Paper | Zyxel Telnet 漏洞分析(CVE-2025-0890、CVE‑2024‑40891)

原创

404实验室

知道创宇404实验室

**作者：fan@******知道创宇404实验室****

**时间：**2025年2月14日****

**1.前言**

参考资料

这是2025年开年分析的第一个洞。2月4日 Zyxel 发布安全公告，旗下部分旧款 DSL 客户终端设备(CPE)存在严重的安全漏洞[1]，包括 默认凭证不安全问题 和 命令注入漏洞 ，攻击者可通过默认凭证登录 Telnet 并利用此漏洞在受影响的设备上执行任意命令。

**2.产品介绍**

参考资料

Zyxel DSL CPE 是 Zyxel 公司生产的一种网络设备，用于通过电话线（DSL 技术）连接互联网。它集成了调制解调器和路由器功能，可将电话线的宽带信号转换为网络信号，供用户上网、使用 Wi-Fi 或打电话。这类设备广泛应用于家庭和小型企业，适合通过 DSL 或 VDSL 技术接入互联网的场景。

简单来说，这是一种用电话线上网的设备，既能提供网络，又能支持无线连接和语音通话。

**3.漏洞分析**

参考资料

#### 固件下载地址[2]

安全公告里提到的受影响型号包括：

```
VMG1312-B10A、VMG1312-B10B、VMG1312-B10E、VMG3312-B10A、VMG3313-B10A、VMG3926-B10B、VMG4325-B10A、VMG4380-B10A、VMG8324-B10A、VMG8924-B10A、SBG3300、SBG3500
```

`CVE-2025-0890` 涉及以上设备存在默认凭证，攻击者可能利用这些弱凭据直接登录设备管理界面。`CVE-2024-40891` 是一个需要认证的命令注入漏洞，攻击者可以通过 `Telnet` 在受影响设备上执行操作系统命令。两个漏洞的结合使得攻击者可以先通过 `CVE-2025-0890` 使用默认凭证登录设备，然后利用 `CVE-2024-40891` 实现任意命令注入，最终完全控制目标设备。

### **3.1 CVE-2025-0890**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicKYaFJogPh6a2MMnlTJnQbRtMZ5coXw47DNAdy4ibtib0x4Wd7m1xQOVw/640?wx_fmt=png&from=appmsg)

CVE-2025-0890 漏洞描述

漏洞描述：`Telnet` 功能存在默认凭证不安全的问题。如果管理员没有更改默认凭证，攻击者可能会利用这些默认凭证登录管理界面。需要注意的是，默认情况下已禁用 `WAN` 访问和 `Telnet` 功能。

首先，分析 `CVE-2025-0890` 寻找默认凭证。

默认凭证保存在 `/etc/default.cfg` 文件中，我们来分析一下这个文件。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicFdFDe6c3znTGf4znTryutcPLhPEbFfhcLIwiaNhLklsZicF3iazdgtc2w/640?wx_fmt=png&from=appmsg)

/etc/default.cfg

`default.cfg` 包含了两个用户 `admin` 和 `zyuser` 以及权限范围。其中 `admin` `zyuser` 两者均拥有 `remoteMGMT` 远程管理功能，可以通过 `Telnet` 登录设备。

这里遇到一个问题，我下载的固件是 `VMG1312-B10A_1.00`，其中 `Password` 是经过加密并 `base64` 编码的。通过 `base64` 解码后的结果是乱码，说明还需要进行解密。于是我通过搜索关键字 `grep -rni "etc/defaulf.cfg"` ，试图找到处理 `default.cfg` 的方式。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puiceVCMkzDYNys7LDicRqrMpogjPuSgK2W11YvQXKVpLgwaicWymLvTI1Bw/640?wx_fmt=png&from=appmsg)

grep -rni "etc/defaulf.cfg"

以上三个二进制文件对 `etc/defaulf.cfg` 进行操作，但是我并没有找到有关解密的相关逻辑。于是我尝试转变思路，换个固件试试，于是在 `VMG4325-B10A_1.00` 中找到仅仅被 `base64` 编码，并没有加密的账户密码。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicXHs5uMgNf61rwicmL3mgAtoia6qicvY3jiccfABgu4kOqkcvjNicIbZsa1g/640?wx_fmt=png&from=appmsg)

/etc/default.cfg

`default.cfg` 包含了三个用户 `supervisor` `admin` 和 `zyuser` 以及权限范围。其中 `supervisor` `admin` `zyuser` 均拥有 `remoteMGMT` 远程管理功能，可以通过 `Telnet` 登录设备。

```
supervisor:zyad1234
admin:1234
zyuser:1234
```

### **3.2 CVE-2024-40891**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puiclic5DCCNrW5EV53icUqNJ5rQ23uC1vK4LkPAKo2gKwurOmPUNOwRXHUA/640?wx_fmt=png&from=appmsg)

CVE-2024-40891 漏洞描述

漏洞描述：存在身份验证后命令注入漏洞。该漏洞可能允许经过身份验证的攻击者通过 `Telnet` 在受影响的设备上执行操作系统命令。需要注意的是，默认情况下已禁用 `WAN` 访问和 `Telnet` 功能。

当成功登录 `Telnet` 后，我们接下来分析 `CVE-2024-40891` 如何触发命令注入漏洞，

先分析入口 `telnetd` 。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicX88mWDVAryb9cWqJK5QuFu5rh9MiaEOt5cfibGGPChnmpmmBvIedBZvg/640?wx_fmt=png&from=appmsg)

telnetd main函数

`main` 通过 `cmsDal_getNetworkAccessMode` 检查客户端的网络访问权限， `sub_4016C4` 判断是否创建 `Telnet` 会话。

分析 `cmsDal_getNetworkAccessMode`，函数被定义在 `lib/private/libcms_dal.so`。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicuicIWedgUqsAxBnwiaMh8qBQJsuSibJCeibiaicibWB5iaQkWF25U5hIq7y5RA/640?wx_fmt=png&from=appmsg)

libcms\_dal.so cmsDal\_getNetworkAccessMode函数

这段代码的功能是判断客户端 `IP` 地址是通过 `lan` 侧访问还是 `wan` 侧访问，并返回访问网络访问模式。漏洞情报说明默认情况下禁止 `wan` 访问，所以漏洞利用前提是设备允许 `wan` 访问。

接着回到 `telnetd` 的 `sub_4016C4` 分析后续操作。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicaicobPlu8V79Bjqj36uUnQWjWs1MZ8QFYsFWy4kTRvrKQD7wNwiaQ82A/640?wx_fmt=png&from=appmsg)

telnet sub\_4016C4函数

`sub_4016C4` 的功能是为新的 `Telnet` 会话分配资源并创建子进程来处理客户端连接。会通过 `cmsCli_authen` 进行客户端身份认证。

通过验证后 `cmsCli_run` 函数会启动一个命令行交互环境，该函数被定义在 `lib/libcms_cli.so`。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puic3HCyzeFJFxW36W22MR0rNZrlxUuIe2uhq9ooZ1aWibbnm2wmBW0NJ1w/640?wx_fmt=png&from=appmsg)

libcmd\_cli.so cmsCli\_run函数

`cmsCli_run` 会启动命令行交互环境后，通过不断调用 `sub_69F0` 处理用户的输入和命令执行。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puic3GnfNlgsVK92ibwUiaicDDrH4RJAXFpiaGStddXyoByKtQA90Nhua4QAfQ/640?wx_fmt=png&from=appmsg)

libcmd\_cli.so sub\_69F0函数

`sub_69F0` 通过 `cmdedit_read_input` 获取用户输入，再通过 `cli_processCliCmd` 和 `cli_processHiddenCmd` 分别处理常规命令和隐藏命令。`cli_processHiddenCmd` 可能需要管理员权限才能调用，我们先看 `cli_processCliCmd`。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicpNfMFuTKyx2ThcwEzDGNH5CRJgUJbGGHjbTvman77Uyo96HmjPrfzQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puic3NwHyIqNrhD7gT1DnE0hic6UwibiaMpaOjrydeXATsyIda5UrMrhV7Gicw/640?wx_fmt=png&from=appmsg)

libcms\_cli.so cli\_processCliCmd函数

首先提取命令名称，当遇到空格、管道符、分号或者逻辑运算符是认为命令名称结束。接着获取用户权限，`supervisorNameGet` 判断是否为超级用户，如果不是超级用户则遍历配置查看当前用户权限。命令存储在 `off_892BC` 中，遍历匹配命令。

执行命令的逻辑为，如果命令有对应的处理函数 `off_892BC[6 * i + 3]` ，调用处理函数执行命令。如果没有处理函数，但包含分隔符（如 `|` 或 `;`），则会调用 `prctl_runCommandInShellWithTimeout` 在 `Shell` 中运行命令。这个地方就是触发命令注入漏洞的关键了，所以我们现在要做的就是判断 `check_cmd_with_split` 和寻找没有处理函数的命令。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicSx6PxkTH2lYrxCwy4TahBTHYLwfPWFGc8dGyKficGpsuPIZN4k83iakA/640?wx_fmt=png&from=appmsg)

libcms\_cli.so check\_cmd\_with\_split函数

`check_cmd_with_split` 首先调用 `strtok_r` 按照分隔符 `|`、`;` 和 `&` 将命令字符串分割成多个子命令。再通过 `is_cmd_allowed` 检查是否运行被执行。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puich4ican3HZIDeGiaBqYF2qa2pyicQ56iaNRmFDMxewxuVfHKRRNbYGFuqEQ/640?wx_fmt=png&from=appmsg)

livcms\_cli.so is\_cmd\_allowed函数

`is_cmd_allowed` 会先判断是否为特殊命令 `sh` ，如果是 `sh` 进一步判断是否为超级用户(这个地方应该是给超级用户留的后门)。

接着会再次判断权限，然后遍历另一个命令表 `off_8A3E0` 检查当前子命令是否在其中。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puic1sd15aE6fRCO6gCQSCL0enU9AnbQpPm1iblPDRndmK6NqR7q8fiaHHaw/640?wx_fmt=png&from=appmsg)

off\_8A3E0 命令表

结果发现，命令表 `off_8A3E0` 中包含隐藏命令 `sh`。

那么下一步只要在 `off_892BC` 找到没有处理函数的命令，即可触发命令注入。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicJjuAlt00wiafKcwBIIr4HZH5xI2bK3c4zQImZM8J6KedicmJueC5cClw/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicky1iakXzia3EJq3POVSiamawSqvrjaicxlKamJtd3PFbXjjxQNfRIB9Vfg/640?wx_fmt=png&from=appmsg)

off\_892BC 命令表

命令表 `off_892Bc` 中，类似 `help` `logout` 会直接调用对应的处理函数（如 `sub_F31C`、`sub_E9B8` ），但是 `ping` `ifconfig` `ps` 等没有处理函数，因此会调用 `prctl_runCommandInShellWithTimeout` 执行命令。

`prctl_runCommandInShellWithTimeout` 被定义在 `libcms_util.so`。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicyxIFHTOAtiaxjmnGz8CibaI5rKorRDrGztbGvSWkc8Wd6vr5nXgFO2rQ/640?wx_fmt=png&from=appmsg)

libcms\_cli.so prctl\_runCommandInShellWithTimeout函数

`prctl_runCommandInShellWithTimeout` 再调用 `sub_116E0` 执行命令。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicAa6r17oIm7U5PBErKQEuIGd9MbaXkrCyLAOSYZ3XSxGHnC2ESE8gxg/640?wx_fmt=png&from=appmsg)

libcms\_cli.so sub\_116E0函数

`sub_116E0` 通过 `fork` 和 `execv` 在子进程中执行用户提供的命令。

最后，我们构造了一个 `poc`

```
ifconfig || sh
```

**4.环境问题**

参考资料

###

分析过程中，我们使用 `QEMU` 模拟环境，`telnet` 服务有问题导致一直是未授权访问，具体情况如下。

先找到相关文件 `telnetd`。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicm8TfRiajfAf2X7jXvVmXGQdMNLwn1AsIDjZK0hrR7BlqM3z9qSVLWDw/640?wx_fmt=png&from=appmsg)

find . -name "*telnet*"

`/usr/sbin/telnetd` 能成功启动 `Telnet` 服务，但是存在认证问题导致未授权访问且没有权限。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicPnwIicOdfvURPwlnazRofvaaNRGHrfmJlarYFudEkr7AjOibyquRfl3A/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/3k9IT3oQhT3ou8zCjf4XCpaNpawp9puicxlc1KDV9vV9CgD69krdmibCENib0hiagU41aEPWibYgkqABKiaaAB4Hs1WQ/640?wx_fmt=png&from=appmsg)

/strace /usr/sbin/telnetd -l /bin/login -F

`str...