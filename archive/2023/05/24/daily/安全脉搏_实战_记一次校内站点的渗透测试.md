---
title: 实战|记一次校内站点的渗透测试
url: https://www.secpulse.com/archives/200867.html
source: 安全脉搏
date: 2023-05-24
fetch_date: 2025-10-04T11:37:50.575544
---

# 实战|记一次校内站点的渗透测试

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 实战|记一次校内站点的渗透测试

[内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)

[hackctf](https://www.secpulse.com/newpage/author?author_id=34005)

2023-05-23

21,587

> ‍作者：John
>
> 来源：https://xz.aliyun.com/t/12391

## **前言**

这次渗透的对象是一个校内的获奖提交申报平台。不知道什么原因，这个站点未接入深信服waf，所以这次渗透过程异常轻松。

## **0x01 越权**

首先使用功能点添加一次申报

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820314.png)

点击编辑，抓包

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820315.png)

可以看到是使用`id`控制返回的数据的

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820316.png)

服务端没有进行鉴权，修改`id`可返回其他用户的数据

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820317.png)

其他接口也是一样

**越权修改**

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820319.png)

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820320.png)

**越权删除**

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820321.png)

**0x02 任意文件上传**

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820323.png)

还是在提交申报那里，添加文件，抓包

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820324.png)

并没有返回文件路径，但返回了`id`，所以要配合刚才的越权接口使用

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820325.png)

成功解析

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820326.png)

## **0x03 任意文件下载**

在刚才的`viewPage`接口返回的数据里，可以看到调用了名为`downloadFile`的js函数

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820327.png)

我们看下源码

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820328.png)

盲猜这里可以进行目录跨越，`fileName`就是文件名，`fileType`就是文件后缀，还不清楚后缀是不是白名单

先随便传个参看看

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820329.png)

好家伙，太贴心了，没有任何限制还直接把当前目录都返回出来

构造一下

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820331.png)

## **0x04 任意权限的用户添加**

在翻看数据包的时候，发现接口的命名都非常有规律
比如：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820333.png)

`addPage`就是刚才内联框架所使用的HTML文件，里面不仅包含了相关的接口，还包含了表单的字段名

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-200867-1684820334.png)

并且接口名称`studentward`、`role`、`resource`、`counsellor`都是跟功能相关的英文，非常好猜

构造`administrator`、`organization`、`controller`等名称，或者拿本英汉大字典跑也行

最后Fuzz出来了`user`

/user/addPage 如下：

```
<script type="text/javascript">    $(function() {        $('#userAddOrganizationId').combotree({            url : '/organization/tree',            parentField : 'pid',            lines : true,            panelHeight : '200'        });
        $('#userAddRoleIds').combotree({            url: '/role/tree',            multiple: true,            required: true,            panelHeight : 'auto'        });

        $('#sex').combobox({            url:'/dict/loadcombobox?code=sex',            method: 'get',            valueField:'val',            textField:'description',            panelHeight : 'auto',            groupField:'group'
        });
        $('#userType').combobox({            url:'/dict/loadcombobox?code=userType',            method: 'get',            valueField:'val',            textField:'description',            panelHeight : 'auto',            groupField:'group'        });
        $('#userStatus').combobox({            url:'/dict/loadcombobox?code=userStatus',            method: 'get',            valueField:'val',            textField:'description',            panelHeight : 'auto',            groupField:'group'        });
        $('#userAddForm').form({            url : '/user/add',            onSubmit : function() {                progressLoad();                var isValid = $(this).form('validate');                if (!isValid) {                    progressClose();                }                return isValid;            },            success : function(result) {                progressClose();                result = $.parseJSON(result);                if (result.success) {                    parent.$.modalDialog.openner_dataGrid.datagrid('reload');                    parent.$.modalDialog.handler.dialog('close');                } else {                    var form = $('#userAddForm');                    parent.$.messager.alert('提示', eval(result.msg), 'warning');                }            }        });
    });</script><div class="easyui-layout" data-options="fit:true,border:false">    <div data-options="region:'center',border:false" title="" style="overflow: hidden;padding: 3px;">        <form id="userAddForm" method="post">            <table class="grid">                <tr>                    <td>学工号</td>                    <td><input name="loginName" type="text" placeholder="请输入登录名称" class="easyui-validatebox" data-options="required:true" value=""></td>                    <td>姓名</td>                    <td><input name="name" type="text" placeholder="请输入姓名" class="easyui-validatebox" data-options="required:true" value=""></td>                </tr>                <tr>                    <td>密码</td>                    <td><input name="password" type="password" placeholder="请输入密码" class="easyui-validatebox" data-options="required:true"></td>                    <td>...