---
title: 查看指定进程的环境变量
url: http://blog.nsfocus.net/sslkeylogfile/
source: 绿盟科技技术博客
date: 2022-11-01
fetch_date: 2025-10-03T21:26:15.050571
---

# 查看指定进程的环境变量

* [登录](http://blog.nsfocus.net/wp-login.php)
* [注册](http://blog.nsfocus.net/wp-login.php?action=register)

[![Logo](http://blog.nsfocus.net/wp-content/uploads/2020/07/blog-logo.png)](https://blog.nsfocus.net/)

* [技术产品](https://blog.nsfocus.net/category/technology-product/)
* [数智安全](https://blog.nsfocus.net/category/digital-intelligence-secuirty/)
* [威胁通告](https://blog.nsfocus.net/category/threat-alert/)
* [研究调研](https://blog.nsfocus.net/category/security-research/)
* [洞见RSA](https://blog.nsfocus.net/category/rsac/)
* [公益译文](https://blog.nsfocus.net/category/translation/)
* [安全分享](https://blog.nsfocus.net/category/security-sharing/)

[![Logo](http://blog.nsfocus.net/wp-content/uploads/2020/07/blog-logo.png)](https://blog.nsfocus.net/)

* [技术产品](https://blog.nsfocus.net/category/technology-product/)
* [数智安全](https://blog.nsfocus.net/category/digital-intelligence-secuirty/)
* [威胁通告](https://blog.nsfocus.net/category/threat-alert/)
* [研究调研](https://blog.nsfocus.net/category/security-research/)
* [洞见RSA](https://blog.nsfocus.net/category/rsac/)
* [公益译文](https://blog.nsfocus.net/category/translation/)
* [安全分享](https://blog.nsfocus.net/category/security-sharing/)

# 查看指定进程的环境变量

### 查看指定进程的环境变量

[2022-10-31](https://blog.nsfocus.net/sslkeylogfile/ "查看指定进程的环境变量")[scz](https://blog.nsfocus.net/author/scz/ "View all posts by scz")

阅读： 1,243

Q:用如下命令启动Firefox后，想确认SSLKEYLOGFILE位于目标进程环境变量中

SSLKEYLOGFILE=$HOME/src/sslkey.log firefox

A: scz 2022-10-25

获取PID

ps auwx | grep firefox
pidof firefox

显示指定PID的环境变量

strings /proc/<pid>/environ | grep SSLKEYLOGFILE
xargs -0 -n 1 echo < /proc/<pid>/environ | grep SSLKEYLOGFILE
xargs -0 -L 1 -a /proc/<pid>/environ | grep SSLKEYLOGFILE
sed ‘s/\x00/\n/g’ /proc/<pid>/environ | grep SSLKEYLOGFILE
cat /proc/<pid>/environ | tr ‘\0’ ‘\n’ | grep SSLKEYLOGFILE
ps wwe -p <pid> | tr ‘ ‘ ‘\n’ | grep SSLKEYLOGFILE

ww表示”unlimited width”，e表示显示环境变量。显然strings最简单。

检查所有Firefox进程的环境变量

————————————————————————–
for pid in $(pidof firefox)
do
echo $pid
ps wwe -p $pid | tr ‘ ‘ ‘\n’ | grep SSLKEYLOGFILE
done
————————————————————————–
for pid in $(pidof firefox); do echo $pid;ps wwe -p $pid | tr ‘ ‘ ‘\n’ | grep SSLKEYLOGFILE; done
————————————————————————–
for pid in $(pidof firefox); do echo $pid;strings /proc/$pid/environ | grep SSLKEYLOGFILE; done
————————————————————————–

A: scz 2022-10-30

参看proc(5)

/proc/[pid]/environ

进程启动时会分配一块内存，将execve(2)的envp[]所指向的初始环境变量复制进去，各条环境变量之间以\0分隔，这块内存通过proc伪文件系统展现给用户态。进程可以调用prctl(2)的PR\_SET\_MM\_ENV\_START修改这块内存位置，/proc/[pid]/environ会反映这种变化。进程启动之后，若调用putenv(3)或直接修改environ(7)中的环境变量，相应变动并不自动反映到/proc/[pid]/environ中，后者大多数时候只是初始静态备份。

SSLKEYLOGFILE=$HOME/src/sslkey.log opera

for pid in $(pidof opera); do echo $pid;strings /proc/$pid/environ | grep -i SSLKEYLOGFILE; done

Opera启动后应该改动过环境变量，上述命令无输出。

观察Opera各进程的/proc/$pid/environ

for pid in $(pidof opera); do echo $pid;xxd -l 0x40 -g 1 /proc/$pid/environ; done

从上述命令输出看，Opera可能调用过prctl(PR\_SET\_MM\_ENV\_START)，且新区域并未实际存放环境变量。此时无法通过/proc/[pid]/environ检查Opera的环境变量，替代方案是用GDB。

ps auwx | grep opera
pidof opera
gdb -q -nx -p <pid>

(gdb) info address environ

environ是导出的全局变量，初值等于envp，但随后实时指向环境变量区域。

————————————————————————–
#
# https://sourceware.org/gdb/onlinedocs/gdb/Command-and-Variable-Index.html
# https://sourceware.org/gdb/onlinedocs/gdb/Command-Files.html
#
define GetStrArray
set $array = (char \*\*)$arg0
set $i = 0
set $str = $array[$i]
while $str
x/s $str
set $i = $i + 1
set $str = $array[$i]
end
end
#
# 显示所有环境变量
#
GetStrArray environ
————————————————————————–
define FindStrFromArray
set $array = (char \*\*)$arg0
set $magic = $arg1
set $i = 0
set $str = $array[$i]
while $str
if $\_regex($str,$magic)
x/s $str
loop\_break
end
set $i = $i + 1
set $str = $array[$i]
end
end
#
# 查找特定环境变量
#
FindStrFromArray environ “SSLKEYLOGFILE=”
————————————————————————–

(gdb) x/s \*((char \*\*)environ+37)
(gdb) x/s ((char \*\*)environ)[37]
0x1e44002149c0: “SSLKEYLOGFILE=/home/scz/src/sslkey.log”

有时可用”x/10s \*(char \*\*)environ”这类命令快速批量查看环境变量，但该用法不等价于”GetStrArray environ”；不只是数目问题，”x/10s”假设各条环境变量之间只有一个\0，若不符合假设，输出非预期，”x/10s”可用于Firefox，不适用于Opera。

(gdb) show environment
(gdb) sp show environment | grep USER

上述命令显示GDB进程的环境变量，不是被调试进程的，不要掉坑里了。

**版权声明**
本站“技术博客”所有内容的版权持有者为绿盟科技集团股份有限公司（“绿盟科技”）。作为分享技术资讯的平台，绿盟科技期待与广大用户互动交流，并欢迎在标明出处（绿盟科技-技术博客）及网址的情形下，全文转发。
上述情形之外的任何使用形式，均需提前向绿盟科技（010-68438880-5462）申请版权授权。如擅自使用，绿盟科技保留追责权利。同时，如因擅自使用博客内容引发法律纠纷，由使用者自行承担全部法律责任，与绿盟科技无关。

Spread the word. Share this post!

[Previous](https://blog.nsfocus.net/predictionofnewtech1-0/)

[Next](https://blog.nsfocus.net/weeklyreport44/)

### Meet The Author

scz

C/ASM程序员

咨询与合作：nsmagazine@nsfocus.com

* [绿盟科技官网](https://www.nsfocus.com.cn)
* [绿盟威胁情报中心（NTI）](https://nti.nsfocus.com)
* [绿盟云](https://cloud.nsfocus.com)