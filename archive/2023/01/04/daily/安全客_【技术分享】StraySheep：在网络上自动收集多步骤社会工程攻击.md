---
title: 【技术分享】StraySheep：在网络上自动收集多步骤社会工程攻击
url: https://mp.weixin.qq.com/s?__biz=MzA5ODA0NDE2MA==&mid=2649781797&idx=1&sn=325ea8a90d62197301721d7ed87e5ceb&chksm=8893464abfe4cf5c199b73b0795bcaca33ec7546baa3b422adda9ed176d5f51cd44b1dbe7def&scene=58&subscene=0#rd
source: 安全客
date: 2023-01-04
fetch_date: 2025-10-04T02:59:56.859676
---

# 【技术分享】StraySheep：在网络上自动收集多步骤社会工程攻击

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/Ok4fxxCpBb6vU7ibwq7EjdvKvdHCOL0CdxK2CYKicaJHkNLcyJZy1IGuyxHibhhDLHs50UjfhcL5O1mxZp5e2vsQA/0?wx_fmt=jpeg)

# 【技术分享】StraySheep：在网络上自动收集多步骤社会工程攻击

原创

CDra90n

安全客

![](https://mmbiz.qpic.cn/mmbiz_jpg/Ok4fxxCpBb6vU7ibwq7EjdvKvdHCOL0CdjRHPKTjJcfjdIpBBHYBtwCj39CdsaTBcIua3fia6umtdGS9xVtUeqgQ/640?wx_fmt=jpeg)

通过利用人们的心理漏洞，基于Web的现代网络社会工程（SE，Social Engineering）攻击可操纵受害者下载恶意软件并暴露个人信息。为了有效地吸引用户，某些SE攻击会从登录页面开始构成一系列欺骗性网页，并且在每个网页上都进行浏览器交互，称为多步SE攻击。此外，在网页上执行的不同浏览器交互通常会分支为多个序列，以将用户重定向到不同的SE攻击。

本文提出工具StraySheep，该系统可自动抓取一系列网页并检测各种多步骤SE攻击。本研究评估了StraySheep的三个模块（登录页面收集、网页爬取和搜索引擎检测）的有效性，包括SE攻击登录页面收集率、web爬虫获取SE攻击的效率以及检测攻击的准确性。实验结果表明，StraySheep比Alexa top站点和趋势词搜索结果多发现20%的SE攻击，比简单的爬虫模块提高5倍的爬取效率，检测SE攻击的准确率为95.5%。

**Introduction**

PART/11

、

社会工程学（SE）在心理上操纵人们执行特定的动作。现代的基于Web的攻击利用SE来进行恶意软件感染和在线欺诈，这被称为基于Web的SE攻击（或简称为SE攻击）。攻击者通过诱人的Web内容或警告消息巧妙地引导用户的浏览器交互，以使用户下载恶意软件或泄漏敏感信息。例如，要下载盗版游戏，用户单击非法下载网页上的下载按钮。然后，显示带有病毒感染警报的弹出窗口。相信虚假信息的用户单击“确认”按钮并下载虚假的防病毒软件。

自动收集SE攻击的常见系统包括访问从搜索引擎收集的网页。这些系统使用Web浏览器来爬取网页并通过仅从每个网页中提取特征来识别特定的SE攻击。但是，某些类型的SE攻击会构成从登录页面开始的一系列网页，并且需要在每个网页上进行浏览器交互（例如，单击HTML元素）才能达到攻击，将其称为多步SE攻击。这是因为每个网页通过使用不同的心理策略逐渐欺骗用户。另外，在网页上执行的不同浏览器交互操作通常会分支为多个序列，从而将用户重定向到不同的SE攻击，因为存在与用户兴趣或心理脆弱性相对应的多种攻击情形。尽管当前的系统仅分析登录页面或进行仅限于特定攻击的浏览器交互，但很少有人努力遵循此类网页序列来收集多步SE攻击。

本文建议使用StraySheep，该系统可自动抓取网页序列并检测从目标网页派生的各种多步骤SE攻击。StraySheep基于两个关键思想。第一个想法是模拟用户的多步浏览行为，也就是说，通过选择心理上吸引用户以导致他们受到SE攻击的可能元素，有意遵循网页的顺序。StraySheep不仅遵循网页的单一顺序，而且还对从登录页面派生的多个序列进行爬取。第二个想法是从到达的网页以及整个网页序列中提取特征。与以前的方法从单个网页提取特征的方法不同，StraySheep从单个网页中提取特征或识别没有用户交互（即URL重新命名）而自动导致的恶意URL链，而从这些方法中提取特征它积极且递归地遵循了整个网页顺序。也就是说，StraySheep分析到达的网页的图像和语言特征，到达网页之前发生的浏览器事件（例如，显示弹出窗口和警报）以及导致用户遭受SE攻击的浏览器交互。这些特征代表了所有SE攻击的共同特征，即说服和欺骗用户。因此，通过将这些特征组合到分类序列中，StraySheep可以更准确地检测各种多步SE攻击。

**Background**

PART/21

SE用于通过利用人们的心理来操纵人们执行特定的动作，并且已广泛用于各种基于Web的攻击中，例如恶意软件下载，恶意浏览器扩展安装，调查欺骗和技术支持欺骗。伪装成合法软件可实现恶意软件下载和恶意浏览器扩展安装。调查欺骗会招募被虚假调查奖励吸引的用户，以诱骗他们提供敏感信息并访问攻击者控制的网页。通过说服用户致电假冒的技术支持台并安装键盘记录器，远程访问工具或恶意软件来进行技术支持欺骗。

![](https://mmbiz.qpic.cn/mmbiz_png/Ok4fxxCpBb6vU7ibwq7EjdvKvdHCOL0CdXmzia7iccXpjjWBZ1Cj9uaw8Tt1mIsKWQ6y7ysLECyWsVSKUM5JUys8w/640?wx_fmt=png)

多步骤SE攻击使用多个利用不同心理策略的网页来有效地吸引用户访问后续网页。上图显示了经过多步SE攻击的一系列网页以及每个网页中的三个简化阶段：用户吸引，浏览器交互和Web导航。因此，三个阶段可以从登录页面开始多次重复，该登录页面是响应于单击搜索引擎结果或社交媒体链接而出现的。单个网页上不同的用户交互也会导致不同的SE攻击。

### **1）对用户的吸引**

通过使用网页的内容来欺骗和说服用户诱导浏览器交互，从心理上吸引了用户。例如，这些网页广告可免费下载视频游戏，使用伪造的病毒警告威胁用户，并请求伪造的软件更新。这种心理吸引的主要目的是使用户与导航到恶意软件下载或攻击者控制的网页的HTML元素（例如a和div）进行交互，称此类HTML元素为诱饵元素。诱饵元素的共同之处在于它们包含指示元素行为或类别的单词或形状。诱饵元素具有视觉效果，例如易于理解的包含“单击此处下载”的下载按钮和包含“立即观看”或指向右侧的三角形的电影播放按钮。诱饵元素的特征还在于在其文本内容中包含诸如“ download-btn”和“ video-play-link”之类的词，以及诸如id，class和alt之类的文档对象模型（DOM）属性。多个诱饵元素可以布置在单个网页上。在这种情况下，单击这些诱饵元素会导致不同的SE攻击。

### **2）浏览器交互**

在上一个用户吸引阶段受其影响的用户将被引导与网页上的诱饵元素进行交互。该浏览器交互阶段主要是对诱饵元素的明确单击，但也包括意外单击。例如，意外点击包括单击整个网页，上下文菜单和浏览器的后退按钮上的覆盖图。这些点击是由JavaScript强制生成的，目的是将用户重定向到新网页或显示弹出窗口，而不是用户的意图。

### **3）网页导航**

在Web导航阶段，浏览器事件是由于浏览器交互而发生的。这些浏览器事件重定向到当前窗口或新窗口（弹出窗口）中的另一个网页，显示警报对话框并下载文件。网页重定向发生在多步骤SE攻击的中间步骤中，将用户引导至下一个网页。在下一页上，可能再次发生其他用户吸引力，浏览器交互和Web导航。在没有完成对一个网页的攻击的情况下反复使用户访问多个网页的目的是逐步说服用户并提高攻击的成功率。例如，为了提高在非法流媒体站点上观看电影的用户的攻击成功率，攻击者会显示一个弹出窗口，该弹出窗口为专用视频播放器提供了警告对话框，例如“请安装HD播放器以继续。”在第一个网页上提供自动软件下载的说明。而且，在多步骤SE攻击中的多个网页序列通常从登陆网页或中间网页分支，因为此类网页包含导致不同页面的两个或更多个诱饵元素。

### **4）收集SE攻击的问题**

有三种自动收集SE攻击的方法：跟踪Web流量，使用爬虫进行归档以及使用Web浏览器进行搜寻。

第一种方法是从通过被动网络监视获得的网络流量中重构SE攻击。为了采取措施抵制SE攻击，重要的是不仅要揭示从目标页面到达的单个SE攻击，而且还要揭示从网页分支的所有攻击。但是，该方法仅用于观察用户访问的单个网页序列。而且，它不能用于观察从任意网页开始的SE攻击。即，它不能用于观察未受影响的用户但其他用户可能受到影响的攻击。

第二种方法是使用爬虫（例如Heritrix和GNU Wget）访问每个网页。此类爬虫从下载的网页HTML源代码中提取链接，然后递归地对其进行搜寻。这种方法可以解决第一种方法的问题，该方法无法收集用户未达到的SE攻击，因为它可以输入任意URL。但是，这些爬虫只能执行简单的内容下载和静态内容解析。SE攻击通常使用JavaScript动态生成的Web内容，这需要用户交互才能导航到下一页。因此，这些类型的爬虫无法收集大多数SE攻击。

第三种方法是使用诸如Selenium之类的工具实现Web浏览器自动化。Web浏览器自动化能够将用户后期交互与每个网页上的所有元素进行模拟。通过这种方法，可以解决第二种方法的问题。如果将浏览所有链接的想法与第二种方法应用于Web浏览器自动化，即单击每个网页上的所有元素，则理想情况下，可以收集从目标网页派生的所有多步SE攻击。但是，递归地跟踪所有元素会花费大量时间，因为浏览器需要时间来运行JavaScript和呈现网页。

总之，为了在短时间内有效地观察多步骤SE攻击，必须通过从每个网页上的数千个HTML元素中选择可能的诱饵元素来减少要爬取的元素的数量。为了详细分析多步SE攻击，还需要递归地跟踪导致从登陆页面派生SE攻击的多个网页序列，而不是仅跟踪单个网页序列。因此，收集和分析多步骤SE攻击的要求正在通过Web浏览器自动化方法进行爬取，选择可能会导致SE攻击的诱饵元素，并与诱饵元素进行递归交互。

**StraySheep**

PART/31

本文提出了一种名为StraySheep的系统，该系统可以自动收集导致SE攻击的登录页面，对网页进行爬取并检测多步SE攻击。

![](https://mmbiz.qpic.cn/mmbiz_png/Ok4fxxCpBb6vU7ibwq7EjdvKvdHCOL0CdGwTqZBD5cia387RKTibicdnCRabVOn12ulwaqpibCrHYn89sC4mHUUY5ibQ/640?wx_fmt=png)

StraySheep包含三个模块：登陆页面收集，网络爬取和SE检测， StraySheep的概述如上图所示。登陆页收集模块通过利用搜索引擎和社交媒体来收集导致SE攻击的网页URL。Web爬虫模块从登陆页收集模块收集的URL开始递归Web爬取，选择并单击引诱元素，然后输出WebTree。WebTree由树状抽象数据组成，其中包括在从登录页面分支的每个Web页面上观察到的日志，例如Web导航，浏览器交互作用以及快照（屏幕快照和HTML源代码）。SE检测模块从WebTree提取特征并使用分类模型识别多步SE攻击。

### **1）登陆页收集模块**

登陆页面收集模块利用搜索引擎和社交媒体来查找登陆页面，作为网络爬虫模块的输入。许多SE攻击使用带有版权的网页（例如非法下载和免费视频流）吸引谨慎的用户。为了诱使用户访问此类网页，攻击者使用搜索引擎优化技术，并在社交媒体上发布消息，这些消息包括指向登录页面的链接。此类社交媒体发布的示例包括用于非法安装软件的说明视频和介绍免费游戏下载站点的消息。为了有效地收集此类登录页面，登录页面收集模块使用基于Web搜索的方法，该方法包括两个步骤：生成搜索查询以及搜索和抓取。

#### （a）生成搜索查询

登陆页面收集模块生成搜索查询，以搜索可能导致SE攻击的登陆页面的URL。为了生成搜索查询，该模块会收集核心关键字，这些关键字代表付费内容的标题或名称（例如“ Godzilla”和“ Microsoft Office”），并将它们与预定义的限定词（例如free download”, “crack”和“stream online”）。为了收集核心关键字，该模块通过根据每个站点使用预定义的去除逻辑自动去除流行的电子商务（EC）站点和在线数据库站点，并按内容类别（例如，视频，软件和音乐）对核心关键字进行分组。这些核心关键字可以通过重新收集排名和新发行信息来定期更新。

使用限定符的目的是（1）限制搜索结果的覆盖范围，包括非法下载和流式传输，而不是合法站点；以及（2）增加搜索结果的差异。使用搜索引擎上的自动建议/相关搜索功能来预先手动准备限定词。当用户在搜索引擎中查询某个单词时，这些搜索功能会提供相应的关键字预测列表。向搜索引擎输入了一些付费内容标题，并为每个类别收集了限定词，因为需要的限定词根据核心关键字的类别而有所不同。例如，视频的限定词是“stream”, “movie”, “online”。再例如，软件类别的限定词是 “download”, “crack”, “key”。

#### （b）搜索和提取

该模块通过使用生成的搜索查询从搜索引擎或社交媒体中检索URL。它将它们输入到搜索引擎和社交媒体上的搜索表单中，以广泛收集相应的URL。由于所需的最低搜索功能，某些社交媒体并不总是提供全面的搜索结果。因此，该模块还使用搜索引擎来收集社交媒体帖子。最后，它输出从搜索结果中收集的URL和从社交媒体发布中抓取的链接，作为网络爬取模块的输入。

### **2）网页爬取模块**

![](https://mmbiz.qpic.cn/mmbiz_png/Ok4fxxCpBb6vU7ibwq7EjdvKvdHCOL0CdLLfSSY5ib7RhcGGLWkofMV1tldPPzsYSXf2D4k6IhQlv1U0z52hz3AA/640?wx_fmt=png)

Web爬虫模块使Web浏览器自动化，以递归地爬取由登陆页收集模块收集的URL，并输出WebTree作为爬取结果。上图显示了WebTree的概念模型，该模型表示从登陆页派生并由网络隐蔽模块访问的网页序列。Web爬取模块从登录页面开始，单击网页上的多个诱饵元素，然后递归地跟踪从该登录页面派生的多个网页。深度表示网络爬取的递归计数。当此模块到达完成加载并等待浏览器交互的网页时，深度会增加。该模块使用Selenium和原始的浏览器扩展来自动控制和监视Web浏览器。对于系统的原型，选择Google Chrome作为浏览器，但是Selenium也可以控制其他Web浏览器。因此，网络抓取模块可以使用不同的浏览器。在以下部分中，将描述Web爬取模块的两个组件：选择和操作。

#### （a）选择组件

选择组件通过分析HTML源代码和网页屏幕截图来收集诱饵元素，该诱饵元素导致导致SE攻击的Web导航表示元素类别或动作的单词通常用于诱饵元素的DOM属性，文本内容以及在按钮图形内绘制的文本，例如，“ download-btn”中的“ download”类属性中的“”，然后在可点击按钮内绘制的文本的“立即点击”中的“点击”。要选择包含诸如诱惑元素之类的关键字的元素，选择组件将解析HTML源代码并执行网页屏幕截图的图像处理。选择组件的目的不是准确地检测导致SE攻击的元素，而是选择可能的诱饵元素以减少与之交互的元素的数量。通过仅遵循选定的元素，Web爬网模块可以有效地达到各种SE攻击。请注意，同一网页上可能有多个诱饵元素；因此，此组件将分析网页上的所有元素。选择组件还执行图像处理的原因是为了补充在按钮图像（即img元素）中绘制的字符串的获取，这是无法从HTML源代码获取的。该组件还通过诱饵元素的形状来标识它们，例如三角形视频播放按钮。

![](https://mmbiz.qpic.cn/mmbiz_png/Ok4fxxCpBb6vU7ibwq7EjdvKvdHCOL0CdaibkPbibxpdDypoia7fOgW9vCdKRXsiaQPvgZibs3QAWsibtibLj8L4icnuQQA/640?wx_fmt=png)

本文解释了一种用于选择诱饵元素的关键字的统计方法，将实际上已将用户重定向到SE攻击的元素（诱饵元素）与尚未将用户重定向到任何SE攻击的其他元素（非诱饵元素）进行比较，并提取特定于诱饵元素的单词。更具体地说，从收集的元素中提取属性，文本内容和在按钮上绘制的字符串，并将这些单词分为两个文档：一个诱饵元素文档和一个非诱饵元素。然后计算两个文档的词频逆文档频率（tf-idf），并从诱惑元素文档中手动选择具有高tf-idf值的单词。

在HTML源代码分析中，如果元素至少符合以下四个规则之一，则此组件将其确定为诱饵元素：

•元素的文本内容中使用了一个关键字。

•在id，class或alt DOM属性中设置了关键字。

•关键字用作链接（元素）或图像（img元素）的URL指示的文件名。

•可执行文件（例如.exe或.dmg）或压缩文件（例如.zip或.rar）用作链接扩展名。

在图像处理分析中，此组件从屏幕快照中提取在每个元素中编写的字符串，并匹配HTML源代码分析中使用的关键字。为了从屏幕截图中确定按钮的坐标和大小，该组件利用OpenCV查找表示按钮区域的矩形轮廓。它还使用光学字符识别（OCR）和Tesseract OCR从发现的组件的矩形中提取字符串。该组件执行与提取的字符串匹配的关键字，并将包含该区域中的关键字之一的元素确定为诱饵元素。为了获取视频播放按钮作为引诱元素，该模块还会找到一个指向右侧的三角形轮廓。最后，该组件会输出多个诱饵元素，这些诱饵元素可能会导致来自网页的SE攻击。

#### （b）操作组件

操作组件执行浏览器交互（即，点击诱饵元素），监视Web导航并构建WebTree。它模拟了在按下CTRL键以在新的浏览器选项卡中打开网页的情况下点击诱饵元素的情况，因为通过单击即可将当前页面转移到另一个网页。因此，可以在新选项卡中打开链接或弹出窗口，而无需更改原始选项卡。为了模拟前文中描述的意外点击，操作模块还单击了body元素，带有上下文单击的body元素以及浏览器的后退按钮。当打开新选项卡时，选择组件将再次找到诱饵元素，并且操作组件将以深度优先的顺序执行浏览器交互，除非达到预定的最大深度。将在后文中说明在以下实验中使用的最大深度。

![](https://mmbiz.qpic.cn/mmbiz_png/Ok4fxxCpBb6vU7ibwq7EjdvKvdHCOL0CdUs4NvZc5K2egL99Ewp0hJSibGE94PFMkZf0NBGib9PHFeuYRrRxlgloQ/640?wx_fmt=png)

该操作组件还监视Web导航。为了监视JavaScript函数调用，此组件将钩住现有的JavaScript函数，以便它可以检测已执行的JavaScript函数名称及其参数。该组件要监视的JavaScript函数是alert（），window.open（）和浏览器扩展的安装函数（例如chrom.webstore.install（））。函数alert（）常用于SE攻击中，该攻击通过突然显示带有引起用户焦虑的消息的对话框来威胁用户。window.open（）函数将打开一个新的浏览器窗口，并用于弹出广告。该组件还挂钩了浏览器扩展的安装功能，并根据参数检测安装了哪种类型的浏览器扩展。该组件还监视URL重定向...