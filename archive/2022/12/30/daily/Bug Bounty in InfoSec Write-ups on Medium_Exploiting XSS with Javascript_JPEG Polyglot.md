---
title: Exploiting XSS with Javascript/JPEG Polyglot
url: https://infosecwriteups.com/exploiting-xss-with-javascript-jpeg-polyglot-4cff06f8201a?source=rss----7b722bfd1b8d--bug_bounty
source: Bug Bounty in InfoSec Write-ups on Medium
date: 2022-12-30
fetch_date: 2025-10-04T02:44:03.112267
---

# Exploiting XSS with Javascript/JPEG Polyglot

[Sitemap](/sitemap/sitemap.xml)

[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4cff06f8201a&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&%7Estage=mobileNavBar&source=post_page---top_nav_layout_nav-----------------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Finfosecwriteups.com%2Fexploiting-xss-with-javascript-jpeg-polyglot-4cff06f8201a&source=post_page---top_nav_layout_nav-----------------------global_nav------------------)

[Medium Logo](https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav------------------)

[Search](https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Finfosecwriteups.com%2Fexploiting-xss-with-javascript-jpeg-polyglot-4cff06f8201a&source=post_page---top_nav_layout_nav-----------------------global_nav------------------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)

[## InfoSec Write-ups](https://infosecwriteups.com/?source=post_page---publication_nav-7b722bfd1b8d-4cff06f8201a---------------------------------------)

·

Follow publication

[![InfoSec Write-ups](https://miro.medium.com/v2/resize:fill:76:76/1*SWJxYWGZzgmBP1D0Qg_3zQ.png)](https://infosecwriteups.com/?source=post_page---post_publication_sidebar-7b722bfd1b8d-4cff06f8201a---------------------------------------)

A collection of write-ups from the best hackers in the world on topics ranging from bug bounties and CTFs to vulnhub machines, hardware challenges and real life encounters. Subscribe to our weekly newsletter for the coolest infosec updates: <https://weekly.infosecwriteups.com/>

Follow publication

# Exploiting XSS with Javascript/JPEG Polyglot

[![Medusa](https://miro.medium.com/v2/resize:fill:64:64/1*f2U6mEKEJfzwHgsgrqFAXw.jpeg)](https://medusa0xf.medium.com/?source=post_page---byline--4cff06f8201a---------------------------------------)

[Medusa](https://medusa0xf.medium.com/?source=post_page---byline--4cff06f8201a---------------------------------------)

4 min read

·

Apr 8, 2022

--

7

Listen

Share

Press enter or click to view image in full size

![]()

### What is a polyglot?

Just like PNG, JPEG, and DOC are valid file types, polyglots are a combination of two different file types. For example Phar + JPEG (PHP archive and JPEG file), GIFAR (Gif and Rar file) Javascript + JPEG, etc.

Applications allow only certain file types on features like file upload and don’t allow other file types like .php or .js files as these can enable the attacker to upload malicious files on the application. Applications perform extension filtering checks like double extensions(.jpg.php) or use of null bytes in extension(.php%00.jpg), file names (.htaccess, .config, etc..), and if the uploaded file’s signature also matches its content type.

The different application uses different methods and polyglots can be used to bypass some of these validation checks.

### JPEG Structure

A JPEG image is represented as a sequence of segments where each segment begins with a header. Each header starts with some byte. The payload followed by the header is different as per header type. Common JPEG marker types are as listed below:

```
0xffd8: “Start of Image”,0xffe0: “Application Default Header”,0xffdb: “Quantization Table”,0xffc0: “Start of Frame”,0xffc4: “Define Huffman Table”,0xffda: “Start of Scan”,0xffd9: “End of Image”
```

Every binary file contains a couple of headers. They are very important for a file as they define specific information of a file. Most of the headers are followed by length information. This tells us how long that particular segment is.

The start of the image header contains FF D8. If we don’t see it we can assume this is some other file. Another important marker is FF D9 which tells the end of the image.

To make the payload look like a legitimate JPEG file, we will add the length of the header, comment header, null byes to pad and then our javascript attack vector.

Let’s say the attack vector is `*/=alert(“XSS”)/*` Converting it into hexadecimal will look like this.

![]()

The payload in hex:-

```
2A 2F 3D 61 6C 65 72 74 28 22 58 53 53 2E 22 29
```

We can use a hex-editor to inject javascript in the image metadata. This works because the browsers interpret the code when they render the image into HTML.

![]()

test.jpg (Target image file)

I’ve got an image **test.jpg** and below is the hexdump of test.jpg. With the help of **ghex editor**, we are going to replace some hex chars and save them.

Press enter or click to view image in full size

![]()

As we know the first `FF D8` is the start of the image, the next two bytes represent the upcoming two bytes, `00 10` represents the length of the JPEG header which in decimal equivalent is 16 bytes.

## Time for Injection

We are going to inject our payload in between `FF E0` and `FF DB` . Let’s start with `2F 2A` which is hex representation of /\*

Press enter or click to view image in full size

![]()

> *If you notice we just replaced* `00 10` *previously with* `2F 2A` *and the decimal equivalent of hex* `2F 2A` *is 12074 bytes. So now the image header is changed from 16 bytes to 12074 bytes.*

![]()

From the screenshot above, we can see the size of our payload is 18 bytes so we have to pad out the remaining bytes with nulls that is 12074–16–18=12040 bytes.

Press enter or click to view image in full size

![]()

The above commands will read the test.jpg, insert our payload in between `2F 2A FF DB` changes the hex into buffer, add 12040 null bytes and write it to the file test\_new.jpg. Now in the ghex editor close the comment tag before `FF D9`

![]()

hexdump of test\_new.jpeg (modified)

```
Code to execute image as javascript:-<script charset="ISO-8859-1" src="test_new.jpeg">
```

On Firefox when using a UTF-8 character set for the document it corrupts the polyglot when included as an script! So to get the script to work we need to specify the ISO-8859–1 charset on the script tag and it executes fine.

Let’s test it in the browser.

Press enter or click to view image in full size

![]()

Our **javascript/jpeg polyglot** works!

> *Update: Mozilla* [*fixed this in Firefox 51*](https://bugzilla.mozilla.org/show_bug.cgi?id=1288361) *and after versions.*

Share with your friends if you found it interesting.

Thank you for reading.

### From Infosec Writeups: A lot is coming up in the Infosec every day that it’s hard to keep up with. [Join our weekly newsletter](https://weekly.infosecwriteups.com/) to get all the latest Infosec trends in the form of 5 articles, 4 Threads, 3 videos, 2 GitHub Repos and tools, and 1 job alert for FREE!

[Xss Attack](https://medium.com/tag/xss-attack?source=post_page-----4cff06f8201a---------------------------------------)

[Bug Bounty](https://medium.com/tag/bug-bounty?source=post_page-----4cff06f8201a---------------------------------------)

[Cybersecurity](https://medium.com/tag/cybersecurity?source=post_page-----4cff06f8201a---------------------------------------)

[JavaScript](https://medium.com/tag/javascript?source=post_page-----4cff06f8201a---------------------------------------)

[Vulnerability](https://medium.com/tag/vulnerability?source=post_page-----4cff06f8201a---------------------------------------)

--

--

7

[![InfoSec Write-ups](https://miro.medium.com/v2/resize:fill:96:96/1*SWJxYWGZzgmBP1D0Qg_3zQ.png)](https://infosecwriteups.com/?source=post_page---post_publication_info--4cff06f8201a---------------------------------------)

[![InfoSec Write-ups](https://miro.medium.com/v2/resize:fill:128:128/1*SWJxYWGZzgmBP1D0Qg_3zQ.png)](https://infosecwriteups.com/?...