---
title: 格式化字符串漏洞：任意写
url: https://blog.csdn.net/winsunxu/article/details/128889258
source: 深度技术安全
date: 2023-02-06
fetch_date: 2025-10-04T05:47:17.744092
---

# 格式化字符串漏洞：任意写

# 格式化字符串漏洞：任意写

最新推荐文章于 2024-08-13 05:00:00 发布

![](https://csdnimg.cn/release/blogv2/dist/pc/img/original.png)

[![](https://csdnimg.cn/release/blogv2/dist/pc/img/identityVipNew.png)](https://mall.csdn.net/vip)
[winsunxu](https://blog.csdn.net/winsunxu "winsunxu")
![](https://csdnimg.cn/release/blogv2/dist/pc/img/newCurrentTime2.png)
最新推荐文章于 2024-08-13 05:00:00 发布

![](https://csdnimg.cn/release/blogv2/dist/pc/img/articleReadEyes2.png)
阅读量540
![](https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollect2.png)
![](https://csdnimg.cn/release/blogv2/dist/pc/img/tobarCollectionActive2.png)
收藏

1

![](https://csdnimg.cn/release/blogv2/dist/pc/img/newHeart2023Active.png)
![](https://csdnimg.cn/release/blogv2/dist/pc/img/newHeart2023Black.png)
点赞数

CC 4.0 BY-SA版权

分类专栏：
[linux漏洞利用技术](https://blog.csdn.net/winsunxu/category_12171646.html)
文章标签：
[linux](https://so.csdn.net/so/search/s.do?q=linux&t=all&o=vip&s=&l=&f=&viparticle=&from_tracking_code=tag_word&from_code=app_blog_art)
[系统安全](https://so.csdn.net/so/search/s.do?q=%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8&t=all&o=vip&s=&l=&f=&viparticle=&from_tracking_code=tag_word&from_code=app_blog_art)
[pwn](https://so.csdn.net/so/search/s.do?q=pwn&t=all&o=vip&s=&l=&f=&viparticle=&from_tracking_code=tag_word&from_code=app_blog_art)

版权声明：本文为博主原创文章，遵循 [CC 4.0 BY-NC-SA](http://creativecommons.org/licenses/by-nc-sa/4.0/) 版权协议，转载请附上原文出处链接和本声明。

本文链接：<https://blog.csdn.net/winsunxu/article/details/128889258>

## 漏洞程序vuln.c

```
#include <stdio.h>

int auth = 0;

int main() {
    char password[100];

    puts("Password: ");
    fgets(password, sizeof password, stdin);

    printf(password);
    printf("Auth is %i\n", auth);

    if(auth == 10) {
        puts("Authenticated!");
    }
  }
```

## 程序分析

### 1. 编译

gcc -m32 -no-pie -fno-stack-protector -z execstack vuln.c -o vuln

程序保护：

```
└─$ checksec --file=./vuln
[*] '/home/kali/exploits/str_arb_write/vuln'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
```

![](https://csdnimg.cn/release/blogv2/dist/pc/img/lock.png)最低0.47元/天 解锁文章

200万优质内容无限畅学

![](https://csdnimg.cn/release/blogv2/dist/pc/img/vip-limited-close-newBlack.png)

确定要放弃本次机会？

福利倒计时

*:*

*:*

![](https://csdnimg.cn/release/blogv2/dist/pc/img/vip-limited-close-roup.png)
立减 ¥

普通VIP年卡可用

[立即使用](https://mall.csdn.net/vip)

[![](https://profile-avatar.csdnimg.cn/f8402e4ea45942fba4bc0eb4a51c8d70_winsunxu.jpg!1)

winsunxu](https://blog.csdn.net/winsunxu)

关注
关注

* ![](https://csdnimg.cn/release/blogv2/dist/pc/img/tobarThumbUpactive.png)
  ![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/like-active.png)
  ![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/like-dark.png)

  0

  点赞
* ![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/unlike-active.png)
  ![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/unlike-dark.png)

  踩
* ![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/collect-active.png)
  ![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/collect-dark.png)
  ![](https://csdnimg.cn/release/blogv2/dist/pc/img/newCollectActive.png)

  1

  收藏

  觉得还不错?
  一键收藏
  ![](https://csdnimg.cn/release/blogv2/dist/pc/img/collectionCloseBlack.png)
* ![](https://csdnimg.cn/release/blogv2/dist/pc/img/guideRedReward01.png)
  知道了

  [![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/comment-dark.png)

  0](#commentBox)

  评论
* ![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/share-dark.png)
  分享

  复制链接

  分享到 QQ

  分享到新浪微博

  ![](https://csdnimg.cn/release/blogv2/dist/pc/img/share/icon-wechat.png)扫一扫
* ![打赏](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/reward-dark.png)
  打赏

  打赏
* ![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/more-dark.png)

  ![打赏](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/reward-dark.png)
  打赏
  ![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/report-dark.png)
  举报

  ![](https://csdnimg.cn/release/blogv2/dist/pc/img/toolbar/report-dark.png)
  举报

专栏目录

[*格式化**字符串**任意*地址*写*入、函数指针执行shellcode——攻防世界string复现及知识点简述](https://blog.csdn.net/qq_37396476/article/details/108200474)

[独沐晨霖](https://blog.csdn.net/qq_37396476)

08-24
![](https://csdnimg.cn/release/blogv2/dist/pc/img/readCountBlack.png)
1293

[文章目录原题复现——攻防世界string*漏洞*分析攻击思路exp要注意的小细节
原题复现——攻防世界string
*漏洞*分析
题目去除了符号表，简单分析即可还原函数功能，用ida改名即可
先进行基础检查，是64位程序，未开启PIE
main函数中会给出v3[0]和v3[1]的地址
游戏开始需要输入角色名称，无利用点
go\_east函数，没有可以利用的地方，必须输east才能继续游戏
许愿函数，读入用户输入地址以及format，可以结合main函数给我们的地址进行*任意*地址*写*利用
.](https://blog.csdn.net/qq_37396476/article/details/108200474)

[2019.11.3 unctf babyfmt （*格式化**字符串**任意*地址的读和*写*）](https://blog.csdn.net/DSR446/article/details/102883662)

[DSR446的博客](https://blog.csdn.net/DSR446)

11-03
![](https://csdnimg.cn/release/blogv2/dist/pc/img/readCountBlack.png)
1838

[i春秋的一篇关于*格式化**字符串*文章把*任意*地址的读和*写*讲的很清晰：
https*:*//bbs.ichunqiu.com/thread-43624-1-1.html
方法一：先输入一个 %p 泄露出数组的首地址，再retn处下个断点，用返回地址减去数组的首地址，计算出他们之间的相对偏移。因为栈的地址每次都是变化的，所以我们每次都要泄露栈的地址，然后计算出返回地址。
重要的步骤就是利用fmtstr\_pa...](https://blog.csdn.net/DSR446/article/details/102883662)

参与评论
您还未登录，请先
登录
后发表或查看评论

[利用*格式化**字符串**漏洞*实现*任意*地址读*写*](https://devpress.csdn.net/v1/article/detail/130969393)

[个人笔记](https://blog.csdn.net/song_lee)

06-01
![](https://csdnimg.cn/release/blogv2/dist/pc/img/readCountBlack.png)
5640

[理解*格式化**字符串**漏洞*关键还是在于理解栈空间布局，*任意*地址*写*初学者接触到可能较为抽象，但是结合栈空间布局以及*格式化**字符串*的原理，详细我们就能对*格式化**字符串*有个更加清晰的认知。如果能够复现上述*漏洞*案例，那么恭喜你，已经完成了 *pwn* *格式化**字符串**漏洞*这一旅程。](https://devpress.csdn.net/v1/article/detail/130969393)

[*pwn*刷题num26-----*格式化**字符串**漏洞*实现*任意*地址修改](https://blog.csdn.net/tbsqigongzi/article/details/124439524)

[tbsqigongzi的博客](https://blog.csdn.net/tbsqigongzi)

04-27
![](https://csdnimg.cn/release/blogv2/dist/pc/img/readCountBlack.png)
549

[BUUCTF-*PWN*-[第五空间2019 决赛]*PWN*5
首先查保护–>看链接类型–>赋予程序可执行权限–>试运行
32位程序，小端序
开启部分RELRO-----got表可*写*
开启canary保护-----栈溢出需绕过canary
开启NX保护-----堆栈不可执行
未开启PIE-----程序地址为真实地址
动态链接
程序运行后首先输入一个name
然后输入密码（passwd）
最后fail
ida看一下伪代码
观察主函数，发现*格式化**字符串**漏洞*
printf*(*&buf*);*](https://blog.csdn.net/tbsqigongzi/article/details/124439524)

[*格式化**字符串*](https://blog.csdn.net/guiliandudu216/article/details/108328463)

[guiliandudu216的博客](https://blog.csdn.net/guiliandudu216)

08-31
![](https://csdnimg.cn/release/blogv2/dist/pc/img/readCountBlack.png)
306

[1.拼接*字符串*
s = 'pinjie'
print*(*'s = '+ s*)*
2.参数传递
s = 'chuandi'
print*(*'abc','bcd'*)*
print*(*'s =',s*)*
3.占位符
在创建*字符串*的时候可以在*字符串*中指定占位符
%s *任意*的字符
%f *任意*的小数
%d *任意*的整数
s = "占位符"
s = 's = %s' % 'hello'
s = 's = %d' % 10
s = 's = %f' % 3.14
s = 's = %s,s2 = %s'%*(*'hello','wo](https://blog.csdn.net/guiliandudu216/article/details/108328463)

[*格式化**字符串**漏洞*

最新发布](https://blog.csdn.net/qq_67812668/article/details/141144027)

[qq\_67812668的博客](https://blog.csdn.net/qq_67812668)

08-13
![](https://csdnimg.cn/release/blogv2/dist/pc/img/readCountBlack.png)
1084

[*格式化**字符串*是一种很常见的*漏洞*，其产生根源是printf函数设计的缺陷，即printf*(**)*函数并不能确定数据参数arg1,arg2…究竟在什么地方结束，也就是说，它不知道参数的个数。它只会根据format中的打印格式的数目依次打印堆栈中参数format后面地址的内容
格式*字符串**漏洞*发生的条件就是格式*字符串*要求的参数和实际提供的参数不匹配。](https://blog.csdn.net/qq_67812668/article/details/141144027)

[Canary机制及绕过策略-*格式化**字符串**漏洞*泄露Canary](https://download.csdn.net/download/weixin_38650842/14942022)

01-27

[例如，设置断点查看Canary，并通过*格式化**字符串**漏洞*来泄露Canary的值。在`printf`函数处下断点，利用*格式化**字符串*的 `%n` 或其他方式来读取栈上的内存。通过计算偏移量，可以找出Canary相对于栈上其他已知地址的位置...](https://download.csdn.net/download/weixin_38650842/14942022)

[*pwn*学习笔记（5）--*格式化**字符串**漏洞*（未完全完成）](https://blog.csdn.net/qq_66013948/article/details/136491699)

[qq\_66013948的博客](https://blog.csdn.net/qq_66013948)

03-05
![](https://csdnimg.cn/release/blogv2/dist/pc/img/readCountBlack.png)
1713

[​ *格式化**字符串*函数可以接收可变数量的参数，并将第一个参数作为*格式化**字符串*，根据其来解析之后的参数*格式化**字符串*函数*格式化**字符串*[后续参数]](https://blog.csdn.net/qq_66013948/article/details/136491699)

[C语言基础之*格式化*占位符](https://blog.csdn.net/weixin_39187443/article/details/118730026)

[weixin\_39187443的博客](https://blog.csdn.net/weixin_39187443)

07-14
![](https://csdnimg.cn/release/blog...