---
title: 行为正则化与顺序策略优化结合的离线多智能体学习算法
url: https://tech.meituan.com/2025/02/21/marl-in-meituan.html
source: 美团技术团队
date: 2025-02-22
fetch_date: 2025-10-06T20:32:39.326499
---

# 行为正则化与顺序策略优化结合的离线多智能体学习算法

[ç¾å¢ææ¯å¢é](https://tech.meituan.com/ "ç¾å¢ææ¯å¢é")

* [ææ°æç«](https://tech.meituan.com/ "æ¥çææ°æç«")
* [æç« å­æ¡£](/archives "æ¥çæç«")
* [ææ¯æ²é¾](/tech-salon "äºè§£ææ¯æ²é¾")
* [å³äºæä»¬](/about "äºè§£æ´å¤å")

Â© 2023 ç¾å¢ææ¯å¢é

All rights reserved.

# [è¡ä¸ºæ­£ååä¸é¡ºåºç­ç¥ä¼åç»åçç¦»çº¿å¤æºè½ä½å­¦ä¹ ç®æ³](https://tech.meituan.com/2025/02/21/marl-in-meituan.html)

2025å¹´02æ21æ¥
ä½è: å±¥çº¦å¹³å°ææ¯é¨
[æç« é¾æ¥](https://tech.meituan.com/2025/02/21/marl-in-meituan.html)
5805å­
12åééè¯»

ç¦»çº¿å¤æºè½ä½å¼ºåå­¦ä¹ ï¼MARLï¼æ¯ä¸ä¸ªæ°å´é¢åï¼ç®æ æ¯å¨ä»é¢åæ¶éçæ°æ®éä¸­å­¦ä¹ æä½³çå¤æºè½ä½ç­ç¥ãç¸æ¯äºåæºè½ä½æåµï¼å¤æºè½ä½ç¯å¢æ¶åå°å¤§è§æ¨¡çèåç¶æââå¨ä½ç©ºé´åå¤æºè½ä½é´çè¦åè¡ä¸ºï¼è¿ç»ç¦»çº¿ç­ç¥ä¼åå¸¦æ¥äºé¢å¤çå¤ææ§ãéçäººå·¥æºè½ææ¯çåå±ï¼å¤æºè½ä½ç³»ç»å¨è¯¸å¦èªå¨é©¾é©¶ãæºè½å®¶å±ãæºå¨äººåä½ä»¥åæºè½è°åº¦å³ç­ç­æ¹é¢å±ç°äºå·¨å¤§çåºç¨æ½åãä½æ¯ç¦»çº¿MARLè¾åæºè½ä½æåµä¸æ´å å¤æï¼å¶æ¶ååºå¤§çèåç¶æ-å¨ä½ç©ºé´åå¤æºè½ä½é´çå¤æäºå¨è¡ä¸ºï¼è¿ä½¿å¾ç¦»çº¿ç­ç¥ä¼åæä¸ºä¸é¡¹è°å·¨çä»»å¡ã

ç¦»çº¿MARLé¢ä¸´çä¸»è¦ææåæ¬ï¼ä¸æ¯å¦ä½ææåºå¯¹åå¸åç§»é®é¢ï¼å³å¨ç­ç¥è¯ä¼°è¿ç¨ä¸­ï¼åå¸å¤ï¼OODï¼æ ·æ¬å¯è½å¯¼è´è¯¯å·®ç§¯ç´¯ï¼äºæ¯å¨å¤æºè½ä½ç¯å¢ä¸ï¼åè°å¤ä¸ªæºè½ä½çè¡ä¸ºæ¾å¾å°¤ä¸ºå°é¾ãç°æçç¦»çº¿MARLæ¹æ³å°½ç®¡åå¾äºä¸äºè¿å±ï¼ä½ä»å­å¨ä¸åè°è¡ä¸ºååå¸å¤èåå¨ä½çé®é¢ãä¸ºäºåºå¯¹è¿äºææï¼ä¸­å±±å¤§å­¦è®¡ç®æºå­¦é¢ãç¾å¢å±¥çº¦å¹³å°ææ¯é¨å¼å±äºå­¦æ¯åä½é¡¹ç®ï¼èåæåºäºä¸ç§æ°é¢çç¦»çº¿MARLç®æ³ââæ ·æ¬åé¡ºåºç­ç¥ä¼åï¼In-Sample Sequential Policy Optimization, InSPOï¼ï¼è¯¥æ¹æ³éè¿é¡ºåºæ´æ°æ¯ä¸ªæºè½ä½çç­ç¥ï¼é¿åéæ©OODèåå¨ä½ï¼åæ¶å¢å¼ºäºæºè½ä½ä¹é´çåè°æ§ã

2024å¹´12æ11 æ¥ï¼ä¸­å±±å¤§å­¦è®¡ç®æºå­¦é¢çåå®å¯ãæè°¦ãä½è¶åä¼å¤å¨ç­å­¦æ¯ççä¸å®¶åææï¼è·ç¾å¢ææ¯å¢éèååè¡¨äºä¸ç¯ææ¯è®ºæãOffline Multi-Agent Reinforcement Learning via In-Sample Sequential Policy Optimizationãï¼[è®ºæä¸è½½](https://arxiv.org/pdf/2412.07639)ï¼ãç ç©¶å¢éçä¸»è¦è´¡ç®å¨äºæåºäºInSPOç®æ³ï¼è¯¥ç®æ³ä¸ä»é¿åäºOODèåå¨ä½ï¼è¿éè¿æ¢ç´¢è¡ä¸ºç­ç¥ä¸­çä½æ¦çå¨ä½ï¼è§£å³äºæåæ¶æå°æ¬¡ä¼è§£çé®é¢ãçè®ºä¸InSPOä¿è¯äºç­ç¥çåè°æ¹è¿ï¼å¹¶æ¶æå°éåååºåè¡¡ï¼QREï¼ãå®éªç»æè¡¨æï¼InSPOå¨å¤ä¸ªç¦»çº¿MARLä»»å¡ä¸­è¡¨ç°åºäºæ¾èçææï¼ä¸å½åæåè¿çæ¹æ³ç¸æ¯å·æææ¾çä¼å¿ã

## åä½åé©¬å°å¯å¤«åå¼

å¨çè§£ç¦»çº¿å¤æºè½ä½å¼ºåå­¦ä¹ ï¼MARLï¼ä¸­çæ ·æ¬åé¡ºåºç­ç¥ä¼åä¹åï¼é¦åéè¦äºè§£åä½åé©¬å°å¯å¤«åå¼çåºæ¬æ¦å¿µåæ¡æ¶ã

![å¾1ï¼XORåå¼ï¼aï¼æ¯èåè¡å¨çå¥å±ç©éµï¼bï¼æ¯æ°æ®éçåå¸](https://p0.meituan.net/meituantechblog/8bae7287de099ebc2a918d8f6986365636496.png)

### å®ä¹ä¸åºæ¬æ¦å¿µ

![](https://p0.meituan.net/meituantechblog/6d2cb2487ad38c1fc6113eff1e93b1ce120808.png)

### IGMååä¸å¼åè§£

å¨å¤æºè½ä½ç³»ç»ä¸­ï¼ç´æ¥è®¡ç®èåQå½æ°æ¯ä¸ä¸ªæå¶å¤æçé®é¢ï¼å ä¸ºç¶æ-å¨ä½ç©ºé´ä¼éçæºè½ä½æ°éçå¢å èææ°çº§å¢é¿ãå¼åè§£æ¹æ³éè¿å°èåQå½æ°åè§£ä¸ºæ¯ä¸ªæºè½ä½çä¸ªä½Qå½æ°ï¼æå¤§å°ç®åäºè¿ä¸ªè®¡ç®è¿ç¨ãå·ä½æ¥è¯´ï¼èåQå½æ°Q(s,a)è¢«è¡¨ç¤ºä¸ºæ¯ä¸ªæºè½ä½Qå½æ°$Q\_i$çç»åãè¿ç§åè§£æ¹å¼ä¾èµäºä¸ªä½-å¨å±-æå¤§åï¼IGMï¼ååï¼å³æä¼èåå¨ä½å¯ä»¥éè¿æ¯ä¸ªæºè½ä½çè´ªå©ªå¨ä½æ¥è¯å«ãç¶èï¼è¿ç§æ¹æ³å¨å¤çç¯å¢ä¸­å­å¨å¤æ¨¡æå¥å±å¾è°±æ¶å¯è½ä¼éå°å°é¾ï¼å ä¸ºIGMåè®¾å¾å¾ä¼è¢«ç ´åã

![å¾2ï¼M-NEåå¼ï¼aï¼æ¯èåè¡å¨çå¥å±ç©éµï¼bï¼æ¯æ°æ®éçåå¸](https://p0.meituan.net/meituantechblog/b38b6e530f683abb2fa295ce3c01dece44952.png)

### ç¦»çº¿MARLä¸­çè¡ä¸ºæ­£ååé©¬å°å¯å¤«åå¼

ä¸ºäºææåºå¯¹ç¦»çº¿MARLä¸­çåå¸åç§»é®é¢ï¼è¡ä¸ºæ­£ååé©¬å°å¯å¤«åå¼å¼å¥äºä¸ä¸ªä¸æ°æ®ç¸å³çæ­£ååé¡¹ãè¿ä¸ªæ­£ååé¡¹éè¿å¨å¥å±å½æ°ä¸­å å¥é¢å¤çæ©ç½ï¼è¿«ä½¿å­¦ä¹ å°çç­ç¥å°½éæ¥è¿è¡ä¸ºç­ç¥ï¼ä»èé¿åéæ©åå¸å¤çå¨ä½ãå¨è¿ä¸ªæ¡æ¶ä¸­ï¼ç­ç¥çç®æ æ¯æå¤§åææææ£åæ¥ï¼åæ¶åå»æ­£ååé¡¹ï¼ä»¥æ­¤å¹³è¡¡ç­ç¥çæ¢ç´¢åå©ç¨ãè¿æ ·ä¸ä»æé«äºç­ç¥çç¨³å®æ§ï¼è¿è½é²æ­¢å¶æ¶æå°å±é¨æä¼è§£ã

éè¿å¼å¥è¿äºåºç¡æ¦å¿µååçï¼åä½åé©¬å°å¯å¤«åå¼ä¸ºå¤æºè½ä½ç³»ç»çè¡ä¸ºå»ºæ¨¡åä¼åæä¾äºä¸ä¸ªå¼ºå¤§çå·¥å·ãå°¤å¶å¨ç¦»çº¿ç¯å¢ä¸­ï¼ç»åè¡ä¸ºæ­£åååå¼åè§£æ¹æ³ï¼å¯ä»¥ææè§£å³å¤æºè½ä½é´çåè°é®é¢ï¼å¹¶æé«ç­ç¥çæ´ä½è¡¨ç°ã

## æ ·æ¬åé¡ºåºç­ç¥ä¼å

å¨ç¦»çº¿å¤æºè½ä½å¼ºåå­¦ä¹ ï¼MARLï¼ä¸­ï¼ç­ç¥çä¼åå¾å¾é¢ä¸´çåå¸å¤ï¼OODï¼èåå¨ä½åå±é¨æä¼è§£é®é¢ãä¸ºäºåºå¯¹è¿äºææï¼ç ç©¶å¢éæåºäºä¸ç§åæ°çæ¹æ³ââæ ·æ¬åé¡ºåºç­ç¥ä¼åï¼In-Sample Sequential Policy Optimization, InSPOï¼ãè¯¥æ¹æ³å¨è¡ä¸ºæ­£ååé©¬å°å¯å¤«åå¼æ¡æ¶ä¸è¿è¡ï¼ç»åäºéKLæ£åº¦åæå¤§çµæ­£ååï¼æ¨å¨éè¿é¡ºåºæ´æ°æ¯ä¸ªæºè½ä½çç­ç¥ï¼é¿åéæ©OODèåå¨ä½ï¼åæ¶å¢å¼ºæºè½ä½ä¹é´çåè°ã

### æ ·æ¬åé¡ºåºç­ç¥ä¼åçæ°å­¦æ¨å¯¼

InSPOæ¹æ³çæ ¸å¿å¨äºéè¿éKLæ£åº¦è¿è¡è¡ä¸ºæ­£ååï¼ä»èç¡®ä¿å­¦ä¹ å°çç­ç¥ä¸è¡ä¸ºç­ç¥å±äº«ç¸åçæ¯æéï¼é¿åéæ©åå¸å¤çå¨ä½ãå·ä½æ¥è¯´ï¼ç®æ å½æ°ä¸­çéKLæ£åº¦é¡¹å¯ä»¥åè§£ä¸ºåä¸ªæºè½ä½çç¬ç«é¡¹ï¼è¿ä½¿å¾é¡ºåºæ´æ°æ¯ä¸ªæºè½ä½çç­ç¥æä¸ºå¯è½ãæ°å­¦ä¸éè¿ä½¿ç¨Karush-Kuhn-Tuckerï¼KKTï¼æ¡ä»¶ï¼æ¨å¯¼åºç®æ å½æ°çé­å¼è§£ï¼ä»èå®ç°æ ·æ¬åå­¦ä¹ ãæç»çä¼åç®æ ä¸ºæå°åKLæ£åº¦ï¼ä»¥ç¡®ä¿ç­ç¥æ´æ°çæææ§åä¸è´æ§ã

### æå¤§çµè¡ä¸ºæ­£ååé©¬å°å¯å¤«åå¼

ä¸ºäºè¿ä¸æ­¥å¢å¼ºæ¢ç´¢æ§ï¼é²æ­¢ç­ç¥è¿æ©æ¶æå°å±é¨æä¼è§£ï¼InSPOå¼å¥äºæå¤§çµè¡ä¸ºæ­£ååé©¬å°å¯å¤«åå¼ï¼MEBR-MGï¼æ¡æ¶ãå¨è¿ä¸ªæ¡æ¶ä¸­ï¼ç­ç¥ä¼åçç®æ å½æ°ä¸ä»åå«éKLæ£åº¦é¡¹ï¼è¿å¼å¥äºç­ç¥çµé¡¹ãéè¿è¿ç§æ¹å¼ï¼ä¼åç®æ è½å¤ä¿ä½¿ç­ç¥å¨é«æ¦çå¨ä½åä½æ¦çå¨ä½ä¹é´ä¿æå¹³è¡¡ï¼é¼å±ååæ¢ç´¢ä½æ¦çå¨ä½ï¼ä»èé¿åå±é¨æä¼è§£ãçè®ºä¸ï¼æå¤§çµè¡ä¸ºæ­£ååè¿è½å¤ç¡®ä¿ç­ç¥æ¶æå°éåååºåè¡¡ï¼QREï¼ï¼å³å¨é¢å¯¹æ°å¨å¥å±æ¶ï¼ç­ç¥ä»è½ç»´æç¨³å®çæ§è½ã

éè¿ä¸è¿°æ¹æ³ï¼æ ·æ¬åé¡ºåºç­ç¥ä¼åä¸ä»ææè§£å³äºç¦»çº¿MARLä¸­çOODèåå¨ä½é®é¢ï¼è¿éè¿ç­ç¥çµçå¼å¥ï¼æ¾èæé«äºç­ç¥çæ¢ç´¢è½ååå¨å±æä¼è§£çåç°æ¦çã

## ç®æ³ç»è

**ç®æ³ 1: InSPO çæ­¥éª¤**

InSPOç®æ³çæ ¸å¿å¨äºéè¿é¡ºåºæ´æ°çæ¹å¼ï¼éæ­¥ä¼åæ¯ä¸ªæºè½ä½çç­ç¥ï¼æç»å®ç°å¨å±æä¼ãå·ä½æ­¥éª¤å¦ä¸ï¼

1. è¾å¥ï¼ç¦»çº¿æ°æ®éDãåå§ç­ç¥$\pi\_0$ååå§Qå½æ°$Q\_0$ã
2. è¾åºï¼æç»ç­ç¥$\pi\_K$ã
3. é¦åï¼éè¿ç®åçè¡ä¸ºåéæ¹æ³è®¡ç®åºè¡ä¸ºç­ç¥$\mu$ã
4. æ¥ä¸æ¥ï¼å¼å§è¿­ä»£ä¼åãå¨æ¯ä¸è½®è¿­ä»£ä¸­ï¼åè®¡ç®åºå½åQå½æ°$Q\_k$ã
5. éæºæ½åä¸ä¸ªæºè½ä½çæå$i\_{1:N}$ï¼å¹¶ä¾æ¬¡æ´æ°æ¯ä¸ªæºè½ä½çç­ç¥ã
6. å¯¹äºæ¯ä¸ªæºè½ä½ï¼ä½¿ç¨æ¨å¯¼åºçç®æ å½æ°è¿è¡ç­ç¥æ´æ°ã
7. éå¤ä¸è¿°è¿ç¨ï¼ç´å°è¾¾å°é¢å®çè¿­ä»£æ¬¡æ°Kã

è¿ç§é¡ºåºæ´æ°çç­ç¥ï¼ç¡®ä¿äºæ¯ä¸æ­¥çç­ç¥ä¼åé½æ¯å¨æ ·æ¬åè¿è¡çï¼é¿åäºåå¸å¤å¨ä½çéæ©ï¼æé«äºç­ç¥çç¨³å®æ§åæææ§ã

### ç­ç¥è¯ä¼°

ç­ç¥è¯ä¼°æ¯InSPOç®æ³ä¸­çä¸ä¸ªå³é®æ­¥éª¤ãæ ¹æ®æ´æ°çQå½æ°ï¼è®¡ç®å½åç­ç¥ç...