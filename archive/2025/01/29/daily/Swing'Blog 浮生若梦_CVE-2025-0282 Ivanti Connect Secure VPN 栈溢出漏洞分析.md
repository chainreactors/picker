---
title: CVE-2025-0282 Ivanti Connect Secure VPN 栈溢出漏洞分析
url: https://bestwing.me/CVE-2025-0282-Ivanti-Connect-Secure-VPN-stack-overflow.html
source: Swing'Blog 浮生若梦
date: 2025-01-29
fetch_date: 2025-10-06T20:06:25.131909
---

# CVE-2025-0282 Ivanti Connect Secure VPN 栈溢出漏洞分析

* [Home](/)
* [About](/about/)
* [Articles](/archives/)
* [Search](/search)
* [RSS](/atom.xml)
* [Categories](/categories/)
* [Links](/link)

Previous post
Next post
Back to top
Share post

1. [1. TL; DR](#TL-DR)
2. [2. 固件提取](#%E5%9B%BA%E4%BB%B6%E6%8F%90%E5%8F%96)
   1. [2.1. decrypt](#decrypt)
   2. [2.2. shell 获取](#shell-%E8%8E%B7%E5%8F%96)
3. [3. CVE-2025-0282](#CVE-2025-0282)
   1. [3.1. Diff patched](#Diff-patched)
   2. [3.2. PoC](#PoC)
   3. [3.3. exploit](#exploit)
4. [4. Reference link](#Reference-link)

# CVE-2025-0282 Ivanti Connect Secure VPN 栈溢出漏洞分析

Swing

2025-01-29

[漏洞分析](/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/)

[CVE-2025-0282](/tags/CVE-2025-0282/), [pulse](/tags/pulse/), [vpn](/tags/vpn/)

…

## TL; DR

2025年（暨蛇年）第一篇博客文章，顺便祝我的博客读者新春快乐吧。

1月9日 google 发布的 Ivanti Connect Secure VPN 设备的在野漏洞预警：

<https://cloud.google.com/blog/topics/threat-intelligence/ivanti-connect-secure-vpn-zero-day/>

1月10日 watchtowr 就发布了漏洞分析

<https://labs.watchtowr.com/do-secure-by-design-pledges-come-with-stickers-ivanti-connect-secure-rce-cve-2025-0282/>

1月10日我也发了我的漏洞复现推特： <https://x.com/bestswngs/status/1877715807506952486>

这次 diff版本2.3 build 3431 和 2.5， 特意留到了除夕夜发这篇文章..

## 固件提取

这部分内容依旧感谢我的同事 @explore 和 @leommxj的帮助， 具体流程如下：

添加磁盘到虚拟机里后， 用 `lvdisplay` 可以看到几个分区

|  |  |
| --- | --- |
| ``` 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 ``` | ``` ──(root㉿kali)-[/home/kali/Desktop] └─# lvdisplay   --- Logical volume ---   LV Path                /dev/groupA/home   LV Name                home   VG Name                groupA   LV UUID                vPWDHH-AlTq-GvBS-UAnf-orT1-yT2d-TdbWyK   LV Write Access        read/write   LV Creation host, time (none), 2025-01-09 17:28:21 -0500   LV Status              NOT available   LV Size                <4.87 GiB   Current LE             1246   Segments               1   Allocation             inherit   Read ahead sectors     auto       --- Logical volume ---   LV Path                /dev/groupA/runtime   LV Name                runtime   VG Name                groupA   LV UUID                dFDVOl-kYQR-J3N5-3HNC-toXc-9947-sj0yzc   LV Write Access        read/write   LV Creation host, time (none), 2025-01-09 17:28:39 -0500   LV Status              NOT available   LV Size                <19.46 GiB   Current LE             4981   Segments               2   Allocation             inherit   Read ahead sectors     auto       --- Logical volume ---   LV Path                /dev/groupZ/home   LV Name                home   VG Name                groupZ   LV UUID                cOTBS1-oaYw-PlAt-puTS-Uvq5-6C91-pK6QHK   LV Write Access        read/write   LV Creation host, time (none), 2024-10-07 06:47:49 -0400   LV Status              NOT available   LV Size                6.72 GiB   Current LE             1721   Segments               1   Allocation             inherit   Read ahead sectors     auto ``` |

可以看到这几个都是 lvm2 加密的， 没法直接 mount

|  |  |
| --- | --- |
| ``` 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 ``` | ``` ┌──(root㉿kali)-[/home/kali/Desktop] └─# fdisk -l Disk /dev/sdb: 80.09 GiB, 86000000000 bytes, 167968750 sectors Disk model: VMware Virtual S Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0xc45d0b27  Device     Boot Start       End   Sectors  Size Id Type /dev/sdb1  *     2048 167968749 167966702 80.1G 83 Linux   Disk /dev/sda: 80 GiB, 85899345920 bytes, 167772160 sectors Disk model: VMware Virtual S Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x00000000  Device     Boot     Start       End   Sectors  Size Id Type /dev/sda1           16065    224909    208845  102M 83 Linux /dev/sda2          224910    433754    208845  102M 83 Linux /dev/sda3          449820    658664    208845  102M 83 Linux /dev/sda4          674730 167766794 167092065 79.7G 85 Linux extended /dev/sda5          674731  14779799  14105069  6.7G 83 Linux /dev/sda6        14779801  30089744  15309944  7.3G 83 Linux /dev/sda7        30089746  65802239  35712494   17G 83 Linux /dev/sda8        65802241  81112184  15309944  7.3G 83 Linux /dev/sda9        81112186 116824679  35712494   17G 83 Linux /dev/sda10      116824681 132134624  15309944  7.3G 82 Linux swap / Solaris /dev/sda11      132134626 167766794  35632169   17G 83 Linux                                                                                                                                                              ┌──(root㉿kali)-[/home/kali/Desktop] └─# mount /dev/groupZ/home /mnt/runtime                                                                                                                                                              ┌──(root㉿kali)-[/home/kali/Desktop] └─# mount /dev/sda1 /mnt/runtime                                                                                                                                                                     ┌──(root㉿kali)-[/home/kali/Desktop] └─# ls /mnt/runtime  boot.b  compact-file  coreboot.img  disksize  grub  kernel  log_coreboot  lost+found  VERSION ``` |

我们在 `/dev/sda1` 找到了对应的 `kernel` 和 `coreboot.img`， 可以看看到 coreboot.img 作为initrd

|  |  |
| --- | --- |
| ``` 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 ``` | ``` └─# cat /mnt/runtime/grub/grub.cfg  set default=0 set timeout=5 insmod ext2 password 07ow3w3d743 serial --unit=0 --speed=9600 --word=8 --parity=no --stop=1 menuentry "Current" { set root=(hd0,2)     linux /kernel system=A rootdelay=5 console=ttyS0,115200n8 console=tty0 vm_hv_type=VMware        initrd /coreboot.img } menuentry "Factory Reset" { set root=(hd0,1)     linux /kernel system=Z noconfirm rootdelay=5 console=ttyS0,115200n8 console=tty0 vm_hv_type=VMware        initrd /coreboot.img } ``` |

### decrypt

coreboot.img 作为initrd

[![image.png](https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-21-ee05dc473ae5764c7ab74ac2a110f46a-38fd2f.png)](https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-21-ee05dc473ae5764c7ab74ac2a110f46a-38fd2f.png "image.png")

我们去将这里的 kernel 通过 vmlinux-to-elf 转换一下就可以逆向了， 在 kernel中`populate_rootfs`里面写死密钥的AES解密

|  |  |
| --- | --- |
| ``` 1 2 3 4 5 6 7 8 ``` | ``` >>> DRAMFS_AES_KEY = bytes.fromhex("13D7B32E2600B7747D80FBA8F8D5C7CA") >>> >>> realkey = strxor(DRAMFS_AES_KEY[:4][::-1], bytes.fromhex('99ED2BF2'))[::-1]   2 realkey += strxor(DRAMFS_AES_KEY[4:8][::-1], bytes.fromhex('AEEF41FE'))[::-1]   3 realkey += strxor(DRAMFS_AES_KEY[8:12][::-1], bytes.fromhex('141058C7'))[::-1]   4 realkey += strxor(DRAMFS_AES_KEY[12:16][::-1], bytes.fromhex('D2ED180E'))[::-1] >>> realkey b'\xe1\xfc^\xb7\xd8AX\xda\xba\xd8\xeb\xbc\xf6\xcd*\x18' ``` |

binary ninja 带有神奇的优化，
[![image.png](https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-21-fb9e3ca218c682ba175b92611e4cb934-dbe415.png)](https://sw-blog.oss-cn-hongkong.aliyuncs.com/img/2025-01-21-fb9e3ca218c682ba175b92611e4cb934-dbe415.png "image.png")
优化出来就是异或完的

|  |  |
| --- | --- |
| ``` 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ``` | ``` ffffffff826d0815            int64_t initrd_start_3 = initrd_start; ffffffff826d081c            int32_t initrd_end_1 = (*(uint32_t*)initrd_end); ffffffff826d082e            int64_t* rax_1 = crypto_alloc_base("aes", 0, 0); ffffffff826d0833            uint64_t i = (uint64_t)(initrd_end_1 - initrd_start_3); ffffffff826d083f            int64_t rcx_1; ffffffff826d083f            int64_t rdx_1; ffffffff826d083f            int64_t r8_1; ffffffff826d083f             ffffffff826d083f            if (rax_1 <= -0x1000) ffffffff826d083f            { ffffffff826d0875                int32_t var_6c_1 = 0xda5841d8; ffffffff826d0889                int32_t var_70 = 0xb75efce1; ffffffff826d08...