---
title: 一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】 - 渗透测试中心
url: https://www.cnblogs.com/backlion/p/17150742.html
source: 博客园 - 渗透测试中心
date: 2023-02-25
fetch_date: 2025-10-04T08:04:35.726687
---

# 一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】 - 渗透测试中心

[![](https://img2024.cnblogs.com/blog/35695/202509/35695-20250929100304557-587378723.jpg)](https://qoder.com/)

* [![博客园logo](//assets.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园")
* [会员](https://cnblogs.vip/)
* [众包](https://www.cnblogs.com/cmt/p/18500368)
* [新闻](https://news.cnblogs.com/)
* [博问](https://q.cnblogs.com/)
* [闪存](https://ing.cnblogs.com/)
* [赞助商](https://www.cnblogs.com/cmt/p/19081960)
* [HarmonyOS](https://harmonyos.cnblogs.com/)
* [Chat2DB](https://chat2db-ai.com/)

* ![搜索](//assets.cnblogs.com/icons/search.svg)
  ![搜索](//assets.cnblogs.com/icons/enter.svg)
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    所有博客
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    当前博客
* [![写随笔](//assets.cnblogs.com/icons/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔")
  [![我的博客](//assets.cnblogs.com/icons/myblog.svg)](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客")
  [![短消息](//assets.cnblogs.com/icons/message.svg)](https://msg.cnblogs.com/ "短消息")
  ![简洁模式](//assets.cnblogs.com/icons/lite-mode-on.svg)

  [![用户头像](//assets.cnblogs.com/icons/avatar-default.svg)](https://home.cnblogs.com/)

  [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx)
  [我的园子](https://home.cnblogs.com/)
  [账号设置](https://account.cnblogs.com/settings/account)
  [会员中心](https://vip.cnblogs.com/my)
  简洁模式 ...
  退出登录

  [注册](https://account.cnblogs.com/signup)
  登录

[![返回主页](/skins/custom/images/logo.gif)](https://www.cnblogs.com/backlion/)

# [渗透测试中心](https://www.cnblogs.com/backlion)

##

* [博客园](https://www.cnblogs.com/)
* [首页](https://www.cnblogs.com/backlion/)
* [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
* [联系](https://msg.cnblogs.com/send/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%BF%83)
* [管理](https://i.cnblogs.com/)
* 订阅
  [![订阅](/skins/coffee/images/xml.gif)](https://www.cnblogs.com/backlion/rss/)

# [一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://www.cnblogs.com/backlion/p/17150742.html "发布于 2023-02-24 11:40")

## 前言

一次攻防演练中首先是团队拿到了一个 Webshell ，后续又把权限弹到了 CobaltStrike 方便我来做内网渗透：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113904691-1861859810.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/3-1670143475.png)

通过发现当前机器是一台公网服务器，只有公网 IP：xxx.xxx.xxx.16

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113905728-1322381779.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/6-1670143476.png)

通过查看 arp 缓存发现当前是有一些公网机器的：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113906694-996692326.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/0-1670143477.png)

通过查询这些 IP 发现是"某网络"，而且通过 Nbtscan 发现当前 C 段有主机存活：（初步判断当前 C 段机器有可能存在域，但不确定）

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113907753-435073056.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/2-1670143482.png)

## 对当前第一层内网机器 C 段进行横向移动

由于是攻防演练，拿到越多的分数越好，在这里就不考虑一些其他问题，拿到当前机器后我抓到了明文密码：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113908609-1946604751.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/5-1670143483.png)

但是通过此密码去利用 MSF 对 C 段进行密码喷洒发现没有一台主机被成功横向出来：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113909675-1274157899.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/7-1670143484.png)

就在这个时候我又扫了一下看看有没有 MS17010：（一般来说向这种"某某网"基本上都有几台存在永恒之蓝，所以直接去扫就行）

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113910592-205743041.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/5-1670143486.png)

发现 92、151、200 这三台是存在 MS17010 的，随后打了 92 这台：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113911379-1933682523.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/3-1670143487.png)

随后 MSF 和 CS 联动，我把 MSF 的 shell 又弹到了 Cs，并且做了权限维持：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113912198-838193283.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/0-1670143487.png)

这个时候其实用这两台跳板机器就够了，另外两台存在 MS17010 没必要继续打，随后我对当前 C 段进行信息搜集，对 Web 资产进行扫描存活发现大量 Web 资产：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113913287-397035519.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/8-1670143488.png)

通过手工分析发现一枚 SQL 注入，而且是 DBA 权限：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113914148-71681062.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/7-1670143490.png)

然后添加了一个管理员用户然后开启了 3389 （因为有诺顿，常规免杀没时间弄了，主要拿分，索性直接登录服务器）

而且直接通过 socks 连接不了，感觉是做了限制，后续发现使用 `mstsc /admin` 是可以登录的：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113915104-1956259370.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/4-1670143490.png)

这个时候我用 92 这台机器当作跳板远程登录到 71 桌面：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113915992-714060266.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/7-1670143491.png)

随后克隆了 administrator 的桌面：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113916978-122992184.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/2-1670143491.png)

此时重新登录之前添加的账号到远程桌面就是 administrator 的桌面了：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113917838-541299111.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/4-1670143492.png)

通过一系列的信息搜集并且翻密码，拿到了 Mssql 和所有旁站的权限：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113918728-1116643481.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/3-1670143492.png)[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113919541-2008301675.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/2-1670143493.png)

通过已搜集到的密码去对 C 段继续密码喷洒成功喷洒出 C 段的一台 Mssql：xxx.xxx.xxx.239

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113920490-1995055409.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/6-1670143494.png)

后续直接调用 XP\_cmdshell 执行命令，发现权限还很大：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113921468-1817136248.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/6-1670143496.png)

随后直接利用 bitsadmin 上线到 cs：

[![一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】](https://img2023.cnblogs.com/blog/1049983/202302/1049983-20230224113922282-1220912435.png "一次在工作组的内网里渗透到第三层内网【从 0 到 1 打穿所有内网机器】")](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/12/7-1670143497.png)

此时已经拿到了：16、92、239 这三台机器的权限，但是还没有发现有内网，这个时候就陷入了瓶颈。

搞到这里发现横向不了，其他 Web 又不想...