---
title: Nothing new under the Sun – Discovering and exploiting a CDE bug chain
url: https://security.humanativaspa.it/nothing-new-under-the-sun/
source: hn security
date: 2023-01-19
fetch_date: 2025-10-04T04:17:05.502134
---

# Nothing new under the Sun – Discovering and exploiting a CDE bug chain

[![logo](https://hnsecurity.it/wp-content/uploads/2025/09/HN_Security_v2.svg)](https://hnsecurity.it/)

* [Home](https://hnsecurity.it)
* [Company](https://hnsecurity.it/company/)
* [Services](https://hnsecurity.it/services/)
  + [Red Teaming](https://hnsecurity.it/services/red-teaming/)
  + [DORA TLPT](https://hnsecurity.it/services/threat-led-penetration-test-dora/)
  + [AI Red Teaming](https://hnsecurity.it/services/ai-red-teaming/)
  + [Network Assessment](https://hnsecurity.it/services/network-assessment/)
  + [Web Assessment](https://hnsecurity.it/services/web-application-assessment/)
  + [Mobile Assessment](https://hnsecurity.it/services/mobile-application-assessment/)
  + [Mainframe Assessment](https://hnsecurity.it/services/mainframe-assessment/)
  + [Cloud Assessment](https://hnsecurity.it/services/cloud-assessment/)
  + [OT Assessment](https://hnsecurity.it/services/ot-assessment/)
  + [IoT Assessment](https://hnsecurity.it/services/iot-assessment/)
  + [Hardware Assessment](https://hnsecurity.it/services/hardware-assessment/)
  + [Security by Design](https://hnsecurity.it/services/security-by-design/)
* [Blog](https://hnsecurity.it/blog/)
* [Careers](https://hnsecurity.it/careers/)
* [Contacts](https://hnsecurity.it/contacts/)
* [![Italian](https://hnsecurity.it/wp-content/plugins/sitepress-multilingual-cms/res/flags/it.svg)](https://hnsecurity.it/it/blog/nothing-new-under-the-sun/ "Switch to ")

Get in touch

info@hnsecurity.it

![](https://hnsecurity.it/wp-content/uploads/2025/09/ORACLE-uai-836x836.jpg)

# Nothing new under the Sun – Discovering and exploiting a CDE bug chain

January 18, 2023|[![Marco Ivaldi](https://hnsecurity.it/wp-content/uploads/2025/09/Ivaldi-sm-150x150.jpg)](https://hnsecurity.it/blog/author/marco-ivaldi/)By [Marco Ivaldi](https://hnsecurity.it/blog/author/marco-ivaldi/)

[Exploits](https://hnsecurity.it/blog/category/exploits/ "View all posts in Exploits"), [Vulnerabilities](https://hnsecurity.it/blog/category/vulnerabilities/ "View all posts in Vulnerabilities")

> *“What has been will be again,*
> *what has been done will be done again;*
> *there is nothing new under the Sun.”*
> *— Ecclesiastes 1:9*

### TL;DR

We have identified multiple security vulnerabilities that are exploitable via the the setuid-root **dtprintinfo** binary from the Common Desktop Environment (CDE) distributed with **Oracle Solaris 10**:

* A bug in the parser of the lpstat external command invoked by dtprintinfo to list the names of available printers allows low-privileged local users to **inject arbitrary printer names**.
* This printer name injection allows low-privileged local users to manipulate the control flow of the target program and **disclose memory contents**.
* The ability to inject arbitrary printer names opens other attack vectors: as an example, we discovered **multiple icon parsing bugs** in the Motif library libXm that cause memory corruption.

We demonstrated the possibility to chain together the printer name injection bug and a stack-based buffer overflow in libXm to achieve **local privilege escalation to root on a fully-patched Solaris 10 system**.

Our detailed **advisory** is available here: <https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt>

Our proof-of-concept **exploit** is here: <https://github.com/0xdea/exploits/blob/master/solaris/raptor_dtprintlibXmas.c>

### Discovery

Following our last CDE [vulnerability disclosures](https://github.com/0xdea/raptor_infiltrate20), Oracle kindly shared with us a copy of their then current **Solaris 10 security patch set** (CPU January 2021), so that we could install it in our lab and verify the fixes for the bugs we had reported.

In addition to verifying these fixes, we decided to take a closer look at the **dtprintinfo** program distributed with CDE, because of its complexity and its impressive [historical record](https://www.exploit-db.com/search?q=dtprintinfo) of high-impact vulnerabilities.

After fruitlessly spending a few days reversing and auditing the patched version of dtprintinfo, we came up with the idea of using the **poor man’s fuzzer** below to quickly check for the presence of flaws in the parsing of the $HOME/.printers file:

```
$ cat /dev/urandom > ~/.printers
^C
```

Indeed, this led to immediate results. It turns out that it is possible to **inject fake printers** to be displayed by dtprintinfo. In addition, by manipulating the injected printer names, we were able to trigger an out-of-bound read and **disclose partial heap memory contents** of our target setuid-root binary. Check out the [advisory](https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt) for a detailed analysis of these two bugs.

Being able to inject arbitrary printer names is significant also because it opens other attack vectors that otherwise would not be available on systems without configured printers. One such vector we thought that was worth exploring is the **parsing of printer icons** in the [XPM format](https://www.xfree86.org/current/xpm.pdf). A low-privileged local user can supply his or her own icons for dtprintinfo to show by placing them in the $HOME/.dt/icons directory and selecting them in the X11 GUI. A bug in the XPM parser could easily lead to memory corruption and privilege escalation. To prove our point, we built a rudimentary **mutation fuzzer** written in Python and we unearthed a few icon parsing bugs in the **libXm library** used by CDE, originally part of the [Motif toolkit](http://www.opengroup.org/desktop/motif.html). Check out the [advisory](https://github.com/hnsecurity/vulns/blob/main/HNS-2022-01-dtprintinfo.txt) for additional details.

After our brief but intense artisanal fuzzing experience, it was time to go back to **static analysis** for a short while, specifically targeting the apparently weak libXm library parser. We fired up our [Rhabdomancer](https://github.com/0xdea/ghidra-scripts/blob/main/Rhabdomancer.java) Ghidra script to quickly find locations in the library where dangerous API functions are called, using them as starting points for our binary audit. Among some interesting candidate points, the following one stood up, in the familiar **ParseColors()** function that we had already encountered while analyzing the crashes produced by our XPM fuzzer:

```
int ParseColors(int *data, uint ncolors, uint cpp, undefined4
        *colorTablePtr, undefined4 hashtable)
{
    ...
    char local_83c[1024];
    char local_43c[1024];
    ...
    local_c = _XmxpmNextWord(local_34, local_83c, 0x400);
    ...
    local_83c[local_c] = '\0';
    strcat(local_43c, local_83c); /* VULN */
}
```

A perfect specimen of **stack-based buffer overflow**, caused by the reckless use of the insecure API function strcat(). This vulnerability can be triggered via a specially crafted XPM icon with long color strings.

### Exploitation

We have created a **proof-of-concept exploit** that chains together the printer name injection bug and the stack-based buffer overflow we have identified in libXm. It allows a low-privileged local user to escalate his or her privileges to those of the root user on Intel-based Solaris 10 systems with the latest patches installed (tested on CPU January 2021).

The [exploit code](https://github.com/0xdea/exploits/blob/master/solaris/raptor_dtprintlibXmas.c) is extensively commented and should be self-explanatory. Here it is in action.

[![](https://hnsecurity.it/wp-content/uploads/2022/01/dtprintlibXmas-1.gif)](https://hnsecurity.it/wp-content/uploads/2022/01/dtprintlibXmas-1.gif)

### Disclosure and Fix

The disclosure timeline spans exactly one year:

* **2022-01-18**: Oracle was notified via <secalert\_us@oracle.com>.
* **2022-01-19**: Oracle acknowledged our vulnerability reports.
* **2022-04-20**: Asked Oracle to provide an update on the patch release date.
* **2022-04-21**: Oracle replied they could not comment on the patch release date.
* **2022-09-03**: Asked Oracle for an update and infor...