---
title: Sayrud：因为不想重复写 CRUD，我把 18 岁那年开的坑填完了
url: https://github.red/hello-sayrud/
source: Light Cube
date: 2024-07-15
fetch_date: 2025-10-06T17:39:17.374620
---

# Sayrud：因为不想重复写 CRUD，我把 18 岁那年开的坑填完了

[![logo](/images/logo.svg)](https://github.red/)

[é¦é¡µ](/)

[å³äºæ](/about-me/)

[ç»æçè¨](/guestbook/)

[åæé¾æ¥](/my-friends/)

[æç« å½æ¡£](/archive/)

[æ´æ°æ¥å¿](/update-history/)

![Sayrudï¼å ä¸ºä¸æ³éå¤å CRUDï¼ææ 18 å²é£å¹´å¼çåå¡«å®äº](https://img13.360buyimg.com/ceco/jfs/t1/30929/23/21692/210666/6693d8baFff55323b/df72a53e6a6e281e.png.webp)

## Sayrudï¼å ä¸ºä¸æ³éå¤å CRUDï¼ææ 18 å²é£å¹´å¼çåå¡«å®äº

[2024-07-14](//hello-sayrud//)â¢
[ææ¯](/categories/%E6%8A%80%E6%9C%AF/)
â¢
5764 å­ / 12 åé

## å°å¹´ 18 å²æ¶çæ¢¦

è®°å¾æ 18 å²é£å¹´é«èå®å¨å®¶ï¼è¿æ²¡æ¾æ¾å å¤©å°±è¢«æç¸å¬çå»æ¾ä»½æåå·¥ä½ãå½æ¶æå¯¹å·¥ä½ä¸ç¹æ¦å¿µä¹æ²¡æï¼ç³äºä»½ç®åå°±å¨ 58 ååä¸ä¹±æï¼æå®ç¬¬äºå¤©è·ä¸å®¶å¬å¸çº¦äºçº¿ä¸èèï¼ç»æè¿çè®©æèå°ä¸ªå¨å®¶å¼èçå·¥ä½ã~~ï¼åæ¥åç°å¶å®å·¨ä¸é è°±ï¼~~

å·¥ä½åå®¹å¤§è´æ¯å¼åå¾®ä¿¡å°ç¨åºï¼æå½æ¶ä»æä¸ç¹èªå­¦çå¾®ä¿¡å°ç¨åºçå¼åç»éªå PHP CodeIgniter åç«¯ç»éªï¼å·®ä¸å¤è½ Hold ä½å¯¹é¢çéæ±ï¼çè³è¿å¨ GitHub ä¸ç»ä¸ä¸ªå°ç¨åºåç«¯ç»ä»¶åºæäº PRãï¼ç°å¨åè¿å¤´çå½ååçä»£ç ï¼ççæ¯âæ»¡ç®ç®çâââåç«¯ UI æ²¡å¯¹é½ï¼åç«¯ SQL æ³¨å¥æ»¡å¤©é£ï¼é»åå²äºå±äºæ¯ï¼

ç´å°å¤§å­¦å¼å­¦åï¼æåçä¸¤ä¸ªæéæç»é£è¾¹å¼åäºä¸¤ä¸ªå¾®ä¿¡å°ç¨åºãå ä¸ºæ¯æ¬¡é½è¦ç¨ CodeIgniter æ¡æ¶ååè½ç±»ä¼¼çåç«¯ï¼å¹´å°çæå¨æ³è½å¦æ MVC ç Model æä½æ°æ®åºï¼Controller å¤çé»è¾ï¼View è¿åååºç»å°è£æä¸ä¸ªçº¿ä¸çæå¡ï¼æå¨å¾å½¢åç Web é¡µé¢ä¸ç¹ç¹ç¹å°±å¯ä»¥å®ç°å»ºè¡¨ãéªè¯è¡¨åãå®ä¹ API æ¥å£ç­æä½ã

æè¢«èªå·±è¿ä¸ªå¤©æè¬çç¹å­æé¼èï¼ç¨ PHP åäº [WeBake](https://github.com/wuhan005/WeBake) ï¼å½æ¶çæ³æ³æ¯ç¨æ¥å¿«éæå»ºå¾®ä¿¡å°ç¨åºåç«¯ãå¹´å°çæä»¥ä¸ºèªå·±å¨ååäººä»æ¥æ²¡åè¿çä¸è¥¿ï¼æ²æµ¸å¶ä¸­å¹¶æèªçªåãç´å°è¿å¥å¤§å­¦çåä¸å¤©å¤éï¼æå¨ç¥ä¹ä¸å¶ç¶çå°äºä¸å®¶åç±»åç SaaS åºç¨æ¨å¹¿ï¼ä¹æ¯å¨è·æåç¸åçä¸è¥¿ï¼å¹¶ä¸å·²ç»å¼å§äºåä¸åï¼ææç¥éä¸åæå¾å¤å¬å¸é½å·²ç»å¨åäºãé£å¤©æä¸æç´æ¥å¿æçç¸ãå³äº WeBake è¿ä¸ªé¡¹ç®åé¢ä¹å°±çæå½ç¶çå¼åäºã

åæ¥åççäºï¼å¤§å®¶ä¹é½ç¥éäºï¼å¾®ä¿¡åé¢åå¸äºãå¾®ä¿¡äºå¼åãçä¸ç«å¼åç«¯è§£å³æ¹æ¡ï¼ç´æ¥å®æ¹å¿æ­»åäººãååæ¥ âLowCode ä½ä»£ç âçæ¦å¿µå¼å§æµè¡ï¼LeanCloud è¢«å¿å¨æ¸¸ææ¶è´­ï¼å½å¤ AirTableãå½åé»å¸äºãç»´æ ¼è¡¨ Vika ç­äº§åå¼å§æµè¡èµ·æ¥…… èé£ä¸ªå½æ¶è®©æå¿æçç¸çåå°ç¨åºåç«¯ç SaaS äº§åï¼å¨äºèç½ä¸å ä¹æ¾ä¸å°å®ççè¿¹äºã

## å¼å§å¡«å

æå¨ 2021 å¹´çæ¶åçå°äº Hooopo çæç«  [Let’s clone a Leancloud](https://ruby-china.org/topics/37922)ï¼éé¢ä»ç»äºä½¿ç¨ Postgres å®ç°ç±»ä¼¼ LeanCloud ç Schemaless Table çç¹æ§ãæç´å¼å¥½å®¶ä¼ï¼æ²¡æ³å° Postgres çè§å¾å JSON æ°æ®ç±»åè¿å¯ä»¥è¿æ ·ç©åºè±æ¥ãæå½æ¶å¯¹çæç« ç¨ Go å®ç°äºä¸ªå° Demoï¼æè§ç¡®å®æææãä½æ¯å ä¸ºæ²¡æå·ä½çéæ±ï¼é£ä¸ª Demo ä¸ç´èººå¨æç GitHub éã

ä»å¹´ææ¾å¼ WordPress ä½¿ç¨ Hugo éæäºæ¬åå®¢ï¼ä¸ç´æ²¡æ¾å°ä¸ªè½æ»¡è¶³æéæ±çéæåå®¢è¯è®ºç»ä»¶ï¼ä¾¿æ³èªå·±é è½®å­åä¸ä¸ªãä½æ¯è¯è®ºæå¡çåç«¯ï¼ä¸å°±è·çè¨æ¿ä¸æ ·ï¼é½æ¯äºå¾åºç¡å¾æ èç CRUD åï¼æå·²ç»ä¸æ³åç¨ Go æ èå CRUD äºï¼è¦ä¸ææéæ±æ½è±¡ä¸å±ï¼ç´æ¥åä¸ªâä½ä»£ç æ°æ®ä¸­å°âåºæ¥ï¼å¥½åæç¹ææå¦……ï¼

å°±è¿æ ·ï¼Sayrud è¯çäºã

## Schemaless ç¹æ§

Schemalessï¼ä¸­ææºç¿»ä¸ºãæ æ¨¡å¼ãï¼è®©äººå¬å¾äºéé¾éçï¼è®©æä»¬ä¸æ­¥æ­¥æ¥ã

é¦åï¼æ°æ®åºè¯­å¢ç `Schema` å¯ä»¥ç®åççè§£ä¸ºæ¯æ°æ®åºçè¡¨ç»æå®ä¹ï¼ææä¸å¼ å­¦çè¡¨ï¼è¡¨éæå­¦å·ãå§åãç­çº§ä¸åï¼ç¶åå­¦å·æ¯ä¸»é®…… è¿äºå°±æ¯ `Schema` ãå¨å³ç³»åæ°æ®åºä¸­ï¼æä»¬å¾å SQL è¯­å¥æ¥å®ä¹è¿å¼ è¡¨ï¼

```
CREATE TABLE students (no TEXT, name TEXT, class TEXT);
```

åé¢éæ±æ¹äºï¼è¦åæ°å¢ä¸åè®°å½âåºçæ¥æâï¼é£æä»¬å¾å SQL ä¿®æ¹è¡¨ç»æï¼

```
ALTER TABLE students ADD COLUMN birth_date DATE;
```

å¦ææ¹å¾å¤äºï¼é£è¿å°±æç¹ç¦äºãåµä¸å¨å®éçé¡¹ç®éæä»¬è¿å¾å»ç¼åæ°æ®åºè¿ç§»ç SQL å¹¶å¨çº¿ä¸è¿è¡è¿ç§»ç Migration ç¨åºãèªæçä½ ä¼°è®¡æ³å°äºæä»¬å¯ä»¥ç¨ MongoDB æ¥ååï¼è¦æ°å¢ä¸åç´æ¥å¨ JSON ä¸­å ä¸ä¸ªå­æ®µå°±è¡ï¼æ æè°ä»ä¹âè¡¨ç»æâçæ¦å¿µãè¡¨ç»æçæ¦å¿µæ²¡äºï¼ä¹å°±æ¯ `Schema` æ²¡äºãè±æä¸­å½¢å®¹è¯ `-less` åç¼æ `without` ï¼è¿å°±æäº `Schemaless` è¿ä¸ªè¯ãç®åæ¥è¯´å°±æ¯è· MongoDB ä¸æ ·ä¸åè¡¨ç»æå®ä¹çæ¡æ¡æ¡æ¡ï¼æ³å å­æ®µå°±å å­æ®µã

å¸é¢ä¸çå¾å¤ Schemaless ç¹æ§çäº§åï¼å¶åç«¯å¤§å¤é½ä½¿ç¨ MongoDB å®ç°ãä½æåæä¸­æå°äº Hooopo é£ç¯æç« ï¼åå ä¸æå¯¹ Postgres çç­ç±ï¼æå³å®å¦è¾è¹å¾ä½¿ç¨ Postgres æ¥å®ç°ã

æä»¬å¹³æ¶ååç«¯ï¼éè¦åå»ºè¡¨ï¼å®ä¹è¡¨éæåªäºå­æ®µï¼æåå¾è¡¨éææ°æ®ï¼å¯¹åºå° Sayrud ä½¿ç¨ `sl_tables` `sl_fields` `sl_records` ä¸å¼ è¡¨æ¥å­å¨ãï¼ä»¥ä¸ååºçè¡¨ç»æç²¾ç®äºé¡¹ç®åç»ã`gorm.Model` éåå«çå­æ®µï¼

* `sl_tables`ï¼ Schemaless è¡¨

| å­æ®µå | ç±»åï¼Goï¼ | è¯´æ |
| --- | --- | --- |
| name | `string` | è¡¨åï¼ç»ç¨åºçç |
| desc | `string` | è¡¨å¤æ³¨åï¼åç«¯ç»äººçç |
| increment\_index | `int64` | è®°å½å½åèªå¢ ID |

* `sl_fields`ï¼Schemaless å­æ®µ

| å­æ®µå | ç±»åï¼Goï¼ | è¯´æ |
| --- | --- | --- |
| sl\_table\_id | `int64` | å±äºåªå¼ è¡¨ |
| name | `string` | å­æ®µå |
| label | `string` | å­æ®µå¤æ³¨ï¼åç«¯ç»äººçç |
| type | `string` | å­æ®µç±»åï¼åæ¬ `int` `text` `bool` `float` `timestamp` `reference` `generated` ç­ |
| options | `json.RawMessage` | å­æ®µé¢å¤çå±æ§ï¼å¦é»è®¤å¼ãçº¦ææ¡ä»¶ç­ |
| position | `int` | å­æ®µå¨è¡¨ä¸­çé¡ºåº |

* `sl_records` ï¼Schemaless æ°æ®

| å­æ®µå | ç±»åï¼Goï¼ | è¯´æ |
| --- | --- | --- |
| sl\_table\_id | `int64` | å±äºåªå¼ è¡¨ |
| data | `json.RawMessage` | JSON å­æ°æ®ï¼Key ä¸ºå­æ®µç IDï¼Value ä¸ºå­æ®µçå¼ |

ç¶åç¥å¥çäºæå°±æ¥äº~ æä»¬æç§ Hooopo ä¸è¿°æç« éæä»ç»çï¼ä¸ºæ¯ä¸ä¸ª Schemaless è¡¨å½åå»ºä¸å¼ è§å¾ãä»¥ä¸æ¯ä¸ä¸ªè§å¾ç SQL å®ä¹ç¤ºä¾ï¼

![](/images/2024/07/schemaless_view_sql.png)

å¾çäº Postgres å¯¹ JSON ç±»åçå¼ºå¤§æ¯æï¼æä»¬å¯ä»¥ä» `sl_records` è¡¨ä¸­æå JSON å­æ®µçå¼ä½ä¸ºåå®¹ï¼æå»ºåºä¸å¼ âè¡¨âï¼ææå¦ä¸ï¼

![](/images/2024/07/schemaless_view_data.png)

å½ç¨æ·éè¦æ¥è¯¢ Schemaless è¡¨ä¸­çæ°æ®æ¶ï¼æä»¬ç´æ¥æ¥è¯¢è¿å¼ è§å¾å°±è¡ãå¯¹äº GORM èè¨ï¼è¿å°±è·æ¥è¯¢ä¸å¼ æ®éçè¡¨ä¸æ ·ï¼å®é½ä¸ä¼æè¯å°è¿æ¯ç±ä¸å¼ è¡¨æ¼åæååºæ¥çæ°æ®ãæ´ç¥å¥çæ¯ï¼å½ä½ å¯¹çè¿å¼ è§å¾å é¤ä¸æ¡è®°å½æ¶ï¼å¯¹åºç `sl_records` åå§è¡¨ä¸­çè®°å½è¡ä¹ä¼è¢«å é¤ï¼Postgres å±ç¶è½æè¿ä¿©å³èèµ·æ¥ã

å·ä½å°ä»£ç å®ç°ä¸ï¼æä»¬éè¦å¨ææé åå»ºè§å¾ç SQL è¯­å¥ãèåå­æ®µãè¡¨åè¿ç±»å³é®å­å¨ SQL è¯­å¥ä¸­æ¯ä¸æ¯æ SQL é¢ç¼è¯ä¼ å¥çï¼ä¸ºäºé¿åæ½å¨ç SQL æ³¨å¥é£é©ï¼æä½¿ç¨äº [github.com/tj/go-pg-escape](https://github.com/tj/go-pg-escape) åºæ¥å¯¹å­æ®µååè¡¨åè¿è¡è½¬ä¹ã

æ­£å¦ Hooopo æç« ä¸­ææå°çï¼æå°è¿ä¸ªè§å¾åå»ºå¨äºå¦ä¸ä¸ª Postgres Schema ä¸ï¼ä¸é»è®¤ç `public` è¿è¡åºåï¼è¿ä¹æ¯ä¸ç§ç®æçå¤ç§æ·å®ç°äºã

æåæ³¨æï¼

ä¹åçå°è¿è¿ç¯æç« ï¼ [ãæä»¬ä½¿ç¨ Postgres æå»ºå¤ç§æ· SaaS æå¡æ¶è¸©çåã](https://mp.weixin.qq.com/s/8T4Lgis9q30jHaSAfT3jgQ)ï¼æä¸­æå°ä½¿ç¨ Postgres Schema æå»ºå¤ç§æ·æ¶ï¼å¦ææ¯ä¸ª Postgres Schema ä¸é½æ¯åæ ·ç...