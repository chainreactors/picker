---
title: 蠕虫病毒伪装传播，根目录文件遭神秘删除
url: https://mp.weixin.qq.com/s?__biz=MzI3NjYzMDM1Mg==&mid=2247519324&idx=1&sn=1659754a737a29ccf27bb82560fcb5b7&chksm=eb705263dc07db75c75ac547d5c73b35e7f58c1727c9c822d5cac4eecc3f2fd9c8de84477188&scene=58&subscene=0#rd
source: 火绒安全
date: 2024-07-04
fetch_date: 2025-10-06T17:44:28.031990
---

# 蠕虫病毒伪装传播，根目录文件遭神秘删除

![cover_image](https://mmbiz.qpic.cn/sz_mmbiz_jpg/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8thQ6LibLj6wF8fkzFvYrEh3nic7VdU9Xpw1ibtzFVckeiavic133huZqH1LQ/0?wx_fmt=jpeg)

# 蠕虫病毒伪装传播，根目录文件遭神秘删除

原创

火绒安全

火绒安全

![](https://mmbiz.qpic.cn/sz_mmbiz_gif/0icdicRft8tz4nrnOI1emtFr0UYnrLKytAvy2gia6ZuIUJs14h2pEIwpiaWPCTTuCQIDibx9dlfXoyrNyVEWb8DVUUA/640?wx_fmt=gif&from=appmsg)

近期，火绒威胁情报中心监测到一款通过改名为USB Disk来欺骗用户执行的蠕虫病毒正在传播，火绒安全工程师第一时间提取样本进行分析。分析过程中发现该程序在后台自动感染每个插入的可移动磁盘，并将原文件移动到一个隐藏文件夹中。随后，程序创建一个名为“USB Disk.exe”的文件，诱导用户点击以执行病毒程序。同时，程序还会启动后门进程，试图控制用户主机成为自己的肉鸡。目前，火绒安全产品可对上述病毒进行拦截查杀，请广大用户及时更新病毒库以提高防御能力。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8t6ibic31ITLgHsbMpsJodUzrgW0JmJ5AnYwg2va5MDsic9jOPDYk6GvDMA/640?wx_fmt=png&from=appmsg)

火绒6.0查杀图

样本执行流程图如下所示：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8t4oUvDFibGxguEHx7rCalJb2EcvpqfO8nIQsR3oqcPFtIdDE6bhqKYyw/640?wx_fmt=png&from=appmsg)

流程图

在此，火绒工程师提醒大家对来历不明的文件应保持警惕，同时安装可靠的安全软件保护设备免受恶意软件和病毒的侵害。目前，火绒6.0已正式上线，综合用户的实际场景、使用感受和建议等多个方面，在形式、功能和操作等方面均进行了改进与创新，升级反病毒引擎等核心技术，精细化病毒查杀设置，增加更多威胁检测点，为“杀、防、管、控”增强壁垒。欢迎大家前往火绒官方网站下载体验。

**一、样本分析**

分析得出该病毒通过多个模块协同工作，通过白加黑的手段，具备较强的隐蔽性。其包含U盘传播、虚拟机检测、自启动设置、文件管理和CMD后门等多种恶意行为。

其中白文件是wwntray.exe（第二启动器）、Transfer.exe（蠕虫启动器）、Permissions.exe（后门启动器），它们主要是通过调用dll导出函数的方式执行恶意代码。

样本USB Disk.exe在刚被制作出来时并不能完整运行，因为需要满足多种条件才可执行，所以需要通过transfer.exe启动蠕虫并感染第一个可移动磁盘，从而“帮助”它满足条件才可以真正开始传播。

传播的方式是将USB Disk.exe放入到可移动磁盘中的根目录下，同目录下其他六个文件放入到可移动磁盘的隐藏目录中。之后在其他主机上使用该可移动硬盘并运行USB Disk.exe时，总启动器USB Disk.exe就会执行同目录下病毒文件夹中的wwntray.exe实现从可移动磁盘逆感染主机的操作，此时被感染的主机就会在后台执行蠕虫模块和后门模块，使每一个插入该主机的可移动磁盘都会被感染，重复第一次transfer.exe完成的操作。

**初始化**

病毒在运行蠕虫模块和后门模块前会进行一系列检查、持久化设置、删除部分文件等操作。

样本会在感染U盘时，将程序改名为USB Disk.exe，以诱导用户点击并执行。所以当USB Disk.exe程序在用户的U盘中出现时，意味着该U盘可能已被该病毒感染。

**USB Disk.exe**

该程序首先通过GetModuleFileName检查当前目录是否为盘符的根目录，如果不是，则结束运行。

随后，通过CreateProcess启动explorer.exe，参数为藏有U盘原文件的目录，此操作的主要目的是打开并展示受害者U盘中的原始文件，从而试图让受害者误以为自己仅仅是打开了USB Disk文件夹而不是病毒。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8t1yNTOue4V19T5AODWANdp5rXaicdz0clqNceAvChsc6tkIYJP7ibH9EQ/640?wx_fmt=png&from=appmsg)

打开原始文件目录

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tFAO4lXCylrcnCX8HmiaDr2NKfAtv0ICquCpB2Kv2uLl00E4P6jDYia5Q/640?wx_fmt=png&from=appmsg)

U 盘中原始文件目录

接着通过传入字符串参数"(C:)"来寻找磁盘根目录窗口并发送关闭窗口指令，目的是为了让受害者感受到打开的就是一个普通的文件夹。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8ticvp1s45XL1vNfdvFKjt4f4kC16KXIWpv3GUZXPpbGHc6ziaJRW2FT8g/640?wx_fmt=png&from=appmsg)

关闭磁盘根目录窗口

并通过OpenEvent参数ConfigurantionDebug4防止程序多开wwnotray.exe，随后执行wwnotray.exe，参数为-debug。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8th0zk3b6c6Ob5SSW31JUFMzbv6Vh2dx2kmyKooCLN2TPnv2hwb8yF7g/640?wx_fmt=png&from=appmsg)

执行 wwnotray.exe

**wwnotray.exe**

wwnotray.exe加载wweb32.dll并执行该dll导出表中的ShowModalWordWebWEx函数，该函数包括持久化操作、执行蠕虫和后门模块等功能。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8taJ8wcKRX2LTydJjQfqlo5oSRpUQq2GGmgRIlrGbA4XuibictRekHMTvw/640?wx_fmt=png&from=appmsg)

执行 ShowModalWordWebWEx 函数

程序首先通过CreateEvent检测事件是否已经存在来防止多开。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tgnbpgqNawxmT5TgJKibtq4fJEsDSGs19wmMQElsMWjPZNpVb9ptK1VA/640?wx_fmt=png&from=appmsg)

防止多开

动态获取函数地址：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tsmCrWXqdQS3cEFlicv8yFoKPSFRHibQMiaJ59YfDwNZvLj1XWmMRKhRQQ/640?wx_fmt=png&from=appmsg)

动态获取函数地址

动态获取函数地址方法如下，主要原理是通过比对函数名Hash值来获取函数地址。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tZ4hh2o4N0STL7eE6PIz2zhnYxkMdshMXZd5Sxo16mmibAg7ia09wqYDg/640?wx_fmt=png&from=appmsg)

获取 Windows API 函数地址函数

其执行时会判断参数是否为-debug，以及路径中是否包含$WinUpdate，否则直接结束进程。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tFPqica2kWa2Pn1TE2xynCL4mWNFSbqaibiasJXdaopFjyqWkicIvJYZ2Hg/640?wx_fmt=png&from=appmsg)

判断逻辑

随后样本开始删除文件C:\users\Public\GBPRSMBAL\WaveEditor.exe和C:\users\Public\GBPRSMBAL\WaveeditNero.exe，根据相关样本推测，这可能是老版本病毒文件名，进行清除。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tSpCDmQR9wpGuXJgEnicDElXjaUibTYmMJ9JHIpia46fQl3aymOn0viczVQ/640?wx_fmt=png&from=appmsg)

删除文件

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tTMB1ODxQzqveoNw20sj5xEnnRJu0mWnblticKiaIUKXsbJAqgXlXWSHg/640?wx_fmt=png&from=appmsg)

删除路径列表

还会删除目录，推测可能也是清除老版本的操作。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tfAQYs1aJYMIsMEqUUuWWAib1F8SJmeXIw7PumVddHsnzGYPzahsI0tg/640?wx_fmt=png&from=appmsg)

删除目录

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tBmTdsmWF1EcwC8FhOuehL0ZKHK77CcCO59ibNE7shFAzrN7dW8vYfibQ/640?wx_fmt=png&from=appmsg)

删除目录列表

删除目录的操作是通过cmd命令加上参数/c rd/s/q来完成的。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tAyh1EvnZrQfsic3MgibF3NgxYFSd6e7JEWQcxuAUTBjw0ibh8xzJtZ9Mw/640?wx_fmt=png&from=appmsg)

CMD 实现删除

通过reg.exe add设置注册表实现蠕虫模块和后门模块的自启动。

其中设置蠕虫模块为自启动的参数为add HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v "Microsoft Usb" /d "C:\Users\Public\GBPAGVMCZ\Transfer.exe -Install" /f

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tcom4ibMqUDG6iaBM1fPjTXFJfSeDWbCJWlVSic2dWXfSed8g9vQBsBvjg/640?wx_fmt=png&from=appmsg)

设置自启动

创建存放病毒文件的文件夹"C:\Users\Public\GBPUXQLQU"，并设置为隐藏文件和系统文件。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tr6Lo5AyjdKOUAZSOgphHKsqdiarm4UAESx8hmcETzduEZCzdGrbpmqQ/640?wx_fmt=png&from=appmsg)

创建病毒文件夹

并把病毒文件复制到该文件夹中，附加参数执行，用于执行蠕虫和后门模块。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tB15OlsNva6iblf1RTwrViaw802mclRia98Dpp1iaYwibehvMsJ1hQtQtnrg/640?wx_fmt=png&from=appmsg)

复制后执行蠕虫和后门模块

**蠕虫模块**

该模块的主要功能是将病毒文件复制到可移动磁盘中，并将可移动磁盘中的文件移动到隐藏文件夹中。最终，它会遍历D盘到L盘中的所有可移动磁盘。

下图是感染后U盘文件结构，可以看出除USB Disk以外均被隐藏。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tQ4qD6nctR66uJkwXqKLod7OabWiam7YFWibiaiaADBJz2fvyVQ3Bv9Cj2Q/640?wx_fmt=png&from=appmsg)

U 盘根目录

Transfer.exe加载drivespan.dll并执行函数run执行蠕虫函数。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tmmsM0Uw3GJ39OrzqGRNrzXDyZvyI5FeCW726YvxHUGeXyN4dbkhLUw/640?wx_fmt=png&from=appmsg)

执行蠕虫函数

创建事件drivespan4\_以防程序多开。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8te8O2BJiaaDbFt8HmuHsp0qk7icJfrl96uMfG0uKbvAwIwIia09YjTX0jw/640?wx_fmt=png&from=appmsg)

创建事件

该模块也会动态获取函数地址并填充结构体。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tRnxfdjC5WkfdOoefGbqUBYBiaicvTCVv2roc2p738OWtVPKFibPeNkn9A/640?wx_fmt=png&from=appmsg)

动态获取函数地址

判断参数是否为Install、判断是否已经有事件防止双开、判断当前盘符是不是可移动磁盘，满足以上所有条件才会开始传播，最后会遍历D盘到L盘中所有可移动磁盘。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tzwJiaw88qDQjJJ5UmOtvl5XiaGIUqsTuzjm7Aoibb8nxndJelU9GkVctg/640?wx_fmt=png&from=appmsg)

遍历传播逻辑

获取USB Disk名，如果有剩余空间就会填入剩余空间（GB为单位）。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tvMUHaV99arCpJABs0DxErVIXH4tPxkT4bJJhGIlJY5tEiaicHpJ3cUyA/640?wx_fmt=png&from=appmsg)

获取 USB Disk 名字

之后判断是否需要更新，接着创建一个没有名称的文件夹，并将其设置为隐藏和系统文件。需要注意的是，由于该程序会删除U盘根目录下的exe文件，因此这些文件将永久丢失。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tlRQYA4VrEJFNds2Rn6k7hsvZfMhqqtt0bLu2dHYXht3icnoayffMIDQ/640?wx_fmt=png&from=appmsg)

创建文件夹并设置

样本会把全部病毒文件复制到可移动盘中，然后将DAQDeviceControl.exe复制到U盘并重命名为USB Disk.exe，同时修改该文件的version字段为4，并进行标记。接着，将所有可移动盘中的内容移动到一个隐藏文件夹中，使受害者只能通过运行这个USB Disk.exe文件来访问内容。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8t8P5atZicxrUTAb6MoIicWeJQswYFdPrXEVBiakvR4VQmrWFic4k1TBpKeA/640?wx_fmt=png&from=appmsg)

感染可移动盘符

**后门模块**

其主要功能包括搜集主机信息，文件管理和CMD远程执行以及循环发送心跳包以保持连接。该后门功能虽然较少，但是控制端可以通过CMD远程执行任意命令来完全控制被植入后门的主机。

Permission.exe加载RBGUIFramework.dll 并执行函数MainExport执行后门函数。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0icdicRft8tz4WSN6a46Eor4MIrCiaApG8tQLKicia90jfod9UiaGZkiao4zfup3kXDhIkfCOc1kZTcv3hicn74A4H3ClA/640?wx_fmt=png&from=appmsg)

执行后门函数

后门模块通过接收的远程服务器的控制码，执行相应的恶意操作。

![](https://mmbiz.qpic.cn/s...