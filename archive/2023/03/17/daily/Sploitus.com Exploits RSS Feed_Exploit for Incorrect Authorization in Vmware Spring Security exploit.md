---
title: Exploit for Incorrect Authorization in Vmware Spring Security exploit
url: https://sploitus.com/exploit?id=F153A1C0-8116-5071-908F-9BCC68E9E042&utm_source=rss&utm_medium=rss
source: Sploitus.com Exploits RSS Feed
date: 2023-03-17
fetch_date: 2025-10-04T09:50:37.186808
---

# Exploit for Incorrect Authorization in Vmware Spring Security exploit

[x]
Dark Mode

[##### SPLOITUS](/)

# Exploit for Incorrect Authorization in Vmware Spring\_Security CVE-2022-22978

2023-03-16 | CVSS 9.8

Copy
Download
Source
[Share](#share-url)

```
## https://sploitus.com/exploit?id=F153A1C0-8116-5071-908F-9BCC68E9E042
# CVE 2022-22978: **Authorization Bypass in RegexRequestMatcher** ü•∂

### Kh√°i qu√°t

Theo th√¥ng tin em t√¨m hi·ªÉu ƒë∆∞·ª£c, ƒë√¢y l√† l·ªó h·ªïng li√™n quan ƒë·∫øn class **RegexRequestMatcher** trong framework Spring Security. C·ª• th·ªÉ, nh·ªØng application s·ª≠ d·ª•ng RegexRequestMatcher m√† trong regular expression c√≥ ch·ª©a d·∫•u ch·∫•m (.) s·∫Ω b·ªã bypass b·∫±ng c√°c k√≠ t·ª± **\r(%0a)** , **\n(%0d)**; t·ª´ ƒë√≥ c√°c attacker kh√¥ng c·∫ßn x√°c th·ª±c m√† v·∫´n c√≥ th·ªÉ truy c·∫≠p v√†o c√°c ƒë∆∞·ªùng d·∫´n kh√¥ng cho ph√©p.

C√°c version b·ªã d√≠nh l·ªó h·ªïng c·ªßa framework Spring Security:

- `5.5.x` tr∆∞·ªõc `5.5.7`
- `5.6.x` tr∆∞·ªõc `5.6.4`
- C√°c unsupported versions tr∆∞·ªõc ƒë√≥.

### Ph√¢n t√≠ch

Ta c·∫ßn truy c·∫≠p v√†o m√£ ngu·ªìn c·ªßa Spring Security ƒë·ªÉ ph√¢n t√≠ch tƒ©nh l·ªó h·ªïng n√†y. C·ª• th·ªÉ ·ªü ƒë√¢y, em d√πng ch·ª©c nƒÉng so s√°nh c√°c commits gi·ªØa 2 version 5.6.3 (version b·ªã d√≠nh l·ªó h·ªïng) v√† 5.6.4 (version ƒë√£ fix l·ªói) c·ªßa Github. Xem ·ªü link sau: [Comparing 5.6.3...5.6.4 ¬∑ spring-projects/spring-security (github.com)](https://github.com/spring-projects/spring-security/compare/5.6.3...5.6.4)

![img1](img/img1.png)

Em th·ª±c hi·ªán ki·ªÉm tra nh·ªØng thay ƒë·ªïi trong class `RegexRequestMatcher`. C√≥ th·ªÉ th·∫•y, ·ªü version `5.6.4`, class n√†y s·ª≠ d·ª•ng `Pattern.DOTALL` thay v√¨ d√πng `.` m·∫∑c ƒë·ªãnh nh∆∞ version  `5.6.3`.

Trong ƒë√≥:

- `Pattern` : l√† m·ªôt trong 3 class c√≥ trong g√≥i`java.util.regex`, c√≥ ch·ª©c nƒÉng x·ª≠ l√Ω c√°c regular expression.
- `Pattern.DOTALL` : Khi s·ª≠ d·ª•ng flag n√†y, ‚Äú.‚Äù trong regular expression s·∫Ω match v·ªõi t·∫•t c·∫£ c√°c k√≠ t·ª±, k·ªÉ c·∫£ k√≠ t·ª± xu·ªëng d√≤ng nh∆∞ `\n , \r`.
- `Pattern.CASE_INSENSITIVE`: kh√¥ng quan t√¢m k√≠ t·ª± in hoa hay in th∆∞·ªùng.

![img2](img/img2.png)

Theo m·∫∑c ƒë·ªãnh, d·∫•u `.` trong regular expression s·∫Ω match t·∫•t c·∫£ c√°c k√≠ t·ª± tr·ª´ c√°c k√≠ t·ª± xu·ªëng d√≤ng nh∆∞ `\n, \r`. Khi ƒë√≥ n·∫øu nh∆∞ trong tr∆∞·ªùng h·ª£p c√≥ h√†m regex validate pattern c·ªßa m·ªôt chu·ªói n√†o ƒë√≥ th√¨ h√†m regex ƒë√≥ s·∫Ω kh√¥ng match n·∫øu c√≥ c√°c k√≠ t·ª± xu·ªëng d√≤ng trong chu·ªói. ƒê·ªÉ tr√°nh vi·ªác n√†y, c√≥ th·ªÉ s·ª≠ d·ª•ng flag `Pattern.DOTALL`.

Tuy nhi√™n n·∫øu nh∆∞ c√≥ ng∆∞·ªùi c·ªë t√¨nh d√πng `%0d` thay v√¨ `\n` hay`%0a` thay v√¨ `\r` th√¨ regex tr√™n v·∫´n kh√¥ng th·ªÉ match. Do ƒë√≥, ·ªü version 5.6.4, ƒë√£ c√≥ ƒëo·∫°n check th√™m tr∆∞·ªùng h·ª£p n√†y trong `RegexRequestMatcherTests.java`. C·ª• th·ªÉ, n√≥ s·∫Ω convert `%0d` v√† `%0a` l·∫ßn l∆∞·ª£t th√†nh `\n` v√† `\r` r·ªìi m·ªõi check b·∫±ng regex.

![img3](img/img3.png)

### Demo

***B∆∞·ªõc 1:*** T·∫°o m·ªôt spring boot web application b·∫±ng [Spring Initializr](https://start.spring.io/) v·ªõi 2 dependencies k√®m theo l√† Spring Security v√† Spring Web.

![img4](img/img4.png)

***B∆∞·ªõc 2:*** T·∫°o m·ªôt Controller th·ª±c hi·ªán in ra d√≤ng ch·ªØ `This is a CVE-2022-22978 demo` khi c√≥ request ƒë·∫øn ƒë∆∞·ªùng d·∫´n `/admin/*`

![img5](img/img5.png)

***B∆∞·ªõc 3:*** Thi·∫øt l·∫≠p c∆° ch·∫ø x√°c th·ª±c m·ªói khi user truy c·∫≠p v√†o ƒë∆∞·ªùng d·∫´n `/admin/` b·∫±ng s·ª≠ d·ª•ng `regexMatchers("/admin/.*").authenticated()` . ƒê√¢y ch√≠nh l√† l·ªó h·ªïng c√°c attacker t·∫≠n d·ª•ng ƒë·ªÉ xem n·ªôi dung c·ªßa c√°c trang `/admin/` m√† kh√¥ng c·∫ßn x√°c th·ª±c.

![img6](img/img6.png)

***B∆∞·ªõc 4:*** ·ªû file c·∫•u h√¨nh, th·ª±c hi·ªán khai b√°o version c·ªßa Spring Security m√† c√≥ ch·ª©a l·ªó h·ªïng. ·ªû ƒë√¢y m√¨nh ch·ªçn version `5.6.3`.

![img7](img/img7.png)

***B∆∞·ªõc 5:*** Ch·∫°y ·ª©ng d·ª•ng b·∫±ng c√¢u l·ªánh `gradlew bootRun` , ch∆∞∆°ng tr√¨nh m·∫∑c ƒë·ªãnh d√πng Apache Tomcat l·∫Øng nghe ·ªü port 8080. Ta truy c·∫≠p v√†o ƒë∆∞·ªùng d·∫´n `/admin/xyz` (ƒë∆∞·ªùng d·∫´n n√†o c≈©ng ƒë∆∞·ª£c mi·ªÖn l√† t·ª´ `/admin/`).

![img8](img/img8.png)

K·∫øt qu·∫£ tr·∫£ v·ªÅ m√£ `403 Forbidden` nghƒ©a l√† m√¨nh kh√¥ng th·ªÉ truy c·∫≠p do ch∆∞a x√°c th·ª±c.

L√∫c n√†y, t·∫≠n d·ª•ng l·ªó h·ªïng c·ªßa h√†m regexMatchers trong Sping Security (version `5.6.3`) khi n√≥ kh√¥ng match c√°c k√≠ t·ª± xu·ªëng d√≤ng nh∆∞ `\r(%0d)` v√† `\n(%0a)` ‚Üí m√¨nh c√≥ th·ªÉ truy c·∫≠p v√†o ƒë∆∞·ªùng d·∫´n tr√™n m√† kh√¥ng c·∫ßn x√°c th·ª±c b·∫±ng payload `/admin/%0dxyz`

![img9](img/img9.png)

T∆∞∆°ng t·ª± v·ªõi payload `/admin/%0axyz`

![img10](img/img10.png)

Nh∆∞ v·∫≠y ta ƒë√£ t·∫≠n d·ª•ng ƒë∆∞·ª£c l·ªó h·ªïng CVE-2022-22978 th√†nh c√¥ng ch·ªâ v·ªõi m·ªôt payload v√¥ c√πng ƒë∆°n gi·∫£n.

### C√°ch kh·∫Øc ph·ª•c

- Update version c·ªßa Spring Security l√™n th√†nh:
    - 5.5.7+
    - 5.6.4+
    - 5.7+
- Demo: S·ª≠ d·ª•ng phi√™n b·∫£n ƒë√£ fix l·ªói, c·ª• th·ªÉ l√† `5.7.1`

![img11](img/img11.png)

Th·ª≠ t·∫•n c√¥ng web b·∫±ng payload t∆∞∆°ng t·ª± tr√™n: `/admin/%0dxyz`

![img12](img/img12.png)

L√∫c n√†y, app ƒë√£ kh√¥ng tr·∫£ v·ªÅ response nh∆∞ attacker mong mu·ªën.

### Usage

```git
git clone https://github.com/ducluongtran9121/CVE-2022-22978-PoC.git
cd CVE-2022-22978-PoC
gradlew bootRun
```

### Requirements

```
Java 18
Gradle 7.4.1
```
```

Share

Copy

![](https://mc.yandex.ru/watch/54912310)