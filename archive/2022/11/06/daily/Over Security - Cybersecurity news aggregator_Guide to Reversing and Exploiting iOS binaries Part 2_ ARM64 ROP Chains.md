---
title: Guide to Reversing and Exploiting iOS binaries Part 2: ARM64 ROP Chains
url: https://www.inversecos.com/2022/06/guide-to-reversing-and-exploiting-ios.html
source: Over Security - Cybersecurity news aggregator
date: 2022-11-06
fetch_date: 2025-10-03T21:50:32.300732
---

# Guide to Reversing and Exploiting iOS binaries Part 2: ARM64 ROP Chains

[Skip to main content](#main)

### Search This Blog

# [@inversecos](https://www.inversecos.com/)

my research :D

### Guide to Reversing and Exploiting iOS binaries Part 2: ARM64 ROP Chains

* Get link
* Facebook
* X
* Pinterest
* Email
* Other Apps

-
[June 16, 2022](https://www.inversecos.com/2022/06/guide-to-reversing-and-exploiting-ios.html "permanent link")

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgmkvA_BmXTrQjwioWXKegvOC5pSLUxTzd9mE6Isd_gfxD7Bbf25OAFQIcLlRH-0J8o2s4ctXZ5c1Z2Z0QlNN_JjwspmEkl4ckv7wyrnp9Htzyaipo2liNUBsmkhW7iOGEzidZivM8LQbKnBhAOdXTJLN_l1UNmDASI_zb4ozqJHC9ICu-OzPvAze2m1A/s16000/Cover%20Photo.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgmkvA_BmXTrQjwioWXKegvOC5pSLUxTzd9mE6Isd_gfxD7Bbf25OAFQIcLlRH-0J8o2s4ctXZ5c1Z2Z0QlNN_JjwspmEkl4ckv7wyrnp9Htzyaipo2liNUBsmkhW7iOGEzidZivM8LQbKnBhAOdXTJLN_l1UNmDASI_zb4ozqJHC9ICu-OzPvAze2m1A/s1156/Cover%20Photo.png)

**Welcome back my masochistic kings and queens... This is PART 2 of how to reverse engineer and exploit iOS binaries.**

If you’ve missed the blogs in the series, check them out below ^\_^
[Part 1: How to Reverse Engineer and Patch an iOS Application for Beginners](https://www.inversecos.com/2022/06/how-to-reverse-engineer-and-patch-ios.html)
[Part 2: Guide to Reversing and Exploiting iOS binaries: ARM64 ROP Chains](https://www.inversecos.com/2022/06/guide-to-reversing-and-exploiting-ios.html)
[Part 3: Heap Overflows on iOS ARM64: Heap Spraying, Use-After-Free](https://www.inversecos.com/2022/07/heap-overflows-on-ios-arm64-heap.html)

By the end of this blog post you will be able to reverse engineer an arm64 iOS binary and exploit it in two ways – first through a buffer overflow, and then through a ROP chain. Once again, I will walk you step-by-step through the following:

* Building and compiling your own iOS binary
* Reverse engineering the binary
* Calculating the runtime function addresses without disabling ASLR
* Buffer overflow attack
* ROP chain exploitation

We will only be using FREE tools because I don’t like to spend money on nerd things. Therefore, for this blog post/tutorial, I have compiled and built you an iOS binary that you can use and abuse. I have also included the source code on GitHub for all my evil cheaters out there!!! Don’t think for a second that I don’t know you exist :P.

[Download the exercise binary “dontpopme” from Github here.](https://github.com/inversecos/ios-dontpopme)

This blog post builds on Part 1’s knowledge of how to perform basic reversing on iOS apps. The difference is this blog post will focus on exploiting iOS arm64 binaries and we will take what we learn from reversing the binary to perform two attacks. As such, I will be introducing you to buffer overflows and ROP chain attacks.

This blog post is broken up into five sections, if you are familiar with my blog posts then this shouldn’t be a surprise. Anyway, these are the sections:

* High level walk through of the steps we will take
* Tools
* Environment set up
* Introduction to the binary we are exploiting
* Arm64 buffer overflow
* Arm64 ROP Chain
* A selfie of me uwu

**HIGH-LEVEL STEPS**Below are the high-level step-through of what this blog post will cover. We will go through each little step below in detail.

1. Upload the iOS binary onto your jailbroken iOS via SFTP. If you don’t know how to jailbreak your phone, please refer to unC0ver guide.
2. Run the binary to test it works
3. Find the buffer overflow vulnerability
4. Check the iOS crash logs to get the position of the link register (LR) so we can craft the payload
5. Debug the binary to find interesting functions that we will jump to in the payload
6. Calculate the function addresses at runtime (ASLR enabled on iOS)
7. Execute the buffer overflow attack
8. Find the next function we want to use for ROP chain
9. Execute a ROP chain

**TOOLS**These are the tools we will use to perform the analysis:

* LLDB - <https://lldb.llvm.org/>
* Radare 2 - <https://rada.re/n/>
* Hopper Disassembler (DEMO Version) - <https://www.hopperapp.com/>
* Your jailbroken iPhone (I am using an old phone with iOS 14.1)
* Your capable and massive brain

**ENVIRONMENT SET-UP**In order for you to follow this walkthrough step-by-step, make sure you have your jailbroken phone ready with SSH / SFTP set up and connected on the same LAN.

**Step 1:**Download the vulnerable binary from [my GitHub page](https://github.com/inversecos/ios-dontpopme)Please only download the dontpopme binary and NOT the source code. We are going to perform this entire exercise as a black box attack.

**Step 2:**SFTP the binary onto your jailbroken iOS device to the /var/mobile directory
![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjFQMX8Eld1sNTV_D9DiIK-fUu2TZdwNAzURIluF2gQ5UOdl0rmHy8dkLykxrv9rL578MFqBzotIoqOfhcMOAPL5I0E12N_ETmzNGtc_p2fKCJbOXFn3TtXjMHYnp_IBOb_V27brv904A2l_Kc7oNkbBW_Zo5tLjp1fjeZZ7X8L-Bt0hOZ5iGoE8eWhGA/s16000/1.PNG)

**Step 3:** Modify the permissions on the binary
Use chmod 777 dontpopme :)

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhhzGwUXpDNnjxmi7B_gVqnh4X4joSz6iBmxLSXa15pfZjylWgSI9mSGDNGf4Thwy7yh6pd_115N3Qg-3pk2OOYRcvOcMrYXGdQFU3Tw1wbL0dvC9CBz_h7Pq43fEvN4PSM4ItXwN06CzwlUanz9D8ke2kqFwZL_CEZR_LWLrGJxj1ClnOhiuDf-W5VHw/s16000/2.PNG)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhhzGwUXpDNnjxmi7B_gVqnh4X4joSz6iBmxLSXa15pfZjylWgSI9mSGDNGf4Thwy7yh6pd_115N3Qg-3pk2OOYRcvOcMrYXGdQFU3Tw1wbL0dvC9CBz_h7Pq43fEvN4PSM4ItXwN06CzwlUanz9D8ke2kqFwZL_CEZR_LWLrGJxj1ClnOhiuDf-W5VHw/s838/2.PNG)

**Step 4:** Run the binary and check it works :)

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjJJq6qSV8DalO1oKYjG-cq2rUpRhcRrzAbJvI4tJuAe0IO7xShNwKaxe_Jcyv-9Ey_UkY3JD-dXcP61x29VMT1r5TBrmIeI3Y0lFNEECRvDWK4b-ntyAW6oi-rKVwv7ZjWY_sfixXkCdFCVmPBXAZdF0PCgQSXO3PktQ5ab1LWdgaQEPEWty62MMtNvw/s16000/3.PNG)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjJJq6qSV8DalO1oKYjG-cq2rUpRhcRrzAbJvI4tJuAe0IO7xShNwKaxe_Jcyv-9Ey_UkY3JD-dXcP61x29VMT1r5TBrmIeI3Y0lFNEECRvDWK4b-ntyAW6oi-rKVwv7ZjWY_sfixXkCdFCVmPBXAZdF0PCgQSXO3PktQ5ab1LWdgaQEPEWty62MMtNvw/s749/3.PNG)

**Step 5:** Time to show the binary who's boss ^\_^

**INTRODUCTION TO THE BINARY**

This binary is called “dontpopme”, it’s a Mach-O 64-bit executable and it will serve us for the purpose of the buffer overflow and ROP exploitation.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiiE2-GZPIWIXSR_TtBQ2Mit6G-KUn98Tkvaogi-qeN6-2-BO23Djdkf5O5rIQrrS3sze70MD4qMhx2BEvHOdu15MAQfBy0uvuLZeNjWjTdvwICFop1WWAKezqL6bLqubzkzC2w3UhqLgS-Es9FM_Wnd01TmiXQQHtNeW-MiWgFU4-6j8DqurTMf3188w/s16000/Screen%20Shot%202022-06-14%20at%204.30.01%20pm.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiiE2-GZPIWIXSR_TtBQ2Mit6G-KUn98Tkvaogi-qeN6-2-BO23Djdkf5O5rIQrrS3sze70MD4qMhx2BEvHOdu15MAQfBy0uvuLZeNjWjTdvwICFop1WWAKezqL6bLqubzkzC2w3UhqLgS-Es9FM_Wnd01TmiXQQHtNeW-MiWgFU4-6j8DqurTMf3188w/s406/Screen%20Shot%202022-06-14%20at%204.30.01%20pm.png)

The buffer overflow vulnerability exists in the file-reading function “fread()” C function within the binary. This function basically reads from a file and is memory unsafe! The binary expects you to put a file named “resume.txt” in the same directory as the binary. It will then attempt to read the contents. What you put inside those contents can lead to a buffer overflow ;)

Hidden inside the binary are two further secret functions that are NEVER called within main. The goal of the buffer overflow is to cause the program to jump to one of these functions. The goal of the ROP Chain is to buffer overflow > jump to function 1 > jump to function 2.

The way I compiled this C code to make it run on iOS is through using a combination of Theos and clang. Here is how I compiled and signed the C code:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgP3Si-YrlX-yD9LRXpVq5GzF1zwD3ITIEbTRVBB089R7cp3TApTh6PBu2tWuks1bnU0YmLi1fhoWq5CnHVt6qeWYUQoQjxDk0ojfpCDNlEQdwdzfsmM5w-jkum7RC4O4U2m5Tl7nWYUsatv1RJ...