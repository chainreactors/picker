---
title: Unburdened By What Has Been: Exploiting New Attack Surfaces in Radio Layer 2 for Baseband RCE on Samsung Exynos
url: https://labs.taszk.io/articles/post/there_will_be_bugs/
source: Taszk Labs on taszk.io labs
date: 2024-07-30
fetch_date: 2025-10-06T17:47:19.236838
---

# Unburdened By What Has Been: Exploiting New Attack Surfaces in Radio Layer 2 for Baseband RCE on Samsung Exynos

[![logo](https://labs.taszk.io/images/taszk_logo.png)
![logo](https://labs.taszk.io/images/taszk_logo_white.png)](https://labs.taszk.io)

* [Home](https://labs.taszk.io/)
* [Articles](https://labs.taszk.io/articles)
* [Advisories](https://labs.taszk.io/blog)
* [Get in touch](https://taszk.io/contact)

## [Unburdened By What Has Been: Exploiting New Attack Surfaces in Radio Layer 2 for Baseband RCE on Samsung Exynos](https://labs.taszk.io/articles/post/there_will_be_bugs/)

2024-07-29
 by Daniel Komaromy, Lorant Szabo, Laszlo Szapula
 [Samsung](/articles/tags/samsung) [baseband](/articles/tags/baseband)

We have written extensively about remote baseband vulnerability research in the past, examining various vendors’ baseband OS micro-architectures and exploring their implementations for remotely exploitable bugs. So have many others. One might say, our research exists in the context in which it lives and what came before it: whether it be about finding ([1](https://comsecuris.com/blog/posts/theres_life_in_the_old_dog_yet_tearing_new_holes_into_inteliphone_cellular_modems/), [2](https://fredericb.info/category/advisory.html), [3](https://i.blackhat.com/USA-20/Wednesday/us-20-Hernandez-Emulating-Samsungs-Baseband-For-Security-Testing.pdf), [4](https://syssec.kaist.ac.kr/pub/2019/kim_sp_2019.pdf), [5](https://github.com/FirmWire/FirmWire), [6](https://asset-group.github.io/disclosures/5ghoul/), [7](https://www.usenix.org/conference/usenixsecurity23/presentation/klischies)) or exploiting ([1](https://www.usenix.org/system/files/conference/woot12/woot12-final24.pdf), [2](https://comsecuris.com/slides/rpw-pacsec2013-hexagon.pdf), [3](https://comsecuris.com/slides/recon2016-breaking_band.pdf), [4](https://downloads.immunityinc.com/infiltrate2018-slidepacks/amat-cama-a-walk-with-shannon/presentation.pdf), [5](https://youtu.be/YyaNgWAzBQY?si=oL99UWxOfojoAqZf&t=1212), [6](https://www.blackhat.com/us-21/briefings/schedule/index.html#how-to-tame-your-unicorn---exploring-and-exploiting-zero-click-remote-interfaces-of-modern-huawei-smartphones-23337), [7](https://youtu.be/SLuB2eza6kU?si=8ldtDI6aMo9KE9L3&t=238), [8](https://www.youtube.com/watch?v=OSJdAGtn8Qw), [9](https://i.blackhat.com/USA21/Wednesday-Handouts/us-21-Over-The-Air-Baseband-Exploit-Gaining-Remote-Code-Execution-On-5G-Smartphones.pdf), [10](https://labs.taszk.io/articles/post/mtk_baseband_csn1_exploitation/), [11](https://www.youtube.com/watch?v=Blytiwrf9bY), [12](https://i.blackhat.com/BH-US-23/Presentations/US-23-Karimi-Over-the-Air-Under-the-Radar.pdf), [13](https://hardwear.io/usa-2023/presentation/how-to-hack-shannon-baseband.pdf), [14](https://labs.taszk.io/blog/post/84_mtk_pncd_bof/)) vulnerabilities.

However, one area that has been absent from prior art was a direct examination of lower layers of Radio Layer protocols for security vulnerabilities. For this reason, last year we decided to explore new attack surfaces and bug patterns in Layer 2 of Radio Access Technologies such as 2G. A result of our work was a new baseband RCE exploit against Samsung Exynos smartphones, based on a chain of vulnerabilities that are described in our newly released disclosures: [1](https://labs.taszk.io/blog/post/93_rlc_bof/), [2](https://labs.taszk.io/blog/post/94_rlc_heap_bof/).

We published this work earlier this year at [CSW](https://www.secwest.net/s/CSW24-There-Will-Be-Bugs-SlideDeck.pdf) and then at GeekCon. For those of you who may have missed these opportunities (and can’t crack the leet password protecting the CSW talk video), in this blogpost we describe how we exploited our chain of vulnerabilities to gain full arbitrary remote code execution.

As a play on the theme of mining a new, deeper layer for bugs, we named our presentation There Will Be Bugs. So first, we discuss what kind of attack surfaces prop up in Layer 2 and what we targeted, then we describe the exploitation of the vulnerabilities we have chosen.

Before that, we draw attention to another indication of the soundness of our “prediction” (that there *will* be bugs to be found by targeting L2): the upcoming Black Hat [talk](https://www.blackhat.com/us-24/briefings/schedule/#overcoming-state-finding-baseband-vulnerabilities-by-fuzzing-layer-2-40707) by Muensch et al. on “Finding Baseband Vulnerabilities by Fuzzing Layer 2”. Be sure to check that one out too if you are interested in this topic.

## Layer 2: There Will Be Bugs

Layer 2 protocols in 3GPP Radio Access Technologies (RAT) such as 2G/3G/4G/5G serve much the same purpose as L2 i.e. data link layer protocols in the OSI model: taking care of transferring data between nodes of the RAN (radio access network) over the physical layer.

In other words, these protocols implement the transfer of packets direct over the radio link connection, i.e. between a mobile device (UE) and a radio tower (which can be a BTS, nodeB, eNB, gNB - depending on the particular RAT).

In the case of GSM, the L2 protocol is LAPDm. GPRS introduced in its place the MAC, RLC, and LLC sublayer protocols (and the Layer 3 protocol SNDCP on top) and the evolved technologies (3/4/5G) simplified that combination to MAC, RLC, and PDCP as the L2 protocol stack.

![gprs_stack_rlc](/images/blog/twbb/gprs_stack_rlc.png)

Each of these protocols have their own specifications, frame encoding formats, and procedure definitions, but what they share in common are the functionalities they provide, as a bridge between Layers 1 and 3:

* use smaller (than L3), fixed sized data frames
* as obvious from the above, implement L3 PDU segmentation and re-assembly procedures over L2 data frames
* since L3 protocols are numerous, implement the required multiplexing support for delivering to the correct recipient endpoint (called Service Access Points in 3GPP parlour)
* support unacknowledged and acknowledged modes of transfer and provide support for sliding windows for the later
* in the later, provide the support for in-order delivery and handling sliding ack windows
* besides data frames, implement control frames that carry configuration commands for the layer itself
* in the upper sublayers such as LLC/SNDCP or PDCP in the newer RATS, implement ciphering and compression for the SDUs they carry (and re-assemble)

One of the things that jumps out even from this generic description, is the recognition that this layer (one of its sublayers, depending on the RAT in question, to be precise) is the one in 3GPP responsible for applying ciphering to the enveloped SDUs of the upper layer that it serves.

This means, of course, that all the ciphering (encryption / integrity protection) meant to thwart malicious over-the-air message injection (see: “fake base station” based attacks) only comes into play AFTER the PDUs on these sublayers have been processed. In other words, any processing that pertains to headers of these lower sublayer DATA frames *as well as* the processing of the control frames belonging to these sublayers are going to include cases where the ciphering is just not of any concern at all.

That itself makes any possible memory corruption vulnerabilities in frame decoding in these sublayers quite interesting.

In L3, most published memory corruption bugs are classic decoding-a-variable-length-field vulnerabilities, where a length representation in a single packet is encoded in some malformed way, whether it be a length value in a TLV encoded field used unchecked or as part of an erroneous integer arithmetic, an ignored grammar constraint on the length of an ASN1 encoded SS or RRC packet SEQOF type field, or a mishandled recursive repetition encoded variable length field in CSN1-using 2G Radio Resource Management packets, to name a few prominent examples from the prior art.

Despite the much shorter frame lengths in L2 usually restricting the practical usefulness of such bugs, some of the same can apply to L2 too. In particular, 2G RLC uses the same CSN1 encoding as 2G RRM.

But there was a more interesting opportunity specific to ...