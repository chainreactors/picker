---
title: 猎影计划：从密流中捕获 Cobalt Strike 的隐秘身影
url: https://www.anquanke.com/post/id/310538
source: 安全客-有思想的安全新媒体
date: 2025-07-25
fetch_date: 2025-10-06T23:27:37.035216
---

# 猎影计划：从密流中捕获 Cobalt Strike 的隐秘身影

首页

阅读

* [安全资讯](https://www.anquanke.com/news)
* [安全知识](https://www.anquanke.com/knowledge)
* [安全工具](https://www.anquanke.com/tool)

活动

社区

学院

安全导航

内容精选

* [专栏](/column/index.html)
* [精选专题](https://www.anquanke.com/subject-list)
* [安全KER季刊](https://www.anquanke.com/discovery)
* [360网络安全周报](https://www.anquanke.com/week-list)

# 猎影计划：从密流中捕获 Cobalt Strike 的隐秘身影

阅读量**231775**

发布时间 : 2025-07-24 12:50:35

**x**

##### 译文声明

本文是翻译文章

译文仅供参考，具体内容表达以及含义原文为准。

# 导读：

在由 SSL/TLS 编织的现代网络“静默区”中，黑客的指令如同加密电台中的摩尔斯电码般悄然传输。传统安全设备如同戴着眼罩的卫兵，只能听见电流的白噪音。直到我们用模型为攻击行为刻下无法伪造的“行为指纹”，赋予了机器“听见加密心跳”的能力，Cobalt Strike 这个深度潜伏的“隐身刺客”才彻底暴露在安全防护的视野之下，再无藏身之所。

![]()

# 一、故事开篇：一次看似正常的“心跳通信”

在某大型企业的SOC中心，安全工程师注意到一台员工终端设备会访问到互联网上某个看似正常的IP，流量大小和频次等亦无明显特征，看似毫无威胁。然而，正是这看似正常的流量会话，触发了我们的检测模型告警：“**高疑似Cobalt Strike beacon流量**”。几秒钟内，系统自动抓取完整会话，推送IOC，最终确认该终端已被恶意植入，被用于红队测试中的隐蔽上线。而传统防火墙、WAF与IPS完全未检测出相关问题。

“就像在暴风雨中寻找特定的一片雪花” —— 受害企业CSO的叹息，折射出行业痛点。

# 二、问题背景：加密流量下的“隐形刀锋”

Cobalt Strike 已成为主流APT组织的常用工具，通过以下方式实现高度隐匿：

* **· 全程加密**：HTTPS传输，内容层不可见
* **· 混淆变种泛滥**：破解版本广泛传播，变异严重，HTTPS证书可以自定义，传统特征库无法准确匹配
* **· Beacon机制**：通信周期随机且低频，难以捕获准确通信特征
* **· Malleable C2配置**：定制协议/HTTP字段，模拟正常Web访问

在加密世界里，内容失语，唯有行为在说话，检测的未来，不再是内容，而是行为。

![]()

# 三、技术破壁：三层解码引擎穿透加密铠甲

我们构建了一套以**多模态流量表征+模态融合与平衡+集成阳性清洗**为核心的多模态检测框架：

![]()

## 3.1 第一阶段：多模态流量表征模型预训练

类似于多模态大模型结合文本、图像、音频等多种模态输入以强化跨领域任务能力的思路，融合统计流量特征、原始流量序列与原始数据包字节等多种流量表征/模态进行分析，有助于帮助智能模型自动挖掘加密流量及其变种的行为模式，实现不同任务场景下对加密流量的准确分类。

然而，统计流量特征、原始流量序列与原始数据包字节等现有流量表征形式差异大，需要分别建立针对性的模态表征模型与预训练任务，如：

**Flags 输入模态**

* **· 输入数据**：流量会话的状态与类型特征，例如

| 特征字段 | 流量含义 |
| --- | --- |
| session\_type | 会话类型，如TCP单边会话、无SYN包TCP会话 |
| session\_flags | 会话状态，如CLIENT\_SEND\_FIN、SERVER\_SEND\_RST |
| app\_status | 会话结束方式，如FIN、TIMEOUT |
| protocol | 协议号 |
| dir\_flag | 会话方向和上下行是否一致（通过目的ip列表算出） |

* 模型架构及预训练任务：Embedding Layer 将离散数值映射为 embedding 向量 + AutoEncoder 重构预训练

**Statistics 输入模态**

* **· 输入数据**：流量会话中数据包时序、数量等信息相关的统计特征，例如

| 特征字段 | 流量含义 |
| --- | --- |
| up\_rtt\_num | rtt上行数量 |
| ttl\_down | 次包的Time To Live |
| syn\_synack\_delay | TCP建链响应时延（微秒），即从syn到syn\_ack消息的时延（icmp表示icmp up status） |
| client\_flow\_bytes | 上行流量字节数 |
| recv\_p\_pkts | 会话非控制报文数 |

* **· 子模态划分**：在预训练数据集中对不同统计特征的数值分布进行层次聚类，按照分布相似性分成若干组子模态

![]()

* **· 模型架构及预训练任务**：Mean-Std 特征归一化 + AutoEncoder 重构预训练

**Sequences 输入模态**

* **·** 输入数据：流量中数据包的长度序列、到达时间序列（前 20 个包）
* **·** 模型架构及预训练任务：BERT-based 模型 + Same Original-Direction-Flow
* **·** Sequences 输入模态

![]()

**Bytes 输入模态**

* **·** 输入数据：流量中数据包的原始字节序列（前 5 个包，每个包取 ethernet header 之后的前 64 个 bytes）
* **·** 模型架构及预训练任务：BERT-based 模型 + Masked Language Modeling

![]()

## 3.2 第二阶段：模态融合与平衡微调算法

在综合多模态信息对基座模型进行微调的过程中，由于不同模态所含信息有效性与学习速度不同，基座模型很容易过度依赖某些模态进行流量分析而忽略对其余模态的学习。因此，需要在模态融合机制中对不同模态信息的学习程度进行量化感知，并设计微调任务平衡各模态信息的学习速度：

* **·** Step 1（模态融合）：使用全部输入模态，经过 Self-Attention 模态融合后输入 BERT-based 模型，进行 m 个 Epoch 的准确性微调训练
  ![]()
* **·** Step 2（随机模态挑选）: 平等初始化各个模态对分类结果的影响权重，并按权重随机挑选一个模态 x
  ![]()
* **·**  Step 3（模态影响评估）: 针对所选择模态 x 进行平衡性微调，首先将模态 x 移除，观察模型分类准确率相较于使用所有模态时的损失程度
  ![]()
* **·** Step 4（模态平衡）: 若移除模态 x 后准确率损失超过阈值（5%），说明对模态 x 依赖较强，为防止过度依赖、加强对其他模态的使用，在去除模态 x 的情况下微调训练 n 个 Epoch
  ![]()

  若移除模态 x 后准确率损失低于阈值（5%），说明对模态 x 依赖较差，为加强对模态 x 的使用，在只使用模态 x 的情况下训练 n 个 Epoch
  ![]()

  根据 n 个 Epoch 后准确率的提升程度重置模态 x 的影响权重，使对平衡性改善明显的模态更频繁的被选取，缺乏有效信息的模态不会频繁影响训练

## 3.3 第三阶段：降低误告警的阳性清洗

现网中流量规模巨大且正常流量与攻击流量比例悬殊，基于机器学习的流量检测模型需要在海量的正常流量数据中尽可能避免误告警，为单一模型的训练带来了巨大挑战。
![]()

我们将降低误告警这一困难问题拆解为两个子问题加以有效解决：

* **·** 首先，在多模态流量检测模型的训练过程当中，通过假阳性与假阴性感知过滤掉模糊标注的攻击样本，降低训练数据中的噪声为模型训练所带来的干扰
* **·** 其次，在多模态流量检测模型产生告警样本后，集成多个轻量化的决策树模型对其中的误告警进行清洗，若存在任一假阳性清洗模型将告警样本判定为假阳性，则召回该告警样本为正常流量

## 3.4 实战锋刃：在攻防演练中验证的硬指标

| 指标 | 定义 | 数值 |
| --- | --- | --- |
| 日均告警数目 | 正式转安全事件运营告警总数 | 2.14 |
| 精确率（precision） | 真实告警数 / 每周正式转安全事件运营告警总数 | 90% |
| 演练攻击召回率 （recall） | 攻防演练告警数 / 攻防演练安全事件总数 | 100% |
| 检测吞吐性能 | 单个 CPU 核平均每秒能检测的会话数量 | 单核 3600 session/s |

# 四、总结：未来安全，必须“预测型防御”

Cobalt Strike只是一个缩影，更多APT攻击将走向“无签名、加密、碎片化”。火山引擎云安全团队，正在将这套检测能力进一步拓展至冰蝎、哥斯拉、Sliver以及Mythic等多种C2工具及平台。

我们相信，真正的安全不仅仅是堵住所有风险，而且要精准地识别敌人藏身之地。

# 五、关于火山引擎网络安全团队

火山引擎网络安全团队汇聚业界资深安全专家，依托在云防火墙、高级网络威胁检测系统、WAF以及Anti-DDoS 防护等核心安全产品领域的多年技术积淀与实战经验，构建起多层级多场景流量防护体系。

同时在大模型时代下，火山引擎网络安全团队推出大模型应用防火墙，为大模型推理提供AII in one 安全防护能力。网络安全团队不仅为抖音、今日头条、西瓜视频等业务提供全链路安全护航，同时依托火山引擎为客户打造专业化、高可靠的安全防护方案。

如果你对大模型安全及高级网络威胁检测系统感兴趣，欢迎联系我们：<https://www.volcengine.com/product/nta>

本文翻译自 原文链接。如若转载请注明出处。

商务合作，文章发布请联系 anquanke@360.cn

本文由**火山引擎云安全**原创发布

转载，请参考[转载声明](https://www.anquanke.com/note/repost)，注明出处： [https://www.anquanke.com/post/id/310538](/post/id/310538)

安全KER - 有思想的安全新媒体

本文转载自:

如若转载,请注明出处：

安全KER - 有思想的安全新媒体

分享到：![微信](https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png)

* [APT](/tag/APT)
* [攻防演练](/tag/%E6%94%BB%E9%98%B2%E6%BC%94%E7%BB%83)
* [NTA](/tag/NTA)
* [告警](/tag/%E5%91%8A%E8%AD%A6)

**+1**7赞

收藏

![](https://p3.ssl.qhimg.com/t01d7c5cb6fdb04a6cc.png)火山引擎云安全

分享到：![微信](https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png)

## 发表评论

您还未登录，请先登录。

[登录](/login/index.html)

![](https://p1.ssl.qhimg.com/t014757b72460d855bf.png)

[![](https://p3.ssl.qhimg.com/t01d7c5cb6fdb04a6cc.png)](/member.html?memberId=165382)

[火山引擎云安全](/member.html?memberId=165382)

火山引擎云安全产品是字节跳动旗下的企业级安全技术服务产品

* 文章
* **40**

* 粉丝
* **4**

### TA的文章

* ##### [为AI Agent行为立“规矩”——字节跳动提出Jeddak AgentArmor智能体安全框架](/post/id/312426)

  2025-09-28 13:43:32
* ##### [教你打造一款AI安全助手 | 安全MCP的实践指南](/post/id/311884)

  2025-09-05 10:40:51
* ##### [当数字世界的“万能钥匙”被滥用，谁来守护核心资产？火山的 MCP 安全授权新范式](/post/id/311597)

  2025-08-28 09:50:41
* ##### [广汽集团×火山引擎：出海合规助力企业新增长](/post/id/311498)

  2025-08-26 10:17:09
* ##### [智能体防御 | 一文了解3种系统提示词加固方法](/post/id/311279)

  2025-08-18 16:34:50

### 相关文章

* ##### [APT-C-55（Kimsuky）组织在RandomQuery活动中投递开源RAT的攻击活动分析](/post/id/297233)

  2024-06-13 10:15:14
* ##### [Andariel APT 使用 DoraRAT 和 Nestdoor 恶意软件监视韩国企业](/post/id/297004)

  2024-06-03 10:52:13
* ##### [Turla APT 组织涉嫌利用 MSBuild 微小后门进行隐秘攻击](/post/id/296639)

  2024-05-21 10:31:48
* ##### [发现针对印度大学的 SideCopy APT 活动](/post/id/296541)

  2024-05-16 11:47:09
* ##### [俄罗斯黑客 APT28 对波兰政府发动恶意软件攻击](/post/id/296335)

  2024-05-09 11:10:37
* ##### [透明部落：针对印度国防部门的难以捉摸的威胁](/post/id/295858)

  2024-04-22 11:09:46
* ##### [沙鹰：源自中东还是美国？](/post/id/293799)

  2024-03-12 10:54:16

### 热门推荐

文章目录

* [3.1 第一阶段：多模态流量表征模型预训练](#h2-0)
* [3.2 第二阶段：模态融合与平衡微调算法](#h2-1)
* [3.3 第三阶段：降低误告警的阳性清洗](#h2-2)
* [3.4 实战锋刃：在攻防演练中验证的硬指标](#h2-3)

![](https://p0.qhimg.com/t11098f6bcd5614af4bf21ef9b5.png)

安全KER

* [关于我们](/about)
* [联系我们](/note/contact)
* [用户协议](/note/protocol)
* [隐私协议](/note/privacy)

商务合作

* [合作内容](/note/business)
* [联系方式](/note/contact)
* [友情链接](/link)

内容需知

* [投稿须知](https://www.anquanke.com/contribute/tips)
* [转载须知](/note/repost)
* 官网QQ群：568681302

合作单位

* [![安全KER](https://p0.ssl.qhimg.com/t01592a959354157bc0.png)](http://www.cert.org.cn/)
* [![安全KER](https://p0.ssl.qhimg.com/t014f76fcea94035e47.png)](http://www.cnnvd.org.cn/)

Copyright © 北京奇虎科技有限公司 三六零数字安全科技集团有限公司 安全KER All Rights Reserved [京ICP备08010314号-66](https://beian.miit.gov.cn/)[![](https://icon.cnzz.com/img/pic.gif)](https://www.cnzz.com/stat/website.php?web_id=1271278035 "站长统计")

微信二维码

**X**![安全KER](https://p0.ssl.qhimg.com/t0151209205b47f2270.jpg)