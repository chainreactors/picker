---
title: Analysis CVE-2023-29300: Adobe ColdFusion Pre-Auth RCE
url: https://govuln.com/news/url/x8Yv
source: Sec-News 安全文摘
date: 2023-07-14
fetch_date: 2025-10-04T11:51:00.138993
---

# Analysis CVE-2023-29300: Adobe ColdFusion Pre-Auth RCE

[ProjectDiscovery![ProjectDiscovery Logo](/_next/static/media/ProjectDiscoveryLogo.a524f50f.svg)](/)

[Enterprise](/enterprise)[Pricing](/pricing)[Docs](https://docs.projectdiscovery.io/cloud/introduction)[Blog](/blog)

[Sign in](https://cloud.projectdiscovery.io/sign-in)

[Request demo](/request-demo)Open menu

[Blog](/blog)

[Stories](/blog/stories/1)[Categories](/blog/categories)[Authors](/blog/authors)

Jul 12, 2023-

12 min read

# Adobe ColdFusion Pre-Auth RCE(s)

[Vulnerability Research](/blog/category/vulnerability-research/1)[Nuclei & Templates](/blog/category/nuclei-templates/1)

![Adobe ColdFusion Pre-Auth RCE(s)](/_next/image?url=https%3A%2F%2Fprojectdiscovery.ghost.io%2Fcontent%2Fimages%2F2024%2F01%2FBlog---Adobe.png&w=828&q=75)

#### Table of Contents

* [Introduction](#introduction "Introduction")
* [What's in the patch?](#whats-in-the-patch "What's in the patch?")
* [Parsing of WDDX Packet](#parsing-of-wddx-packet "Parsing of WDDX Packet")
* [Finding the Sink](#finding-the-sink "Finding the Sink")
* [Finding the Source](#finding-the-source "Finding the Source")
* [Escalating JNDI Injection To RCE](#escalating-jndi-injection-to-rce "Escalating JNDI Injection To RCE")
* [Updates](#updates "Updates")
* [Conclusion](#conclusion "Conclusion")

#### Authors

[![Harsh Jaiswal](/_next/image?url=https%3A%2F%2Fprojectdiscovery.ghost.io%2Fcontent%2Fimages%2F2023%2F08%2F1585309233118.jpeg&w=96&q=75)

###### Harsh Jaiswal](/blog/author/harsh/1)[![Rahul Maini](/_next/image?url=https%3A%2F%2Fprojectdiscovery.ghost.io%2Fcontent%2Fimages%2F2023%2F11%2FTKTMQH41W-U04DH0WJJLX-eec5b4b57170-512.jpeg&w=96&q=75)

###### Rahul Maini](/blog/author/rahul/1)

#### Share

For the **latest updates** on CVE-2023-29300 / CVE-2023-38203 / CVE-2023-38204, see the [**updates section**](https://projectdiscovery.io/blog/adobe-coldfusion-rce/#updated-information)

---

### Introduction

The Adobe ColdFusion, widely recognized for its robust web development capabilities, recently [released](https://helpx.adobe.com/security/products/coldfusion/apsb23-40.html) a critical security update. The update specifically targeted three security issues, among them, [CVE-2023-29300](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-29300), a highly concerning pre-authentication Remote Code Execution (RCE) vulnerability. This vulnerability poses a significant threat, allowing malicious actors to execute arbitrary code on vulnerable Coldfusion 2018, 2021 and 2023 installations without the need for prior authentication.

In this blog post, we aim to provide a comprehensive analysis of CVE-2023-29300, shedding light on the nature of the vulnerabilities, and their potential impact, and sharing the journey of code review undertaken by our team.

### What's in the patch?

In our research environment, an existing Adobe ColdFusion 2021 setup was already in place from our previous work. Upon discovering the availability of a new security update (version 7), we proceeded to install it after ensuring the backup of our current installation directory. The purpose of this installation was to perform a patch diff, enabling us to compare the changes made by the security update and rollback if necessary.

We conducted a git diff and observed notable changes in the `coldfusion.wddx.DeserializerWorker.java` file.

![](/_next/image?url=https%3A%2F%2Fprojectdiscovery.ghost.io%2Fcontent%2Fimages%2F2023%2F07%2Fimage-12.png&w=3840&q=75)

This is a [WDDX](https://helpx.adobe.com/coldfusion/developing-applications/using-web-elements-and-external-objects/using-xml-and-wddx/using-wddx.html) packet deserializer which is of XML type. Within the `startElement` method of `DeserializerWorker` we notice that a newly added validation is being performed via `validateWddxFilter()`for `struct` element.

java

Copy

```
1public void startElement(String name, AttributeList atts) throws SAXException {
2        try {
3			...
4            if (name.equalsIgnoreCase("struct") && atts.getType(0) != null) {
5                validateWddxFilter(atts);
6            }
7           ...
8        } catch (WddxDeserializationException e) {
9            throwSAXException(e);
10        }
11    }
12
13   private void validateWddxFilter(AttributeList atts) throws InvalidWddxPacketException {
14        String attributeType = atts.getValue("type");
15        validateBlockedClass(attributeType);
16    }
17
18    private void validateBlockedClass(String attributeType) throws InvalidWddxPacketException {
19        if (attributeType != null && !attributeType.toLowerCase().startsWith("coldfusion") && !attributeType.equalsIgnoreCase(StructTypes.ORDERED.getValue()) && !attributeType.equalsIgnoreCase(StructTypes.CASESENSITIVE.getValue()) && !attributeType.equalsIgnoreCase(StructTypes.ORDEREDCASESENSITIVE.getValue()) && WddxFilter.invoke(attributeType)) {
20            throw new InvalidWddxPacketException();
21        }
22    }
```

The `struct` element now includes a new check in its `type` attribute, ensuring that the className begins with `coldfusion` and passes additional secondary checks. The `validateBlockedClass` function indicates that a fully qualified class name (FQCN) would be passed as the type attribute.

### Parsing of WDDX Packet

After reviewing documentation and articles on WDDX, we have gained a basic understanding of the WDDX packet's structure. Now, let's delve into the parsing of this packet. Each WDDX element corresponds to a specific handler; for instance, the struct element is handled by the StructHandler. Since the changes were made in relation to the struct element, our focus shifted to parsing the WDDX struct element.

cli

Copy

```
1<wddxPacket version='1.0'><header/><data><struct type='className'><var name='prop_name'><string>prop_value</string></var></struct></data></wddxPacket>
```

Through reading, debugging, and tracing various breakpoints, we comprehended the parsing process. It was observed that Java reflections are extensively used in certain code blocks, suggesting that user input will undergo reflection invocations.

This is the code flow of interesting part of the parsing process:

`onEndElement() -> getClassBySignature() -> setBeanProperties()`

### Finding the Sink

In the `onEndElement()` method, a check is performed on the `m_strictType` field, which is set earlier in the code if the type attribute is provided in the struct element of the WDDX packet.

cli

Copy

```
1public void onEndElement() throws WddxDeserializationException {
2
3        if (this.m_strictType == null) {
4            setTypeAndValue(this.m_ht);
5            return;
6        }
7        try {
8            Class beanClass = getClassBySignature(this.m_strictType);
9            Object bean = beanClass.getDeclaredConstructor(new Class[0]).newInstance(new Object[0]);
10            setBeanProperties(bean, this.m_ht);
11            setTypeAndValue(bean);
12        } catch (Exception e) {
13			...
14        }
15    }
```

After passing this check, a call is made to `getClassbySignature()`, which uses reflection to obtain the class instance. The class name is derived from user-controlled input `m_strictType`, and the first and last characters are removed, possibly because the input is expected in the form of [LclassName;](https://stackoverflow.com/questions/5085889/l-array-notation-where-does-it-come-from/5085908)

cli

Copy

```
1private static Class getClassBySignature(String jniTypeSig) throws ClassNotFoundException {
2        char c = jniTypeSig.charAt(0);
3        switch (c) {
4            ...
5            default:
6                String className = jniTypeSig.substring(0 + 1, jniTypeSig.length() - 1);
7                return Class.forName(className);
8        }
9      }
```

Once we have the class name, reflection is used to access the constructor of the class, specifically the one with no arguments, and an instance of the class is instantiated. This instance is then passed to `setBeanProperties()`, along with the user-controlled `m_ht` fi...