---
title: 全自动白帽漏洞扫描器
url: https://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247495554&idx=1&sn=07c147197a62ad4b5235c4342d2634c4&chksm=e8a5e5e1dfd26cf7e8dafb1547e1913e08f78702165868748224efa9ec4ef39279b4ad86c95e&scene=58&subscene=0#rd
source: 迪哥讲事
date: 2024-08-21
fetch_date: 2025-10-06T18:04:59.275692
---

# 全自动白帽漏洞扫描器

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/YmmVSe19Qj74iavDPD17bMKN5T6CvicL8HsyMzC2EA0pHianvHWzaqauGNPY6aWEIKHRrwzLdUFG2GW3QvEoN4SqA/0?wx_fmt=jpeg)

# 全自动白帽漏洞扫描器

迪哥讲事

以下文章来源于攻防有道
，作者bywalks

![](http://wx.qlogo.cn/mmhead/Q3auHgzwzM6T9Yr732dK6Xt0YZtspkZP67SM4JxvdsrYI2kJl9AHZg/0)

**攻防有道**
.

分享平日所学，供自己和朋友们学习查阅。

## 简介

DarkAngel 是一款全自动白帽漏洞扫描器，从hackerone、bugcrowd资产监听到漏洞报告生成、企业微信通知。

DarkAngel 下载地址：https://github.com/Bywalks/DarkAngel

当前已支持的功能：

* hackerone资产监听；
* bugcrowd资产监听；
* 自定义资产添加；
* 子域名扫描；
* 网站指纹识别；
* 漏洞扫描；
* 漏洞报告自动生成；
* 企业微信通知扫描结果；
* 前端显示扫描结果；

## 自动生成漏洞报告

自动生成漏洞报告 - MarkDown格式 - 存放地址/root/darkangel/vulscan/results/report

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzanD2y8oaaXEtRA05roypHWia2Ho5lNEicsiaIvRRSgJGQXAUOl8maI3qQ/640?wx_fmt=png)

支持自添加漏洞报告模板，目前已添加漏洞报告模板如下，漏洞名配置为nuclei模板文件名即可

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzbYAoEEiazjw49VMDRiciaJJPoWufR2f7gkkqibuV6Salp5vqsq8q7dP2VQ/640?wx_fmt=png)

自定义漏洞报告模板格式

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1Tz861v0h8zbOgj1aAUjkawWPTjMibPicYsCaTZCugichVFcdCcv6q91dqRw/640?wx_fmt=png)

## 企业微信通知

可先查看如何获取配置：企业微信开发接口文档

```
https://developer.work.weixin.qq.com/document/path/90487
```

获取参数后，在/root/darkangel/vconfig/config.ini中配置参数，即可启用企业微信通知

微信通知 - 漏洞结果

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1Tz0e1A6C92kjkg2rBHRQIwBb5rWiazZJwicJ9trhbL82SAAWkhLw96apuQ/640?wx_fmt=png)

微信通知 - 扫描进程

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzMsNzb4ZhtR8EYHla6uvWyoMWUoRA1iaBVI2icbM8qC4pcfxsNQq6vfzw/640?wx_fmt=png)

## 安装

整体项目架构ES+Kibana+扫描器，所以安装需要三个部分

ES镜像：

```
拉取ES镜像
docker pull bywalkss/darkangel:es7.9.3

部署ES镜像
docker run -e ES_JAVA_OPTS="-Xms1024m -Xms1024m" -d -p 9200:9200 -p 9300:9300 --name elasticsearch elasticsearch:7.9.3

查看日志
docker logs -f elasticsearch

出现问题，执行命令
sysctl -w vm.max_map_count=262144

重启docker
docker start elasticsearch
```

Kibana镜像：

```
拉取Kibana镜像
docker pull bywalkss/darkangel:kibana7.9.3

部署Kibana镜像（修改一下es-ip）
docker run --name kibana -e ELASTICSEARCH_URL=http://es-ip:9200 -p 5601:5601 -d docker.io/bywalkss/darkangel:kibana7.9.3

查看日志
docker logs -f elasticsearch

出现问题，执行命令
sysctl -w vm.max_map_count=262144

重启docker
docker start elasticsearch
```

扫描器镜像：

```
拉取扫描器镜像
docker pull bywalkss/darkangel:v1

部署扫描器
docker run -it -d -v /root/darkangel:/root/darkangel --name darkangel bywalkss/darkangel:v1
```

docker容器内挂载目录无权限运行容器时：--privileged=true

## 用法

```
usage:  [-h] [--scan-new-domain]        [--add-domain-and-scan ADD_DOMAIN_AND_SCAN [ADD_DOMAIN_AND_SCAN ...]]        [--offer-bounty {yes,no}] [--nuclei-file-scan]        [--nuclei-file-scan-by-new-temp NUCLEI_FILE_SCAN_BY_NEW_TEMP]        [--nuclei-file-scan-by-new-add-temp NUCLEI_FILE_SCAN_BY_NEW_ADD_TEMP]        [--nuclei-file-scan-by-temp-name NUCLEI_FILE_SCAN_BY_TEMP_NAME]        [--nuclei-file-polling-scan] [--delete]
DarkAngel is a white hat scanner. Every user makes the Internet more secure.
--------------------------------------------------------------------------------
optional arguments:  -h, --help            show this help message and exit  --scan-new-domain     scan new domain from h1 and bc  --add-domain-and-scan ADD_DOMAIN_AND_SCAN [ADD_DOMAIN_AND_SCAN ...]                        scan new domain from h1 and bc  --offer-bounty {yes,no}                        set add domain is bounty or no bounty  --nuclei-file-scan    scan new domain from h1 and bc  --nuclei-file-scan-by-new-temp NUCLEI_FILE_SCAN_BY_NEW_TEMP                        use new template scan five file by nuclei  --nuclei-file-scan-by-new-add-temp NUCLEI_FILE_SCAN_BY_NEW_ADD_TEMP                        add new template scan five file by nuclei  --nuclei-file-scan-by-temp-name NUCLEI_FILE_SCAN_BY_TEMP_NAME                        use template scan five file by nuclei  --nuclei-file-polling-scan                        five file polling scan by nuclei
```

### --scan-new-domain

`$ python3 darkangel.py --scan-new-domain`

* 监听hackerone和bugcrowd域名并进行扫描（第一次使用时会把hackerone和bugcrowd域名全部添加进去，资产过多的情况下做好准备，扫描时间很长）

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1Tzibic61EOLpj3zKicTSPIvAyQlLGk6InxyoLeUpvjvkbjRsvB4ib0xJxZ8A/640?wx_fmt=png)

### --add-domain-and-scan

`$ python3 darkangel.py --add-domain-and-scan program-file-name1 program-file-name2 --offer-bounty yes/no`

* 自定义添加扫描域名，并对这些域名进行漏洞扫描
* 文件名为厂商名称，文件内存放需扫描域名
* 需提供--offer-bounty参数，设置域名是否提供赏金

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzAhwtTia1BOvVRbXM2tMAZBzhqwibUQhfa0RHyDeGWKb0BnegmvZZA0pw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzTDlbibmiamgpRbfIL4ibNYicG60bltJoZESLzFSfFrR45bGiad8GibYWCaTQ/640?wx_fmt=png)

扫描结束后，会把子域名结果存在在/root/darkangel/vulscan/results/urls目录，按照是否提供赏金分别存放在，bounty\_temp\_urls\_output.txt、nobounty\_temp\_urls\_output.txt文件内

### --nuclei-file-scan

`$ python3 darkangel.py --nuclei-file-scan`

* 用nuclei扫描20个url文件

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzW0vJPhkHOEJhf0PfHUicd0cTkssYtGV9SyEu1kYZFRcedjEibVw3Uscg/640?wx_fmt=png)

url列表存放位置

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzJJI1SctDibYYRFfEGGicjH3YIXJ4nT3LZu4tm4KGVOTJRnCjz5AqmOvw/640?wx_fmt=png)

### --nuclei-file-polling-scan

`$ python3 darkangel.py --nuclei-file-polling-scan`

* 轮询用nuclei扫描20个url文件，可把该进程放在后台，轮询扫描，监听是否url列表是否存在新漏洞出现

### --nuclei-file-scan-by-new-temp

`$ python3 darkangel.py --nuclei-file-scan-by-new-temp nuclei-template-version`

* 监听nuclei-template更新，当更新时，对url列表进行扫描

当前nuclei-template版本为9.3.1

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzovPHt160LtP3S6V6QzJPHEqWt10YmalACdx1WSmpN1AZ8NYzmn50Jw/640?wx_fmt=png)

执行命令，监听9.3.2版本更新

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzG1vVyRicsms7BXic5knibRbDkcMPoic04U7Ye40z4Ju9FIhJG04OgCH7TA/640?wx_fmt=png)

企业微信通知

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1Tzv2AK9dRVDND98GeKwWm3boE48uoicnTf2e7qn9dQ0Yjnib6pUTjcYzQA/640?wx_fmt=png)

url列表存放位置

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzJJI1SctDibYYRFfEGGicjH3YIXJ4nT3LZu4tm4KGVOTJRnCjz5AqmOvw/640?wx_fmt=png)

### --nuclei-file-scan-by-new-add-temp

`$ python3 darkangel.py --nuclei-file-scan-by-new-add-temp nuclei-template-id`

* 监听nuclei单template更新，当更新时，用该template对url列表进行扫描，这里是打了个时间差，某些时候先提交tempalte，验证后才会加入nuclei模板，在还未加入时，我们已经监听并进行扫描，扫描后id会自动增加，监听并进行扫描

查看nuclei单template的id，这里为6296

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzeOutqvZpEdendBeMZdia55Y4bLgLdAq2jqJvEflgAJQTc0z8NRv0icoQ/640?wx_fmt=png)

执行命令，对该template进行扫描

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzicpKn0ibb12XFGNsTD4YsHmc6gGnbRCF1PiaOI8b81jGoVxGZpQaicpjBA/640?wx_fmt=png)

url列表存放位置

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzJJI1SctDibYYRFfEGGicjH3YIXJ4nT3LZu4tm4KGVOTJRnCjz5AqmOvw/640?wx_fmt=png)

### --nuclei-file-scan-by-temp-name

`$ python3 darkangel.py --nuclei-file-scan-by-temp-name nuclei-template-name`

* 用单template对url列表进行扫描

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzpicNGjp6zgpMsDCKnlNbcudLojVnib6N2QCnLz743QXuGzyPJKicPoycQ/640?wx_fmt=png)

## 结果显示

前端 - 扫描厂商

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzvRfoBXZJsibEWtg6sDSF6jhFbKMp2aMMM0ZUicz1OiaHHe1UDubFO3l5A/640?wx_fmt=png)

前端 - 扫描域名

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzSXYqicLDJbiamLE1sju22otduU6aDxd3qLFcXmJBJJ5fGLqKBwupjOQw/640?wx_fmt=png)

前端 - 扫描结果

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzAhqtEJNP1icEEI2ibdfAnmRaJ1tdc1TqWEdjjQr1Qm8CEGCybA6eCOsw/640?wx_fmt=png)

微信通知 - 扫描进程

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1TzMsNzb4ZhtR8EYHla6uvWyoMWUoRA1iaBVI2icbM8qC4pcfxsNQq6vfzw/640?wx_fmt=png)

微信通知 - 漏洞结果

![](https://mmbiz.qpic.cn/mmbiz_png/ib3VCxzGNvRapF80qWMlbsRDuzRJED1Tz0e1A6C92kjkg2rBHRQIwBb5rWiazZJwicJ9trhbL82SAAWkhLw9...