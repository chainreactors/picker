---
title: 云安全-s3对象存储攻防
url: https://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247496290&idx=1&sn=12e62668b9a6e7dda337d4ba4c18e27d&chksm=e8a5f801dfd27117fb8d2ca0997c9f6ad7731e61cdf5bcf9189ad9983f8b721271973317953e&scene=58&subscene=0#rd
source: 迪哥讲事
date: 2024-11-06
fetch_date: 2025-10-06T19:19:57.111060
---

# 云安全-s3对象存储攻防

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/YmmVSe19Qj7IQgN7cicj4AT8ZG39NTYrpicibRY6M9UEz3SKbqK4JZbc0doIyGyiaf8WERniaBdVkOcn76LcmGKFwng/0?wx_fmt=jpeg)

# 云安全-s3对象存储攻防

迪哥讲事

以下文章来源于剑客古月的安全屋
，作者苏心斋|月金剑客

![](http://wx.qlogo.cn/mmhead/dibCvqHg4WncsYKQOO8N6HULUqdiclOBngrrMRcia94YODoKo1RdGLzdaGhqoSxXPWDz2g0yZG2Ewk/0)

**剑客古月的安全屋**
.

本科在读，目前大三。曾在多家甲乙方大厂实习。技术栈：移动端(安卓IOS鸿蒙)攻防、web端爬虫、风控、空间测绘与抗测绘、web端基础安全攻防、渗透、安全开发、src挖掘、代码审计、免杀，LLM大模型(NLP，CV)

🌟 ❤️

作者：yueji0j1anke

首发于公号：剑客古月的安全屋

字数：1630

阅读时间:    15min

声明：**请勿利用文章内的相关技术从事非法测试，由于传播、利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者不为此承担任何责任。合法渗透，本文章内容纯属虚构，如遇巧合，纯属意外**

**目录**

* 前言
* 基础概念
* 对象存储攻防
* 总结

##

##

## 0x01 前言

之前多多少少都有所涉及云安全，但不够系统和具体，因此单独开辟一个专题来介绍深入云安全相关概念

## 0x02 基础概念

### 1.云服务

云服务代指云厂商提供的服务，国外有著名的AWS，国内比如说

阿里云、腾讯云、华为云

不同的云服务有不同的叫法，下面举几个例子

S3对象存储-> 类似于bucket存储桶、网盘

EC2弹性计算服务->云虚拟机、服务器

RDS云数据库->云数据库

IAM身份和访问管理->云服务器上的身份管理服务

### 2.S3云存储

如果大家经常挖src的话，可能早已接触过云存储服务，如下图所示

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38JD0KfEvaZPeyu3L3Xmam0If0IBIvQUg5WicFiaF44to32MPfeRUh24sw/640?wx_fmt=png&from=appmsg)

这样的页面可能存在漏洞(任意文件上传)

当然，现在我们先回归基础概念

在Amazon的标准下，对象存储中可以有多个bucket，有多个对象在bucket中，其中每个对象包含三个部分-> Key(sid)、Data(被存储的数据本身)和Metadata(元数据，类似于标签，方便查询排序)

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38GbyAvSXAfIdHhnceXxM5Zmhia1ZSIBsXnQZSBiciamdibaIrQxqlJKW5GQ/640?wx_fmt=png&from=appmsg)

## 0x03 对象存储攻防

### 1.公开访问漏洞

存储桶一旦设置了所有人可以公开访问，即会存在隐私泄密等问题，就比如此处

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38pqYrGuzZl94p0UlmWruibK7RTTFsZjsZia0iaWouzheFEpqNOia8WF6hicg/640?wx_fmt=png&from=appmsg)

访问下载泄露了部分版本号、部署信息

一旦访问存储服务 返回码为403则证明设置了权限访问，不存在该漏洞

### 2.Bucket爆破

类似于目录爆破，通过爆破获取到key进而获取到data内容，也属于隐私泄密的一种

我这里创建一个bucket进行演示

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo386fWuFPcGRutz9fxmtkW6HakCmdp7BEBZgcEJ8F1cYQJ4q7eAFwCmMw/640?wx_fmt=png&from=appmsg)

当地址错误，会提示NoSuchBucker或提示InvalidBucketName

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38S05LMSM5c9op7NyU9RcZqMibic6JhibD9TeSiaCp0NW8PKnOJVdno1vWVQ/640?wx_fmt=png&from=appmsg)

当地址正确，会显示正确页面(自然也就知道key)或者显示access denied

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38ddmWMgaIyDbDJJfmVd2kPhVuqDNdO1uBMIzAxQr4aicxia3zgFTNeotQ/640?wx_fmt=png&from=appmsg)

对应的，我们如果知道key，也就可以产生Bucket目录对象遍历了

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38CFpyg1dG2zKltO22KvFbnsiawe6p3cianLGrKc5Giacy5YECKPakicc36Q/640?wx_fmt=png&from=appmsg)

### 3.任意文件上传、覆盖删除

如何对于策略配置不当，则会导致Bucket桶内对象被任意添加、删除、篡改

只需简单的PUT、Delete请求即可完成任意文件上传、覆盖、删除操作

下面做个简单的demo演示

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38DZJdzsF6O6pWrRCib2zAM5tHXzkyMGAQZvOQptnhT4eoIyPFZyjq03w/640?wx_fmt=png&from=appmsg)

回过来访问查看是否上传成功

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38YXcOWgIRDtf64h61lB5p89Bg9oLQkegQfC2NPxdeO23ian3boGXHyOQ/640?wx_fmt=png&from=appmsg)

### 4.AK、SK泄露

超级大高危，一般发现点如下

1.github泄露

2.反编译apk、小程序拿到源码中的ak、sk(不过一般都是加密过的)

3.源代码、js中泄露

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38yW2EqWRcuCo1ZzDQ1cBdEILFvuVMticSr8bMBcjEmZiakvhJ0heVTSSA/640?wx_fmt=png&from=appmsg)

搜索关键词

```
access_key =
secret_access_key =
bucketregion =
```

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38Nmgu6rkzeSSzTHyFeMhZSaOCwTdEp6N4SuUOPjlQrgnUYVMDkbrhvw/640?wx_fmt=png&from=appmsg)

### 5.Bucket接管

这里以阿里云bucket为例

当我们访问bucket显示NoSuchBucket时，证明该存储桶可以被我们创建接管

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38KU9KdZXVa8Y7iadAibuI1s1TWhfAyE264jhWhxuqXaSiaib9zBZJZQiafYA/640?wx_fmt=png&from=appmsg)

如果有域名被绑定在该存储桶并已过期或被管理员删除该存储桶，我们就可以通过接管该存储桶进行域名下网页的接管篡改(类似于子域名接管)

比如该网站

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38pH4XmnLtwWqg2Ghpib3SAzYUhI6gHibwXMPuU6zocxtnk6wh3ETE9raQ/640?wx_fmt=png&from=appmsg)

被绑定在我的域名下

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38OQAX0ZnIVBCrnKkkRz2u48XQNWQ5a6ezSEHVbX6v9R9wC2elNpTx0g/640?wx_fmt=png&from=appmsg)

此时我去官网注册该bucket进行配置创建

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38ocziaoH97641D8Megh3WO5bAcgQc2riaHzbpqISHumTfhmaV8TjTanLg/640?wx_fmt=png&from=appmsg)

成功实现网页域名接管(bucket接管)

### 6.Bucket策略配置可写

访问bucket时，回显如下

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38A1mgubhFicic8MTsRwgicmqqYNMrbsCaSk44429DlXjbhWYU2WciayAYxw/640?wx_fmt=png&from=appmsg)

这里可以尝试一下bucket策略配置可写(前提是bucket策略配置了putbucketpolicy)

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38Fe4ticrTpJnsKZe36YaAHkCbaJ8Ugb14IEgCGrYgjpoFs4jf62pqN3w/640?wx_fmt=png&from=appmsg)

这里需要配置一下ossutil

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38dbMppibibRsFNnEFQ4Tz0H1foJNsFIG1csYFGnoXKHDmom9DhrzZQn0A/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38sl2qLwoOCqVqDkEqXlu7LfQ6P6CEUyQ4oeGj4arUa2ZRibr2zjSPicTg/640?wx_fmt=png&from=appmsg)

可以看到这里授权为deny，所以我们看不见存储桶，我们将其更改

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38NncoFib2fbYqnwvgOKV3Hbibva140bjx6licbF2TWZmItVVWLhLBIia0yw/640?wx_fmt=png&from=appmsg)

上传配置进行修改，再次访问

![](https://mmbiz.qpic.cn/mmbiz_png/wF30Z0OMuW3KoEnpzUibJtnVg8WPRWo38TQia81L3t4peVicaibteibH3kRMKkLJNstz4xp783kI60aCyxozkfueagA/640?wx_fmt=png&from=appmsg)

成功看到bucket里面的object内容

既然可以更改deny为allow，我们还可以让allow变为deny，使某些网页读取不了资源文件直接瘫痪

## 0x04 总结

总体来说，s3对象存储基本围绕bucket展开，进攻方式较为单一，但一旦挖到便是高危，笔者到目前为止也只从反编译小程序中挖到ak和sk解密，获得一个高危。切面较小，不过危害极大。后续将会为大家带来更多云安全内容。

如果你是一个长期主义者，欢迎加入我的知识星球，我们一起往前走，每日都会更新，精细化运营，微信识别二维码付费即可加入，如不满意，72 小时内可在 App 内无条件自助退款

![](https://mmbiz.qpic.cn/mmbiz_png/YmmVSe19Qj5EMr3X76qdKBrhIIkBlVVyuiaiasseFZ9LqtibyKFk7gXvgTU2C2yEwKLaaqfX0DL3eoH6gTcNLJvDQ/640?wx_fmt=png&from=appmsg)

## 往期回顾

[一款bp神器](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247495880&idx=1&sn=65d42fbff5e198509e55072674ac5283&chksm=e8a5faabdfd273bd55df8f7db3d644d3102d7382020234741e37ca29e963eace13dd17fcabdd&scene=21#wechat_redirect)

[ssrf绕过新思路](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247495841&idx=1&sn=bbf477afa30391b8072d23469645d026&chksm=e8a5fac2dfd273d42344f18c7c6f0f7a158cca94041c4c4db330c3adf2d1f77f062dcaf6c5e0&scene=21#wechat_redirect)

[dom-xss精选文章](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247488819&idx=1&sn=5141f88f3e70b9c97e63a4b68689bf6e&chksm=e8a61f50dfd1964692f93412f122087ac160b743b4532ee0c1e42a83039de62825ebbd066a1e&scene=21#wechat_redirect)

[年度精选文章](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247487187&idx=1&sn=622438ee6492e4c639ebd8500384ab2f&chksm=e8a604b0dfd18da6c459b4705abd520cc2259a607dd9306915d845c1965224cc117207fc6236&scene=21#wechat_redirect)

[Nuclei权威指南-如何躺赚](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247487122&idx=1&sn=32459310408d126aa43240673b8b0846&chksm=e8a604f1dfd18de737769dd512ad4063a3da328117b8a98c4ca9bc5b48af4dcfa397c667f4e3&scene=21#wechat_redirect)

[漏洞赏金猎人系列-如何测试设置功能IV](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247486973&idx=1&sn=6ec419db11ff93d30aa2fbc04d8dbab6&chksm=e8a6079edfd18e88f6236e237837ee0d1101489d52f2abb28532162e2937ec4612f1be52a88f&scene=21#wechat_redirect)

[漏洞赏金猎人系列-如何测试注册功能以及相关Tips](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247486764&idx=1&sn=9f78d4c937675d76fb94de20effdeb78&chksm=e8a6074fdfd18e59126990bc3fcae300cdac492b374ad3962926092aa0074c3ee0945a31aa8a&scene=21#wechat_redirect)

参考文献:

https://cloudsec.huoxian.cn/

预览时标签不可点

![]()

微信扫一扫
关注该公众号

继续滑动看下一个

轻触阅读原文

![](http://mmbiz.qpic.cn/mmbiz_png/YmmVSe19Qj4k2mXPm8xlXujVgicTGvZbcictoGLuPERQn9lRPAKkKUB5ut9XMicric8PxLRmSOq0tT5LuGuD1WemBQ/0?wx_fmt=png)

迪哥讲事

向上滑动看下一个

知道了

![]()
微信扫一扫
使用小程序

取消
允许

取消
允许

取消
允许

×
分析

![跳转二维码]()

![作者头像](http://mmbiz.qpic.cn/mmbiz_png/YmmVSe19Qj4k2mXPm8xlXujVgicTGvZbcictoGLuPERQn9lRPAKkKUB5ut9XMicric8PxLRmSOq0tT5LuGuD1WemBQ/0?wx_fmt=png)

微信扫一扫可打开此内容，
使用完整服务

：
，
，
，
，
，
，
，
，
，
，
，
，
。

视频
小程序
赞
，轻点两下取消赞
在看
，轻点两下取消在看
分享
留言
收藏
听过