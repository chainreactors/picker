---
title: VSCode CVE-2023-29338
url: https://govuln.com/news/url/098n
source: Sec-News 安全文摘
date: 2023-07-07
fetch_date: 2025-10-04T11:51:33.763953
---

# VSCode CVE-2023-29338

[明天的乌云](/)

透明人博客

* [首页](/)
* [分类](/categories/)
* [归档](/archives/)
* [日报专栏](https://daily.xlab.app/)
* [我的推荐](/links/)
* [友情链接](/friends/)
* [关于](/about/)
* 搜索

* 文章目录
* 站点概览

1. [1. 漏洞概述](#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0)
2. [2. 漏洞发现](#%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0)
3. [3. Bypass](#Bypass)
4. [4. CSRF/SSRF](#CSRF-x2F-SSRF)
5. [5. 有趣的利用](#%E6%9C%89%E8%B6%A3%E7%9A%84%E5%88%A9%E7%94%A8)
   1. [5.1. 非JSON文件](#%E9%9D%9EJSON%E6%96%87%E4%BB%B6)
   2. [5.2. 文件探针](#%E6%96%87%E4%BB%B6%E6%8E%A2%E9%92%88)
6. [6. Fix](#Fix)
7. [7. Timeline](#Timeline)
8. 8. 相关文章

![透明人](/images/logo.png)

透明人

Tmr Blog

[197
日志](/archives/)

[33
分类](/categories/)

[159
标签](/tags/)

0%

链接

* [透明日报](https://daily.xlab.app/ "https://daily.xlab.app")

# VSCode CVE-2023-29338

发表于
2023-06-07

分类于

[安全](/categories/%E5%AE%89%E5%85%A8/)
，
[漏洞挖掘](/categories/%E5%AE%89%E5%85%A8/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/)

阅读次数：

本文字数：
2.3k

阅读时长 ≈
2 分钟

VSCode CVE-2023-29338

## 漏洞概述

VS Code Information Disclosure Vulnerability

<https://github.com/microsoft/vscode/security/advisories/GHSA-mmfh-4pv3-39hr>

VS Code打开包含UNC路径数据的文件时，会导致NTLM hashes泄露

注意不是打开UNC路径的文件，只是文件中包含UNC路径

## 漏洞发现

在VS Code中可以自定义JSON Schema

> The association of a JSON file to a schema can be done either in the JSON file itself using the `$schema` attribute, or in the User or Workspace settings (File > Preferences > Settings) under the property `json.schemas`.
> <https://code.visualstudio.com/docs/languages/json#_json-schemas-and-settings>

可以在设置中配置，类似这样

|  |  |
| --- | --- |
| ``` 1 2 3 4 5 6 7 8 9 10 ``` | ``` {   "json.schemas": [     {       "fileMatch": [         ".babelrc.json"       ],       "url": "https://json.schemastore.org/babelrc.json"     },   ] } ``` |

或者在文件中配置

|  |  |
| --- | --- |
| ``` 1 2 3 4 ``` | ``` {   "$schema": "https://json.schemastore.org/babelrc.json",   "somekey": "abcd" } ``` |

这里就引入问题了，`schema`文件是由VS Code远程加载并解析的

然而这个远程地址不仅仅支持http，在Windows中还可以是一个UNC路径

最终实现打开一个JSON文件，就能收到NTLM hash

> 后面也去看了VS Code代码，支持文件路径，file协议之类的，其他的schema就不支持了，不然就是[另一个故事](/p/8fbece25/#URI-scheme)了

## Bypass

* Restricted Mode

<https://code.visualstudio.com/docs/editor/workspace-trust>

VS Code为了打开不受信文件做保护功能，这个模式下会禁用了一些功能和配置项，~~避免在看代码的时候被RCE~~

但并没有控制JSON Schema下载行为，所以这里提到的所有利用都可以在`Restricted Mode`中复现，工作区信任并不能缓解利用

* `json.schemaDownload.enable`

在设置中这个配置项可以控制是否从远程下载，默认开启

但只能控制http/https，对于UNC路径并没有用

## CSRF/SSRF

其实最早这个洞我是作为CSRF来对待的，在测试VS Code的各种环境后，发现这个漏洞非常通用，除了常见的桌面端，还有VSCode Web和VSCode Remote都可以利用

桌面端不必多说，直接从本机发起请求

VSCode Web是从浏览器发出，发一个`fetch`的跨域请求，纯CSRF，总体感觉价值不大，就没有细看了

VSCode Remote是从远程机器发出，这个就比较有趣了，有点SSRF的意思

值得一提的是GitHub Codespaces也是用的VSCode Remote，然后机器基本都在Azure上，云SSRF的想象空间就比较大了

## 有趣的利用

### 非JSON文件

前面提到这个依赖打开JSON文件，触发JSON Schema的功能

利用Automatic language detection功能，自动检测文本语言，开启相关功能

> <https://code.visualstudio.com/updates/v1_60#_automatic-language-detection>

这样无后缀的文件也能触发，只要内容是JSON就行

另外在YAML中也可以[使用JSON Schema](https://github.com/redhat-developer/vscode-yaml#associating-schemas)，所以也能用

### 文件探针

合理的设置`fileMatch`和`url`能够实现监控受害者打开文件

|  |  |
| --- | --- |
| ``` 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 ``` | ``` {   "json.schemas": [     {       "fileMatch": [         "file1.json"       ],       "url": "http://server/file1"     },     {       "fileMatch": [         "file2.json"       ],       "url": "http://server/file2"     },     {       "fileMatch": [         "file3"       ],       "url": "http://server/file3"     }   ] } ``` |

## Fix

看[fix commit](https://github.com/microsoft/vscode/commit/6a995c4f4cc2ced6e3237749973982e751cb0bf9)应该是在底层加了UNC路径的访问控制，通过白名单配置

## Timeline

* 2023.01.31 报告给微软
* 2023.02.11 开始修复
* 2023.05.15 修复完成

## 相关文章

* [Claude Code Router远程命令执行漏洞](https://blog.xlab.app/p/70dc71dc/)
* [蜜罐反制的现状与未来](https://blog.xlab.app/p/2b5e681a/)
* [eval5 前端沙箱逃逸与 CSP Bypass](https://blog.xlab.app/p/766bba8a/)
* [从Office诱饵到鸡肋RCE](https://blog.xlab.app/p/8fbece25/)
* [反制Goby-漏洞挖掘与利用](https://blog.xlab.app/p/9a9afc24/)

欢迎关注我的其它发布渠道

[Twitter](https://twitter.com/tmr11235)

[Telegram](https://t.me/tm_daily)

[RSS](/atom.xml)

[漏洞](/tags/%E6%BC%8F%E6%B4%9E/)
 [VSCode](/tags/VSCode/)
 [CVE](/tags/CVE/)

[eval5 前端沙箱逃逸与 CSP Bypass](/p/766bba8a/ "eval5 前端沙箱逃逸与 CSP Bypass")

[HoneypotGPT](/p/5cffec0/ "HoneypotGPT")

[地球ICP备42号](https://beian.miit.gov.cn/)

© 2016 –
2025

透明人

站点总字数：
343k

Theme NexT works best with JavaScript enabled