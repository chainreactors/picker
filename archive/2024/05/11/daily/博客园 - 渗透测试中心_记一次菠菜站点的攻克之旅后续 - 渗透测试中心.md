---
title: 记一次菠菜站点的攻克之旅后续 - 渗透测试中心
url: https://www.cnblogs.com/backlion/p/18184300
source: 博客园 - 渗透测试中心
date: 2024-05-11
fetch_date: 2025-10-06T17:17:07.084657
---

# 记一次菠菜站点的攻克之旅后续 - 渗透测试中心

[![](https://img2024.cnblogs.com/blog/35695/202509/35695-20250929100304557-587378723.jpg)](https://qoder.com/)

* [![博客园logo](//assets.cnblogs.com/logo.svg)](https://www.cnblogs.com/ "开发者的网上家园")
* [会员](https://cnblogs.vip/)
* [众包](https://www.cnblogs.com/cmt/p/18500368)
* [新闻](https://news.cnblogs.com/)
* [博问](https://q.cnblogs.com/)
* [闪存](https://ing.cnblogs.com/)
* [赞助商](https://www.cnblogs.com/cmt/p/19081960)
* [HarmonyOS](https://harmonyos.cnblogs.com/)
* [Chat2DB](https://chat2db-ai.com/)

* ![搜索](//assets.cnblogs.com/icons/search.svg)
  ![搜索](//assets.cnblogs.com/icons/enter.svg)
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    所有博客
  + ![搜索](//assets.cnblogs.com/icons/search.svg)

    当前博客
* [![写随笔](//assets.cnblogs.com/icons/newpost.svg)](https://i.cnblogs.com/EditPosts.aspx?opt=1 "写随笔")
  [![我的博客](//assets.cnblogs.com/icons/myblog.svg)](https://passport.cnblogs.com/GetBlogApplyStatus.aspx "我的博客")
  [![短消息](//assets.cnblogs.com/icons/message.svg)](https://msg.cnblogs.com/ "短消息")
  ![简洁模式](//assets.cnblogs.com/icons/lite-mode-on.svg)

  [![用户头像](//assets.cnblogs.com/icons/avatar-default.svg)](https://home.cnblogs.com/)

  [我的博客](https://passport.cnblogs.com/GetBlogApplyStatus.aspx)
  [我的园子](https://home.cnblogs.com/)
  [账号设置](https://account.cnblogs.com/settings/account)
  [会员中心](https://vip.cnblogs.com/my)
  简洁模式 ...
  退出登录

  [注册](https://account.cnblogs.com/signup)
  登录

[![返回主页](/skins/custom/images/logo.gif)](https://www.cnblogs.com/backlion/)

# [渗透测试中心](https://www.cnblogs.com/backlion)

##

* [博客园](https://www.cnblogs.com/)
* [首页](https://www.cnblogs.com/backlion/)
* [新随笔](https://i.cnblogs.com/EditPosts.aspx?opt=1)
* [联系](https://msg.cnblogs.com/send/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%BF%83)
* [管理](https://i.cnblogs.com/)
* 订阅
  [![订阅](/skins/coffee/images/xml.gif)](https://www.cnblogs.com/backlion/rss/)

# [记一次菠菜站点的攻克之旅后续](https://www.cnblogs.com/backlion/p/18184300 "发布于 2024-05-10 14:42")

## 前情提要

上回故事说到，骗子服务器的最高权限虽然已经拿到，但这也只是技术层面的掌控，想要立案，需要提供尽量多的人员相关信息，如手机、银行卡等，但这些目前都并未采集到（前面虽然提到了某次源码有个银行账户，但后面发现那只是个测试号，百度出来一堆在用的…），所以还需要通过一些额外的手段去获取有用的信息；

## 信息收集

### 宝塔后台

首先想到的就是之前一直留着没进去的宝塔面板后台，里面应该会有些登录信息之类，但并没有得到登录密码，但这也并没有太大影响，因为现在可以直接访问宝塔的数据库文件（panel/data/default.db， sqlite数据库文件），所以直接进去备份个账户然后设置个密码，防止把正常账户挤下去：

![cmd-change-baota-password](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144317406-33819272.png)

![cmd-baota-backup-user](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144318403-425993938.png)

清理下日志，然后就是愉快的登录进去 ㄟ( ▔, ▔ )ㄏ：

![front-baota-home](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144319216-820684372.png)

首先看到的就是账户名，想是管理员的手机号，这里看不全，去设置里面瞅瞅：

![front-baota-lookup-phone-elements](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144320041-384638747.png)

这里也是中间四位打了星号，从源码里也看不出，但这些也都是纸老虎，因为随后审查发现一处接口请求数据，返回信息里是完整的手机号，微信搜了下也有这个这么个账户：

![wechat-baota-phone](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144320781-2047252370.png)

但其真实性未知，多半只是个幌子，先记着吧；

### 新起点

在之后某个时间点准备继续收集信息的时候，发现其域名甚至IP都无法再访问了，后面几天试了也都不行，感觉可能是收割完一波然受卷款跑路了；自然，除了一些信息，之前获取的所有权限，都化作泡影了；也是在这之后，警察蜀黍竟主动联系了过来（没有喝茶，俺是良民 $\_$），由于想着再碰碰运气看看，结果有趣的事再次发生了，访问之前那个IP展示出了这么个页面：

![front-user-login](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144321616-603893038.png)

好吧得承认，那一瞬间确实差点信了这标题和图标，还浪费了三秒考虑渗透它的正当性，仔细想想也知道，真要是那家银行，怎么会把服务器放到有前科的IP身上，页面内容也说不过去，然后简单注册了个账号登录进去：

![front-user-home-1](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144322519-1621807479.png)

![front-user-home-2](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144323312-1691194193.png)

![front-user-home-3](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144324205-627022469.png)

## 漏洞挖掘

### 端口服务

=\_= 好吧，来都来了，就是个顺手的事；下面的分析也印证了上面的猜想，这也算是个IP反查域名 的小技巧，因为正常的工具比如 nslookup, dig 只能从域名到IP进行解析（某些有 ptr 的除外），但是遇到这种有使用 https 的站点，如果没有限制IP直接访问的话，能够正常进入页面，并且在浏览器左上角点击协议名还能查看所使用的证书，正常的证书的“颁发给”的值就是站点的域名，这里显然不是，应该是个临时或者测试证书：

![front-https-cert](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144324980-1673783900.png)

然后反过来对域名分析一波：

![cmd-nslookup-domain](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144325593-1546206771.png)

这里发现通过公共DNS解析出来的IP，和前面用的好像对不上号，细想下，应该就是使用了 CDN服务，这些IP对应的服务器都是提供服务的三方机构的，渗透没太大意义，并且也不容易，这里辛亏是直接通过源站IP进入的，不然要通过域名和CDN检索出源站还是另一项头疼的活儿；

那么有了域名就来扫一波子域名，获取潜在的关联站：

![cmd-enum-subdomain](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144326289-1635537152.png)

还真有不少，先记着备用，随后从前台页面的返回数据里分析，发现这是一台使用 php 的 Linux 服务器，和之前的 Windows IIS 服务器不同，看来应该是域名被释放或转卖了，那么就从新扫波端口吧：

![nmap-normal-scan](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144327029-375924110.png)

还是发现了一些熟悉的身影，依旧先后台跑着密码先吧，按以往的经验，遇到精明的主也许有漏网之鱼，所以还需要贴心的整套全端口扫描服务：

![nmap-all-port-scan](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144327746-1442063982.png)

还确实有，看协议大概能猜到是什么服务，挨个试试，发现一个是 ssh 登录，一个宝塔后台：

![cmd-ssh-login](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144328360-1850257657.png)

![front-bt-login](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144328977-2143662218.png)

宝塔依然有登录次数校验，爆破无望，只能先搁一边；

### 后台目录

这次都还没来得及用上目录爆破，手打了几个就盲猜了出来后台路径，倒也省工夫勒：

![front-admin-login-jump](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144329633-529450887.png)

![front-admin-login](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144330596-877543491.png)

双赢？不存在的，只会是单方面的 ╮（╯＿╰）╭，简单分析了会儿页面，这里就暂时不用祭出神器了，直接用 wfuzz 跑一波账户密码：

![cmd-wfuzz-admin-login](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144331428-805176034.png)

先放后台跑着，去其他地方转转；一会儿后就看到了结果，哟西！进去瞅瞅：

![front-admin-home](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144332271-872493648.png)

![front-admin-products](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144333010-1068744427.png)

![front-admin-user-bank](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144333704-1357237350.png)

![front-admin-user-info](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144334419-815139068.png)

![front-admin-user-charge](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144335252-1461134780.png)

麻雀虽小五脏俱全，然后也有一些预料中的有意思的东西：

![front-admin-user-withdraw](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144336161-336147511.png)

![front-admin-risk-control](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144336836-526667756.png)

提现那个就不说了，能否成功全看管理员心情，下面那个看不太明白也没关系，可能道理大家也都懂，反正就那么个意思，你的命运我掌控，你的风险我操纵 (¬‿¬)；

### Get webshell

后面花了点时间，分析了下页面找到一处可利用的漏洞，然后传个小玩意上去：

![front-backdoor-phpinfo](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144337530-837700307.png)

搞定，又到了亮剑的时刻：

![ant-file-site-root](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144338207-857142646.png)

往上遍历目录发现确实不简单，出现了之前的某些域名，难道是小站群，后面花了好一段时间才稍微搞懂他们的架构，多个二级域名指向当前IP，并拥有几个不同的CDN地址，然后某个二级域名又指向另一台服务器IP，当前IP的服务器呢又包含了另一个一级域名对应的二级域名，这几个站点又几乎在共享同一套代码，=\_= 真够复杂的，难道是业务拓展导致的计划不周么，不过着也不重要，对应到服务器就行；

![ant-file-more-sites](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144338855-1605355296.png)

然后就是访问 /etc/passwd 文件查看用户，因为这个文件在 Linux 中是所有用户可访问：

![ant-file-passwd](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144339548-860287699.png)

都是些默认账户，由于当前是 www 账户，所以是没有访问 /etc/shadow 文件的权限的，这个文件记录的是系统所有账户的密码的 hash 值，所以后面步骤就是提权了；

在浏览系统目录的时候，发现了 phpMyAdmin 的登录地址，难怪之前没扫出，应该是宝塔里配置过，生成随机的复杂路径来校验访问入口：

![ant-file-pma-path](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144340152-2087070191.png)

![front-pma-login](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144340767-451906831.png)

账户和密码就简单了，可通过某些手段获取，只是可惜对方并不是配置的 root 账户，而是一个子账户，用站点命名，应该是服务器有多站点的缘故，权限也不高，先登录进去看下：

![front-pma-home](https://img2023.cnblogs.com/blog/1049983/202405/1049983-20240510144341567-437837448.png)

内部包含的是站点前后台的一些数据，先找下有用的信息：

![front-pma-databases](https://img202...