---
title: 基于 Traefik ForwardAuth 实现集群服务统一认证
url: https://github.red/traefik-forward-auth/
source: Light Cube
date: 2024-09-08
fetch_date: 2025-10-06T18:22:27.077178
---

# 基于 Traefik ForwardAuth 实现集群服务统一认证

[![logo](/images/logo.svg)](https://github.red/)

[茅娄聳茅隆碌](/)

[氓聟鲁盲潞聨忙聢聭](/about-me/)

[莽禄聶忙聢聭莽聲聶猫篓聙](/guestbook/)

[氓聫聥忙聝聟茅聯戮忙聨楼](/my-friends/)

[忙聳聡莽芦聽氓陆聮忙隆拢](/archive/)

[忙聸麓忙聳掳忙聴楼氓驴聴](/update-history/)

![氓聼潞盲潞聨 Traefik ForwardAuth 氓庐聻莽聨掳茅聸聠莽戮陇忙聹聧氓聤隆莽禄聼盲赂聙猫庐陇猫炉聛](https://img14.360buyimg.com/ceco/jfs/t1/26017/13/22895/35345/66dc908dFcef2c1ee/e9bcbcbdfa2b20d9.png.webp)

## 氓聼潞盲潞聨 Traefik ForwardAuth 氓庐聻莽聨掳茅聸聠莽戮陇忙聹聧氓聤隆莽禄聼盲赂聙猫庐陇猫炉聛

[2024-09-07](//traefik-forward-auth//)芒聙垄
[忙聤聙忙聹炉](/categories/%E6%8A%80%E6%9C%AF/)
芒聙垄
3051 氓颅聴 / 6 氓聢聠茅聮聼

忙聢聭氓聹篓猫聟戮猫庐炉盲潞聭盲赂聤忙聹聣盲赂聙氓聫掳 4C8G 莽職聞 LightHouse 猫陆禄茅聡聫盲潞聭忙聹聧氓聤隆氓聶篓茂录聦忙聹聧氓聤隆氓聶篓盲赂聤盲陆驴莽聰篓 k3s 忙聬颅盲潞聠盲赂陋氓掳聫茅聸聠莽戮陇茅聝篓莽陆虏猫聡陋氓路卤氓录聙氓聫聭莽職聞氓掳聫莽聨漏忙聞聫茂录聦盲禄楼氓聫聤盲赂聙盲潞聸氓赂赂猫搂聛莽職聞氓聼潞莽隆聙莽禄聞盲禄露茫聙聜氓娄聜 Grafana 氓聛職盲禄陋猫隆篓莽聸聵氓卤聲莽陇潞茫聙聛Uptrace 猫庐掳氓陆聲 Go 莽篓聥氓潞聫莽職聞茅聯戮猫路炉茫聙聛Metabase 莽聰篓盲陆聹 NekoBox 莽職聞忙聲掳忙聧庐氓潞聯 BI茫聙聜猫驴聶盲潞聸忙聹聧氓聤隆茅聙職猫驴聡 Helm Charts 茅聝篓莽陆虏猫聡鲁茅聸聠莽戮陇茂录聦茅聟聧莽陆庐 Ingress 氓聬聨莽聸麓忙聨楼茅聙職猫驴聡氓聟卢莽陆聭氓聼聼氓聬聧氓聧鲁氓聫炉盲禄楼猫庐驴茅聴庐茫聙聜

忙聢聭忙聴露氓赂赂氓聹篓忙聝鲁猫驴聶盲潞聸莽卢卢盲赂聣忙聳鹿氓潞聰莽聰篓盲录職盲赂聧盲录職氓聯陋氓陇漏莽聢聠氓聡潞盲赂陋 0day 猫垄芦忙聣聯莽漏驴茫聙聜猫驴聸猫聙聦氓炉录猫聡麓忙聢聭氓颅聵氓聹篓茅聡聦茅聺垄莽職聞忙聲掳忙聧庐氓潞聯茅聟聧莽陆庐茫聙聛盲潞聭 AK SK 盲鹿聥莽卤禄莽職聞氓聡颅猫炉聛忙鲁聞茅聹虏茫聙聜氓聸聽猫聙聦氓聹篓忙聝鲁猫聝陆氓聬娄**氓聹篓茅聸聠莽戮陇莽職聞 Ingress 氓聫聧盲禄拢氓卤聜茅聺垄氓聛職莽禄聼盲赂聙莽職聞忙聺聝茅聶聬猫庐陇猫炉聛**茂录聦氓掳卤氓聝聫氓聟卢氓聫赂氓聠聟莽職聞忙聼聬莽禄聼盲赂聙猫庐陇猫炉聛莽鲁禄莽禄聼盲赂聙忙聽路 芒聙聰芒聙聰 氓聟路盲陆聯氓聬聧氓颅聴忙聢聭盲赂聧莽聼楼茅聛聯猫聝陆盲赂聧猫聝陆猫炉麓茂录聦盲赂聧猫驴聡盲陆聽氓潞聰猫炉楼氓聫炉盲禄楼氓聹篓氓聟卢莽陆聭盲赂聤忙聣戮氓聢掳氓庐聝莽職聞莽聴聲猫驴鹿茫聙聜

忙聢聭盲赂聙莽聸麓猫搂聣氓戮聴茂录聦猫驴聶莽搂聧忙聻露猫庐戮氓聹篓氓聫聧盲禄拢盲赂聤莽職聞莽禄聼盲赂聙猫庐陇猫炉聛茂录聦忙炉聰茅聜拢盲潞聸猫路鲁莽卢卢盲赂聣忙聳鹿 OAuth 莽職聞茅陋聦猫炉聛忙聳鹿氓录聫氓庐聣氓聟篓氓陇職盲潞聠茫聙聜

莽禄聫氓赂赂猫聝陆莽聹聥氓聢掳盲赂聙盲潞聸盲录聛盲赂職氓聠聟茅聝篓莽職聞 Web 莽芦聶茂录聦氓聛職莽職聞氓聣聧氓聬聨莽芦炉氓聢聠莽娄禄莽職聞忙聻露忙聻聞茫聙聜莽卢卢盲赂聙忙卢隆猫庐驴茅聴庐忙聴露氓聤聽猫陆陆氓聣聧莽芦炉茅隆碌茅聺垄茂录聦氓聣聧莽芦炉茅聙禄猫戮聭氓聢陇忙聳颅莽聰篓忙聢路忙聹陋莽聶禄氓陆聲茂录聦猫路鲁猫陆卢氓聢掳莽卢卢盲赂聣忙聳鹿 SSO 氓聛職莽禄聼盲赂聙莽聶禄氓陆聲茫聙聜莽聶禄氓陆聲忙聢聬氓聤聼氓聬聨 callback 盲赂聙盲赂陋 SSO Token 氓聸聻氓聨聼莽芦聶莽聜鹿茫聙聜莽聞露氓聬聨氓聬聨莽芦炉 API 莽颅戮盲赂聙盲赂陋猫聡陋氓路卤盲赂職氓聤隆莽職聞 Token 氓聫聭莽禄聶氓聣聧莽芦炉茂录聦氓聣聧莽芦炉忙聤聤盲赂職氓聤隆 Token 忙聰戮 Local Storage 茅聡聦氓颅聵莽聺聙茫聙聜莽聰卤盲潞聨莽陆聭莽芦聶忙聵炉氓聣聧氓聬聨莽芦炉氓聢聠莽娄禄莽職聞茂录聦忙聰禄氓聡禄猫聙聟氓聹篓忙聹陋莽聶禄氓陆聲莽職聞忙聴露氓聙聶氓掳卤氓聫炉盲禄楼猫庐驴茅聴庐氓聣聧莽芦炉茂录聦盲禄聳氓掳卤氓聫炉盲禄楼盲禄聨氓聣聧莽芦炉忙聣聯氓聦聟氓聬聨莽職聞 JavaScript 茅聡聦忙聤聤氓聬聨莽芦炉忙聨楼氓聫拢氓聟篓忙聫聬氓聫聳氓聡潞忙聺楼氓聨禄 Fuzz茫聙聜茂录聢忙聸麓氓聢芦猫炉麓猫驴聵忙聹聣盲潞聸盲赂聧氓聟鲁 Sourcemap 莽職聞茂录聣氓聬聨莽芦炉氓聹篓氓庐聻莽聨掳盲赂聤盲赂聡盲赂聙忙录聫盲潞聠盲赂陋猫路炉莽聰卤茂录聦茅聣麓忙聺聝盲赂颅茅聴麓盲禄露忙虏隆氓聦聟氓聢掳茂录聢氓戮聙氓戮聙猫驴聵忙聵炉盲潞聸盲赂聤盲录聽盲赂聥猫陆陆忙聳聡盲禄露莽職聞忙聨楼氓聫拢茂录聣茂录聦莽聞露氓聬聨氓掳卤忙聨楼氓聫拢猫露聤忙聺聝盲赂聙忙聤聤忙垄颅盲潞聠茫聙聜

氓聸聽忙颅陇忙聢聭猫搂聣氓戮聴盲戮聸氓聠聟茅聝篓盲陆驴莽聰篓莽職聞忙聹聧氓聤隆茂录聦盲赂聧莽庐隆忙聵炉氓聼潞盲潞聨莽卢卢盲赂聣忙聳鹿莽職聞猫驴聵忙聵炉猫聡陋氓禄潞莽職聞茂录聦茅聝陆氓潞聰猫炉楼氓聹篓莽陆聭氓聟鲁氓卤聜茅聺垄氓聛職盲赂聙氓楼聴莽禄聼盲赂聙莽職聞茅聣麓忙聺聝茫聙聜

茅聜拢盲鹿聢猫炉麓氓鹿虏氓掳卤氓鹿虏茂录聛氓聹篓忙聼楼茅聵聟盲潞聠莽聸赂氓聟鲁猫碌聞忙聳聶氓聬聨茂录聦莽芦聶氓聹篓氓聣聧盲潞潞莽職聞猫聜漏猫聠聙盲赂聤茂录聦忙聢聭茅聙聽盲潞聠盲赂陋氓掳聫猫陆庐氓颅聬 芒聙聰芒聙聰 ikD茫聙聜

![ikd_web_screenshot](/images/2024/09/ikd_web_screenshot.png)

## 忙炉聰 traefik-forward-auth 莽庐聙忙麓聛

莽聰卤盲潞聨盲陆驴莽聰篓 k3s 忙聬颅氓禄潞莽職聞茅聸聠莽戮陇盲录職氓聠聟莽陆庐盲赂聙盲赂陋 Traefik 氓聛職盲赂潞茅禄聵猫庐陇莽職聞 Ingress Class茂录聦忙聢聭盲鹿聼氓掳卤氓聸麓莽禄聲 Traefik 忙聺楼氓卤聲氓录聙盲潞聠茫聙聜ikD 猫驴聶盲赂陋氓聬聧氓颅聴茂录聦氓聟露氓庐聻盲鹿聼氓掳卤忙聵炉氓聫聳猫聡陋 Traef**ik** I**D** 盲赂颅莽職聞盲赂聣盲赂陋氓颅聴忙炉聧茫聙聜盲赂聙氓录聙氓搂聥忙聝鲁氓聫芦 `ikID` 莽職聞茂录聦盲陆聠忙聵炉盲禄聰莽禄聠盲赂聙猫炉禄氓聝聫忙聵炉盲禄聙盲鹿聢氓聞驴莽芦楼氓聯聛莽聣聦……茂录聼茅聛聜忙聰鹿氓聬聧茫聙聜

忙聢聭莽職聞忙聝鲁忙鲁聲忙聵炉氓聟聢忙聣戮忙聣戮莽聹聥 Traefik 忙聹聣忙虏隆忙聹聣莽卤禄盲录录 K8s Mutating Webhook 莽職聞莽聣鹿忙聙搂茂录聦氓陆聯氓聡聠氓陇聡盲禄拢莽聬聠盲赂聙盲赂陋茅聸聠莽戮陇氓聠聟莽職聞 Service 忙聴露茂录聦氓聟聢氓聨禄猫掳聝莽聰篓盲赂聙盲赂聥忙聢聭氓聠聶氓戮聴芒聙聹WebHook芒聙聺茂录聦莽聰卤忙聢聭忙聺楼忙聦聡忙聦楼氓庐聝氓聬聨莽禄颅莽職聞猫隆聦盲赂潞茫聙聜忙聣戮盲潞聠盲赂聙氓聹聢氓聫聭莽聨掳 Traefik 茅聡聦猫驴聵莽聹聼忙聹聣猫驴聶忙聽路盲赂聙盲赂陋盲赂颅茅聴麓盲禄露茂录職[ForwardAuth](https://doc.traefik.io/traefik/middlewares/http/forwardauth/)茂录聦氓聬聦忙聴露猫驴聵忙聣戮氓聢掳盲潞聠氓聣聧盲潞潞氓录聙氓聫聭莽職聞 [traefik-forward-auth](https://github.com/thomseddon/traefik-forward-auth/) 茅隆鹿莽聸庐茫聙聜猫炉楼茅隆鹿莽聸庐氓聢漏莽聰篓 ForwardAuth 盲赂颅茅聴麓盲禄露猫庐漏 Traefik 氓聫聧盲禄拢忙聰炉忙聦聛氓聣聧莽陆庐盲陆驴莽聰篓 Google 猫麓娄氓聫路忙聢聳 OpenID 忙聹聧氓聤隆猫驴聸猫隆聦猫潞芦盲禄陆猫庐陇猫炉聛茫聙聜莽聞露猫聙聦忙聢聭氓戮聢氓掳聭莽聰篓 Google 猫麓娄氓聫路莽聶禄氓陆聲茂录聦OAuth茫聙聛OpenID茫聙聛SAML 茅聜拢盲潞聸莽聨漏忙聞聫忙聸麓忙聵炉氓聜禄氓聜禄氓聢聠盲赂聧忙赂聟茂录聦忙聙禄盲赂聧猫聝陆盲赂潞盲潞聠莽聰篓猫驴聶莽聨漏忙聞聫忙聢聭氓聠聧氓聨禄忙鲁篓氓聠聦盲赂陋 Auth0 氓聬搂茂录聼茂录聛

氓聸聽忙颅陇忙聢聭氓聹篓茅聵聟猫炉禄盲潞聠 traefik-forward-auth 莽職聞忙潞聬莽聽聛氓聬聨茂录聦氓聠聶盲潞聠 ikD 猫驴聶盲赂聙莽聣聢忙聥楼忙聹聣忙聸麓莽庐聙忙麓聛忙聸麓茅聙聜氓聬聢忙聢聭猫聡陋氓路卤盲陆驴莽聰篓莽職聞 Traefik ForwardAuth 猫庐陇猫炉聛忙聹聧氓聤隆茫聙聜

## ForwardAuth

Traefik 忙聹卢猫潞芦盲赂聧忙聰炉忙聦聛莽聰篓忙聢路莽录聳氓聠聶猫聡陋氓庐職盲鹿聣茅聙禄猫戮聭莽職聞盲赂颅茅聴麓盲禄露茂录聦氓聫陋猫聝陆氓掳聠氓庐聵忙聳鹿忙聳聡忙隆拢盲赂颅莽禄聶莽職聞氓聠聟莽陆庐盲赂颅茅聴麓盲禄露莽庐聙氓聧聲茅聟聧莽陆庐氓聬聨盲陆驴莽聰篓茫聙聜忙炉聰氓娄聜氓庐聵忙聳鹿莽禄聶盲陆聽忙聫聬盲戮聸盲潞聠盲赂陋 `Errors` 茅聰聶猫炉炉盲赂颅茅聴麓盲禄露茂录聦茅聜拢盲陆聽氓聫炉盲禄楼猫聡陋氓路卤茅聟聧莽陆庐氓聯陋盲潞聸莽聤露忙聙聛莽聽聛猫娄聛忙聤楼茅聰聶茂录聦盲禄楼氓聫聤忙聤楼茅聰聶茅隆碌茅聺垄莽職聞氓聹掳氓聺聙忙聵炉氓聲楼茫聙聜

ForwardAuth 氓掳卤忙聵炉氓庐聵忙聳鹿忙聫聬盲戮聸莽職聞莽聰篓盲潞聨猫陆卢氓聫聭猫炉路忙卤聜氓聢掳氓陇聳茅聝篓忙聹聧氓聤隆猫驴聸猫隆聦茅陋聦猫炉聛莽職聞盲赂颅茅聴麓盲禄露茫聙聜猫驴聶茅聡聦莽聸麓忙聨楼猫麓麓忙聳聡忙隆拢茅聡聦莽職聞氓聸戮茂录聦忙聳鹿盲戮驴氓聬聨忙聳聡盲禄聥莽禄聧茫聙聜

![authforward](/images/2024/09/authforward.png)

氓炉鹿盲潞聨盲陆驴莽聰篓盲潞聠 ForwardAuth 盲赂颅茅聴麓盲禄露莽職聞猫路炉莽聰卤茂录聦Traefik 盲录職氓聟聢猫炉路忙卤聜 `address` 盲赂颅茅聟聧莽陆庐莽職聞莽卢卢盲赂聣忙聳鹿忙聹聧氓聤隆氓聹掳氓聺聙茂录聦氓鹿露盲陆驴莽聰篓 `X-Forwarded-*` 猫炉路忙卤聜氓陇麓盲录聽茅聙聮盲赂聤忙赂赂猫炉路忙卤聜莽職聞猫炉路忙卤聜忙聳鹿氓录聫茫聙聛氓聧聫猫庐庐茫聙聛盲赂禄忙聹潞氓聬聧茫聙聛URL茫聙聛忙潞聬 IP 氓聹掳氓聺聙莽禄聶莽卢卢盲赂聣忙聳鹿忙聹聧氓聤隆茫聙聜莽卢卢盲赂聣忙聳鹿忙聹聧氓聤隆氓掳卤氓聫炉盲禄楼忙聽鹿忙聧庐猫驴聶盲潞聸盲驴隆忙聛炉忙聺楼忙聣搂猫隆聦猫聡陋氓庐職盲鹿聣莽職聞茅陋聦猫炉聛茅聙禄猫戮聭盲潞聠茂录聦猫聥楼莽卢卢盲赂聣忙聳鹿忙聹聧氓聤隆猫驴聰氓聸聻 2XX 氓聯聧氓潞聰莽聽聛茂录聦氓聢聶盲禄拢猫隆篓茅陋聦猫炉聛茅聙職猫驴聡茂录聸氓聬娄氓聢聶茅陋聦猫炉聛盲赂聧茅聙職猫驴聡茂录聦Traefik 氓掳聠忙聤聤莽卢卢盲赂聣忙聳鹿忙聹聧氓聤隆莽職聞氓聯聧氓潞聰盲录聽莽禄聶盲赂聤忙赂赂茫聙聜

猫驴聶盲赂陋猫庐戮猫庐隆氓聧聛氓聢聠莽庐聙忙麓聛茫聙聜茅陋聦猫炉聛盲赂聧茅聙職猫驴聡忙聴露猫驴聰氓聸聻莽卢卢盲赂聣忙聳鹿忙聹聧氓聤隆莽職聞氓聯聧氓潞聰茂录聦氓聫炉盲禄楼忙聳鹿盲戮驴忙聢聭盲禄卢氓掳聠忙聹陋茅陋聦猫炉聛莽聰篓忙聢路 302 猫路鲁猫陆卢氓聢掳莽聶禄氓陆聲茅隆碌茅聺垄茫聙聜

氓聙录氓戮聴盲赂聙忙聫聬莽職聞忙聵炉茂录聦忙聢聭氓聧聛氓聢聠氓楼陆氓楼聡 Traefik 忙潞聬莽聽聛盲赂颅氓聟鲁盲潞聨 2XX 氓聯聧氓潞聰莽聽聛莽職聞氓聢陇忙聳颅忙聳鹿氓录聫茂录聦忙聢聭盲禄楼盲赂潞盲录職忙聵炉 `statusCode / 100 == 2` 猫驴聶忙聽路莽職聞氓聠聶忙鲁聲茂录聦盲陆聠氓庐聻茅聶聟忙聵炉茂录職

```
// https://github.com/traefik/traefik/blob/9dc2155e637318c347b8b00e084c3dd0c75f18e4/pkg/middlewares/auth/forward.go#L187-L189

// Pass the forward response's body and selected headers if it
// didn't return a response within the range of [200, 300).
if forwardResponse.StatusCode < http.StatusOK || forwardResponse.StatusCode >= http.StatusMultipleChoices {
```

氓庐聝忙聵炉氓聢陇忙聳颅莽聤露忙聙聛莽聽聛莽職聞忙聲掳氓颅聴忙聵炉氓聬娄猫聬陆氓聹篓 `[200, 300)` 猫驴聶盲赂陋氓聦潞茅聴麓氓聠聟茂录聦忙聢聭忙聞聼猫搂聣猫驴聶忙聽路莽職聞氓聠聶忙鲁聲氓聫炉盲禄楼猫搂聞茅聛驴忙聨聣 `statusCode / 100 == 2` 盲赂颅氓聡潞莽聨掳莽職聞 `2` 猫驴聶盲赂陋 Magic Number茫聙聜氓聹篓 Lint 盲赂聤盲录職忙聸麓氓楼陆盲赂聙盲潞聸茫聙聜

## 氓庐聦忙聲麓莽職聞莽聶禄氓陆聲忙碌聛莽篓聥

![ikd_user_signin](/images/2024/09/ikd_user_signin.png)

莽聰禄盲潞聠氓录聽氓聸戮忙聺楼忙垄鲁莽聬聠 ikD 忙聵炉忙聙聨忙聽路氓陇聞莽聬聠莽聰篓忙聢路莽聶禄氓陆聲莽職聞茫聙聜

1. 莽聰篓忙聢路猫炉路忙卤聜盲潞聠 `https://hello.example.com/index.php` 莽陆聭莽芦聶茂录聦茅聸聠莽戮陇氓聠聟 Traefik 猫炉路忙卤聜 ikD 忙聹聧氓聤隆茂录聦ikD 氓聫聭莽聨掳莽聰篓忙聢路忙聹陋莽聶禄氓陆聲茂录聦猫驴聰氓聸聻 302 猫路鲁猫陆卢氓聢掳 `https://ikd.example.com/?redirect=https://hello.example.com/index.php`茫聙聜
2. 莽聰卤盲潞聨莽聤露忙聙聛莽聽聛茅聺聻 2XX茂录聦Traefik 莽聼楼茅聛聯猫驴聶忙聵炉茅陋聦猫炉聛盲赂聧茅聙職猫驴聡茂录聦氓掳聠 ikD 莽職聞 302 氓聯聧氓潞聰猫驴聰氓聸聻莽禄聶盲赂聤忙赂赂茫聙聜莽聰篓忙聢路莽職聞忙碌聫猫搂聢氓聶篓猫路鲁氓聢掳盲潞聠莽聶禄氓陆聲茅隆碌茫聙聜茂录聢猫驴聶茅聡聦猫路鲁猫陆卢莽職聞 URL 茅聡聦 Query 茅聹聙猫娄聛氓赂娄盲赂聙盲赂聥忙聺楼忙潞聬 URL茂录聦忙聳鹿盲戮驴莽聶禄氓陆聲忙聢聬氓聤聼氓聬聨猫路鲁氓聸聻氓聨禄茂录聣
3. 莽聶禄氓陆聲茅隆碌`https://ikd.example.com/` 忙聵炉氓聧聲莽聥卢氓聛職莽職聞 Web 忙聹聧氓聤隆茂录聦莽聰篓忙聢路氓聹篓猫驴聶茅聡聦忙聫聬盲潞陇氓聡颅猫炉聛莽聶禄氓陆聲忙聢聬氓聤聼茂录聦氓聬聨莽芦炉忙聨楼氓聫拢盲录職氓聹篓忙聺楼忙潞聬 URL 盲赂颅氓聤聽盲赂聤盲赂聙盲赂陋 `ikdcode` Query 氓聫聜忙聲掳茂录聦氓娄聜茂录職`https://hello.example.com/index.php?ikdcode=a1b2c3d4e5f6g7` 氓聣聧莽芦炉忙聨搂氓聢露莽聰篓忙聢路忙碌聫猫搂聢氓聶篓猫路鲁猫陆卢氓聢掳猫炉楼氓聹掳氓聺聙茫聙聜
4. 猫路鲁氓聢掳 `hello.example.com` 氓聼聼盲赂聥氓聬聨茂录聦氓聫聢猫垄芦 ikD ForwardAuth 盲赂颅茅聴麓盲禄露忙聥娄盲潞聠茂录聦盲陆聠氓庐聝氓聫聭莽聨掳猫驴聶忙卢隆氓陇職盲潞聠盲赂陋 `ikdcode` 氓聫聜忙聲掳茂录聦盲录職氓聨禄茅陋聦猫炉聛猫驴聶盲赂陋氓聫聜忙聲掳忙聵炉氓聬娄忙聹聣忙聲聢茫聙聜氓娄聜忙聻聹忙聹聣忙聲聢茂录聦氓聢聶盲录職氓聹篓猫驴聰氓聸聻 302 猫路鲁猫陆卢氓聢掳氓聨禄茅聶陇 `ikdcode` 莽職聞氓聹掳氓聺聙茂录職`https://hello.example.com/index.php`茂录聦**氓鹿露 Set-Cookie**茫聙聜**猫驴聶茅聡聦忙聵炉忙聲麓盲赂陋莽聶禄氓陆聲猫驴聡莽篓聥盲赂颅忙聢聭猫庐陇盲赂潞忙聹聙氓路搂氓娄聶莽職聞氓聹掳忙聳鹿茂录職ForwardAuth 盲赂颅茅聴麓盲禄露氓聤芦忙聦聛盲潞聠莽聸庐忙聽聡莽芦聶莽職聞氓聯聧氓潞聰茂录聦猫驴聰氓聸聻 `Set-Cookie` 氓陇麓猫庐漏氓庐聝氓聫炉盲禄楼氓聹篓莽聸庐忙聽聡莽芦聶莽職聞氓聼聼氓聬聧盲赂聥氓聠聶盲赂聙盲赂陋 ikD 莽職聞 Cookie茫聙聜**
5. 莽聰篓忙聢路忙碌聫猫搂聢氓聶篓氓聠聧忙卢隆猫路鲁氓聢掳 `https://hello.example.com/index.php` 茂录聦盲录職氓赂娄盲赂聤盲鹿聥氓聣聧盲赂聙忙颅楼猫庐戮莽陆庐莽職聞 Cookie茫聙聜忙颅陇忙聴露氓聠聧猫垄芦 ikD 忙聥娄忙聢陋茂录聦ikD 猫庐陇氓聡潞盲潞聠猫驴聶盲赂陋 Cookie 氓鹿露茅陋聦猫炉聛茅聙職猫驴聡茂录聦猫驴聰氓聸聻莽聤露忙聙聛莽聽聛 `200 OK`茂录聦猫聡鲁忙颅陇猫炉路忙卤聜莽禄聢盲潞聨猫聝陆氓陇聼猫垄芦猫陆卢氓聫聭氓聢掳氓聬聨茅聺垄莽職聞 `hello.example.com` 忙聹聧氓聤隆莽職聞 Service 盲赂聤盲潞聠茫聙聜

氓聟路盲陆聯氓聢掳盲禄拢莽聽聛氓庐聻莽聨掳盲赂聤茂录聦忙聹聣盲赂聙盲潞聸莽禄聠猫聤聜茅聹聙猫娄聛忙鲁篓忙聞聫茂录職

1. ikD 莽聶禄氓陆聲茅隆碌莽聶禄氓陆聲忙聢聬氓聤聼氓聬聨茂录聦盲鹿聼茅聹聙猫娄聛莽禄聶 `https://ikd.example.com/` Session 氓颅聵盲赂陋莽聶禄氓陆聲忙聙聛茂录聦盲赂聥忙卢隆氓聠聧猫路鲁猫驴聡忙聺楼茂录聦氓聫聭莽聨掳盲鹿聥氓聣聧氓路虏莽禄聫莽聶禄氓陆聲猫驴聡盲潞聠茂录聦莽聸麓忙聨楼猫路鲁猫碌掳氓掳卤猫隆聦茫聙聜
2. `ikdcode` 忙聥录忙聨楼氓聬聨盲陆聹盲赂潞 Redis 莽職聞 Key茂录聦Value 氓颅聵氓聜篓莽聸庐莽職聞莽芦聶莽聜鹿莽職聞 Proto + Host茫聙聜氓庐聻茅聶聟莽聶禄氓陆聲忙聴露茂录聦莽聰篓忙聢路忙聥驴氓聢掳氓赂娄 `ikdcode` 莽職聞 URL 氓聡聽莽搂聮盲赂聧氓聢掳氓掳卤猫路鲁猫陆卢氓聨禄茅陋聦猫炉聛盲潞聠茂录聦忙聣聙盲禄楼 Key 莽職聞忙聹聣忙聲聢忙聹聼氓聫炉盲禄楼猫庐戮莽陆庐莽職聞莽聼颅盲赂聙莽聜鹿茂录聦氓娄聜盲赂聙氓聢聠茅聮聼茫聙聜氓聝聫盲赂聤茅聺垄莽職聞盲戮聥氓颅聬氓聹篓 Redis 盲赂颅氓颅聵氓聜篓莽職聞氓掳卤忙聵炉茂录職

```
redis.SetEx("ikd:authcode:a1b2c3d4e5f6g7", "https://hello.example.com", 1*time.Minute)
```

3. 忙聽隆茅陋聦`ikdcode` 忙聴露茂录聦盲陆驴莽聰...