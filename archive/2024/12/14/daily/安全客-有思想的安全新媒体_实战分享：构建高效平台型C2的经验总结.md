---
title: 实战分享：构建高效平台型C2的经验总结
url: https://www.anquanke.com/post/id/302717
source: 安全客-有思想的安全新媒体
date: 2024-12-14
fetch_date: 2025-10-06T19:37:38.402518
---

# 实战分享：构建高效平台型C2的经验总结

首页

阅读

* [安全资讯](https://www.anquanke.com/news)
* [安全知识](https://www.anquanke.com/knowledge)
* [安全工具](https://www.anquanke.com/tool)

活动

社区

学院

安全导航

内容精选

* [专栏](/column/index.html)
* [精选专题](https://www.anquanke.com/subject-list)
* [安全KER季刊](https://www.anquanke.com/discovery)
* [360网络安全周报](https://www.anquanke.com/week-list)

# 实战分享：构建高效平台型C2的经验总结

阅读量**528676**

|评论**3**

发布时间 : 2024-12-13 09:49:41

**x**

##### 译文声明

本文是翻译文章

译文仅供参考，具体内容表达以及含义原文为准。

`作者@一份布丁`

在红队演习中，C2（指挥与控制，Command & Control）系统作为关键的基础设施，对行动的成功起着至关重要的作用。随着攻防技术的不断进化，一些C2工具因其卓越性能和适应性而获得了广泛的认可。然而，面对日益先进的防御机制，红队成员通常需要对这些工具进行定制化开发和优化，以满足特定任务的需求。
本文将深入探讨一种基于在线平台的C2架构设计，该架构旨在通过实践构建一个具有更强隐蔽性和持久性的自研C2系统。我们将介绍如何利用在线服务的特点，来创建一个既能在复杂网络环境中保持低调运行，又能有效支持红队操作的指挥控制系统。

## 常见C2架构介绍

在国内，商用化的C2（指挥与控制，Command & Control）解决方案相对稀缺，因此红队和安全研究人员更多依赖于开源的C2框架，如Havoc、Sliver、Mythic等，或是对商业化的C2工具（例如Cobalt Strike、BRC4、Nighthawk C2等）进行破解或二次开发。这些工具虽然来源不同，但它们在通信原理上却有着相似之处，普遍采用HTTP、HTTPS、DNS等标准互联网协议来实现攻击者与受控目标之间的通信。
典型的C2操作流程包括：首先，在一台VPS（虚拟专用服务器）上部署TeamServer作为中央控制节点；然后，攻击者通过本地客户端连接到该TeamServer；最后，生成并部署恶意软件，使其回连至TeamServer，从而建立命令与控制通道。这种架构允许攻击者远程执行命令、管理植入物，并接收从受控系统中提取的数据。
![]()

我们来分析implant（植入体）在整个过程中到底做了什么

1. Implant首先需要与部署在VPS上的TeamServer建立一个安全、可靠的通信通道。这通常通过HTTP、HTTPS或DNS等标准协议实现，以确保数据传输的隐蔽性和稳定性。
2. Implant启动后，会立即收集目标主机的基础信息，如操作系统版本、网络配置、用户名等，这些信息统称为元数据（Metadata）。收集完成后，Implant会将这些元数据发送回TeamServer，标志着该主机已成功上线，可供进一步操作。
3. 为了减少被检测的风险，Implant通常会在完成初始通信后进入休眠状态。这种设计使得Implant在非活跃状态下几乎不产生任何网络流量，从而降低了被发现的可能性。
4. 命令控制的方式一般分为会话模式（Session Mode)和信标模式（Beacon Mode），在会话模式下，Implant与TeamServer之间保持持续的连接，允许攻击者即时下发指令并接收响应。这种方式虽然提供了无延迟的交互体验，但由于其持续的网络活动，更容易被防御系统识别。信标模式是更为隐蔽且常用的方式。Implant在休眠一段时间后，定期向TeamServer发起请求，检查是否有新的命令。信标模式通过间歇性的通信减少了连续的网络流量，显著降低了被检测的风险。
5. implant在休眠结束后，需要从TeamServer接收到命令（例如，shell whoami），它会解析并执行该命令（这里实际上不是接收命令，而是去请求获取命令，implant的所有操作和执行结果都是通过请求的方式进行单向访问）。执行完毕后，Implant会将结果封装并通过相同的通信通道发送回TeamServer。随后，再次进入休眠状态，等待下一次唤醒周期的到来。
6. 这一过程是循环进行的，Implant根据设定的时间间隔或特定条件不断重复上述步骤，确保能够及时响应来自TeamServer的新指令，并将执行结果反馈给攻击者。

深入了解植入体的工作流程后，我们可以认识到它在C2架构中占据着至关重要的位置。因此，在进行C2系统的武器开发时，必须将更多资源和精力投入到植入体的设计与优化中。开发过程中，应尽量避免使用第三方库和直接调用Windows API，转而采用自研代码和内置功能，以减少攻击面并提高隐蔽性。同时，持续优化植入体的核心逻辑，确保其轻量化、高效运行，从而在复杂的网络环境中具备更强的对抗能力。这种策略不仅提升了植入体的稳定性和隐蔽性，还增强了整个C2系统的实战效能。

### 现存痛点问题

在实战场景中，攻击者通常会使用海外注册的域名加云函数等方式来隐藏自己的C2通信地址，这种方法很容易受到威胁情报和恶意域名巡查等SOC手法的针对。当我们使用同一个C2上线控制了多台主机，蓝队成员一旦排查到一个C2回连地址，就会从DNS侧封禁域名解析，从而导致我们同时失去了多台主机权限。
常见的C2工具特征过于明显，如CS生成的shellcode/implant过于固定，导致杀毒软件很容易查杀其特征，所以通常不得不去构建复杂的loader，或者二开implant去对抗杀毒软件的查杀。

## 平台型C2-披着羊皮的狼

平台型C2的核心在于充分利用在线平台的现有功能，将其作为接收和下发命令、传输执行结果的服务端。这样一来，植入体（implant）的所有通信均通过这些在线平台进行，不仅极大地提升了通信的隐蔽性，还增强了系统的对抗能力。借助在线平台的广泛使用和正常流量掩护，C2通信可以更好地规避检测，确保长期稳定的控制通道。这种设计使得攻击活动更加难以被发现和追踪，为红队行动提供了强大的支持。

### 平台型C2实践-Redeemer C2

仓库地址：<https://github.com/Cherno-x/Redeemer-C2>

Redeemer C2是一款使用Rust编写的平台型C2，旨在滥用可信域名的API平台进行命令控制，用来对抗恶意域名巡查，是一款专注于权限维持的C2工具。

* 目前已经支持的平台：Github

Github模块利用了github仓库自身的功能，巧妙的利用其功能特性，利用GitHub的Issue标签（labels）来区分上线主机，利用GitHub的Issue和Comment功能来下发命令和接收结果，implant通过调用GitHub API与私密仓库进行通信，攻击者利用Client可以直接对上线主机进行命令控制。
![]()

**运行截图：**
主机上线
![]()
命令控制
![]()
兼容cobaltstrike bof
![]()

除了Github外，大量云存储服务、AI应用、开发者平台等都可以作为命令控制的服务节点，需要大家开放想象，根据实战场景，寻找最优通信节点。

万物皆可C2，在当今的网络攻防环境中，红队攻击者必须充分考虑到目标的应用场景，将命令与控制（C2）通信巧妙地隐藏在正常的通信流量中可以有效地混淆攻击流量，使其与合法用户的活动难以区分，攻击流量变得更加难以检测、封禁或转化为有效的威胁情报。

**注：** 由于笔者水平有限，文中可能存在疏漏或不准确之处，恳请读者多多指正。如有任何建议或反馈，欢迎通过微信（vx：lxlxaiaiai）联系笔者。感谢您的支持与帮助！

本文翻译自 原文链接。如若转载请注明出处。

商务合作，文章发布请联系 anquanke@360.cn

本文由**360安全应急响应中心**原创发布

转载，请参考[转载声明](https://www.anquanke.com/note/repost)，注明出处： [https://www.anquanke.com/post/id/302717](/post/id/302717)

安全KER - 有思想的安全新媒体

本文转载自:

如若转载,请注明出处：

安全KER - 有思想的安全新媒体

分享到：![微信](https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png)

* [C2](/tag/C2)
* [红队演习](/tag/%E7%BA%A2%E9%98%9F%E6%BC%94%E4%B9%A0)

**+1**18赞

收藏

![](https://p5.ssl.qhmsg.com/dm/200_200_100/t01b5d8fecc4d01072b.jpg)360安全应急响应中心

分享到：![微信](https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png)

## 发表评论

您还未登录，请先登录。

[登录](/login/index.html)

![](https://p1.ssl.qhimg.com/t014757b72460d855bf.png)

[![](https://p5.ssl.qhmsg.com/dm/200_200_100/t01b5d8fecc4d01072b.jpg)](/member.html?memberId=122586)

[360安全应急响应中心](/member.html?memberId=122586)

360安全应急响应中心（360 Security Response Center，简称360SRC）是360公司致力于保障产品及业务安全，促进白帽专家合作与交流的平台。诚邀白帽专家向我们反馈360产品安全漏洞、威胁情报，共筑数字安全基石，保障数亿用户业务和产品的安全。

* 文章
* **67**

* 粉丝
* **13**

### TA的文章

* ##### [Python代码保护之重置操作码映射的攻与防探究（一）](/post/id/311484)

  2025-08-26 10:49:47
* ##### [诚邀莅临|三六零天御·亚马逊云科技安全合规沙龙](/post/id/308420)

  2025-06-13 14:18:45
* ##### [360 MCP 生态安全风险治理实践与思考](/post/id/307934)

  2025-05-29 11:07:56
* ##### [ingress-nightmare 漏洞利用分析与 k8s 相关组件理解](/post/id/306494)

  2025-04-14 15:24:44
* ##### [基于 RAG 提升大模型安全运营效率](/post/id/306214)

  2025-04-03 19:07:23

### 相关文章

* ##### [基于边界节点链路交互C2流量](/post/id/278140)

  2022-08-17 10:30:32
* ##### [红队攻防基础建设—C2 IP隐匿技术](/post/id/238142)

  2021-04-14 15:30:39
* ##### [如何隐蔽你的C2](/post/id/231448)

  2021-02-24 15:30:09
* ##### [基于打印机跳板技术的新型C2及其检测方法（下篇）](/post/id/221634)

  2020-11-09 10:00:47
* ##### [基于打印机跳板技术的新型C2及其检测方法（上篇）](/post/id/221633)

  2020-11-06 10:30:17
* ##### [利用heroku隐藏C2服务器](/post/id/220868)

  2020-10-30 10:00:01
* ##### [利用 ZoomEye 追踪多种 Redteam C&C 后渗透攻击框架](/post/id/214897)

  2020-08-21 16:30:09

### 热门推荐

文章目录

* [常见C2架构介绍](#h2-0)
  + [现存痛点问题](#h3-1)
* [平台型C2-披着羊皮的狼](#h2-2)
  + [平台型C2实践-Redeemer C2](#h3-3)

![](https://p0.qhimg.com/t11098f6bcd5614af4bf21ef9b5.png)

安全KER

* [关于我们](/about)
* [联系我们](/note/contact)
* [用户协议](/note/protocol)
* [隐私协议](/note/privacy)

商务合作

* [合作内容](/note/business)
* [联系方式](/note/contact)
* [友情链接](/link)

内容需知

* [投稿须知](https://www.anquanke.com/contribute/tips)
* [转载须知](/note/repost)
* 官网QQ群：568681302

合作单位

* [![安全KER](https://p0.ssl.qhimg.com/t01592a959354157bc0.png)](http://www.cert.org.cn/)
* [![安全KER](https://p0.ssl.qhimg.com/t014f76fcea94035e47.png)](http://www.cnnvd.org.cn/)

Copyright © 北京奇虎科技有限公司 三六零数字安全科技集团有限公司 安全KER All Rights Reserved [京ICP备08010314号-66](https://beian.miit.gov.cn/)[![](https://icon.cnzz.com/img/pic.gif)](https://www.cnzz.com/stat/website.php?web_id=1271278035 "站长统计")

微信二维码

**X**![安全KER](https://p0.ssl.qhimg.com/t0151209205b47f2270.jpg)