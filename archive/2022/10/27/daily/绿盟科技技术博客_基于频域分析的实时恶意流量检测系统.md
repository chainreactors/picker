---
title: 基于频域分析的实时恶意流量检测系统
url: http://blog.nsfocus.net/realtime-robust-malicious-traffic-detection-via-frequency-domain-analysis/
source: 绿盟科技技术博客
date: 2022-10-27
fetch_date: 2025-10-03T21:00:58.480150
---

# 基于频域分析的实时恶意流量检测系统

* [登录](http://blog.nsfocus.net/wp-login.php)
* [注册](http://blog.nsfocus.net/wp-login.php?action=register)

[![Logo](http://blog.nsfocus.net/wp-content/uploads/2020/07/blog-logo.png)](https://blog.nsfocus.net/)

* [技术产品](https://blog.nsfocus.net/category/technology-product/)
* [数智安全](https://blog.nsfocus.net/category/digital-intelligence-secuirty/)
* [威胁通告](https://blog.nsfocus.net/category/threat-alert/)
* [研究调研](https://blog.nsfocus.net/category/security-research/)
* [洞见RSA](https://blog.nsfocus.net/category/rsac/)
* [公益译文](https://blog.nsfocus.net/category/translation/)
* [安全分享](https://blog.nsfocus.net/category/security-sharing/)

[![Logo](http://blog.nsfocus.net/wp-content/uploads/2020/07/blog-logo.png)](https://blog.nsfocus.net/)

* [技术产品](https://blog.nsfocus.net/category/technology-product/)
* [数智安全](https://blog.nsfocus.net/category/digital-intelligence-secuirty/)
* [威胁通告](https://blog.nsfocus.net/category/threat-alert/)
* [研究调研](https://blog.nsfocus.net/category/security-research/)
* [洞见RSA](https://blog.nsfocus.net/category/rsac/)
* [公益译文](https://blog.nsfocus.net/category/translation/)
* [安全分享](https://blog.nsfocus.net/category/security-sharing/)

# 基于频域分析的实时恶意流量检测系统

### 基于频域分析的实时恶意流量检测系统

[2022-10-26](https://blog.nsfocus.net/realtime-robust-malicious-traffic-detection-via-frequency-domain-analysis/ "基于频域分析的实时恶意流量检测系统")[薛甜](https://blog.nsfocus.net/author/xuetian/ "View all posts by 薛甜")[加密流量](https://blog.nsfocus.net/tag/%E5%8A%A0%E5%AF%86%E6%B5%81%E9%87%8F/)

阅读： 1,461

## ****一、引言****

目前，对于恶意流量的识别，基于机器学习的检测技术愈发成熟。然而在高吞吐量的网络中，它对于流量特征提取的效率低，检测精确度低，不能实现实时检测。且由于攻击者在流量中注入了噪声，导致包级特征和流级特征不再适用，因此传统的机器学习技术不再可行。

本文介绍一篇来自ACM Computer and Communications Security 的文章《Realtime Robust Malicious Traffic Detection via Frequency Domain Analysis》[1]，主要介绍一种实时恶意流量检测系统Whisper，它是通过频域特征来实现恶意流量实时检测的高精度和高吞吐量。

## ****二、频域特征****

文中开发了三步频域特征提取方法，通过流量的频域特征分析来提取流量的序列特征：

（1）将每个包的特征序列编码为特征向量，用于减少数据的规模；

（2）对编码后的特征向量分割，并进行离散傅里叶变换(DFT)，用于提取流量的序列特征；

（3）对上述产生的频域特征作对数变换，用于解决数值不稳定而引起的浮点溢出问题。

## ****三、W********hisper****

* **总体框架**

Whisper恶意流量检测系统通过频域来提取流量的序列特征，因频域特征代表了报文序列的细粒度顺序特征，不受噪声报文的干扰，因此可以很好的实现鲁棒性检测。图1显示了Whisper系统的框架图。

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/图1-2-300x91.png)

图1 Whisper系统框架图

Whisper检测系统主要包括四种模块：

**高速数据包解析模块：**负责提取每个包的特征，如包的长度和到达时间间隔等，并向特征提取模块提供逐包特征序列，用于频域特征的提取，向自动参数选择模块提供编码向量。

**频率特征提取模块：**负责从每个包的特征序列中提取频域特征。以固定的时间间隔定期轮询来自高速包解析器模块的所需信息。并将逐包特征序列编码为向量，通过频域特征提取流量的序列特征。

**自动参数选择模块：**负责为特征提取模块计算编码向量。通过解决一个约束优化问题来决定编码向量，该问题减少了每个包不同特征之间的相互干扰。在训练阶段，该模块获取每个数据包并求解一个等价的可满足性模理论(SMT)问题来近似原问题的最优解。

**统计聚类模块：**负责从特征提取模块学习频域特征。在训练阶段，该模块计算良性流量频域特征的聚类中心和平均训练损失。在检测阶段，该模块计算频域特征与聚类中心之间的距离。如果距离明显大于训练损失，那么Whisper将会检测到恶意流量。

* **子模型介绍**

**3.2.1 频率特征提取模块**

该模块通过轮询高速数据包解析模块（利用Intel DPDK来实现）来获取同一条流的*N*个数据包的逐包特征，并将数据包的逐包特征表示为矩阵如下：

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.1-300x76.png)

对上述矩阵进行**w**线性变换以获得数据包的编码特征。通过步长分割向量获得帧数，对每个帧进行傅里叶变换来获得帧的特征频率。由于DFT输出的特征是复数向量，后续还需进行复数模与对数的计算。

在广域网中文章对于三种类型流量进行测试，选用1500个连续的包，提取包长度、协议类型和到达时间间隔等特征。对频域特征进行最小-最大归一化处理，并将结果映射到RGB空间中。图2反应出实际观察到的恶意流量比良性流量的频域特征区域更暗。

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/图2a-300x142.png)

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/图2b-300x142.png)

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/图2c-300x143.png)

图2 三种典型流量攻击的频率特征映射到RGB空间的图谱

**3.2.2 自动参数选择模块**

自动参数选择模块可以对高速数据包解析模块产生的逐包特征序列进行向量编码。在这一过程中，通常将编码向量选择问题转化为约束优化问题，通过求解等价的SMT问题来获取原问题的最优解。以下是具体实现步骤：

假设可以用一组连续函数来描述逐包特征的变化，且所有包特征都是连续函数的采样，记为。在限制整体范围的情况下，通过向量**w**来放大和叠加这些函数，并进行优化以使这些特征之间相互干扰最小化。

首先，可以先将编码向量**w**和叠加函数的范围绑定如下：

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.2-300x100.png)

对函数的保序属性进行约束，确保包编码时各个包不同类型的特征之间不会相互干扰：

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.3-300x25.png)

接下来通过优化**w**，使函数之间的距离最大，以使每个包特征之间的相互干扰最小化，得到优化对象:

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.4-300x88.png)

而在具体实践中，需要将原点约束优化问题改造为具有优化对象的SMT问题，以近似最优解。最终，通过以下约束条件：

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.5-300x115.png)

来获得使以下目标最大化的SMT问题的最优解：

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.6-300x99.png)

**3.2.3 统计聚类模块**

该模块主要是用于学习从特征提取模块获得的频域特征的模式与所选择的参数。

训练过程中，该模块对于良性流量计算频域特征的聚类中心和平均训练损耗。为提高Whisper算法的鲁棒性，通过采用长度为的采样窗口对频域特征矩阵R进行分割，表示采样次数，表示起始点,特征序列维度上对采样窗口取平均，聚类算法的输入表示为：

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.7-300x53.png)

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.8-300x52.png)

表示聚类中心，计算平均训练损失。对于每个，找到最近的聚类中心，并取平均范数作为训练损失，如下：

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.9-300x42.png)

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.10-300x82.png)

检测过程中，该模块计算流量频域特征与聚类中心之间的距离。对于每个给定的频域特征，在R上采样段，长度为。在误差估计方面，可以找到最近的聚类中心作为的估计值，并计算范数作为估计误差：

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/公式3.11-300x38.png)

如果估计误差，可以认为统计聚类算法无法解析流量的频域特征，即该流量是恶意的。

## ****四、实验评估****

* **数据集**

实验使用来自WIDE MAWI Gigabit backbone network中的四组数据集，并在测试台上回放了四组与良性流量结合的恶意流量。具体数据如表1所示，包括：传统DoS和扫描攻击、多阶段TCP攻击、隐形TCP攻击和逃避攻击。

表1 攻击数据配置

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/表1-300x121.png)

* **准确性评估**

对于Whisper检测系统，文中主要进行了精度方面的检测实验，以包级检测（Kitsune）、 流级统计聚类（FSC）、带有自编码器的流级频域特性（FAE）为基线，以TRP、FPR、AUC、EER为评价指标，在多种类型攻击数据下进行测试，其测试结果如表2所示。当AUC在0.931~0.996之间，EER在0.201之内时，Whisper可以检测到测试的所有攻击。

表2 在14种攻击下Whisper和基线的检测精度

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/表2-300x112.png)

* **鲁棒性评估**

为验证Whisper的鲁棒性，假设攻击者将良性TLS流量和UDP视频流量注入恶意流量中，测试Whisper对于恶意流量的检测性能。实验发现，Whisper能更好的屏蔽混淆流量带来的干扰。实验结果展示如图3。

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/图3-2-300x253.png)

图3 采用以良性流量注入比为均值的规避策略的攻击检测精度

* **实时性评估**

实验测试了总体检测时延的累积分布函数，如图4，发现在Whisper的检测时延在0.047~0.133秒之间。这表明Whisper可以实现高吞吐网络中的实时检测。

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/图4-2-300x178.png)

图4 延迟的累积分布函数

同样将Whisper、FAE、Kitsune在不同吞吐量下的累积分布函数做了比较，如图5。其中，Whisper能够达到11.35~13.22Gbps的平均吞吐量。与其他检测系统相比，Whisper吞吐量达到最高。

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/图5a-300x191.png)

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/图5b-300x191.png)

![](https://blog.nsfocus.net/wp-content/uploads/2022/10/图5c-300x186.png)

图5 三种检测系统的累计分布函数及吞吐量对比

## ****五、总结****

本文介绍了一个实时恶意流量检测系统Whisper，通过频域分析利用流量的顺序特征，实现鲁棒攻击检测。Whisper具有有限信息损失的频域特征，因此既能达到较高的检测精度，同时又能达到较高的检测吞吐量。

### 参考文献

[1] Fu C, Li Q, Shen M, et al. Realtime Robust Malicious Traffic Detection via Frequency Domain Analysis. In 2021 ACM SIGSAC Conference on Computer and Communications Security.

**版权声明**
本站“技术博客”所有内容的版权持有者为绿盟科技集团股份有限公司（“绿盟科技”）。作为分享技术资讯的平台，绿盟科技期待与广大用户互动交流，并欢迎在标明出处（绿盟科技-技术博客）及网址的情形下，全文转发。
上述情形之外的任何使用形式，均需提前向绿盟科技（010-68438880-5462）申请版权授权。如擅自使用，绿盟科技保留追责权利。同时，如因擅自使用博客内容引发法律纠纷，由使用者自行承担全部法律责任，与绿盟科技无关。

Spread the word. Share this post!

[Previous](https://blog.nsfocus.net/ubuntu-22bpftrace/)

[Next](https://blog.nsfocus.net/aisecops/)

### Meet The Author

薛甜

咨询与合作：nsmagazine@nsfocus.com

* [绿盟科技官网](https://www.nsfocus.com.cn)
* [绿盟威胁情报中心（NTI）](https://nti.nsfocus.com)
* [绿盟云](https://cloud.nsfocus.com)