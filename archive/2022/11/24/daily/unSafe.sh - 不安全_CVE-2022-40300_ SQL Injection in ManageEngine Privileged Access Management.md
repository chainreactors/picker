---
title: CVE-2022-40300: SQL Injection in ManageEngine Privileged Access Management
url: https://buaq.net/go-136958.html
source: unSafe.sh - 不安全
date: 2022-11-24
fetch_date: 2025-10-03T23:36:52.785040
---

# CVE-2022-40300: SQL Injection in ManageEngine Privileged Access Management

* [unSafe.sh - 不安全](https://unsafe.sh)
* [我的收藏](/user/collects)
* [今日热榜](/?hot=true)
* [公众号文章](/?gzh=true)
* [导航](/nav/index)
* [Github CVE](/cve)
* [Github Tools](/tools)
* [编码/解码](/encode)
* [文件传输](/share/index)
* [Twitter Bot](https://twitter.com/buaqbot)
* [Telegram Bot](https://t.me/aqinfo)
* [Search](/search/search)

[Rss](/rss.xml)

[ ]
黑夜模式

![]()

CVE-2022-40300: SQL Injection in ManageEngine Privileged Access Management

In this excerpt of a Trend Micro Vulnerability Research
*2022-11-23 23:58:41
Author: [www.thezdi.com(查看原文)](/jump-136958.htm)
阅读量:56
收藏*

---

*In this excerpt of a Trend Micro Vulnerability Research Service vulnerability report, Justin Hung and Dusan Stevanovic of the Trend Micro Research Team detail a recently patched SQL injection vulnerability in Zoho ManageEngine products. The bug is due to improper validation of resource types in the AutoLogonHelperUtil class. Successful exploitation of this vulnerability could lead to arbitrary SQL code execution in the security context of the database service, which runs with SYSTEM privileges. The following is a portion of their write-up covering CVE-2022-3236, with a few minimal modifications.*

ManageEngine recently [patched](https://www.manageengine.com/products/passwordmanagerpro/advisory/cve-2022-40300.html) a SQL injection vulnerability bug in their Password Manager Pro, PAM360, and Access Manager Plus products. The vulnerability is due to improper validation of resource types in the *AutoLogonHelperUtil* class. A remote attacker can exploit the vulnerability by sending a crafted request to the target server. Successful exploitation could lead to arbitrary SQL code execution in the security context of the database service, which runs with SYSTEM privileges.

**The Vulnerability**

Password Manager Pro is a secure vault for storing and managing shared sensitive information such as passwords, documents, and digital identities of enterprises. The product is also included in other two similar ManageEngine products: PAM360 and Access Manager Plus. A user can access the web console on these products through HTTPS requests via the following ports:

The HTTP request body may contain data of various types. The data type is indicated in the *Content-Type* header field. One of the standardized types is [multipart](https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html), which contains various subtypes that share a common syntax. The most widely used subtype of multipart type is multipart/form-data. Multipart/form-data is made up of multiple parts, each of which contains a *Content-Disposition* header. Each part is separated by a string of characters. The string of characters separating the parts is defined by the *boundary* keyword found in the *Content-Type* header line. The *Content-Disposition* header contains parameters in “name=value” format. Additional header lines may be present in each part; each header line is separated by a CRLF sequence. The last header line is terminated by two consecutive CRLFs sequences and the form element’s data follows. The *filename* parameter in a *ContentDisposition* header provides a suggested file name to be used if the element's data is detached and stored in a separate [file](https://www.ietf.org/rfc/rfc2183.txt).

A user with admin privileges can add/edit a resource type via Password Manager Pro web interface by clicking the menu “Resources” -> “Resource Types” -> “Add” (or “Edit”) and a HTTP multipart/form-data request will be submitted to the “AddResourceType.ve” endpoint, as an example shown below:

where several form-data parts are transferred in the request, like “TYPEID”, “dnsname\_label”, “resLabChkName\_\_1”, etc. The data carried in the multipart/form-data part with a *name* parameter value of “resourceType” represents the name of the resource type, which is relevant to the vulnerability in this report.

An SQL injection vulnerability exists in Password Manager Pro. The vulnerability is due to a lack of sanitization of the name of the resource type in the Java class *AutoLogonHelperUtil*. The *AutoLogonHelperUtil* class is used by several controller classes, like *AutologonController* and *PasswordViewController*, to construct a partial SQL statement related to the query for existing resource types. For example, if a user clicks the menu “Connections” on the web admin interface, a request will be sent to “AutoLogonPasswords.ec” endpoint, and the *includeView()* method of *ViewProcessorServlet* class is called. The *includeView()* method will use *AutologonController* class to handle the request. The *AutologonController* class is derived from the *SqlViewController* class and its *updateViewModel()* method is called to process the request. The *updateViewModel()* method will first call the *initializeSQL()* method to get an SQL statement. It then calls the *getAsTableModel()* method of the *SQLQueryAPI* class to execute the SQL statement.

In the *initializeSQL()* method, it will call the *getSQLString()* method of the *AutologonController* class to get the SQL statement, which will invoke the *getFilledString()* method of the *TemplateAPI* class. In the *getFilledString()* method, it will call the *getVariableValue()* method of the *AutologonController*. The *getVariableValue()* method will use the *getOSTypeCriteriaForView()* method of the *AutoLogonHelperUtil* class to construct a partial SQL statement. The *getOSTypeCriteriaForView()* will call the *getOSTypeCriteria()* method, which uses *getOSTypeList()* to read all resource types from the database. It then uses these resource types to build a partial SQL statement as below:

`PTRX_OSTYPE in ( <resource type 1>, <resource type 2>, ..., <resource type n> )`

where `<resource type n>` represents a resource type name queried from a database by the *getOSTypeList()* method. Then, this partial SQL statement will be returned to *getOSTypeCriteriaForView()* and then be returned to the *getFilledString()*. The *getFilledString()* will use this partial SQL statement to generate the final complete SQL statement and return it back to *getSQLString()*.

However, the *getOSTypeCriteria()* method of the *AutoLogonHelperUtil* class does not sanitize the name of the resource type (returned from *getOSTypeList()*) for SQL injection characters before using it to create a partial SQL statement. An attacker can therefore first add a new resource type (or edit an existing resource type) with a crafted resource type name containing a malicious SQL command, and then click a menu such as “Connections” to invoke the methods of the *AutoLogonHelperUtil* class which will use the malicious resource type name to construct a SQL statement. This could trigger the execution of the injected SQL command.

A remote authenticated attacker can exploit the vulnerability by sending a crafted request to the target server. Successful exploitation could lead to arbitrary SQL code execution in the security context of the database service, which runs with SYSTEM privileges.

**Detection Guidance**

To detect an attack exploiting this vulnerability, the detection device must monitor and parse traffic on the ports listed above. Note that the traffic is encrypted via HTTPS and should be decrypted before performing the following steps.

The detection device must inspect HTTP POST requests to a Request-URI containing the following string:

`/AddResourceType.ve`

If found, the detection device must inspect each part of the multipart/form-data parts in the body of the request. In each part, the detection device must search for the Content-Disposition header and its name parameter to see if its value is *“resourceType”*. If found, the detection device must continue to inspect the data carried in this multipart/ form-data part to see if it contains the single-quote character “`' (\x27)`”. If found, the traffic should be considered malicious and an attack exploiting this vulnerability is likely underway. An example of malicious re...