---
title: 渗透测试｜某单位从敏感三要素泄露到接管管理员的漏洞挖掘之旅
url: https://forum.butian.net/share/4406
source: 奇安信攻防社区
date: 2025-06-19
fetch_date: 2025-10-06T22:47:50.207845
---

# 渗透测试｜某单位从敏感三要素泄露到接管管理员的漏洞挖掘之旅

#

[问答](https://forum.butian.net/questions)

*发起*

* [提问](https://forum.butian.net/question/create)
* [文章](https://forum.butian.net/share/create)

[攻防](https://forum.butian.net/community)
[活动](https://forum.butian.net/movable)

Toggle navigation

* [首页 (current)](https://forum.butian.net)
* [问答](https://forum.butian.net/questions)
* [商城](https://forum.butian.net/shop)
* [实战攻防技术](https://forum.butian.net/community)
* [漏洞分析与复现](https://forum.butian.net/articles)
  NEW
* [活动](https://forum.butian.net/movable)
* [摸鱼办](https://forum.butian.net/questions/Play)

搜索

* [登录](https://forum.butian.net/login)
* [注册](https://user.skyeye.qianxin.com/user/register?next=http://forum.butian.net/btlogin)

### 渗透测试｜某单位从敏感三要素泄露到接管管理员的漏洞挖掘之旅

* [渗透测试](https://forum.butian.net/topic/47)

这次的渗透测试范围特别广，包含整个市里面的好多政企单位和学校，资产多，测试起来也就比较简单。下面简单给师傅们分享下一些渗透测试上面的漏洞复盘，给新手师傅们，特别是没有参加过渗透测试的师傅们给点经验。

声明
--
本文章所分享内容仅用于网络安全技术讨论，切勿用于违法途径，所有渗透都需获取授权，违者后果自行承担，与本号及作者无关，请谨记守法.
作者：routing
原文链接：<https://zone.huoxian.cn/d/2990>
0x1 前言
------
### 一、浅谈
这篇文章主要是给师傅们分享下前段时间我们公司做的渗透测试，这次是跟市里面的网信办一起做的。因为是第一次所以我们这次做的渗透测试价格不高，主要是为了后面连续几年的一个渗透测试服务项目。
这次的渗透测试范围特别广，包含整个市里面的好多政企单位和学校，资产多，测试起来也就比较简单。下面简单给师傅们分享下一些渗透测试上面的漏洞复盘，给新手师傅们，特别是没有参加过渗透测试的师傅们给点经验。这里需要注明下，该项目中的漏洞目前已经全部修复了，另外提醒师傅们不要做未授权测试。所以下面的渗透测试漏洞案例中又部分截屏不全，我会备注，因为目前已经修复了。
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-47a31efb45141f253109b23fb819b7aa170f7148.png)
### 二、资产整理
首先我会把公司发的跟这次渗透测试项目相关的文件和资产，还有一些些漏洞报告的模版之类的汇总在一个文件夹中，这样方便后面我自己进行一个漏洞报告编写，以及资产的收集整理，比如像web资产和APP、小程序漏洞都是可以分开整理
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-7e01a319561fd7a3fdcf319b861e21f9bbb4dc20.png)
我们在渗透测试项目之前，甲方那边都会给我们一些资产相关的表格，下面就是常见的excel表格资产，还有就是有些甲方可能目标资产不是那么多，且大多都是web资产，直接也有发txt文件的
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-8b7c3b45484b5f37458785c5bb093b98ae509a22.png)
txt的类型像下面的如下：
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-3cafbc356dff55daf0e6de267ef684f22082dbfe.png)
然后像渗透测试，还有就是授权书也是得有的，这里我们都是合法授权渗透测试的项目，跟那边都有授权合作的项目书，这里也希望师傅们能够合法进行渗透测试
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-26e4cf95e248b69e9ac22032e07071f043cb5aac.png)
0x2漏洞一 短信轰炸
-----------
### 一、纵向轰炸
这里首先先带师傅们看看渗透测试常测试的点，比如像登陆口，一般都有手机号码登录，手机号码验证登录，需要我们接受短信验证码，然后进行登录操作。像渗透测试还有重测和src漏洞挖掘中，短信轰炸都是收的，企业src价格低点，且一般香短信轰炸，一般像很多企业都要求在比如每分钟15/30条以上就收。
这里测试的手是一个人力资源管理局的一个微信小程序，这里直接输入我自己的手机号，然后使用bp抓包，拦截短信验证码发送的数据包：
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-c1be735d150c5dee772fb21633615a792b00068c.png)
直接把数据包放到重放模块，下面直接go一下（第一次go）数据包
可以看到数据包回显是正常的，且手机也是正常的接受到了短信验证码了
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-4fc021eecbf2874f6c92f80df87a60e47cab321b.png)
但是第二次再次点击发送数据包，缺显示报错，意思是我们已经发送了一次，在短时间类不能再发送了
这里我们就可以想下了，我们能不能进行一个验证码发送限制次数的绕过，这个要是能绕过，无限次数的发送验证码是会消耗这个单位的一个资源的
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-00b4c3620eeae9969094d473de669d5f5e009aa4.png)
然后我们就可以进行一个测试了，看看什么字符可以进行绕过验证码发送呢？
经过测试发现，可以通过@、空格、+86、逗号等进行绕过，从而达到短信轰炸的漏洞危害：
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-188b28e25769bfe649b87f6f64ce2579516b3bcf.png)
我们如果要把危害加大，达到一分钟短信轰炸达到几十条，那么我们就要利用bp的爆破了，我们手动添加多个绕过字符，然后进行爆破，尽量多的提高每分钟爆破短信验证码的发送次数，以此来提高这个漏洞的危害：
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-9f8ed516638618c0800dab6389d4cb9ba20099d2.png)
然后师傅们就可以看自己的手机上面的短信验证码了，就可以看到一次性并发绕过了很多条短信验证码：
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-e221bd3c3d4128e84a87ce6758a5d4939bcd8047.png)
### 二、横向轰炸
然后这个人力资源局的小程序还存在横向爆破绕过漏洞，可以进行双手机号验证码同时进行发送，从而造成逻辑漏洞，下面师傅们可以参考下我具体的绕过技巧，在碰到这样的场景时候，直接去实操即可
类似下面的，常用的就是下面几个：
```Ada
phone=13888888888,phone=13999999999
phone=13888888888&phone=13999999999
phone=13888888888,13999999999
phone=13888888888&13999999999
```
下面我就直接重新回到刚才上面的抓包步骤，抓取发送短信验证码的数据包，然后去尝试使用上面的绕过方法，看看能不能进行绕过，双手机号验证码同时发送，这里我使用我的卡一和卡二来演示：
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-b6cbcf9090caa05dbe6d7372bc56629fd9badefe.png)
我这里使用的就是下面这个思路：
```Bash
phone=13888888888&13999999999
```
然后就可以看到自己手机短信验证码，收到了来自卡一和卡二一样的验证码，且时间也是一样的：
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-0f473c4211f9586c8b2fd5398b76d2c959168356.png)
然后我们这里就可以使用卡二的手机收到的验证码，只需要知道卡一的手机号就行了，那么就可以直接登陆卡一的账号
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-ffed73c115c847a6a869eed5a76a41289eea5d96.png)
那么我们后面深入利用就可以去改人力资源局相关站点去搜索电话号码，然后使用这个漏洞就可以越权登陆其他账号，特别是像权限比较高的admin之类的管理员账号
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-952f15b6ee28a48131bdd198ea596027a28ec286.png)
### 三、短信轰炸总结
下面是我之前总结的一些验证码爆破的一个思维导图，师傅们可以保存下，对于挖掘企业src和众测的时候，厂家收不收呢，其实可以看看相关的文档，一般都是定义每分钟15/30条以上就收
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-c6a62a7a6836b54d55a7897b8bdb0c74b6617844.png)
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-e76eea6533c492747175500918c9e92cdd7a4ece.png)
0x3 漏洞 二 SessionKey三要素泄露
------------------------
### 一、未授权登陆
下面这个漏洞就是给师傅们分享下，在渗透测试中比较容易发现，并且好打的一个漏洞点——SessionKey三要素泄露，这个漏洞在蛮多微信小程序中都存在，且利用的手法不难，看完我这篇文章，师傅们也可以去测试下
这个漏洞需要使用到一个SessionKey三要素解密的工具，有直接下载使用的，也有burpsuit插件，反正原理都是一样的，加解密→替换数据包→未授权登陆
1、首先介绍下使用到的SessionKey解密工具
[https://github.com/mrknow001/wx\\_sessionkey\\_decrypt/releases/tag/v0.1](https://github.com/mrknow001/wx\_sessionkey\_decrypt/releases/tag/v0.1)
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-5b3c52f9022d7d6b447378d0e7a4ab6b4fb4319b.png)
这个工具直接双击运行即可，类似下面的：
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-3b8ffeb49ea3f4b9a9112aeec09b75bd4f2da3f8.png)
还有一个就是使用burpsuit的自带插件
<https://github.com/mrknow001/BurpAppletPentester/releases/tag/v1.1>
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-f0e217625446bfcab0c7eacbff47c2fcfc5a3542.png)
直接就可以导入到bp插件中
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-20fac7d83539c9982ac271fe2c097b311a64ba47.png)
2、这个微信小程序是目标资产中的一个大学的小程序设备，大学那种预约访谈进出校园、校园招聘那种功能点，像这样的基本上都有那种手机号一键登陆的功能点，像这样的微信小程序手机号一键登陆，很大概率存在SessionKey三要素泄露漏洞，这样的漏洞我之前挖EDUSRC挖了好多，且有一本证书站也就是这个漏洞，但是没有那么明显
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-e7f477b364b962df4434460aeac64f570ad0ae18.png)
3、点击手机号快捷登陆操作，直接使用bp抓包，可以看到数据包中出现了SessionKey三要素泄露：
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-5b2931a57bf840c59961f62ced788ba2aceaa787.png)
4、直接一键发送到AppletPentester 插件中
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-714324e28fbaa7c87e1fd64876ed17a194f81f7d.png)
5、直接一键解密即可
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-eea6729bee6783ebdbdc38d9a5699df0d56c71c5.png)
6、在信息收集的时候，在一个接口中，发现这个微信小程序里面有很多的一些学校老师信息，比如手机号之类的，然后这里我就带师傅们利用这个SessionKey三要素泄露漏洞，直接未授权登陆管理员老师账号
直接替换成管理员老师176的手机号，然后点击加密
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-30c3fd2ac7f40f931a28d35997b59c80f4c542b0.png)
再进行登陆口抓起数据包，替换数据包，然后点击重发数据包即可
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-fafc0abed57fc509e36ebda00150a0dc2fd9cd4a.png)
就可以直接未授权登陆这个账号了
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-9cfa06f98f9c3344ab3b767fdc6b5e4feb6f21f2.png)
### 二、弱口令+信息泄露
然后，我这里直接把这个小程序的host拿到web页面去访问，因为我一般打小程序都有这个习惯，看看web端有没有系统，特别是那种登陆系统，弱口令的概率很大
打开web端访问，直接跳转这个页面，特别经典的若依系统页面
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-d5edd0380241bdca418e64296f20e1d7a2d3e42f.png)
这里直接使用刚才的手机号+弱口令密码
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-8822d3c39a134637ee67b24cdb0e552e0cc05b67.png)
直接成功登陆了后台，里面泄露了整个学校的学校个人敏感信息
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-ff0fdac5eadfbcf7740c514a4c12e27ccc269117.png)
0x4 JWT爆破攻击
-----------
### 一、可爆破/未验证签名导致越权
首先通过微信搜索小程序，找到对应目标资产中的小程序系统
![image.png](https://cdn-yg-zzbm.yun.qianxin.com/attack-forum/2025/05/attach-...