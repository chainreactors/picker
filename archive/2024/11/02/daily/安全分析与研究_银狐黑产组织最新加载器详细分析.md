---
title: 银狐黑产组织最新加载器详细分析
url: https://mp.weixin.qq.com/s?__biz=MzA4ODEyODA3MQ==&mid=2247489416&idx=1&sn=7af957388dfcff409a4b4b36f0e4ce1e&chksm=902fb8a0a75831b68ead69eb65b7c6953b1b4b5115362a13934f047b23c92ab21935886cd91d&scene=58&subscene=0#rd
source: 安全分析与研究
date: 2024-11-02
fetch_date: 2025-10-06T19:17:29.906687
---

# 银狐黑产组织最新加载器详细分析

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0wwaTGW9Lm2u27fBoGTwQ70WGTKtN3XMdu115Z4xmzmB51Hyahj6Y6g/0?wx_fmt=jpeg)

# 银狐黑产组织最新加载器详细分析

原创

pandazhengzheng

安全分析与研究

**安全分析与研究**

专注于全球恶意软件的分析与研究

前言概述

原文首发出处：

https://xz.aliyun.com/t/16024

先知社区 作者：熊猫正正

银狐黑产组织一直在更新自己的攻击样本，基本上每隔一段时间就会出现一些新的攻击样本，笔者近日在沙箱平台上发现一例最新的银狐黑产组织加载器攻击样本，对该加载器样本进行了详细分析，分享出来供大家参考学习。

详细分析

1.样本的编译时间为2024年10月14日，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0d60WbX8SVBAGLezvpUhwgfTRibhBicQkWXTT0XLEBpcXuA55y9ya6cbQ/640?wx_fmt=png)

2.查看样本信息发现该恶意样本伪装为一个QtWidgetsApplication程序，恶意代码隐藏在程序中，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0TJ8rKuAHXaWOLg9yFExC6DXmEOW6wpEJJsaN8ACxZx83l3J1xHCS8A/640?wx_fmt=png)

3.通过分析发现恶意代码就隐藏在主程序中，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0WS4A0yviaxmPw8cOGQe9aZTxqCQMuXBBibdnwf8xRiaLxGia46JdOZVZxw/640?wx_fmt=png)

4.进入该函数之后，恶意代码会隐藏在最后一个函数里面，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0XHYiambjGibGH5pdnWvnDfuPtewIZjfbYSJjIibFGvb5btfFvoe2ibA4nw/640?wx_fmt=png)

5.该函数包含的恶意代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0aGsIzD3zLWic8aqEYhzs7XNhHlSfYfsK9EN34HgLQ3peiaRAgZvDiaIlQ/640?wx_fmt=png)

6.通过时间对比进行反虚拟机对抗，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0D4x9t60tPQRI1aznXaKhxXo9ugFF962RwpMu0YnxPsRDZEMlQXmAGQ/640?wx_fmt=png)

7.通过LZ4算法解密加密的PayLoad代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0B9VkatqmVHNt1fTXcvcuQQiafqcyoopxhZyQIpAarUMJmmM6wAicBibeA/640?wx_fmt=png)

8.解密出来的PayLoad代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0DqBwKzJf7rHIjZolGMFEZ2mOs4zo5DibZMSQ8iaAaduhxE0P1TSCe95Q/640?wx_fmt=png)

9.分配相应的内存空间，将解密出来的PayLoad拷贝到该内存空间，执行解密出来的PayLoad,如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0sGp2VGFOC4LhzMxFL7gjAicmAdblBpZpX7dDgh7Fu2VicJVibL2FRRnag/640?wx_fmt=png)

10.执行到PayLoad的DllEntryPoint导出函数，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0cvPkPg6onHOialFDo0g7VCiapLET3cQWEPFibXczDYLjWo9WcwAqOicETg/640?wx_fmt=png)

11.判断C:\Windows目录下是否存在cef.dat文件，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0ycp270mT9JC7vOwv9XtJCyVU31QT7af3ic85RVqYTjrfbcrFWuiaaosg/640?wx_fmt=png)

12.如果不存在cef.dat文件，再判断C:\Users\Public\Downloads目录下是否存在code.jpg文件，获取该文件属性，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah09n1b08tTpTrpddM9P3Ool7f0tUgDxv5yia3IfA2iblveCLUib0ZJIic8zA/640?wx_fmt=png)

13.如果存在该文件，则读取该文件内容到内存中，然后解密执行，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0VXmfubp1k48AH4RdmHHMbrZtDDt2vSy0SJOCtUCPic9VdyDVE08vTRw/640?wx_fmt=png)

14.通过执行文件名进行反虚拟机对抗，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0gOcCwBkZ1TofxNl5485tnPkeNWZpS055GiaxAvzXIicTF0icgvPXY5hQw/640?wx_fmt=png)

15.通过CheckRemoteDebuggerPresent函数进行反调试对抗，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0XvO8CKUtpbKFiay6KIv3DJlMaMJiaV09iakPQYLmIT01YI4kXj0JQq20Q/640?wx_fmt=png)

16.设置防火墙规则，阻止安全软件云查或更新等，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0d1cubFmiajShxcDJ85J8VgmJkCLQ4M4ZHtwEhVThfPAjJhnLFibREo9g/640?wx_fmt=png)

17.遍历系统安全软件，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0RnAtry0ibcKrTe4UsAoymSHwRjiaiaJGJoL3PEXfbgbArrMLVTvI1AM3A/640?wx_fmt=png)

18.在C:\Windows目录下生成相关的恶意文件，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0A9MWjZPyEqicLRpJksvT9p0vWOBPiaozl1GCdXe01ytb4HaTEkoI05Kg/640?wx_fmt=png)

19.设置相应的服务自启动ggaa.exe程序，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0MqsHm2N2SXTScwNibu7yvuKCjgKOsOshtvoMPJtOLwgoNxrQ8vLTldQ/640?wx_fmt=png)

20.禁用系统UAC功能，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0899uCWNOefeyC6iaStmPyICMySp8heOiaoyMlUiayicOPk63D4j7Pg2xVQ/640?wx_fmt=png)

21.采用白+黑的攻击手法，加载恶意模块，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0t7sZf7DEu3BCeRMM0OjibURiaeSSQ02oCDPokHZ96f1zmfkG6MuH4VFQ/640?wx_fmt=png)

22.获取同目录下的cef.dat数据文件，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0bNnLo8Mu2f0o1KFp1TwDJvxCuHMe8PjzSvoPV4rWkicNf1o2U43dxnQ/640?wx_fmt=png)

23.将cef.dat文件的数据读取到分配的内存空间当中，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0X4agZ1ibfmGYjiborsASoHIRubXlxgj9g5BOTB3aPXzJ2bx80iasnr4HA/640?wx_fmt=png)

24.再次分配相应的内存空间，将ShellCode代码拷贝到该内存空间，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0NibvwickSWKt27NJ3X4J4jib8D4mfibPvGw1IQp6nq1rngS5LzpkKuPfhA/640?wx_fmt=png)

25.跳转执行到ShellCode代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0f2BZJpe8Kk06QibcVk2cA4LicSqdaxxHVGDyTftJic5hkK0E6jvic5MVvQ/640?wx_fmt=png)

26.将ShellCode代码中加密的数据拷贝到分配的内存空间当中，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0WKPkTSXEF0wWficgmOrPqAAtSs8CXiaTySico0hCdxLicPz2979Rpp5AUA/640?wx_fmt=png)

27.异或解密加密的数据，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0MCMD6ick94ENZlSA50yKLykKOa3pJuuQaDTgrkkYrnLKdDnSX7WLKrA/640?wx_fmt=png)

28.解密之后，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah00aAgoBKOe26IV5ozLHrUIxZ0RUfMP0L1riaAW4FZsKyMdX71uicqhnFg/640?wx_fmt=png)

29.解密后的PayLoad使用UPX加壳，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0f2v4lQc5ulcj4WFq2PPcyaMaJC81EIOnsoB1IxQvHRtbbqePuqoHSA/640?wx_fmt=png)

30.脱壳之后PayLoad的导出函数，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah0w19ia9BftiarzqySME9wTEXnTSiby6qFwsd58JwB6c54Nfey7YFj0aVnw/640?wx_fmt=png)

最后解密出来的PayLoad与此前分析的变种样本使用的内核相同，可以去参考此前的分析报告。

威胁情报

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmU5wySSqG06ruDiacuco8Ah08P8O0WOgWX3n7eBggcibgK1fds1YQudybpLFza6x7kLYvmsVnVSQeDw/640?wx_fmt=png)

总结结尾

去年使用“银狐”黑客远控工具的几个黑产团伙非常活跃，今年这些黑产团伙仍然非常活跃，而且仍然在不断的更新自己的攻击样本，采用各种免杀方式，逃避安全厂商的检测，免杀对抗手法一直在升级。

安全分析与研究，专注于全球恶意软件的分析与研究，追踪全球黑客组织攻击活动，欢迎大家关注，获取全球最新的黑客组织攻击事件威胁情报。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oibWJqH5OVmV2gFBgMiaUPMlCoP3U5ZLreq5DibibsFm4BFFlh7Rjd8xq8mVSQcnmbYljOxPdRu6cGViap4YugvcDgQ/640?wx_fmt=jpeg)

王正

笔名：熊猫正正

恶意软件研究员

长期专注于全球恶意软件的分析与研究，深度追踪全球黑客组织的攻击活动，擅长各种恶意软件逆向分析技术，具有丰富的样本分析实战经验，对勒索病毒、挖矿病毒、窃密、远控木马、银行木马、僵尸网络、高端APT样本都有深入的分析与研究

预览时标签不可点

阅读原文

![]()

微信扫一扫
关注该公众号

继续滑动看下一个

轻触阅读原文

![](http://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmVcFgYKtoVnKR7h3pkl3AyxwS0l7iagicAJnYjEQhwIuZgR3RR65DLpJh2TGZS82DY7CjsBUmiaAl7BQ/0?wx_fmt=png)

安全分析与研究

向上滑动看下一个

知道了

![]()
微信扫一扫
使用小程序

取消
允许

取消
允许

取消
允许

×
分析

![跳转二维码]()

![作者头像](http://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmVcFgYKtoVnKR7h3pkl3AyxwS0l7iagicAJnYjEQhwIuZgR3RR65DLpJh2TGZS82DY7CjsBUmiaAl7BQ/0?wx_fmt=png)

微信扫一扫可打开此内容，
使用完整服务

：
，
，
，
，
，
，
，
，
，
，
，
，
。

视频
小程序
赞
，轻点两下取消赞
在看
，轻点两下取消在看
分享
留言
收藏
听过