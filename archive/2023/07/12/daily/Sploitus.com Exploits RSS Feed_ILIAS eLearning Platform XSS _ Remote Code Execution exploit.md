---
title: ILIAS eLearning Platform XSS / Remote Code Execution exploit
url: https://sploitus.com/exploit?id=PACKETSTORM:173359&utm_source=rss&utm_medium=rss
source: Sploitus.com Exploits RSS Feed
date: 2023-07-12
fetch_date: 2025-10-04T11:54:05.413170
---

# ILIAS eLearning Platform XSS / Remote Code Execution exploit

[x]
Dark Mode

[##### SPLOITUS](/)

# Exploit for ILIAS eLearning Platform XSS / Remote Code Execution

2023-07-11 | CVSS 7.1

Copy
Download
Source
[Share](#share-url)

```
## https://sploitus.com/exploit?id=PACKETSTORM:173359
SEC Consult Vulnerability Lab Security Advisory < 20230627-0 >
=======================================================================
title: Multiple high risk vulnerabilities
product: ILIAS eLearning platform
vulnerable version: see section "Vulnerable version" below
fixed version: see section "Solution" below
CVE number: -
impact: High
homepage: https://www.ilias.de
found: 2022-12-28
by: Armin Stock (Atos)
SEC Consult Vulnerability Lab

An integrated part of SEC Consult, an Eviden business
Europe | Asia

https://www.sec-consult.com

=======================================================================

Vendor description:
-------------------
"Around since 1998, ILIAS is a powerful learning management system that fulfills
all your requirements. Using its integrated tools, small and large businesses,
universities, schools and public authorities are able to create tailored,
individual learning scenarios."

Source: https://www.ilias.de/en/

Business recommendation:
------------------------
The vendor provides a patch which should be installed immediately.

SEC Consult highly recommends to perform a thorough security review of the product
conducted by security professionals to identify and resolve potential further
security issues.

Vulnerability overview/description:
-----------------------------------
1) Authenticated remote code execution (ilObjRoleGUI)
The function `changeExistingObjectsObject` of the class `ilObjRoleGUI` passes
user-controlled data to the `unserialize` function.

-------------------------------------------------------------------------------
# FILE: Services/AccessControl/classes/class.ilObjRoleGUI.php
/**
* Change existing objects
* @return
*/
protected function changeExistingObjectsObject()
{
global $DIC;

$tree = $DIC['tree'];
$rbacreview = $DIC['rbacreview'];
$rbacadmin = $DIC['rbacadmin'];

$mode = (int) $_POST['mode'];
$start = ($this->obj_ref_id == ROLE_FOLDER_ID ? ROOT_FOLDER_ID : $this->obj_ref_id);

$this->object->changeExistingObjects($start, $mode, unserialize(ilUtil::stripSlashes($_POST['type_filter'])));

ilUtil::sendSuccess($this->lng->txt('settings_saved'), true);
$this->ctrl->redirect($this, 'perm');
}
-------------------------------------------------------------------------------

The user-controlled `POST` parameter `type_filter` is passed to the
`unserialize` function. The function `ilUtil::stripSlashes` only tries to
protect against `HTML injection` and does not interfere with the serialized payload.

To be able to exploit this vulnerability it is required to have `edit_permission`
on an object, which supports the `ilPermissionGUI` command and has a `ref_id`.
Also an `obj_id` of a role is required. As an example the `course` object is used.

-------------------------------------------------------------------------------
# FILE: Services/AccessControl/classes/class.ilPermissionGUI.php
public function executeCommand()
{
global $DIC;

$rbacsystem = $DIC['rbacsystem'];
$ilErr = $DIC['ilErr'];

if (!$rbacsystem->checkAccess("edit_permission", $this->gui_obj->object->getRefId())) {
$ilErr->raiseError($this->lng->txt("permission_denied"), $ilErr->MESSAGE);
}

$next_class = $this->ctrl->getNextClass($this);

switch ($next_class) {
case "ilobjrolegui":
$this->ctrl->setReturn($this, 'perm');
include_once("Services/AccessControl/classes/class.ilObjRoleGUI.php");
$this->gui_obj = new ilObjRoleGUI("", (int) $_GET["obj_id"], false, false);
$ret = $this->ctrl->forwardCommand($this->gui_obj);
break;
-------------------------------------------------------------------------------

2) ilUtil::renameExecutables bypass allows PHP code execution
The ILIAS platform uses the function `ilUtils::renameExecutables` in the
`ilFileSystemGUI` class (used to upload or unzip files for various objects), to
prevent the upload of executable files like `.php`.

--------------------------------------------------------------------------------
# File: ILIAS-7.17\Services\FileSystem\classes\class.ilFileSystemGUI.php
/**
* delete object file
*/
public function unzipFile($a_file = null)
{
# ...
if (@is_file($a_file)) {
include_once("./Services/Utilities/classes/class.ilFileUtils.php");
$cur_files = array_keys(ilUtil::getDir($cur_dir));
$cur_files_r = iterator_to_array(new RecursiveIteratorIterator(new RecursiveDirectoryIterator($cur_dir)));

if ($this->getAllowDirectories()) {
ilUtil::unzip($a_file, true);
} else {
ilUtil::unzip($a_file, true, true);
}
# ...
}
# Call to renameExecutables, after a ZIP file has be unzipped
ilUtil::renameExecutables($this->main_dir);

$this->ctrl->saveParameter($this, self::CDIR);
ilUtil::sendSuccess($lng->txt("cont_file_unzipped"), true);
$this->ctrl->redirect($this, "listFiles");
}
--------------------------------------------------------------------------------

This function changes the extension of all files, which have an extension
specified in the variables `SUFFIX_REPL_DEFAULT` and `SUFFIX_REPL_ADDITIONAL` to
`.sec`.

--------------------------------------------------------------------------------
# File: ILIAS-7.17\Services\Init\classes\class.ilInitialisation.php
// define default suffix replacements
define("SUFFIX_REPL_DEFAULT", "php,php3,php4,inc,lang,phtml,htaccess");
define("SUFFIX_REPL_ADDITIONAL", $ilSetting->get("suffix_repl_additional"));

# File: ILIAS-7.17\Services\Utilities\classes\class.ilUtil.php
/**
* Rename uploaded executables for security reasons.
*
* @static
*
*/
public static function renameExecutables($a_dir)
{
$def_arr = explode(",", SUFFIX_REPL_DEFAULT);
foreach ($def_arr as $def) {
ilUtil::rRenameSuffix($a_dir, trim($def), "sec");
}

$def_arr = explode(",", SUFFIX_REPL_ADDITIONAL);
foreach ($def_arr as $def) {
ilUtil::rRenameSuffix($a_dir, trim($def), "sec");
}
}
--------------------------------------------------------------------------------

The `ilUtil::rRenameSuffix` is responsible for renaming the provided suffixes to
the `sec` suffix. To achieve this it does the following:

a) Iterate the provided directory, skipping the `.` and `..` files
b) Test if the filename ends with a dot and removes it: `foo.php.` --> `foo.php`
c) Test if the filename has the provided suffix and
replace it with `sec`: `foo.php` --> `foo.sec`

--------------------------------------------------------------------------------
/**
* Renames all files with certain suffix and gives them a new suffix.
* This words recursively through a directory.
*
* @param string $a_dir directory
* @param string $a_old_suffix old suffix
* @param string $a_new_suffix new suffix
*
* @access public
* @static
*
*/
public static function rRenameSuffix($a_dir, $a_old_suffix, $a_new_suffix)
{
# ...
// read a_dir
$dir = opendir($a_dir);

while ($file = readdir($dir)) {
if ($file != "." and
$file != "..") {
// directories
if (@is_dir($a_dir . "/" . $file)) {
ilUtil::rRenameSuffix($a_dir . "/" . $file, $a_old_suffix, $a_new_suffix);
}

// files
if (@is_file($a_dir . "/" . $file)) {
// first check for files with trailing dot
if (strrpos($file, '.') == (strlen($file) - 1)) {
rename($a_dir . '/' . $file, substr($a_dir . '/' . $file, 0, -1));
$file = substr($file, 0, -1);
}

$path_info = pathinfo($a_dir . "/" . $file);

if (strtolower($path_info["extension"]) ==
strtolower($a_old_suffix)) {
$pos = strrpos($a_dir . "/" . $file, ".");
$new_name = substr($a_dir . "/" . $file, 0, $pos) . "." . $a_new_suffix;
rename($a_dir . "/" . $file, $new_name);
}
}
}
}
return true;
}
--------------------------------------------------------------------------------

The first test can be abused to generate a `PHP` warning. If the uploaded file
has the name `...` it tries to rename it to `..` which is not possible and
results in a warning:

--------------------------------------------------------------------------------
php > rename("./..."...