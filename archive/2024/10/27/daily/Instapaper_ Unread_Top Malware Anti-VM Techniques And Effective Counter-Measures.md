---
title: Top Malware Anti-VM Techniques And Effective Counter-Measures
url: https://digitalinvestigator.blogspot.com/2024/10/top-malware-anti-vm-techniques-and.html
source: Instapaper: Unread
date: 2024-10-27
fetch_date: 2025-10-06T18:51:50.047294
---

# Top Malware Anti-VM Techniques And Effective Counter-Measures

### Facebook SDK

* [Home](/)
* [whoami](https://digitalinvestigator.blogspot.com/p/trainingswebinars-attended.html?m=1)
* [Subscribe](https://blogspot.us14.list-manage.com/subscribe?u=f0561841d9ef7ca0687144c59&id=93ea8a701f)

[![Digital Investigator](https://blogger.googleusercontent.com/img/a/AVvXsEjCBXDAFtj3qeFsN0QARpauoOMU-9GGRJMhzK1L_edHwLn3gTy8NtKHApKnUjkKdWPgAEIcdSrosxULEGvjMszmWVhop1V0aiHOOEW8KeeKjSkfEk3bSEuXPRbuGgVQQJlHbfKNju9pNpyZOabgh-Oci700smDybZA3gHWWI5H2Mgy0h08GrB5-FiyV=s150)](https://digitalinvestigator.blogspot.com/)

* [Home](home-icon)
* [whoami](https://digitalinvestigator.blogspot.com/p/trainingswebinars-attended.html?m=1)
* [Subscribe](https://blogspot.us14.list-manage.com/subscribe?u=f0561841d9ef7ca0687144c59&id=93ea8a701f)

[Home](https://digitalinvestigator.blogspot.com/)[Malware Forensics](https://digitalinvestigator.blogspot.com/search/label/Malware%20Forensics)

# Top Malware Anti-VM Techniques And Effective Counter-Measures

Joseph Moronwi
October 25, 2024
0

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhqJ1au6YNPRQfhNCuu8rH2_xUTYH4wRPBqpB75DRb9HnWWlxh3vLHQJneGO3GrgjbzbMbgF6QrOfH7QC6xG9tyLtetlyOeqYNoeM4jo3ApUkEOw-bhFRfg8OOQXC_K0KqZGaH65TrKNHt2uu9u72b7bK_CbNgYorm10AXavhePjDeIpULOW6VuREeZHqo/w647-h315/614x300_RiseofDeepLearning.jpg)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhqJ1au6YNPRQfhNCuu8rH2_xUTYH4wRPBqpB75DRb9HnWWlxh3vLHQJneGO3GrgjbzbMbgF6QrOfH7QC6xG9tyLtetlyOeqYNoeM4jo3ApUkEOw-bhFRfg8OOQXC_K0KqZGaH65TrKNHt2uu9u72b7bK_CbNgYorm10AXavhePjDeIpULOW6VuREeZHqo/s614/614x300_RiseofDeepLearning.jpg)

Malware Analysts and Security researchers rely on Virtual Machines, debuggers, and sandboxes in their malware analysis due to their pertinent design to analyze malware without risking permanent infection to the host Operating system. This is because if malware infects the guest Operating system during analysis, the analyst can simply load in a fresh image thus avoiding any damage to the actual machine.

Hence threat actors and malware authors have raised their stakes by creating malicious software that can detect the presence of virtual machines, and other controlled environments. This class of malware detects the presence of malware analysis tools such as Virtual Machines, debuggers, and sandboxes and then either terminates execution immediately or simply hides its malicious intent and continues to execute benignly thus evading its own detection. A casual malware analyst may misunderstand it as a genuine application. Analysts are forced to analyze such VM-aware malware by executing them on a physical host, which increases the analysis cost. This category of malware has been vouchsafed numerous nomenclatures such as Analysis-Aware Malware, Environment-Sensitive Malware, VM-aware Malware, and Anti-VM Malware. VM awareness becomes a barrier for malware analysis due to the concealment of malicious behaviors. This post aims at various measures that can be adopted by malware analysts to thwart these techniques of Virtual-aware malware.

# Anti-VM Techniques

To evade detection, Malware Authors implement many different techniques to prevent the malware from performing its malicious action in a lab environment, or in some cases from running at all and, by that, preventing the researchers from inspecting any action the malware performs dynamically. The various techniques employed are categorized as follows:

* Hardware fingerprinting
* Registry enumeration
* Process and file system enumeration
* Timing analysis check
* Memory check
* Communication channel lookup

## Hardware Fingerprinting

Evasion techniques targeting the Hardware level leverage the fact that virtual machines and
emulators often create specific hardware patterns unique to VMs. These devices can either be identified
by well-known manufacturer prefixes such as VMWARE VIRTUAL IDE HARD DRIVE and
QEMU HARDDISK or by specific drivers that are not present in a real user’s system. Examples of virtual environment artifacts a threat actor might search for include the MAC address of the network interface card, BIOS, graphic card, and specific hardware controllers. Hardware fingerprinting can be carried out using Windows Management Instrumentation (WMI) classes and APIs.

Malware can run the following command to retrieve the model name of the system within which it is running.

```
wmic computersystem get model
```

If it is running inside a virtual environment, common outputs that can be retrieved include:

* VirtualBox - "VirtualBox".
* VMware - "VMware Virtual Platform".
* Hyper-V - "Microsoft Virtual Machine".
* QEMU/KVM - "KVM".

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi_v9MSpgMu_8LMgrk5dQ-WQZ4eQpy8AJxLzymUQYjHST0mVYhsUXnoBu3V9vzqZ_YfzCof5IFmQBxFrxWyZUtAJ6vdRMB3nNRQFIhKk8PcIB4gBE6qJq6XhpBYIBvhhvfHVYjedeTEhqLyWACW8LEZD1dCMxd98TJbv2OwHtfjX2gs9pHL3hda1XPxpnI/w654-h98/system.PNG)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi_v9MSpgMu_8LMgrk5dQ-WQZ4eQpy8AJxLzymUQYjHST0mVYhsUXnoBu3V9vzqZ_YfzCof5IFmQBxFrxWyZUtAJ6vdRMB3nNRQFIhKk8PcIB4gBE6qJq6XhpBYIBvhhvfHVYjedeTEhqLyWACW8LEZD1dCMxd98TJbv2OwHtfjX2gs9pHL3hda1XPxpnI/s842/system.PNG)

The following Powershell command gives
the BIOS details of a real and virtual machine respectively.

```
Get-WMIObject -namespace root\cimv2 -class Win32_BIOS
```

This command returns the BIOS manufacturer, version, and serial number of the machine under inspection. In virtual machines, the following can be observed.

* VMware typically returns Phoenix Technologies LTD.
* Hyper-V returns Microsoft Corporation.
* VirtualBox returns innotek GmbH.

On physical machines, the BIOS manufacturer will reflect the actual hardware vendor such as "American Megatrends" or "Dell Inc.".

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhwPohnhUlFvxX2TVA5VcmxriMNLlui1flqBaTz3tinUo23JEzSuPQGAAjDJliNYaxngPwJWAMJiydfDarE3DKhYkwu9kCGKzcvJeEnBk6WMAWUhc6wGHmkspkAqWtNBzSvLL4sGZzuwZas99hhQxbysG2IIYryhpK9Fenf09lED01rPzad0cTdHKBNp8s/w657-h127/bios_.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhwPohnhUlFvxX2TVA5VcmxriMNLlui1flqBaTz3tinUo23JEzSuPQGAAjDJliNYaxngPwJWAMJiydfDarE3DKhYkwu9kCGKzcvJeEnBk6WMAWUhc6wGHmkspkAqWtNBzSvLL4sGZzuwZas99hhQxbysG2IIYryhpK9Fenf09lED01rPzad0cTdHKBNp8s/s1213/bios_.png)

Most virtual machine vendors include the feature to virtualize a custom network interface card (NIC) on your host machine. If your lab is running with any VM native NIC, such can be determined using the following command.

```
wmic nic list
```

The first three bytes of a MAC address are typically specific to the vendor. It is called the MAC address Organization Unique Identifier (OUI). The following MAC address OUIs are associated with virtual machines.

#### VMWare

* `00:05:69`
* `00:0C:29`
* `00:1C:14`
* `00:50:56`

#### VirtualBox

* `08:00:27`

#### Hyper-V

* `00:03:FF`

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4Sjs33mFavvwUdQlAUuKbHc-8DkIln8VrHeNJxzjhIGtXk44MeREm-KHhSMi5o1vqo6B7IghobimLTReVviuUcGs1PzqTmzWBITxBxyROQI6MhJR2NJYB7P4W6ToXo3srFTLwEj0dCK81ZFai9MmBbCxD7sWHAhaT49RBJk__fXjGo17D4HaDdm_gOt8/w656-h252/nic.PNG)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4Sjs33mFavvwUdQlAUuKbHc-8DkIln8VrHeNJxzjhIGtXk44MeREm-KHhSMi5o1vqo6B7IghobimLTReVviuUcGs1PzqTmzWBITxBxyROQI6MhJR2NJYB7P4W6ToXo3srFTLwEj0dCK81ZFai9MmBbCxD7sWHAhaT49RBJk__fXjGo17D4HaDdm_gOt8/s965/nic.PNG)

To bypass this method, assign a MAC address manually in the adapter settings.

To query details about disk drives, such as the model and serial number, malware can run the following command.

```
wmic diskdrive get model,serialnumber
```

In a virtual environment, the following results will be obtained:

* VirtualBox - Disk drives may show as VBOV HARDDISK.
* VMware - Drives might be listed as VMware Virtual Disk.
* Hyper-V - Disk drive may show as Microsoft Virtual Disk.

Physical machines will list actual disk manufacturers like Seagate or Western Digital.

[![](https://blogge...