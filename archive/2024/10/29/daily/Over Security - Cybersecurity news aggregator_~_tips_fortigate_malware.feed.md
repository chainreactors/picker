---
title: ~/tips/fortigate_malware.feed
url: https://blog.lobsec.com/2024/10/fortigate-malware-feed/
source: Over Security - Cybersecurity news aggregator
date: 2024-10-29
fetch_date: 2025-10-06T18:53:51.099992
---

# ~/tips/fortigate_malware.feed

[Vai al contenuto](#content "Vai al contenuto")

[Lobsec](https://blog.lobsec.com/)

Yet another security blog

Menu

Menu

* [CV (ITA)](https://blog.lobsec.com/cv-ita/)
* [Privacy policy](https://blog.lobsec.com/privacy-policy/)

# ~/tips/fortigate\_malware.feed

2024-10-11 di [lobst3r](https://blog.lobsec.com/author/lobst3r/ "Visualizza tutti gli articoli di lobst3r")

## Prefazione

Con il recente aggiornamento dell’home page di [lobsec.com](https://lobsec.com/), ho introdotto un [nuovo servizio](https://security.lobsec.com/) pensato per aiutare chiunque voglia migliorare le proprie regole di detection. L’idea alla base è quella di creare oggetti a partire da feed pubblici che metto a disposizione, per poi utilizzarli in regole specifiche con l’obiettivo di intercettare il traffico in ingresso. In questo modo, è possibile registrare l’attività e identificare il dispositivo che ha generato quel traffico, facilitando così eventuali indagini successive.

## Configurazione

La prima cosa da fare è creare un connettore esterno che raccolga le informazioni necessarie ad alimentare il feed degli hash. Per poterlo fare fare click su “External Connectors” > “Create New”

![](https://blog.lobsec.com/wp-content/uploads/2024/10/0.png)

Spostarsi in fondo alla pagina e cliccare su “Malware Hash”

![](https://blog.lobsec.com/wp-content/uploads/2024/10/1.png)

Compilare i campi necessari come mostrato

![](https://blog.lobsec.com/wp-content/uploads/2024/10/2.png)

```
NOTA: nel caso di fortigate il limite massimo delle entry per ogni file è limitato a 10MB o 131072 linee per file.
```

### Tip #1 – Certificate validation

Per migliorare la sicurezza delle connessioni è consigliato abilitare la **server certificate validation** (server-identity-check) in quanto di default non è impostata. Per farlo da CLI

```
config system external-resource
    edit "MALWARE_HASH_COLLECTION_0"
        set type malware
        set resource "https://security.lobsec.com/fgt_000.txt"
        set server-identity-check {none | basic | full}
    next
end
```

Al termine di questa fase bisogna andare ad editare o a creare nei Security Profiles un profilo antivirus ed abilitarne la lettura dei feed impostati. Per fare questo si va su **Security Profiles > AntiVirus**, si edita / crea un nuovo oggetto dove, in fondo, è necessario spuntare la voce “**Use External Malware Block List**” come mostrato

![](https://blog.lobsec.com/wp-content/uploads/2024/10/3.png)

### Tip #2 – La deep packet inspection

In questo genere di regole, per lo scopo che stiamo cercando di seguire, abilitare la DPI aumenta enormemente le possibilità di rilevamento.

## Test

Come già scritto in passato, tutti i firewall da me gestiti inoltrano i log ad uno stack ELK per la gestione e la ricerca dei file di log.

![](https://blog.lobsec.com/wp-content/uploads/2024/10/4-1024x355.png)

In questo caso vado a filtrare su ELK la direttiva **fortinet.firewall.subtype** contenente la stringa “virus” e mostro in tabella i dati quali:

* observer.name: per mostrare su quale firewall l’evento s’è presentato
* source.ip: l’ip sorgente
* source.user.name: il nome utente legato a quella sessione
* destination.ip: l’ip di destinazione dove il virus è stato scaricato
* destination.port: la porta TCP sul server di destinazione
* fortinet.firewall.action: l’azione che ha intrapreso il firewall (blocked)
* message: il tipo di messaggio che il firewall ha processato riguardo la segnalazione
* file.name: il nome del file
* url.domain: se presente il dominio relativo all’ip di destinazione
* fortinet.firewall.virus: la tipologia di virus riscontrata dal firewall

Ovviamente i campi da mostrare sono a vostra discrezione, un esempio di log raw potrebbe essere questo.

```
date=2024-10-11 time=10:06:46 eventtime=1616195207055607417 tz="-0700" logid="0208008217" type="utm" subtype="virus" eventtype="MALWARE_HASH_COLLECIOTN_0" level="notice" vd="vd1" policyid=1 msg="Detected by EMS threat feed." action="monitored" service="HTTPS" sessionid=1005 srcip=10.1.100.24 dstip=172.16.200.214 srcport=54674 dstport=443 srcintf="port2" srcintfrole="undefined" dstintf="port1" dstintfrole="undefined" proto=6 direction="incoming" filename="creditcardSSN.pdf" quarskip="Quarantine-disabled" virus="Email scan" dtype="File Hash" filehash="22466078c2d52dfd5ebbbd6c4207ddec6ac61aa82f960dc54cfbc83b8eb42ed1" filehashsrc="test" url="https://172.16.200.214/hash/creditcardSSN.pdf" profile="av" agent="curl/7.68.0" analyticssubmit="false" crscore=10 craction=2 crlevel="medium"
```

EOF

Categorie [analysis](https://blog.lobsec.com/category/analysis/), [blue team](https://blog.lobsec.com/category/blue-team/), [cyber](https://blog.lobsec.com/category/cyber/), [tips](https://blog.lobsec.com/category/tips/), [tutorial](https://blog.lobsec.com/category/tutorial/) Tag [cybersecurity](https://blog.lobsec.com/tag/cybersecurity/), [elk](https://blog.lobsec.com/tag/elk/), [feed ip](https://blog.lobsec.com/tag/feed-ip/), [fortigate](https://blog.lobsec.com/tag/fortigate/), [malware](https://blog.lobsec.com/tag/malware/)

[/usr/bin/touch nuova\_era](https://blog.lobsec.com/2024/10/lobsec-nuova-era/)

[~/news/blocklist.news](https://blog.lobsec.com/2024/10/blocklist-ioc-updated/)

## 2 commenti su “~/tips/fortigate\_malware.feed”

1. Germano

   [2024-10-12 alle 10:45](https://blog.lobsec.com/2024/10/fortigate-malware-feed/#comment-22)

   Wow! È il genere di articolo che aspettavo da tempo: semplice, diretto e chiaro!

   [Rispondi](#comment-22)
2. Ivan

   [2024-10-21 alle 17:26](https://blog.lobsec.com/2024/10/fortigate-malware-feed/#comment-23)

   Grazie!

   [Rispondi](#comment-23)

### Lascia un commento [Annulla risposta](/2024/10/fortigate-malware-feed/#respond)

Commento

Nome
Email
Sito web

[ ]  Salva il mio nome, email e sito web in questo browser per la prossima volta che commento.

Δ

* [Analisi di un dropper HTML/JS per Internet Explorer basato su ActiveX e regsvr32](https://blog.lobsec.com/2025/08/analisi-di-un-dropper-html-js-per-internet-explorer-basato-su-activex-e-regsvr32/)
* [Kekpi trojan dissection](https://blog.lobsec.com/2025/03/kekpi-malware-dissection/)
* [NIS2: il caos di cui non avevamo (forse) bisogno](https://blog.lobsec.com/2024/12/nis2-il-caos-di-cui-non-avevamo-forse-bisogno/)
* [~/news/blocklist.news](https://blog.lobsec.com/2024/10/blocklist-ioc-updated/)
* [~/tips/fortigate\_malware.feed](https://blog.lobsec.com/2024/10/fortigate-malware-feed/)
* [/usr/bin/touch nuova\_era](https://blog.lobsec.com/2024/10/lobsec-nuova-era/)

© 2025 Lobsec • Creato con [GeneratePress](https://generatepress.com)

Manage Consent

To provide the best experiences, we use technologies like cookies to store and/or access device information. Consenting to these technologies will allow us to process data such as browsing behavior or unique IDs on this site. Not consenting or withdrawing consent, may adversely affect certain features and functions.

Functional

[ ]
Functional
Sempre attivo

The technical storage or access is strictly necessary for the legitimate purpose of enabling the use of a specific service explicitly requested by the subscriber or user, or for the sole purpose of carrying out the transmission of a communication over an electronic communications network.

Preferences

[ ]
Preferences

The technical storage or access is necessary for the legitimate purpose of storing preferences that are not requested by the subscriber or user.

Statistics

[ ]
Statistics

The technical storage or access that is used exclusively for statistical purposes.
The technical storage or access that is used exclusively for anonymous statistical purposes. Without a subpoena, voluntary compliance on the part of your Internet Service Provider, or additional records from a third party, information stored or retrieved for this purpose alone cannot usually be used to identify you.

Marketing

[ ]
Marketing

The technical storage or access is required to create user profiles to send ...