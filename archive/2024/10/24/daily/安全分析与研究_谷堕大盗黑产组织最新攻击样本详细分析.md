---
title: 谷堕大盗黑产组织最新攻击样本详细分析
url: https://mp.weixin.qq.com/s?__biz=MzA4ODEyODA3MQ==&mid=2247489198&idx=1&sn=4fabd50ceb4b877c24b681f48f31322b&chksm=902fb986a75830908b3c1ccc2634f3c9bad05df01521049a6e9337b2a89ba441ac6c669ba652&scene=58&subscene=0#rd
source: 安全分析与研究
date: 2024-10-24
fetch_date: 2025-10-06T18:52:13.357822
---

# 谷堕大盗黑产组织最新攻击样本详细分析

![cover_image](http://mmbiz.qpic.cn/mmbiz_jpg/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwsfrzu1cHwjfYc5Gc0Cu3kLoiczNXb308tk5kecPcjnSrkO2HZLARpLw/0?wx_fmt=jpeg)

# 谷堕大盗黑产组织最新攻击样本详细分析

原创

pandazhengzheng

安全分析与研究

**安全分析与研究**

专注于全球恶意软件的分析与研究

前言概述

原文首发出处：

https://xz.aliyun.com/t/14049

先知社区 作者：熊猫正正

笔者最近跟踪到一例谷堕大盗黑产组织最新的攻击样本，该攻击样本中使用了多种对抗技术，对该样本进行详细分析。

详细分析

1.样本的编译时间为2024年3月4日，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwuhKzfbeUoY0YzBQsSww9HjXL4OgTlVwSfJiaZPtIZicOyW3gEqqQIrDQ/640?wx_fmt=png)

2.发起URL连接请求，获取黑客远程服务器shellcode代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwlR4ysl7kFHrcPwZEooNIUZaem7p6zAjlzpHCY67oB29zh5cHXQroRw/640?wx_fmt=png)

3.从远程服务器读取到shellcode代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwFvOYQicdTmvv8LzCYzYpoib28FSIbOWw41ICP4Rjic3yVKt4xX2PEH7Ag/640?wx_fmt=png)

4.通过VirtualAlloc分配内存空间，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwUVgRz7a5NcfoK2qsXPiapoaXHHvTSUX3iaoeZYVNB4hEIgxf7yA1GYicQ/640?wx_fmt=png)

5.将获取的shellcode代码拷贝到该内存空间当中，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwpVcrUic9JZdPfyoia7eFZBYGoDek9DENXPHlcj9VJKcWnOf41YV1JLTg/640?wx_fmt=png)

6.跳转到shellcode代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwk5FJDAFs5rXjwytB8Y6j1Bux3nz223L1uJt3twO8fHekHpZsAYutYg/640?wx_fmt=png)

7.shellcode代码调用VirtualAlloc分配内存空间，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwxGic4d4S7Zsbht3MbfDDw3RrAxmUJFWwjtZSx79sqfPdaTyyEoFBYEw/640?wx_fmt=png)

8.然后将shellcode代码中包含的恶意模块代码拷贝到该内存空间中，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lweibibBQOIOvIoibukPGPAS4EeWqWqIV1NhEmXPGgIlL2qguR6UYcOvQ3g/640?wx_fmt=png)

9.恶意模块导出函数，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwqt1457RELF7MPByyYoxyNicBESRRLeWjD1fPvkhHBECmUZ9lO3of4Bg/640?wx_fmt=png)

10.shellcode代码调用执行恶意模块的SCTakes\_L导出函数，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwTy4AuvFichHTXlTE9bSj4An1KPeIYJkZYeibh1YicRXcoc6fVlI6ic2JBg/640?wx_fmt=png)

11.恶意模块使用了多种对抗技术，包含反调试和反虚拟机技术，通过BeingDebugged、NtGlobalFlag、ZwQueryInformationProcess等技术反调试，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lweW04icnR75xYa6x3pMYiaVscXITS3tgUCNJpX2QKvZZPGZvVbibYIoRUQ/640?wx_fmt=png)

12.获取系统CPU温度，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwFRerOb3WJnztU1AKpIvFO6QnTt2cUJuMt7VYeicRdjcReYibMwsAj3Qw/640?wx_fmt=png)

13.获取系统风扇转速，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwHt8IyRBoLaTNh0wT1sAvmU45icLqTcgMVSM8iboPPDj3OZ41vEsWj39w/640?wx_fmt=png)

14.获取主机硬件信息，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwoYlsgf9vUtxhdfPM50nzKRRpdFUGaLbK2mu15qt8Vm8ia2BDpYSdSlw/640?wx_fmt=png)

15.获取系统电源状态，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lw5hb9WYXIZJp7LEAsTFE00KojAqE6icH5mtmyesO9cMQfO6Rkiahbc1ZA/640?wx_fmt=png)

16.进程提权操作，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwcO1yGBa6EwJUJXRnpTcAZlbxVqxxblrzKbh9aa2I1eUYmPeKuKic9Vg/640?wx_fmt=png)

17.读取模块资源数据，在相应的目录下生成EXE和DLL恶意文件，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwVVKsIFdlST0fCIlnmrO4o9l6KoxeoQ3MgSTyBTh11Uo3ibpd3xiaibUibQ/640?wx_fmt=png)

18.恶意模块资源数据，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwGcPXVxt7lwlowKdrRWB3icia11a4pecW4bQmX58G462dYuTFrk1icicB5w/640?wx_fmt=png)

19.生成EXE和DLL恶意文件，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwK2vduyoOcOxwgDgfFvqfYOOHYiaBGibkV4YDybyJvsJK9WVBOsl1svtw/640?wx_fmt=png)

20.生成的文件，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwe6f0qj2rzq2nNNsEPIsyd1MophTWP8OPEUvsBA4rOhxvYVUW163GcA/640?wx_fmt=png)

21.从黑客服务器下载对应的恶意模块数据，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwDCAS50MbicicdURqBiaj7jKyZic1MRbpphduMFLjGPOCGhibMy9ZghIRy8g/640?wx_fmt=png)

22.读取服务器上对应的exehook2.dll模块数据，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwh5VDg8T7sg7Yry6qyVvkPHMnicCuziaaiaCaEqPQTAjf4NC7icNCszibo9g/640?wx_fmt=png)

23.将模块数据写入到生成的sqm.dat文件，并创建相应的计划任务，调用执行EXE程序，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwgQm2jZgl2YQQtXfuibPsUibqzMQF8NUGmZy5VDtpSOwLoibx1e1YiagcEw/640?wx_fmt=png)

24.生成的sqm.dat文件，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lw2YTLrsicsbJUslxkHljbf9fYeTcmfiajyBqqpcfnoyMXUAOsb0A1d8qw/640?wx_fmt=png)

25.sqm.dat文件内容，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lws4n9Y5JoPKbJulmib6LJ8slXzicicvznJz8mWUkJsQvUDaJicd9weibjTHA/640?wx_fmt=png)

26.EXE恶意程序，调用DLL模块的导出函数，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwKBqd3QsYJYtOfwtd04ibibrmmhiamibEAg7tibd6vGGBHBwbiaZvEEB5X8zw/640?wx_fmt=png)

27.DLL恶意模块的导出函数，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwibfoI3zHtqcaj113jCXLEodGEs8sVawudP08bdAYJDtqG4seseAytpw/640?wx_fmt=png)

28.读取目录下的sqm.dat数据到内存当中，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwSibOeDBzhS8yWBThCTuh0SicnDq1AJv5ZAcLJ08HR2wyfdFVrEibdUVzw/640?wx_fmt=png)

29.将读取的内存拷贝到分配的内存空间并解密，解密之后为去掉了MZ标志的恶意payload模块，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwDqKrqj8wgBnibSvn1CmWWRs1jTg0TfvN7zic0WJJPRWIiaxwnniaElViaGQ/640?wx_fmt=png)

30.然后跳转到解密后恶意模块执行，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lw7O5FeFj9YoGNzNwkBvf1Vibr7ySh1CAhnhXwMdqpicFAvGmoKfcgmF0Q/640?wx_fmt=png)

31.解密后的恶意模块为谷堕大盗黑产组织的上线模块，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lw2MwxCv1NjgJKibILC1WBTWz72YBZspQFnuJWJsqJKMo9NAibaSlkmmZQ/640?wx_fmt=png)

该上线模块版本信息为2024年2月，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lw3CE1yXkjnxbeEtZ8mGf8Qe6t34Po9txezdvR8jcicRN9cHMyYNv3QbA/640?wx_fmt=png)

远程服务器IP地址为154.12.84.33，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwrfeBZVe36FdMpsDsicq4Omcuibzs4VAh7dwzL8wz7eT3SDSaHa06Tyuw/640?wx_fmt=png)

通过分析可以确认该攻击样本应该为谷堕大盗黑产组织的最新攻击样本。

威胁情报

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwItYvu1xFq3aSWAkfIbaBEDTSuXnvwNwzLd5YwSw3xxILsnTqr7u8iaw/640?wx_fmt=png)

总结结尾

此次发现的谷堕大盗黑产组织最新的攻击样本，增加了大量的反虚拟机，反调试技术，安全对抗会一直持续存在，并不断升级，有攻必有防，攻与防就是矛与盾的关系，安全研究人员需要持续不断的提升自己的安全能力。

安全分析与研究，专注于全球恶意软件的分析与研究，追踪全球黑客组织攻击活动，欢迎大家持续关注，获取全球最新的黑客组织攻击事件威胁情报。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oibWJqH5OVmUnNRBvJfnT5ukzfT9tt8lwfevbMrbsOTib8voWQSs6wcBeknN0HNtJjcoYORCDu8ekm6MGHqDibrYg/640?wx_fmt=jpeg)

王正

笔名：熊猫正正

恶意软件研究员

长期专注于全球恶意软件的分析与研究，深度追踪全球黑客组织的攻击活动，擅长各种恶意软件逆向分析技术，具有丰富的样本分析实战经验，对勒索病毒、挖矿病毒、窃密、远控木马、银行木马、僵尸网络、高端APT样本都有深入的分析与研究

预览时标签不可点

阅读原文

![]()

微信扫一扫
关注该公众号

继续滑动看下一个

轻触阅读原文

![](http://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmVcFgYKtoVnKR7h3pkl3AyxwS0l7iagicAJnYjEQhwIuZgR3RR65DLpJh2TGZS82DY7CjsBUmiaAl7BQ/0?wx_fmt=png)

安全分析与研究

向上滑动看下一个

知道了

![]()
微信扫一扫
使用小程序

取消
允许

取消
允许

取消
允许

×
分析

![跳转二维码]()

![作者头像](http://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmVcFgYKtoVnKR7h3pkl3AyxwS0l7iagicAJnYjEQhwIuZgR3RR65DLpJh2TGZS82DY7CjsBUmiaAl7BQ/0?wx_fmt=png)

微信扫一扫可打开此内容，
使用完整服务

：
，
，
，
，
，
，
，
，
，
，
，
，
。

视频
小程序
赞
，轻点两下取消赞
在看
，轻点两下取消在看
分享
留言
收藏
听过