---
title: Realtek Sdk CVE-2021-35392漏洞分析
url: https://mp.weixin.qq.com/s?__biz=MzkwNzIxMDUyNg==&mid=2247485105&idx=1&sn=4b8d8da5eebe0dfccc7f9801df6cc7a2&chksm=c0ddfcc0f7aa75d6d608b4c0984939a46eb6af70aac8d36c5af20f722c430be304b68ac7de62&scene=58&subscene=0#rd
source: VLab安全实验室
date: 2023-04-01
fetch_date: 2025-10-04T11:22:59.206532
---

# Realtek Sdk CVE-2021-35392漏洞分析

![cover_image](https://mmbiz.qpic.cn/sz_mmbiz_jpg/0NpbNYDUplQVdTRRJicJ2azEOTmTY3Oafy9tyOgicVibOcRia3AZCvzZZCIIaicvyNMjnWjBeWzUGZm2L73ic5EOggvA/0?wx_fmt=jpeg)

# Realtek Sdk CVE-2021-35392漏洞分析

原创

尖峰实验室

VLab安全实验室

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/0NpbNYDUplQVdTRRJicJ2azEOTmTY3OafecibSXaJYKEr60h31TRUOicdYD6RzewdFzj1fiawg9HD0kgaicibZwQmKaQ/640?wx_fmt=jpeg)

**VLab-实验室**

![](https://mmbiz.qpic.cn/mmbiz_gif/2TSketEedQ9mmk8nGa8zUv26iapUUPIczjUGSuap1ZqpQO56wnwGGmwkicPphswx7DG3CgAribFoibGw48d3VoQ17g/640?wx_fmt=gifwxfrom=5wx_lazy=1)

研究人员公开披露了Realtek公司的SDK中存在4个安全漏洞，攻击者可以未经身份验证远程利用这些漏洞，注入任意命令并以最高权限执行任意代码或导致设备崩溃。这些漏洞影响了至少65个不同供应商生产的近200种产品，并作为供应链漏洞，影响了数十万台下游设备。

## 漏洞概述

Realtek芯片组广泛应用于物联网领域的嵌入式设备中，其中RTL8xxx SoC是一种常见的提供无线功能的芯片组。这些二进制文件通过网络公开服务，由Realtek公司提供。这些二进制文件作为Realtek SDK的一部分进行打包，该SDK由Realtek开发并提供给使用RTL8xxx SoC的供应商和制造商。影响着常见的路由器设备厂商、包括dlink,tp-link,tenda，网件等。

此次分析是Realtek SDK的upnp服务程序，CVE-2021-35392,  UPnP 订阅标头参数堆栈缓冲区溢出。

## 漏洞分析

UPnP的订阅功能允许设备向控制点注册感兴趣的事件。当事件发生时，设备将通知控制点。订阅功能允许控制点获得实时设备状态的更改，从而允许控制点动态地调整其行为。 UPnP的订阅功能通常与事件通知一起使用，该事件通知用于在设备状态更改时通知控制点。

此次的漏洞成因就是在通过对IOT设备进行订阅时，对参数解析不正确造成缓冲区溢出。

分析upnp处理的请求，当程序收到订阅的请求时，ProcessHttpQuery\_upnphttp函数负责进行处理。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0NpbNYDUplQVdTRRJicJ2azEOTmTY3OafzuBhEibicCNYFEfiaOVwWPgNicHYiaibn29Q8dMrwj4gz6PiaiaZx5nKhxVEoQ/640?wx_fmt=png)

在第8行，函数UPnPProcessSUBSCRIBE会解析存储在结构体upnphttp中的HTTP请求，然后将其填充到提供的结构体process\_upnp\_subscription的字段中。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0NpbNYDUplQVdTRRJicJ2azEOTmTY3OafgmUvmFza68OLhic0ylGiadQf1CfFXicWicfWAK9qGtgNAYS3BD6l9ZHX0g/640?wx_fmt=png)

ParseSUBSCRIBEPacket函数解析HTTP请求行。它首先验证URL是否是有效的事件URL，检查主机标头是否对应于自己的IP和端口，最后通过调用GetIPandPortandCallBack从回调标头值中提取IP和端口号。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0NpbNYDUplQVdTRRJicJ2azEOTmTY3OafznCMmibEaicjSp9icPv31o7ojZbMoC8CD5zxibJ57u0icjEyl0vXs1hQfgw/640?wx_fmt=png)

接下来函数调用GetIPandPortandCallback函数对请求的port参数进行处理，另外函数还对协议是否合理进行检测，开头为以http://请求以及SUBSCRIBE开头，http:ip:port是否规范等，检验是否为http://ip:port并把port的值通过atoi函数转换成一个整数，这里由于校验不完整可以构造一个port的参数36557AAAAA\*100，拷贝的port的缓冲区中造成溢出。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0NpbNYDUplQVdTRRJicJ2azEOTmTY3OafPicEzHlInmeLwZ1PFUlpicr5vVPzxibnFq9ZibODIeyjxDJbRFrLgxCY4A/640?wx_fmt=png)

可以构造如下请求进行溢出，

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0NpbNYDUplQVdTRRJicJ2azEOTmTY3Oaf7oBa62yAibZMXdQv1Q1c9C6XSKicnP8WFrqW0h6euECPpiboPFAhu29cA/640?wx_fmt=png)

调试结果：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/0NpbNYDUplQVdTRRJicJ2azEOTmTY3OafdibumJEgs22nicHzOxfsFiaQGxqXhOIYdNib9h7flBJbTlN6Wyia2ww129Q/640?wx_fmt=png)

## 修复方案及防护措施

1、进行软件更新、固件升级：打开路由器的管理界面，通常是在浏览器中输入路由器的IP地址来访问。在管理界面中，寻找固件更新选项，进行固件更新。

2、更改设备默认凭据：IoT 设备都具有默认的用户名和密码。更改这些默认凭据，并使用强密码来保护设备

3、确保网络安全：确保网络的安全性也是非常重要的。可以通过使用网络防火墙、访问控制列表和加密来保护网络。

4、定期更新：定期更新 IoT 设备的软件和固件可以确保设备的安全性和性能。

![](https://mmbiz.qpic.cn/mmbiz_png/asLg7via5ibAkf1mRkpS4IuZibZE5eeC0t8nibIZBfZEekibOEZVWyf9jHzIVvT2sTzKS1OtZzSBErxJUZXD1AwAAWw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

往期回顾

![](https://mmbiz.qpic.cn/mmbiz_png/icjDF5uGXY5ibE0P0Mtzns3KNb5hsCIKPfMIRultHDbmzgJcDaibI4wNKM6ZloyGRtRovyXtVdv3SuuVOcmA8gn8A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

# [VMware vRealize Log HTTP服务两个漏洞分析](http://mp.weixin.qq.com/s?__biz=MzkwNzIxMDUyNg==&mid=2247485086&idx=1&sn=440ac37456efd0056eab04e265a2b3bc&chksm=c0ddfceff7aa75f9ef7b01543a1521d99fc18a7ed81293f393090f2385eee83d1a44e89ffaab&scene=21#wechat_redirect)

# [通过机器学习和反编译来检测恶意样本代码重用](http://mp.weixin.qq.com/s?__biz=MzkwNzIxMDUyNg==&mid=2247485056&idx=1&sn=7c2c0272b9ba81a5f2aceac47fd6176e&chksm=c0ddfcf1f7aa75e73d0a1377a555ea279cc38ccb60143a4993a3ea6cc159166c12879b896fe0&scene=21#wechat_redirect)

# [二进制代码相似性检测也能对抗？](http://mp.weixin.qq.com/s?__biz=MzkwNzIxMDUyNg==&mid=2247485038&idx=1&sn=3854168edee727201558bcc013be8b4f&chksm=c0ddfc1ff7aa7509c0fe81ab2ee479b92d4a9f5e87a99e08f8784ce78efe2b05fcf31f0588c7&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/7lCiaSMMkhia4WIkRNZHTwq8jJicy27jdbWa7ED26252RGmSPRE0rmHQsgZ6ZoichVyFNlvhLelZS09a194B9dyoAQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

引领智能网络攻防科技

![](https://mmbiz.qpic.cn/mmbiz_gif/CD1iaLIMEhibPv9rc3gdLj3g6fiaAcCZqIicylIMVKlbvd5ic5usJ2oia9cTgavs6BwQpEEYbfglc82kCJ0Qic3OHMEaw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

点击**在看**

分享给小伙伴

↓↓点击**阅读原文**，了解更多墨云信息

预览时标签不可点

阅读原文

![]()

微信扫一扫
关注该公众号

继续滑动看下一个

轻触阅读原文

![](http://mmbiz.qpic.cn/sz_mmbiz_png/0NpbNYDUplRErZhd53ibCIib5veEic50TtBhu0HJdTX6Ficmp5bpib3NiczqtCBYicmg5CIkprbRg7iaexwWUia4UziaqfkQ/0?wx_fmt=png)

VLab安全实验室

向上滑动看下一个

知道了

![]()
微信扫一扫
使用小程序

取消
允许

取消
允许

取消
允许

×
分析

![跳转二维码]()

![作者头像](http://mmbiz.qpic.cn/sz_mmbiz_png/0NpbNYDUplRErZhd53ibCIib5veEic50TtBhu0HJdTX6Ficmp5bpib3NiczqtCBYicmg5CIkprbRg7iaexwWUia4UziaqfkQ/0?wx_fmt=png)

微信扫一扫可打开此内容，
使用完整服务

：
，
，
，
，
，
，
，
，
，
，
，
，
。

视频
小程序
赞
，轻点两下取消赞
在看
，轻点两下取消在看
分享
留言
收藏
听过