---
title: How keys are used in FileVault and encryption
url: https://eclecticlight.co/2025/06/25/how-keys-are-used-in-filevault-and-encryption/
source: Instapaper: Unread
date: 2025-06-26
fetch_date: 2025-10-06T22:55:46.884331
---

# How keys are used in FileVault and encryption

[Skip to content](#content)

[![](https://eclecticlight.co/wp-content/uploads/2015/01/eclecticlightlogo-e1421784280911.png?w=103)](https://eclecticlight.co/)

# [The Eclectic Light Company](https://eclecticlight.co/)

Macs & painting â€“ ðŸ¦‰ No AI content

##### Main navigation

Menu

* [Downloads](https://eclecticlight.co/downloads/)
* [Freeware](https://eclecticlight.co/free-software-menu/)
* [M-series Macs](https://eclecticlight.co/m1-macs/)
* [Mac Problems](https://eclecticlight.co/mac-troubleshooting-summary/)
* [Mac articles](https://eclecticlight.co/mac-problem-solving/)
* [Macs](https://eclecticlight.co/category/macs/)
* [Art](https://eclecticlight.co/painting-topics/)

[hoakley](https://eclecticlight.co/author/hoakley/)
[June 25, 2025](https://eclecticlight.co/2025/06/25/how-keys-are-used-in-filevault-and-encryption/)
[Macs](https://eclecticlight.co/category/macs/), [Technology](https://eclecticlight.co/category/technology/)

# How keys are used in FileVault andÂ encryption

We rely on FileVault and APFS to protect our secrets by encrypting the volumes containing our documents and data. How they do that is a mystery to many, and raises important questions such as the role our passwords play, and how recovery keys work. This article attempts to demystify them.

#### NaÃ¯ve encryption

A simple scheme to encrypt a disk or volume might be to take the user password, somehow turn it into a key suitable for the encryption method to be used, and employ that to encrypt and decrypt the data as itâ€™s transferred between disk storage and memory.

[![](https://eclecticlight.co/wp-content/uploads/2025/06/filevaultkeys1.png)](https://eclecticlight.co/wp-content/uploads/2025/06/filevaultkeys1.png)

There are lots of weaknesses and difficulties with that. Even using a â€˜robustâ€™ user password, itâ€™s not going to be memorable, sufficiently long or hard to crack, and thereâ€™s no scope for recovery if that password is lost or forgotten.

#### FileVault base encryption

In Macs with T2 or Apple silicon chips when FileVault is disabled, everything in the Data volume stored on their internal SSD is still encrypted, but without any user password. This is performed in the Secure Enclave, which both handles the keys and performs the encryption/decryption. That ensures the keys used never leave the Secure Enclave, so are as well-protected as possible.

[![](https://eclecticlight.co/wp-content/uploads/2025/06/filevaultkeys2.jpg)](https://eclecticlight.co/wp-content/uploads/2025/06/filevaultkeys2.jpg)

Generating the key used to encrypt the volume, the Volume Encryption Key or **VEK**, requires two huge numbers, a hardware key unique to that Mac, and the xART key generated by the Secure Enclave as a random number. The former ties the encryption to that Mac, and the latter ensures that an intruder canâ€™t repeat generation of the same VEK even if it does know the hardware key. When you use Erase All Content and Settings (EACAS), the VEK is securely erased, rendering the encrypted data inaccessible, and thereâ€™s no means to either recover or recreate it.

This scheme lets the Mac automatically unlock decryption, but doesnâ€™t put that in the control of the user, who therefore needs to enable FileVault to get full protection.

#### FileVault full encryption

Rather than trying to incorporate a user password or other key into the VEK, like many other encryption systems FileVault does this by encrypting the VEK using a Key Encryption Key or **KEK**, a process known as *wrapping.*

![filevaultpasswords1](https://eclecticlight.co/wp-content/uploads/2024/03/filevaultpasswords1.jpg?w=940)

When you enter your FileVault password, thatâ€™s passed to the Secure Enclave, where itâ€™s combined with the hardware key to generate the KEK, and thatâ€™s then used together with hardware and xART keys to decrypt or unwrap the VEK used for decryption/encryption.

This has several important benefits. As the KEK can be changed without producing a new VEK, the user password can be changed without the contents of the protected volume having to be fully decrypted and encrypted again. Itâ€™s also possible to generate multiple KEKs to support the use of recovery keys that can be used to unlock the VEK when the userâ€™s password is lost or forgotten. Institutional keys can be created to unlock multiple KEKs and VEKs where an organisation might need access to protected storage in multiple Macs.

#### APFS encryption

True FileVault requires all keys to be stored in the Secure Enclave, and never released outside it. Intel Macs without T2 chips, and other protected volumes such as those on external storage canâ€™t use that, and in the case of removable storage need an alternative that stays on the disk. For that, APFS uses the AES Key Wrap Specification in RFC 3394, using a secret such as a password to maintain confidentiality of every key.

APFS also uses separate VEKs and KEKs, so enabling the use of multiple KEKs for a single VEK, and the potential to change a KEK without having to decrypt and re-encrypt the whole volume, as in FileVault. In APFS, VEKs and KEKs are stored in and accessed from Keybags associated with both containers and volumes. The Container Keybag contains wrapped VEKs for each encrypted volume within that container, together with the location of each encrypted volumeâ€™s keybag. The Volume Keybag contains one or more wrapped KEKs for that volume, and an optional passphrase hint. These are shown in the diagram below.

![apfsencryption1](https://eclecticlight.co/wp-content/uploads/2024/04/apfsencryption1.png?w=940)

Appleâ€™s documentation refers to several secrets that can be used to wrap a KEK, including a user password, an individual recovery key, an institutional recovery key, and an unspecified mechanism implemented through iCloud. Currently, for normal software encryption in APFS, only two of those appear accessible: a user password is supported in both Disk Utility and `diskutil`â€˜s `apfs` verb, while `diskutil` also supports use of an institutional recovery key through its `-recoverykeychain` options. Individual and iCloud recovery keys only appear available when using FileVault, in this case implemented in software, either on Intel Macs without a T2 chip, or on all Macs when encrypting an external volume.

Because keybags are stored on the disk containing the encrypted volume, if the disk is connected to another Mac, when macOS tries to mount that volume, the user will be prompted to enter its password, and can then gain access to its contents. When FileVault is used to protect a Data volume on the internal SSD of a T2 or Apple silicon Mac, that volume can only be unlocked through the Secure Enclave of that Mac, and it isnâ€™t possible to unlock it from another Mac (thatâ€™s also true when FileVault hasnâ€™t been enabled on that volume).

### Share this:

* [Click to share on X (Opens in new window)
  X](https://eclecticlight.co/2025/06/25/how-keys-are-used-in-filevault-and-encryption/?share=twitter)
* [Click to share on Facebook (Opens in new window)
  Facebook](https://eclecticlight.co/2025/06/25/how-keys-are-used-in-filevault-and-encryption/?share=facebook)
* [Click to share on Reddit (Opens in new window)
  Reddit](https://eclecticlight.co/2025/06/25/how-keys-are-used-in-filevault-and-encryption/?share=reddit)
* [Click to share on Pinterest (Opens in new window)
  Pinterest](https://eclecticlight.co/2025/06/25/how-keys-are-used-in-filevault-and-encryption/?share=pinterest)
* [Click to share on Threads (Opens in new window)
  Threads](https://eclecticlight.co/2025/06/25/how-keys-are-used-in-filevault-and-encryption/?share=threads)
* [Click to share on Mastodon (Opens in new window)
  Mastodon](https://eclecticlight.co/2025/06/25/how-keys-are-used-in-filevault-and-encryption/?share=mastodon)
* [Click to share on Bluesky (Opens in new window)
  Bluesky](https://eclecticlight.co/2025/06/25/how-keys-are-used-in-filevault-and-encryption/?share=bluesky)
* Click to email a link to a friend (Opens in new window)
 ...