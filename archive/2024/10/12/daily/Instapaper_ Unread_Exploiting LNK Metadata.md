---
title: Exploiting LNK Metadata
url: http://windowsir.blogspot.com/2024/10/exploiting-lnk-metadata.html
source: Instapaper: Unread
date: 2024-10-12
fetch_date: 2025-10-06T18:56:03.305862
---

# Exploiting LNK Metadata

# [Windows Incident Response](http://windowsir.blogspot.com/)

The Windows Incident Response Blog is dedicated to the myriad information surrounding and inherent to the topics of IR and digital analysis of Windows systems. This blog provides information in support of my books; "Windows Forensic Analysis" (1st thru 4th editions), "Windows Registry Forensics",
as well as the book I co-authored with Cory Altheide, "Digital Forensics with Open Source Tools".

## Wednesday, October 09, 2024

### Exploiting LNK Metadata

Anyone who's followed me for a bit knows that I'm a huge proponent of metadata, and in particular, exploiting metadata in LNK files that threat actors create, use as lures, and send to their targets.

I read an article not long ago from Splunk titled, *[LNK or Swim: Analysis & Simulation of Recent LNK Phishing](https://www.splunk.com/en_us/blog/security/lnk-phishing-analysis-simulation.html)*. The article covered a good bit of information regarding LNK files sent by some threat actors, and even included a list of metadata items that could be used for "threat intel purposes", as illustrated in figure 1.

|  |
| --- |
| [![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiB8py9VTO13iuU2siENAIHyiByrTaJ9C9w6NTGknSqJtPz5d_AJ6JD63DbcEtlVT_wwhkURQ2TjhXWMhATgugdCq7XjESnTTbxO8fHdASeR8gKaPFJinLgNikMAutSG0eqjPTBC_UvIHjYUyiQ2HKpBYZsiVF8MjObYzsGMbhV_4tKtOXcow/w400-h138/lnk1.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiB8py9VTO13iuU2siENAIHyiByrTaJ9C9w6NTGknSqJtPz5d_AJ6JD63DbcEtlVT_wwhkURQ2TjhXWMhATgugdCq7XjESnTTbxO8fHdASeR8gKaPFJinLgNikMAutSG0eqjPTBC_UvIHjYUyiQ2HKpBYZsiVF8MjObYzsGMbhV_4tKtOXcow/s742/lnk1.png) |
| *Fig. 1: Splunk article excerpt* |

However, what's illustrated in figure 1 was as far as they went. In fact, reading through the article and looking at the images of LNK parser tool output, each of those images is cut off before embedded metadata and "extra data blocks" can be seen. Even then, including this information in the images would require analysts to manually transpose this information, which is a very inefficient and error-prone process, particularly given how small some of these images are within the article.

I will say that the article does go on to talk about the use of LNK files in phishing campaigns, and provides a link to an [LNK generator](https://github.com/MHaggis/notes/blob/master/utilities/LNKGEN.hta) tool. There are some definite opportunities here for a research project, where LNK metadata is compared across different creation methods (righ-click on the Desktop, PowerShell, the generator tool, etc.).

In December, 2016, [JPCERT published an article](https://blogs.jpcert.or.jp/en/2016/12/evidence-of-att-3388.html) describing how threat actors reveal clues about their development environment when they sent LNK files to their targets. The LNK files would contain metadata associated with the system on which they were created, which from a CTI perspective is "free money".

Figure 1 from the JPCERT article, extracted and illustrated in figure 2, demonstrates one way that the LNK file metadata can be used. In this figure, various elements of metadata are used in a graph to illustrate relationships amongst data that would not be obvious via a spreadsheet.

|  |
| --- |
| [![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgt65QqHdhXEKKF-pVaL92KmNIIxW-vRxk1EJb38SL8sdZU8sxkUrDgJePAOaIVs2geT1bc9FeLGTtUtxrj7kzTkNy4a4gCPIMuO8aXEHyS49Os4vY_-VECEbO-xVT5QpMkYFsntxYA25V2dZqC2MG61V1_Bm2UrVSl8un4Hu8OQ1R6J908mw/w391-h400/lnk2.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgt65QqHdhXEKKF-pVaL92KmNIIxW-vRxk1EJb38SL8sdZU8sxkUrDgJePAOaIVs2geT1bc9FeLGTtUtxrj7kzTkNy4a4gCPIMuO8aXEHyS49Os4vY_-VECEbO-xVT5QpMkYFsntxYA25V2dZqC2MG61V1_Bm2UrVSl8un4Hu8OQ1R6J908mw/s536/lnk2.png) |
| *Fig. 2: Figure 1, excerpted from JPCERT article* |

At this point, you're probably asking, "how would this metadata be used in the real world?" Almost 2 years after the JPCERT article was published, the folks at [Mandiant published an article](https://cloud.google.com/blog/topics/threat-intelligence/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign/) regarding the comparison of data across two Cozy Bear campaigns, one in 2016 and the other in 2018. Within that article, at figures 5 and 6, the Mandiant analysts compared LNK file from the two campaigns, illustrating not just the differences, but also the similarities, such as the volume serial number (fig. 5) and the machine IDs (fig. 6). While there were differences in time stamps and other metadata, there were also consistencies between the two campaigns, 2 yrs apart.

If you're saying, "...but I don't do CTI..." at this point, that's okay. There may be steps we can take to use what we know about LNK files to protect ourselves.

If you have Sysmon installed on endpoints, Sysmon event ID 11 events identify file creation or modifications; you can monitor the Sysmon Event Log for such events, and extract the full file name and path. If the file extension is ".lnk", you can verify that that file is an LNK file based the "magic number" within the file header and the GUID that follows it. From there, you can then either flag the file based on the path, or take an extra step to compare the machine ID to the current endpoint name; if they're not the same, definitely flag or even quarantine the file.

Is implementing this yourself kind of scary? No problem. If you're using an EDR vendor (directly, or through an MDR) and the EDR generates similar telemetry (keep in mind, not all do), contact the vendor about adding the capability. Detecting behaviors based on LNK files is notoriously difficult, so why not detect them when they're written to disk, and take action before a user double-clicks it?

Posted by
H. Carvey

at
[8:18 AM](http://windowsir.blogspot.com/2024/10/exploiting-lnk-metadata.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_email.gif)](https://www.blogger.com/email-post/9518042/4535663351581418762 "Email Post")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=9518042&postID=4535663351581418762&from=pencil "Edit Post")

[Email This](https://www.blogger.com/share-post.g?blogID=9518042&postID=4535663351581418762&target=email "Email This")[BlogThis!](https://www.blogger.com/share-post.g?blogID=9518042&postID=4535663351581418762&target=blog "BlogThis!")[Share to X](https://www.blogger.com/share-post.g?blogID=9518042&postID=4535663351581418762&target=twitter "Share to X")[Share to Facebook](https://www.blogger.com/share-post.g?blogID=9518042&postID=4535663351581418762&target=facebook "Share to Facebook")[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=9518042&postID=4535663351581418762&target=pinterest "Share to Pinterest")

#### No comments:

[Post a Comment](https://www.blogger.com/comment/fullpage/post/9518042/4535663351581418762)

[Newer Post](http://windowsir.blogspot.com/2024/10/rundown.html "Newer Post")

[Older Post](http://windowsir.blogspot.com/2024/10/shell-items.html "Older Post")
[Home](http://windowsir.blogspot.com/)

Subscribe to:
[Post Comments (Atom)](http://windowsir.blogspot.com/feeds/4535663351581418762/comments/default)

## Pages

* [Home](http://windowsir.blogspot.com/)
* [Timelines](http://windowsir.blogspot.com/p/timelines.html)
* [Books](http://windowsir.blogspot.com/p/books.html)
* [Malware](http://windowsir.blogspot.com/p/malware.html)
* [FOSS Tools](http://windowsir.blogspot.com/p/foss-tools.html)

## Subscribe To WindowsIR

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Posts

[![](https://resources.blogblog.com/img/widgets/subscribe-netvibes.png)](https://www.netvibes.com/subscribe.php?url=http%3A%2F%2Fwindowsir.blogspot.com%2Ffeeds%2Fposts%2Fdefault)
[![](https://resources.blogblog.com/img/widgets/subscribe-yahoo.png)](https://add.m...