---
title: 深度学习后门攻击分析与实现（二）
url: https://www.secpulse.com/archives/205477.html
source: 安全脉搏
date: 2024-12-27
fetch_date: 2025-10-06T19:35:24.549972
---

# 深度学习后门攻击分析与实现（二）

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 深度学习后门攻击分析与实现（二）

[内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)

[蚁景网安实验室](https://www.secpulse.com/newpage/author?author_id=37244)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng2.png)

2024-12-26

13,507

# 前言

在本系列的第一部分中，我们已经掌握了深度学习中的后门攻击的特点以及基础的攻击方式，现在我们在第二部分中首先来学习深度学习后门攻击在传统网络空间安全中的应用。然后再来分析与实现一些颇具特点的深度学习后门攻击方式。

# 深度学习与网络空间安全的交叉

深度学习作为人工智能的一部分，在许多领域中取得了显著的进展。然而，随着其广泛应用，深度学习模型的安全性也引起了广泛关注。后门攻击就是其中一种重要的威胁，尤其在网络空间安全领域中。

我们已经知道深度学习后门攻击是一种攻击者通过在训练过程中插入恶意行为，使得模型在特定的触发条件下表现异常的攻击方式。具体来说，攻击者在训练数据集中加入带有后门触发器的样本，使得模型在遇到类似的触发器时，产生攻击者期望的错误输出，而在正常情况下，模型仍能表现出高准确率。这种隐蔽性和针对性使得后门攻击非常难以检测和防御。

现在我们举几个例子介绍后门攻击在网络空间安全中的应用场景。

**恶意软件检测**：在网络安全中，恶意软件检测是一个重要应用。攻击者可以通过后门攻击技术，使得恶意软件检测模型在检测特定样本时失效。例如，攻击者可以在训练恶意软件检测模型时插入带有后门的恶意样本，使得模型在检测带有特定触发器的恶意软件时无法正确识别，从而达到隐蔽恶意软件的目的。

![image-20240731095843483](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622178.png)

**入侵检测系统**：入侵检测系统（Intrusion Detection System, IDS）用于监测网络流量并识别潜在的入侵行为。攻击者可以在训练IDS模型时加入后门触发器，使得模型在特定条件下无法识别攻击流量。例如，攻击者可以在训练数据中插入带有特定模式的正常流量，使得模型在检测到这些模式时误判为正常，从而绕过入侵检测系统。

![image-20240731095934308](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622180.png)

**图像识别安全**：在网络空间安全中，图像识别技术被广泛应用于身份验证和监控系统中。攻击者可以利用后门攻击，在训练图像识别模型时插入带有后门的图像样本，使得模型在识别带有特定触发器的图像时出现误判。例如，攻击者可以使得带有特定标志的非法图像被识别为合法，从而绕过安全监控系统。

![image-20240731100025409](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622181.png)

可见后门攻击与网络空间安全其他领域还是存在不少交叉的。

现在我们继续来分析并实现、复现典型的深度学习后门攻击方法。

# BppAttack

## 理论

这篇工作提出了一种名为BPPATTACK的深度神经网络（DNN）木马攻击方法。该攻击利用了人类视觉系统对图像量化和抖动处理不敏感的特性，通过这些技术生成难以被人类察觉的触发器，进而实现对DNN的高效、隐蔽的木马攻击。

现有的攻击使用可见模式（如图像补丁或图像变换）作为触发器，这些触发器容易受到人类检查的影响。比如下图就可以看到很明显的触发器。

![image-20240727210502284](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622182.png)

BPPATTACK方案的核心思想是利用人类视觉系统对图像微小变化的不敏感性，通过图像量化和抖动技术生成难以被人类察觉的触发器，实现对深度神经网络（DNN）的高效、隐蔽的木马攻击。

人类视觉系统对颜色深度的变化不是特别敏感，特别是当颜色变化非常微小的时候。BPPATTACK正是基于这一生物学原理，通过调整图像的颜色深度来生成触发器。

1. **图像量化（Bit-Per-Pixel Reduction）**：

* 图像量化是减少图像中每种颜色的比特数，从而减少图像的总颜色数量。BPPATTACK通过降低每个像素的比特深度，使用量化后的最近邻颜色值来替换原始颜色值，实现对图像的微小修改。

2. **抖动技术（Dithering）**：

* 为了消除由于颜色量化引起的不自然或明显的图像伪影，BPPATTACK采用抖动技术，特别是Floyd-Steinberg抖动算法，来平滑颜色过渡，提高图像的自然度和视觉质量。

  BPPATTACK旨在生成一种触发器，它对人类观察者来说是几乎不可察觉的，但对机器学习模型来说足够显著，能够触发预设的木马行为。这种平衡是通过精确控制量化和抖动的程度来实现的。
* 与需要训练额外的图像变换模型或自编码器的攻击不同，BPPATTACK不需要训练任何辅助模型，这简化了攻击流程并提高了效率。
* 为了提高攻击的成功率和隐蔽性，BPPATTACK采用了对比学习和对抗性训练的结合。通过这种方式，模型被训练来识别和利用量化和抖动生成的触发器，同时忽略其他不重要的特征。

量化过程涉及将原始图像的颜色深度从( m )位减少到( d )位（( d < m )）。对于每个像素值，使用以下公式进行量化：

![image-20240727210819783](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622183.png)

其中：

* ( T(x) ) 是量化后的像素值。
* ( x ) 是原始像素值。
* ( m ) 是原始颜色深度的位数（每个通道）。
* ( d ) 是量化后的目标颜色深度的位数。
* ( \text{round} ) 是四舍五入到最近的整数。

Floyd-Steinberg Dithering:抖动算法用于改善量化后的图像质量，通过将量化误差扩散到邻近像素。对于每个像素，计算量化误差并更新周围像素：

![image-20240727210836408](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622184.png)

然后，根据Floyd-Steinberg分布，更新当前像素和周围像素：

![image-20240727210916608](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622185.png)

BPPATTACK方案的关键在于通过量化和抖动技术生成的微小变化对人类视觉系统是不可见的，但对DNN模型是可区分的，从而实现隐蔽的木马攻击。

## 实现

我们来看看该方法得到的部分中毒样本

![image-20240727211016338](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622186.png)

![image-20240727211031242](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622187.png)

![image-20240727211047210](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622188.png)

分析关键函数

* **`Bpp` 类**：继承自 `BadNet`，添加了命令行参数处理和数据集准备功能，用于特定处理阶段。
* **`set_bd_args` 方法**：配置与攻击设置相关的命令行参数。
* **`stage1_non_training_data_prepare` 方法**：准备和变换数据集，设置 DataLoader，并存储阶段 1 的结果。

![image-20240727211138056](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622189.png)

### 1. 类定义与初始化

* **类声明：**

+ `class Bpp(BadNet)`: `Bpp` 是 `BadNet` 的一个子类。

* **构造函数 (`__init__` 方法)：**

+ `def __init__(self):`: 这是 `Bpp` 的初始化方法。
+ `super(Bpp, self).__init__()`: 调用父类 `BadNet` 的构造函数，以确保执行父类中的初始化逻辑。

### 2. 设置命令行参数

* **`set_bd_args` 方法：**

+ `--bd_yaml_path`: 指定一个 YAML 文件的路径，用于提供额外的默认属性。
+ `--neg_ratio`, `--random_rotation`, `--random_crop`, `--squeeze_num`, `--dithering`: 各种与攻击配置相关的参数，如负比率、旋转、裁剪、压缩和抖动。
+ `def set_bd_args(cls, parser: argparse.ArgumentParser) -> argparse.ArgumentParser:`: 这个类方法用于使用 `argparse` 库设置命令行参数。
+ `parser = add_common_attack_args(parser)`: 调用 `add_common_attack_args` 函数，添加与攻击相关的常见参数。
+ `parser.add_argument(...)`: 添加各种命令行参数：

* **返回值：**

+ 返回更新后的 `parser` 对象，其中包含所有添加的参数。

### 3. 准备第一阶段的数据

* **`stage1_non_training_data_prepare` 方法：**

+ `clean_train_dataloader`: 一个用于清洁训练数据集的 DataLoader，应用了变换。
+ `clean_train_dataloader_shuffled`: 一个用于清洁训练数据集的 DataLoader，但数据是打乱的。
+ `clean_test_dataloader`: 一个用于清洁测试数据集的 DataLoader。
+ `train_dataset_without_transform`, `train_img_transform`, `train_label_transform`, 等变量：这些变量被赋值为调用 `self.benign_prepare()` 的结果，该方法用于准备数据集和变换。
+ `clean_train_dataset_with_transform.wrap_img_transform = test_img_transform`: 将训练数据集的图像变换更新为与测试数据集的图像变换一致。
+ `logging.info("stage1 start")`: 记录阶段 1 的开始。
+ `assert "args" in self.__dict__`: 确保 `args` 属性存在于实例中。
+ `def stage1_non_training_data_prepare(self):`: 这个方法用于准备第一阶段的数据。
+ **日志记录与断言：**
+ **数据集准备：**
+ **DataLoader 初始化：**

* **存储结果：**

+ `self.stage1_results`: 存储各种数据集和 DataLoader 以备阶段 1 进一步使用。

![image-20240727211325748](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409261622190.png)

这段代码是一个神经网络训练和评估的流程，具体针对的是后门攻击（backdoor attack）的研究

1. **初始化**：

* 代码开始时，记录训练阶段2的开始时间。
* 通过断言检查 `self` 对象中是否包含 `args` 属性，获取训练参数。

2. **设备选择**：

* 根据是否有可用的 GPU 来设置计算设备。如果 `args.device` 包含多个设备（例如 `"cuda:2,3,7"`），则使用 `torch.nn.DataParallel` 来并行计算。

3. **模型生成**：

* 调用 `generate_cls_model` 函数生成分类模型 `netC`，并将其移动到指定的设备上。

4. **优化器和学习率调度器**：

* 调用 `argparser_opt_scheduler` 函数获取优化器和学习率调度器。

5. **数据预处理**：

* 过滤出可逆的图像变换（如标准化、缩放、转换为张量）。
* 创建干净和背门攻击的数据集，分别保存处理后的数据集。

6. **训练数...