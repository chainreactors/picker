---
title: CVE-2023-24941: Microsoft Network File System Remote Code Execution
url: https://buaq.net/go-166826.html
source: unSafe.sh - 不安全
date: 2023-06-02
fetch_date: 2025-10-04T11:46:04.611201
---

# CVE-2023-24941: Microsoft Network File System Remote Code Execution

* [unSafe.sh - 不安全](https://unsafe.sh)
* [我的收藏](/user/collects)
* [今日热榜](/?hot=true)
* [公众号文章](/?gzh=true)
* [导航](/nav/index)
* [Github CVE](/cve)
* [Github Tools](/tools)
* [编码/解码](/encode)
* [文件传输](/share/index)
* [Twitter Bot](https://twitter.com/buaqbot)
* [Telegram Bot](https://t.me/aqinfo)
* [Search](/search/search)

[Rss](/rss.xml)

[ ]
黑夜模式

![]()

CVE-2023-24941: Microsoft Network File System Remote Code Execution

In this excerpt of a Trend Micro Vulnerability Researc
*2023-6-1 23:0:0
Author: [www.thezdi.com(查看原文)](/jump-166826.htm)
阅读量:74
收藏*

---

*In this excerpt of a Trend Micro Vulnerability Research Service vulnerability report, Quinton Crist, Guy Lederfein, and Lucas Miller of the Trend Micro Research Team detail a recently patched remote code execution vulnerability in the Microsoft Network File Service (NFS). This bug was originally discovered by Wei in Kunlun Lab with*[*Cyber KunLun*](https://www.cyberkl.com/)*. The vulnerability is triggered when handling incoming NFSv4.1 calls containing utf8strings when the server is low on memory. A remote, unauthenticated attacker could exploit this vulnerability by sending a crafted call to an affected server. The following is a portion of their write-up covering CVE-2023-24941, with a few minimal modifications.*

A remote code execution vulnerability has been reported in Microsoft Network File System (NFS). The vulnerability is triggered when handling incoming NFSv4.1 calls.

**The Vulnerability**

Microsoft Windows ships with several network features, some of which can be used to communicate with non-Windows file shares. One of these modules is NFS.

Network File System (NFS) is a network file system protocol originally developed by Sun Microsystems in 1984. Version 2 is documented in [RFC 1094](https://datatracker.ietf.org/doc/html/rfc1094). Version 3 is documented in [RFC 1813](http://www.ietf.org/rfc/rfc1813.txt). Version 4 was developed by the IETF and is documented in [RFC 3010](https://datatracker.ietf.org/doc/html/rfc3010) (released December 2000) and [RFC 3530](http://www.ietf.org/rfc/rfc3530.txt) (released April 2003). NFS allows users to access remote file shares in the same way that the local file system is accessed. Different access levels and permissions can be set on the share, such as read-write and read-only. Additionally, IP/UID/ GID/Kerberos security can be used. NFS uses Open Network Computing (ONC) Remote Procedure Call (RPC) to exchange control messages. ONC RPC was originally developed by Sun Microsystems, it can also be referred to as [Sun RPC](https://tools.ietf.org/html/rfc5531).

When ONC RPC messages are transferred over TCP, they are prepended with a Fragment header structure (as illustrated in the following table) that specifies the length of the message. This allows the receiver to distinguish multiple messages sent over a single TCP session. Other protocols such as UDP do not use this field. Note that all multi-byte values are encoded in big-endian byte order.

In the NFS4 protocol, a utf8string is transferred in the following format:

A remote codes execution vulnerability has been reported in Microsoft Network File System. The vulnerability is triggered when handling incoming NFSv4.1 calls containing utf8strings when the server is low on memory. When a server is parsing a received string, a buffer is allocated to store the string data. The code does not properly handle the allocation failing, resulting in the null termination byte still being written to the end of an invalid buffer.

A remote, unauthenticated attacker could exploit this vulnerability by sending a crafted call to the victim Network File System service. Successful exploitation of this vulnerability can result in remote code execution.

**Source Code Walkthrough**

The following code snippet was taken from *nfssvr.sys* version 10.0.17763.4252. Comments added by Trend Micro have been highlighted.

**Detection Guidance**

To detect an attack exploiting this vulnerability, the detection device must monitor and parse traffic on ports 2049/TCP and 2049/UDP.

When ONC RPC messages are transferred over TCP, they are prepended with a Fragment header structure (as illustrated in the table above) that specifies the length of the message. This allows the receiver to distinguish multiple messages sent over a single TCP session. Other protocols such as UDP do not use this field. The vulnerable method `XdrDecodeString` can only trigger this vulnerability when called from `Nfs4SvrXdrpDecode_STRING`.

The following fields are parsed using `Nfs4SvrXdrpDecode_STRING` and are defined in [RFC 3530](http://www.ietf.org/rfc/rfc3530.txt):

The detection device should monitor the above fields in all NFS4 messages. Any valid field value could trigger this vulnerability, but an attacker would request a large buffer to increase the probability of the failed allocation happening during the string processing. String lengths greater than `0x1000` should be considered suspicious. If found, an attack exploiting this vulnerability is likely underway.

Note that the detection of strings larger than `0x1000` is based on the typical allowed limit of file path strings and can be adjusted higher or lower to account for various server configurations.

**Conclusion**

Microsoft patched this bug in May as [CVE-2023-24941](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-24941). In their write-up, they note that disabling NFSv4.1 and downgrading to NFSv2 or NFSv3 can be used as a temporary mitigation for this vulnerability. However, they also note that you should not employ this mitigation unless you have already installed [CVE-2022-26937](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-26937) from the May 2022 Windows security updates. The better option is to test and deploy the latest patch for NFSv1 to completely address this vulnerability.

Special thanks to Quinton Crist, Guy Lederfein, and Lucas Miller of the Trend Micro Research Team for providing such a thorough analysis of this vulnerability. For an overview of Trend Micro Research services please visit <http://go.trendmicro.com/tis/>.

The threat research team will be back with other great vulnerability analysis reports in the future. Until then, follow the team on [Twitter](https://www.twitter.com/thezdi), [Mastodon](https://infosec.exchange/%40thezdi), [LinkedIn](https://www.linkedin.com/company/zerodayinitiative), or [Instagram](https://www.instagram.com/thezdi) for the latest in exploit techniques and security patches.

* [Microsoft](https://www.thezdi.com/blog?tag=Microsoft)
* [NFS](https://www.thezdi.com/blog?tag=NFS)
* [Research](https://www.thezdi.com/blog?tag=Research)

文章来源: https://www.thezdi.com/blog/2023/5/31/cve-2023-24941-microsoft-network-file-system-remote-code-execution
 如有侵权请联系:admin#unsafe.sh

© [unSafe.sh - 不安全](https://unsafe.sh) Powered By [PaperCache](https://github.com/code-scan/PaperCache)

* admin#unsafe.sh
* [安全马克](https://aq.mk)
* [星际黑客](https://xj.hk)
* [T00ls](https://t00ls.net)