---
title: 当我们谈论小程序安全时，我们在谈论什么
url: https://www.freebuf.com/articles/web/339661.html
source: FreeBuf网络安全行业门户
date: 2022-10-14
fetch_date: 2025-10-03T19:50:29.333034
---

# 当我们谈论小程序安全时，我们在谈论什么

[![freeBuf](/images/logoMax.png)](/)

主站

分类

云安全

AI安全

开发安全

终端安全

数据安全

Web安全

基础安全

企业安全

关基安全

移动安全

系统安全

其他安全

特色

热点

工具

漏洞

人物志

活动

安全招聘

攻防演练

政策法规

[报告](https://www.freebuf.com/report)[专辑](/column)

* ···
* [公开课](https://live.freebuf.com)
* ···
* [商城](https://shop.freebuf.com)
* ···
* 用户服务
* ···

行业服务

政 府

CNCERT
CNNVD

会员体系（甲方）
会员体系（厂商）
产品名录
企业空间

[知识大陆](https://wiki.freebuf.com/page)

搜索

![](/freebuf/img/7aa3bf7.svg) ![](/freebuf/img/181d733.svg)

创作中心

[登录](https://www.freebuf.com/oauth)[注册](https://www.freebuf.com/oauth)

官方公众号企业安全新浪微博

![](/images/gzh_code.jpg)

FreeBuf.COM网络安全行业门户，每日发布专业的安全资讯、技术剖析。

![FreeBuf+小程序](/images/xcx-code.jpg)

FreeBuf+小程序把安全装进口袋

[![](https://image.3001.net/images/20231020/1697804527_653270ef7570cc7356ba8.png)](https://wiki.freebuf.com)

当我们谈论小程序安全时，我们在谈论什么

* ![]()
* 关注

* [Web安全](https://www.freebuf.com/articles/web)

当我们谈论小程序安全时，我们在谈论什么

2022-10-13 10:41:17

所属地 福建省

![](https://image.3001.net/images/20240308/1709876354_65eaa4828e91d155430d9.png)
本文由
创作，已纳入「FreeBuf原创奖励计划」，未授权禁止转载

# 微信小程序场景

在计算机网络的世界中，每种新技术、新产品或新平台的面世都会衍生出新的安全问题，为网络安全发展注入新鲜血液。在微信巨大用户基础和腾讯公司对小程序平台的大力推广之下，近几年来小程序可谓是发展迅速、遍地开花，为移动互联网又带来了一场繁荣。
从安全的角度来看，虽然小程序技术从本质上只是WEB应用在B/S网络架构上的另一种实践，其安全也更多的是常见基础网络安全的堆叠。但由于小程序依赖于微信相对封闭的生态而存在，面向的却可能是**国内互联网上跨度最广、数量最大的用户群体**。因此对于小程序技术，即使是基础安全问题也值得挖掘与思考，进一步针对小程序的独特性进行安全性的研究。

# 小程序场景下的安全问题

从一张流程图简单说明微信小程序的架构拓扑。
![小程序场景简单拓扑](https://image.3001.net/images/20220720/1658308313_62d7c6d91e491e2a3d39b.png!small)
由图中可见小程序的网络架构主要包含前端与后端两个部分。其中**前端**部分是位于用户侧的客户端，包含微信App和小程序客户端（即小程序前端）；而**后端**部分为远离用户的服务端，包括位于腾讯公司服务器的微信服务器后端，以及提供小程序的业务方后端服务器与数据库等。
在小程序的运行过程中，需要与业务后端进行网络数据通信，以完成业务上的功能；同时小程序的运行环境又依赖于微信生态，因此小程序往往需要调用微信提供的API，例如调用微信客户端的二维码识别、人像识别等API，或调用微信后端提供的用户身份认证等接口。
简单说完微信小程序的架构和通信场景，下面针对上述场景探讨可能存在的安全问题。

## 前端安全

**前端**包括微信客户端和小程序两个部分，其中微信客户端主要以App或应用程序形式存在，具体而言就是基于x86或ARM的Android、iOS、Windows或MacOS应用程序；小程序主体为采用微信定义的方式进行打包、编码甚至加密的web应用。

### 源码泄漏

从二进制逆向来说，微信App采用的保护措施并不多，即使练习时长两年半的逆向工程师也能比较容易进行关键函数Hook，从而达到预期的逆向目的。而小程序部分主要为WEB，因为没有编译过程所以代码基本上以源码方式运行，相较与二进制逆向便天然降低了门槛。即使微信团队在小程序供应链上对构造和分发过程采取了一定的安全措施，但相应的小程序逆向技术更可谓是魔高一丈。例如著名的[wxappUnpacker](https://github.com/qwerty472123/wxappUnpacker)对微信小程序的打包算法进行了逆向，实现了小程序解包，这样小程序的逆向就剩下**源码审计**了。
![通过逆向技术对小程序进行源码级调试](https://image.3001.net/images/20220720/1658308333_62d7c6ed11fa0155edbb0.jpg!small)
源码分发是WEB前端技术的一大特征，因此web前端代码保护技术也是一个亘古的话题。WEB前端技术是小程序的基石，因此WEB前端代码保护技术也可以用于于小程序中，对小程序的WEB前端代码进行保护，即使代码被解包也难以被理解、调试和修改。
在腾讯官方提供的小程序开发工具中提供了[压缩代码和代码保护](https://developers.weixin.qq.com/miniprogram/dev/devtools/codecompile.html)选项，可以在打包的过程中对小程序中的JS代码进行混淆与压缩。也可以使用**好评如潮**的[javascript-obfuscator](https://github.com/javascript-obfuscator/javascript-obfuscator)等第三方开源工具进行JS代码混淆保护。

### 源码信息泄漏

攻击者获取了小程序的源码，除了可以对小程序的特定功能流程、API调用等进行分析与修改，也可能在代码审计过程中发现**由于开发者失误而留在WEB前端代码中的敏感信息**。例如账号密码敏感数据、数据库地址或个人信息等。前阵子有**因为在某技术平台进行交流时在代码注释处泄漏数据库密码导致大量信息泄漏**事件，可见在对发布的代码进行**信息脱敏**的重要性。对于WEB前端代码这种几乎以明文分发的代码，对敏感信息的扫描则更显得尤为重要。
在[小程序开发工具](https://developers.weixin.qq.com/miniprogram/dev/framework/security.html#%E4%BB%A3%E7%A0%81%E7%AE%A1%E7%90%86%E4%B8%8E%E6%B3%84%E6%BC%8F)中虽然对特定数据如手机号、银行卡等敏感数据有一定的扫描能力，但对于用户名密码等敏感数据的扫描与检测通常还是需要人工代码审计进行，同时加强开发人员的安全意识。

### 恶意代码

在小程序供应链上，**开发**可谓是最重要的一环。开发小程序的工具主要有三种：使用腾讯官方提供的小程序开发环境进行开发、使用第三方小程序开发环境进行开发、交给外包团队进行开发。除了直接使用官方工具进行开发之外，后二者都会存在一定的风险，例如被第三方植入恶意代码；如果把前端和后端都交给外包团队进行开发的话，则**恶意代码的风险不仅存在于小程序客户端，也可能存在于服务端**，例如外包团队在服务器上留下后门。
虽然官方开发工具安全又可靠，但往往会有一些限制，从而许多开发者选择了更为自由的第三方开发工具，宁愿**用安全换取方便**，就像多年前的[Xcode后门事件](https://baike.baidu.com/item/%E8%8B%B9%E6%9E%9CXcode%E5%90%8E%E9%97%A8%E4%BA%8B%E4%BB%B6/18656526?fr=aladdin)中，开发者因为官方Xcode下载速度慢而安装了第三方途径下载的Xcode，导致编译出来的App存在后门。
在计算机发展史上，安全与效率的博弈是一直处于动态平衡的过程中，二者都是不可或缺的。

## 后端安全

小程序是典型的前后端分离场景，后端通常使用API方式为小程序前端提供服务。与其他后端服务类似，小程序后端也会面临常见的WEB攻击，而又由于使用API方式提供服务，也会面临API相应的安全问题。

### 网络安全

作为一台服务器在公网开放端口提供服务，自然会受到各种各样的骚扰，比如端口扫描、漏洞扫描和端口爆破等。即使是无关业务，攻击者也可以根据存活的主机与开放的端口发起**DoS**和**DDoS**攻击。
所以说服务器在外一定要学会保护好自己：在网络层上，对包长过大的**Ping of Death**等攻击手段进行识别；在传输层上，对**SYN flood**、**UDP flood**等攻击手段进行识别；在应用层上，还要识别**慢速HTTP**、**DNS洪泛**等攻击。当然，专业领域最好交给专业人士，应用服务器不应该疲于应对攻击，**搭建一个DDoS防御服务**是更好的选择。
![](https://image.3001.net/images/20220720/1658308392_62d7c728aaf9fb9fd9483.png!small)

### WEB安全

作为后端服务，面临的WEB安全也是耳熟能详千篇一律，例如基于PHP和MySQL搭建的后端容易受到MySQL注入、PHP反序列化、文件上传与包含等各种攻击；基于Java及其框架搭建的后端，则会受到各种Java反序列化攻击、框架漏洞攻击等；基于Python和Flask搭建的后端，又有模板注入等攻击方式……
WEB安全攻击手段数不胜数，也是防不胜防，但可以用一个通用招数应对，就是上WAF（Web Application Firewall，WEB应用防火墙）！
![](https://image.3001.net/images/20220720/1658308400_62d7c7306fe161b01a335.png!small)
上图中，由于**抗DDoS**和**WAF**都前置于后端服务器并提供安全服务，因此将二者整合抽象作为**安全层**。

### API安全

API安全和WEB安全存在[些许差异](https://blog.csdn.net/weixin_42976139/article/details/103242246)，而由于小程序场景中对API的大量使用，因此在研究小程序后端安全时，可以将API安全独立于web安全进行研究。除了常见的WEB攻击手段外，小程序场景下的API服务还会面临**CC攻击和未授权访问攻击**等。
许多WAF已经具备了对于CC攻击的防护，但对于API攻击的横向、纵向未授权访问防御，通常需要专业API网关进行防护。除此之外，更为行之有效、低成本高收益的措施则是**提高开发人员的安全意识**。毕竟稍微有安全意识的开发人员就不应该写出有未授权访问漏洞的API。

## 业务安全

说到底小程序也是围绕着业务去提供服务，代码层面上的攻击可以用代码去防御，但对于业务上的攻防，代码就更多只能起到辅助作用。
小程序业务上的一个风险点是攻击者**伪造相似的小程序进行用户欺骗**。[伪造小程序](https://www.163.com/dy/article/H2JNSJ6H0511WFPT.html)并不困难，除了正向开发，还能采用**逆向获取源代码**的方式。而伪造的小程序可以骗取用户的点击则更为轻松，虽然人们常常被教育**不要点击来历不明的链接**，但人们往往忽略了**来历不明的小程序**。比起链接给人们带来的不安全感，小程序的点击页面图文并茂，用户在点击之前几乎无法判断小程序的正规性。
![2022-07-19-14-19-19.png](https://image.3001.net/images/20220720/1658308419_62d7c743d356014608c7b.png!small)
对于虚假小程序的排查，一方面需要微信官方提高对小程序发行的审核，阻止[虚假的小程序发布](https://baijiahao.baidu.com/s?id=1705794218365802175&wfr=spider&for=pc)；另一方面对于相关的业务提供方，也可以进行小程序相似名称进行搜索，或接受用户举报，从而发现伪造小程序。

# 后记

正如前文所说，安全与效率始终在进行着动态平衡的博弈。在移动互联网时代，显然是效率为王。快速的应用开发、功能迭代之下，必然是在安全性上作出了牺牲。小程序是移动互联网的又一次繁荣，也是对应用开发效率的进一步追求，而同样也是在安全性上的又一次牺牲。相比起桌面端应用在安全上的孜孜以求，小程序领域上遍地都是未授权的API。
在一个领域发展到巅峰之时，往往是其安全才开始萌芽，而如今小程序技术已将近成熟，开发人员应该多关注关注安全了。

# 小程序 # 小程序加固

免责声明

1.一般免责声明：本文所提供的技术信息仅供参考，不构成任何专业建议。读者应根据自身情况谨慎使用且应遵守《中华人民共和国网络安全法》，作者及发布平台不对因使用本文信息而导致的任何直接或间接责任或损失负责。

2. 适用性声明：文中技术内容可能不适用于所有情况或系统，在实际应用前请充分测试和评估。若因使用不当造成的任何问题，相关方不承担责任。

3. 更新声明：技术发展迅速，文章内容可能存在滞后性。读者需自行判断信息的时效性，因依据过时内容产生的后果，作者及发布平台不承担责任。

![]()

![](https://image.3001.net/images/20240308/1709876354_65eaa4828e91d155430d9.png)
已在FreeBuf发表 0 篇文章

本文为 独立观点，未经授权禁止转载。
如需授权、对文章有疑问或需删除稿件，请联系 FreeBuf
客服小蜜蜂（微信：freebee1024）

被以下专辑收录，发现更多精彩内容

+ 收入我的专辑

+ 加入我的收藏

展开更多

相关推荐

![]()

关 注

* 0 文章数
* 0 关注者

文章目录

前端安全

* 源码泄漏
* 源码信息泄漏
* 恶意代码

后端安全

* 网络安全
* WEB安全
* API安全

业务安全

![](/images/logo_b.png)

本站由阿里云 提供计算与安全服务

### 用户服务

* [有奖投稿](https://www.freebuf.com/write)
* [提交漏洞](https://www.vulbox.com/bounties/detail-72)
* [参与众测](https://www.vulbox.com/projects/list)
* [商城](https://shop.freebuf.com)

### 企业服务

* [安全咨询](https://company.freebuf.com)
* [产业全景图](https://www.freebuf.com/news/307349.html)
* [企业SRC](https://www.vulbox.com/service/src)
* [安全众测](https://www.vulbox.com/)

### 合作信息

* [斗象官网](https://www.tophant.com/)
* [广告投放](https://www.freebuf.com/articles/444331.html)
* [联系我们](https://www.freebuf.com/articles/444332.html)

### 关于我们

* [关于我们](https://www.freebuf.com/news/others/864.html)
* 微信公众号
* [新浪微博](http://weibo.com/freebuf)

### 战略伙伴

* [![](https://image.3001.net/images/20191017/1571306518_5da83c1686dd9.png)](http://www.aliyun.com/?freebuf)

### FreeBuf知识大陆

![](https://image.3001.net/images/20250703/1751535036_68664dbcae34ac40bb9e7.png)

扫码把安全装进口袋

* [斗象科技](https://www.tophant.com/)
* [FreeBuf](https://www.freebuf.com)
* [漏洞盒子](https://www.vulbox.com/)
* [斗象智能安全](https://ai.tophant.com/)
* [免责条款](https://www.freebuf.com/dis)
* [协议条款](https://my.freebuf.com/AgreeProtocol/duty)

Copyright © 2025 WWW.FREEBUF.COM All Rights Reserved
[沪ICP备2024099014号](https://beian.miit.gov.cn/#/Integrated/index) | [沪公安网备
![](https://image.3001.net/images/20200106/1578291342_5e12d08ec2379.png)](http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011502009321)