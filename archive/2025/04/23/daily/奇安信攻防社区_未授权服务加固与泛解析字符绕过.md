---
title: 未授权服务加固与泛解析字符绕过
url: https://forum.butian.net/share/4271
source: 奇安信攻防社区
date: 2025-04-23
fetch_date: 2025-10-06T22:05:10.672245
---

# 未授权服务加固与泛解析字符绕过

#

[问答](https://forum.butian.net/questions)

*发起*

* [提问](https://forum.butian.net/question/create)
* [文章](https://forum.butian.net/share/create)

[攻防](https://forum.butian.net/community)
[活动](https://forum.butian.net/movable)

Toggle navigation

* [首页 (current)](https://forum.butian.net)
* [问答](https://forum.butian.net/questions)
* [商城](https://forum.butian.net/shop)
* [实战攻防技术](https://forum.butian.net/community)
* [漏洞分析与复现](https://forum.butian.net/articles)
  NEW
* [活动](https://forum.butian.net/movable)
* [摸鱼办](https://forum.butian.net/questions/Play)

搜索

* [登录](https://forum.butian.net/login)
* [注册](https://user.skyeye.qianxin.com/user/register?next=http://forum.butian.net/btlogin)

### 未授权服务加固与泛解析字符绕过

面向公网资产多轮加固的业务、异常的业务，通过泛解析字符让服务抛出异常信息回显，定位到无需认证的位置，缩短未授权业务测试的日常时间成本。

#### \*\*前言\*\*
24年厂商把测试范围全部划到\*\*公网资产、IP\*\*。
顿时压力暴增，公网资产已经23年已经测得七七八八了，未授权漏洞都少的可怜，开发作加固都做了好几轮。
公网资产，测试测着，每天都看着哪些服务容易出洞
很多服务测着测着，大半天过去了，最后发现是强认证，有的测着测着，关键位置上开发做了加固。
干了\*\*大半天白忙活\*\*，我做测试，最后变成测试牵着鼻子走。
要是能像审计代码一样，通过他的实现、回显筛选出脆弱的服务点就好了。就算没后续测试，也能\*\*点到为止\*\*，
"跑路"转向下一处位置。
后续，观察到通过代码让服务抛出异常信息回显是很有效的，就能确认到这些服务点\*\*鉴权、调用、地址\*\*的方式。
通过几个季度的积累，完善了通过"\*\*泛解析字符\*\*"探测功能业务的场景，大幅缩短业务测试时间成本，所谓的无后续\*\*点到为止\*\*。
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743477784455-ce40002e-4435-43ce-9674-dc7696ceb1ee.png)
\*\*树形图\*\*
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743510984121-1e09bd9f-e0e6-475b-8d49-09098dd61d7a.png)
#### 泛解析服务探测
\*\*(案例涉及的场景均已修复，由于项目原因，严重厚码;场景更多面向服务功能的实现,以实用为主，请慢食用)\*\*
##### 泛解析字符
通过代码让服务抛出异常信息回显的字符，根据服务string 值
- string 原字符
- string11、string1 相似字符
- str1aing、straaing 混淆字符
- 1aaa、222 垃圾字符
###### 相似字符场景
目录地址，解析特性，回显相同
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743247358009-3e9c086a-47f0-4883-bb1e-15f9d2acf356.png?x-oss-process=image%2Fformat%2Cwebp)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743247433160-45f1cc17-2431-49d2-b8bb-4ddffb0d0dd8.png?x-oss-process=image%2Fformat%2Cwebp)
###### 混淆字符场景
目录地址，回显异常，状态码通常404
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743247436159-646e5c7e-83b4-49a8-a6ca-866561b58fb7.png?x-oss-process=image%2Fformat%2Cwebp)
探测功能类的回显和其父类回显
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743344413015-98e0ad58-f95c-4f01-aeed-297608a224a6.png?x-oss-process=image%2Fformat%2Cwebp)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743344555079-10d40da9-9657-4a86-8143-c2c46201a50e.png?x-oss-process=image%2Fformat%2Cwebp)
###### 垃圾字符
常见为故障排查，无意义字符，看服务怎么回显
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743344712411-6f1ffd6f-f012-45ac-9818-b96376b267fc.png?x-oss-process=image%2Fformat%2Cwebp)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743344717457-c1b37808-8c04-40d8-bafc-f978bf47022b.png?x-oss-process=image%2Fformat%2Cwebp)
##### 泛解析探测功能类实现
以常见的user类为例，每个具体实现的函数login、get函数、upload函数都归到user这个类下边
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743502936655-85f14201-06db-4618-94cd-cdd7bd64b373.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1743503396120-c50ec34f-2cb7-43d5-84e4-bb0d627fff28.png)
###### 同级功能类，不同权值
上边两处实现都在同个功能类下边，查询都是
- Api-Base+/user/getSymbolDetail
- Api-Base+ /user/getReportDeal
getReportDeal鉴权了，需要提供一处token(required),这时候getReportDeal是否也需要提供一处token(required)?
但getReportDeal实现只需要一个Name值，虽然都是在同个父类user下面，但这不需要token值。
\*\*场景1\*\*
一个难啃的公网域名站，啃了两年
业务接入认证，业务只要请求就是401，需要token、返回用户未登录
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742786563897-2bb97e98-01ed-4af4-9e03-47c70f6acfa1.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742787264104-5ceb13b1-2431-4ef8-a30e-e9b2a64e571b.png)
能看到porjectApi/zuul有一处类实现，但zuul下边的实现跟上任何地址，一律返回401
Link到几个JS，
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742831266248-cf8fb195-6f79-4441-a7e2-755607c9701f.png)
无对象参数，几处封装的函数z({url:"地址"}
直接喷洒到已有的父类: projectapi/zuul 、projectapi
projectapi/zuul+getfunction 401
projectapi+getfunction 401
贴图，需要先用\*\*泛解析字符获取到功能类实际地址\*\*
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742831900681-eebe9bda-1f78-404e-91cf-4d875bad2f09.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742831912135-e2b6cf0f-2353-40f3-99bb-535a510f0a94.png)
![](https://cdn.nlark.com/yuque/0/2025/png/55140349/1743511331142-97c7b456-5943-4e11-9e51-16110c39cd36.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742832169535-7bbbf46c-a428-43bf-b38d-f002cd545687.png)
\*\*通过泛解析获取到XXxmobile这个类是在ProjectApi后边实现\*\*
###### \*\*无需认证的功能类\*\*
接着看他的子类实现
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742869315414-3fee989d-e0a6-4c15-bb6c-ad1cdc0054e4.png)
\*\*基本都和article这个子类实现有关，但这个子类上边测试过他的getfunction，是带鉴权的，(需要required token)\*\*
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742871381823-698d8ec1-b6f5-489e-b4b7-cf30ccbb7fa5.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742871582179-88a329e9-a9fa-4db8-a306-232d6f2a53e1.png)
\*\*参数t值，简单测试，1、11、111、1111\*\*
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742871690091-e9359ae4-25e2-419a-8cd8-8c103523f181.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742871762220-c46b1b21-98e1-4e47-bf0a-e0e2a9c6c94d.png)
\*\*通过泛解析获取他父类xmobile的地址、然后探测xmobile的功能类dept实现，dept的实现不需要认证，就得到一处未授权的功能未授权查询\*\*
\*\*场景2\*\*
陆续扩展
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742872145238-cd39fff9-5227-46ac-b2fb-7bdfc5a1d9db.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742872193232-68118309-58b0-4267-804e-50ebdd3d9b60.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742872229268-e44c81ef-a233-45bd-83a1-f128b86b5851.png)
\*\*混淆的 data: t\*\*
\*\*怎么去处理这个t值?\*\*
这子类opi实现有一处pending值，
跟着这处pending值
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742872964140-ae7a4fd0-2945-4e27-8d42-6f8807db20c7.png)
\*\*params:{userId:L("uid"),pendingStatus:0,page:0,limit:20,type:"all",app:"na186"}\*\*
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742872436958-70999434-347a-4783-b547-53b07e7c4825.png)
\*\*配合user/tree/1111 获取的userId值\*\*
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742872546173-efa468fc-80b0-41ea-9c0b-afde9df2a0b5.png)
\*\*场景3\*\*
###### \*\*功能类的键值混淆\*\*
\*\*做泛解析、分析子类权限最后还是要未授权查询，如果一些键值做了混淆，那应该怎么处理?\*\*
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742873108469-bb0dccb0-c708-4b79-bf42-17e5532f517c.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742873203749-63ecf161-4337-4060-b793-24c7bbab995f.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742873199580-9147e308-c27f-492f-adef-e4daa859407d.png)
但找不到t值，提供任何参数都是返回200，同时后边得跟一处items,这处items是常量还是字符串?
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742873362481-3adc5cab-6b03-4c7c-a847-6ca83c0adc52.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742873368773-c05c4107-4375-497f-8205-7148a4cedae5.png)
通过泛解析处理掉这处值，现在只要跟到t值就能未授权
跟他的封装函数dt，跟到一处传参
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742873108469-bb0dccb0-c708-4b79-bf42-17e5532f517c.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742873487339-0769b668-b6a8-4406-ac61-8b6b7ea6c6c7.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742873552588-e78d6a06-ea49-4daa-ad89-f39dd3739248.png)
在大类已知的情况下边，探测功能类地址，如下图，
##### 泛解析探测布尔型回显
场景是公网一处域名，已获取到父类地址/project/api
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742609964512-a90202ce-6af8-4955-804e-e7629097c3cc.png?x-oss-process=image%2Fformat%2Cwebp)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742609526970-5c89f7b6-69f6-4fcb-b624-c1cd2e02d8ae.png?x-oss-process=image%2Fformat%2Cwebp)
###### 父类回显
但通过泛解析字符处理，会得到
`project/api/pdf/extract\\_table 401 response "not login"
project/api/pd1f/extract\\_table 401 response "not login"
project/api1/pdf/extract\\_table 404 response "404"`
在project/api任意类实现，都需要认证，无认证返回401，login
在project任意实现，不存在返回404
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742612597449-b05a534f-39f5-4f59-84db-58b5050d7957.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742612642590-7d3091a5-5356-4d6c-87f4-b8f55c144b33.png)
![](https://cdn.nlark.com/yuque/0/2025/png/32592117/1742612715712-85a3226a-ca51-4cc7-965d-c0e303df0b70.png)
往上走一层测试，看看
`project/pdf/extract\\_table 401 respo...