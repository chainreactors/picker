---
title: CVE-2022-44563: Huawei Recovery Update Zip ToC-ToU Vulnerability
url: https://labs.taszk.io/blog/post/80_update_toctou/
source: Taszk Labs on taszk.io labs
date: 2023-02-17
fetch_date: 2025-10-04T07:16:46.549770
---

# CVE-2022-44563: Huawei Recovery Update Zip ToC-ToU Vulnerability

[![logo](https://labs.taszk.io/images/taszk_logo.png)
![logo](https://labs.taszk.io/images/taszk_logo_white.png)](https://labs.taszk.io)

* [Home](https://labs.taszk.io/)
* [Articles](https://labs.taszk.io/articles)
* [Advisories](https://labs.taszk.io/blog)
* [Get in touch](https://taszk.io/contact)

## [CVE-2022-44563: Huawei Recovery Update Zip ToC-ToU Vulnerability](https://labs.taszk.io/blog/post/80_update_toctou/)

2023-02-16
 by Lorant Szabo
 [Huawei](/blog/tags/huawei) [ota](/blog/tags/ota) [recovery](/blog/tags/recovery) [toctou](/blog/tags/toctou)

We have identified a new Toc-ToU race condition vulnerability in Huawei’s recovery image implementation of SD-card based firmware updates. The vulnerability can be exploited to achieve arbitrary code execution in recovery mode, enabling unauthentic firmware updates, firmware downgrades to a known vulnerable version or other system modifications.

The vulnerability we are disclosing in this advisory affected a wide range of Huawei devices, including phones on the newest chipsets (Kirin 9000). The November 2022 issue of HarmonyOS and EMUI Security Bulletins contains this vulnerability as CVE-2022-44563.

# Vulnerability Details

The implementation of the “SD-update” mode of the Huawei recovery process, which is a proprietary mode for handling update files located on external media, contains the vulnerability that the update file gets reread between different verification phases. This “Time-of-Check Time-of-Use” vulnerability can be exploited to pass verification before forcing modified update image data to be actually used. By chaining this vulnerability with additional gaps of the update process authentication implementation, it is possible to achieve arbitrary code execution as root in recovery mode.

In order to implement a proof-of-concept exploit, we have developed a custom software emulation of an USB flash drive to be able to provide the recovery with different data on each read, thereby triggering the vulnerability at-will.

For more details on the vulnerability and how to exploit it, see our companion research blog [post](https://labs.taszk.io/articles/post/reunzip/).

# Impact

The vulnerability can be exploited without any knowledge of user credentials.
It takes a just few seconds to boot or force reboot the phone into the eRecovery mode, also the injected binary is ready to run almost immediately after starting the update process.
Furthermore the resources needed for the exploitation are minimal: a Raspberry Pi with an USB-C cable or even an other Huawei phone can be used with a patched USB mass storage device kernel module.

# Affected Devices

Huawei’s proprietary update solution is identical throughout their device lineup regardless of the employed chipset (Hisilicon, Qualcomm, Mediatek) or the used base OS (EMUI, HarmonyOS) of a device. Accordingly, we have verified the following devices to be affected:

* Huawei Mate 40 Pro (NOH-NX9) on 102.0.0.254 (HarmonyOS) – Kirin 9000 chipset
* Huawei Mate 30 Pro (LIO-L29) on 102.0.0.252 (HarmonyOS) – Kirin 990 chipset
* Huawei P50 Pro (JAD-LX9) on 102.0.1.221 (HarmonyOS) – Qualcomm chipset
* possibly every Huawei smartphone and tablet

# Fix

Huawei OTA images, released after November 2022, contain the fix for the vulnerability.

# Timeline

* 2022.09.02. Bug reported to Huawei PSIRT
* 2022.10.10. Request update from Huawei, Huawei PSIRT responds it’s being analyzed
* 2022.11.05. Huawei releases [security bulletin](https://consumer.huawei.com/en/support/bulletin/2022/11/)
* 2022.11.08. Update requested again
* 2022.11.10. Huawei confirms vulnerability severity and the fix and CVE released in the [security bulletin](https://consumer.huawei.com/en/support/bulletin/2022/11/)

### Search

### Tags

[android](/blog/tags/android/)

[baseband](/blog/tags/baseband/)

[bootloader](/blog/tags/bootloader/)

[bootrom](/blog/tags/bootrom/)

[dma](/blog/tags/dma/)

[huawei](/blog/tags/huawei/)

[kernel](/blog/tags/kernel/)

[LTE](/blog/tags/lte/)

[MediaTek](/blog/tags/mediatek/)

[ota](/blog/tags/ota/)

[recovery](/blog/tags/recovery/)

[RIL](/blog/tags/ril/)

[samsung](/blog/tags/samsung/)

[soc](/blog/tags/soc/)

[ssl](/blog/tags/ssl/)

[toctou](/blog/tags/toctou/)

[trustzone](/blog/tags/trustzone/)

### Archives

[2018](/blog/archives/2018/)

[2021](/blog/archives/2021/)

[2022](/blog/archives/2022/)

[2023](/blog/archives/2023/)

[2024](/blog/archives/2024/)

### Authors

[Daniel Komaromy](/blog/author/daniel-komaromy/)

[kutyacica](/blog/author/kutyacica/)

[Lorant Szabo](/blog/author/lorant-szabo/)

[Lorant Szabo, Daniel Komaromy](/blog/author/lorant-szabo-daniel-komaromy/)

[TASZK Security Labs](/blog/author/taszk-security-labs/)

### TOC

### Pages

* [Home](/)
* [Articles](/articles)
* [Advisories](/blog)
* [Get in touch](https://taszk.io/contact)

### Links

### Tags

### TOC

[![logo-footer](https://labs.taszk.io/images/taszk_logo_white.png)
![logo-footer](https://labs.taszk.io/images/taszk_logo.png)](https://labs.taszk.io)

##### Company

TASZK Security Labs SL
Rambla de Catalunya 124, 1-2
08008 Barcelona, Spain

[[email protected]](/cdn-cgi/l/email-protection#4d2e2223392c2e390d392c3e3726632422)

pgp:

[CA86 EB1A E756 13A6 EB30
073F 6BB2 BD92 0E93 5D90](https://labs.taszk.io/taszk.asc)

##### Sitemap

* [Articles](https://labs.taszk.io/articles)
* [Advisories](https://labs.taszk.io/blog)

##### Community

* [Github](https://github.com/TaszkSecLabs)
* [Twitter](https://twitter.com/TaszkSecLabs)

##### We provide clients:

customized solutions for unique challenges in the embedded, mobile, automotive, wireless, and telecommunication technology sectors

##### Fineprint

* [Privacy Policy](https://taszk.io/legal)
* [Disclosure Policy](https://taszk.io/disclosure)