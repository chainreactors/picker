---
title: 记一次细得不行的账户权限提升
url: https://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247496946&idx=1&sn=fd344274014da8f4d5f0705d21c1080a&chksm=e8a5fe91dfd2778741884d78e29eb70766ca43d4b3f53f3f268483de8e8639bd61ed87b93e03&scene=58&subscene=0#rd
source: 迪哥讲事
date: 2025-01-26
fetch_date: 2025-10-06T20:10:59.928918
---

# 记一次细得不行的账户权限提升

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/YmmVSe19Qj4iaTUmE6xOxYcmLXbnDicO7qsbZJvlNmWtFib1QV3ib8oOWJJARmDakGLT2twljTGnict6TlMPuOrWh3w/0?wx_fmt=jpeg)

# 记一次细得不行的账户权限提升

迪哥讲事

以下文章来源于洪椒攻防实验室
，作者Reig

![](http://wx.qlogo.cn/mmhead/Q3auHgzwzM6Ij8UBqaXuqBZiasK1vj7ocf4Vv3Dj4jeY2IjKUmATZHA/0)

**洪椒攻防实验室**
.

隶属于交通运输信息安全中心，专注于交通运输行业红蓝对抗、WEB安全渗透测试，定期分享原创漏洞挖掘、攻防实战文章。

```
声明：该公众号大部分文章来自作者日常学习笔记，未经授权，严禁转载，如需转载，联系洪椒攻防实验室公众号。请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。
```

**0x00 前言**

       某次HW行动中，看到其他队伍的报告，通过修改cookie值中的特定参数来达到越权的目的。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFg2RA4FVQMWlRJeiaLdQcu3icz0kUHwuJQ4ydcRYGM4Q9ic2bwY02A6H1pQ/640?wx_fmt=png)

       直接修改KcUser参数即可越权查看用户密码。看到这我惊呆了，多少年没遇见过这种漏洞了，上一次还是2019年刚学安全不久的时候遇到过，后面就经常测试这种漏洞，但是很长一段时间都没遇到过，所以也就慢慢的不再关注这种漏洞。因为按照常理来说，cookie中有SessionId这种参数，一般都是用SessionId进行鉴别用户身份。很难存在越权漏洞。但是现学现用，自这之后我就开始注意到cookie中的参数。

       刚好最近红队评估一个接一个，某次红队评估项目中遇到一个系统，这是一个提前两天打点的一个系统  存在弱口令，并且存在任意文件上传，我就用jpg内容改了一下aspx格式，证明存在漏洞就放那了，心想口子这不就来了吗？你不穿谁穿？

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgwp09ianDs1U3TelLiaCuvCDaOdJqVoia1SjtnfU5G2kTgyh8rAdAicFkqg/640?wx_fmt=png)![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFg4d8bBOU0rQHaQAFTBONrVkySmIMZrsKpSJ7lgSUFPBukkwSzgLMQBQ/640?wx_fmt=png)

        结果正式开打之后就404了：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgWqvFd9C1qiblMCuw8aPaJ28ia99ia7IkBn0OZZBMjSuLs4ROawP1Hd3hw/640?wx_fmt=png)

       我日\*\*\*\*\*\*\*\*\*，应该是有态感监测到了aspx上传行为，开发直接给这个功能删了。普通用户权限下只有这一个上传点，心想管理员是不是有其他的上传点。至此开始超细节的权限提升之路。

**0x01 开始操作**

        首先看看修改密码处，验证原密码，无法实现越权操作。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgKEGjQRN2ZPdteBHf2yeIVOzicIuPoKcUkpRHckUxLDgFw86zKs1z7Fg/640?wx_fmt=png)

        观察cookie，存在多个SessionID等多个参数。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFg3p1EaBA0DUccRlENHVxic9wXraAgmNia4oQUAI4GeUPhToic1iakTMxlEw/640?wx_fmt=png)       按常理来说，大部分的判断用户身份的应该都是SessionId对吧？在之前我可能会到此为止了，但是我想到了前不久有师傅提到了改cookie中的参数，直接现学现用：打开我的资料处：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgChU5EZTtIQ5ChnIYpKpiaHGNMibIfRtcEW8MDvew3hwy6qBd31iaLnGQg/640?wx_fmt=png)       存在一个随机加密的用户id，get请求中及cookie、返回包中均存在该id，那我们怎么拿到这个id呢？

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgtmA0gAfop0khQeK51e7AHtMpwcHQFlDIdKjpETdibAYGQYJLAGDQ6Mg/640?wx_fmt=png)        cookie中还有一个Value参数，是当前用户的用户名：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgtxgNLYY7ibvzyibmC5wI9bUhKDN7TyvHQTxDy6BhtbBVMZ3dTARz1icVA/640?wx_fmt=png)![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgesnMOkdh6WRxEMk4LuTicicdlib3Uxx3K99BkrWoUibF42zUQqaFFm0vPw/640?wx_fmt=png)

       改为admin是不是就可以了？但是很遗憾 不行。到这大多数师傅们应该是到此为止了。但是我没有！！！！开始细到不行的操作。       既然改Value不行，证明你要么还判断了SessionId，要么是cookie中的key，也就是get请求中的did，因为这个id多次出现。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgbQnqtu6c6wgeyCcvLZib5rZosg2HxdNHrZcJaLp7wiaMfUMJjvBeaL7A/640?wx_fmt=png)       懒得一个个测试，我直接全给你删咯，只保留个\_user参数，并且把Key的值也删了：奇迹时刻，直接越权查看到了admin的信息，拿到id不就简单了吗！！！

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgmlPqJGNcmY3BQRtmfH22V1QRVVs1sh8ueJNqV6AGZQRT0KCc0uYOyQ/640?wx_fmt=png)      其实在刚刚测试中，删除SessionId的值就可以了，既然不用校验SessionId，我们也有了管理员的id，后面的操作师傅们应该就有思路了。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFg1Y8MK9Wibf5763iaReibksSojSso7PRta3zlnX56ic36P8R2B9MSPyacDQ/640?wx_fmt=png)      只需要找到管理员的用户管理模块的url地址，就可以实现完美的越权操作。打开首页，可以看到有个菜单栏，能获取到当前用户的所有权限功能模块：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgibjicdiaa15DcbXBQq5WrqiaicecAbOTk2QmqJALKBOmnibOO2e4CxTSlLsg/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgeFp5P2jBib4yjUfl67RMs6RMNsA4I9c5A4fjp6IhG5RktXqzWNLsScg/640?wx_fmt=png)       找到请求该菜单的接口，这时候我们只需要将该cookie中的id替换为刚刚我们获取到的管理员id即可：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgm7VJ1OVRmMRXKfJoCXvWEZkkuOhosPhObe6wph9EJBES9KhGtGyh4A/640?wx_fmt=png)       既然得到了用户管理的url，带上cookie，直接重置密码或者创建管理员账户就都可以了，两万多个用户：

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgU8sFKV6ULdL2iaH4BIzicgP4XpVTNUFRzVibxGmIib8uCzemSZBnPR562g/640?wx_fmt=jpeg)

        直接重置admin的密码：![](https://mmbiz.qpic.cn/sz_mmbiz_png/LxQLSKM9eAJciaU2w4DwLZwKEEia5QjIFgpOA2bVRHxSx3UYKU9AFxLDv4heeyDXYI4J9afZVR61dlr5FJI3ickRQ/640?wx_fmt=png)       虽然拿到管理员账户了 但是两个编辑器上传点都限制了，没办法getshell了，只能拿着两万个用户去爆破其他系统。这个系统就到此为止了xdm。

**0x02 总结一下**
        越权漏洞的小tips，这种漏洞可能会不常见，但肯定会有，xdm平时可以关注一下。

如果你是一个长期主义者，欢迎加入我的知识星球，我们一起往前走，每日都会更新，精细化运营，微信识别二维码付费即可加入，如不满意，72 小时内可在 App 内无条件自助退款

![](https://mmbiz.qpic.cn/mmbiz_png/YmmVSe19Qj5EMr3X76qdKBrhIIkBlVVyuiaiasseFZ9LqtibyKFk7gXvgTU2C2yEwKLaaqfX0DL3eoH6gTcNLJvDQ/640?wx_fmt=png&from=appmsg)

## 往期回顾

[一款bp神器](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247495880&idx=1&sn=65d42fbff5e198509e55072674ac5283&chksm=e8a5faabdfd273bd55df8f7db3d644d3102d7382020234741e37ca29e963eace13dd17fcabdd&scene=21#wechat_redirect)

[挖掘有回显ssrf的隐藏payload](https://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247496898&idx=1&sn=b6088e20a8b4fc9fbd887b900d8c5247&scene=21#wechat_redirect)

[ssrf绕过新思路](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247495841&idx=1&sn=bbf477afa30391b8072d23469645d026&chksm=e8a5fac2dfd273d42344f18c7c6f0f7a158cca94041c4c4db330c3adf2d1f77f062dcaf6c5e0&scene=21#wechat_redirect)

[一个辅助测试ssrf的工具](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247496380&idx=1&sn=78c0c4c67821f5ecbe4f3947b567eeec&chksm=e8a5f8dfdfd271c935aeb4444ea7e928c55cb4c823c51f1067f267699d71a1aad086cf203b99&scene=21#wechat_redirect)

[dom-xss精选文章](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247488819&idx=1&sn=5141f88f3e70b9c97e63a4b68689bf6e&chksm=e8a61f50dfd1964692f93412f122087ac160b743b4532ee0c1e42a83039de62825ebbd066a1e&scene=21#wechat_redirect)

[年度精选文章](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247487187&idx=1&sn=622438ee6492e4c639ebd8500384ab2f&chksm=e8a604b0dfd18da6c459b4705abd520cc2259a607dd9306915d845c1965224cc117207fc6236&scene=21#wechat_redirect)

[Nuclei权威指南-如何躺赚](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247487122&idx=1&sn=32459310408d126aa43240673b8b0846&chksm=e8a604f1dfd18de737769dd512ad4063a3da328117b8a98c4ca9bc5b48af4dcfa397c667f4e3&scene=21#wechat_redirect)

[漏洞赏金猎人系列-如何测试设置功能IV](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247486973&idx=1&sn=6ec419db11ff93d30aa2fbc04d8dbab6&chksm=e8a6079edfd18e88f6236e237837ee0d1101489d52f2abb28532162e2937ec4612f1be52a88f&scene=21#wechat_redirect)

[漏洞赏金猎人系列-如何测试注册功能以及相关Tips](http://mp.weixin.qq.com/s?__biz=MzIzMTIzNTM0MA==&mid=2247486764&idx=1&sn=9f78d4c937675d76fb94de20effdeb78&chksm=e8a6074fdfd18e59126990bc3fcae300cdac492b374ad3962926092aa0074c3ee0945a31aa8a&scene=21#wechat_redirect)

预览时标签不可点

![]()

微信扫一扫
关注该公众号

继续滑动看下一个

轻触阅读原文

![](http://mmbiz.qpic.cn/mmbiz_png/YmmVSe19Qj4k2mXPm8xlXujVgicTGvZbcictoGLuPERQn9lRPAKkKUB5ut9XMicric8PxLRmSOq0tT5LuGuD1WemBQ/0?wx_fmt=png)

迪哥讲事

向上滑动看下一个

知道了

![]()
微信扫一扫
使用小程序

取消
允许

取消
允许

取消
允许

×
分析

![跳转二维码]()

![作者头像](http://mmbiz.qpic.cn/mmbiz_png/YmmVSe19Qj4k2mXPm8xlXujVgicTGvZbcictoGLuPERQn9lRPAKkKUB5ut9XMicric8PxLRmSOq0tT5LuGuD1WemBQ/0?wx_fmt=png)

微信扫一扫可打开此内容，
使用完整服务

：
，
，
，
，
，
，
，
，
，
，
，
，
。

视频
小程序
赞
，轻点两下取消赞
在看
，轻点两下取消在看
分享
留言
收藏
听过