---
title: 超大规模数据库集群保稳系列之二：数据库攻防演练建设实践
url: https://tech.meituan.com/2023/05/26/database-attack-and-defense-practice.html
source: 美团技术团队
date: 2023-05-27
fetch_date: 2025-10-04T11:38:03.896459
---

# 超大规模数据库集群保稳系列之二：数据库攻防演练建设实践

[ç¾å¢ææ¯å¢é](https://tech.meituan.com/ "ç¾å¢ææ¯å¢é")

* [ææ°æç«](https://tech.meituan.com/ "æ¥çææ°æç«")
* [æç« å­æ¡£](/archives "æ¥çæç«")
* [ææ¯æ²é¾](/tech-salon "äºè§£ææ¯æ²é¾")
* [å³äºæä»¬](/about "äºè§£æ´å¤å")

Â© 2023 ç¾å¢ææ¯å¢é

All rights reserved.

# [è¶å¤§è§æ¨¡æ°æ®åºéç¾¤ä¿ç¨³ç³»åä¹äºï¼æ°æ®åºæ»é²æ¼ç»å»ºè®¾å®è·µ](https://tech.meituan.com/2023/05/26/database-attack-and-defense-practice.html)

2023å¹´05æ26æ¥
ä½è: å å¨
[æç« é¾æ¥](https://tech.meituan.com/2023/05/26/database-attack-and-defense-practice.html)
9246å­
19åééè¯»

## 01 èæ¯

### 1.1 åè¯æ··æ²å·¥ç¨

é¦åæä»¬åäºè§£ä¸ä¸ä»ä¹æ¯æ··æ²å·¥ç¨ï¼ç®åèè¨ï¼æ··æ²å·¥ç¨æ¯å¨ç³»ç»ä¸è¿è¡å®éªçææ¯ææ®µï¼ç®çæ¯å»ºç«å¯¹ç³»ç»æµå¾¡çäº§ç¯å¢ä¸­å¤±æ§æ¡ä»¶çè½åä»¥åä¿¡å¿ãè¿ä¸»è¦ä½ç°å¨ä¸¤ä¸ªæ¹é¢ï¼ä»ç³»ç»è§åº¦æ¥è®²ï¼æ··æ²å·¥ç¨å¯ä»¥æåæä»¬æ¶æçå®¹éè½ååé§æ§ï¼éä½æéåççåå¤åçï¼æåç³»ç»ç¨æ·å¨ä½¿ç¨æ¶çä½éªï¼ä»äººåè§åº¦æ¥è®²ï¼éè¿æ··æ²å·¥ç¨æä»¬å¯ä»¥å æ·±å¯¹æ¶æççè§£ï¼å¨å¤çæéæ¶è½æé«æ´ä½çåºæ¥æçï¼å¹¶ä¸è½ä¸»å¨å»æ¢ç©¶ç³»ç»ä¸­æ½å¨çä¸äºé®é¢ã

æ··æ²å·¥ç¨ææ©å¯ä»¥è¿½æº¯å°2008å¹´ï¼å½æ¶å¥é£å¬å¸ï¼Netflixï¼å æ°æ®åºæéé æäºä¸æ¬¡å·¨å¤§çæå¤±ï¼äºæ¯ä»ä»¬ä¾¿å´ç»çç¨³å®æ§ä½ç³»ååºäºä¸äºæ¢ç´¢åå»ºè®¾ãç´å°2015å¹´ï¼æ··æ²å·¥ç¨ççå¿µæè¢«å¥é£æ­£å¼çæåºã2019å¹´ï¼é¿éäºæ¨åºäºå¼æºå·¥å·[Chaos Blade](https://github.com/chaosblade-io/chaosblade)ï¼2020å¹´ï¼PingCAPå¼æºäº[Chaos Mesh](https://github.com/chaos-mesh/chaos-mesh)ï¼è¿ä¹æ å¿çå½åå¨æ··æ²å·¥ç¨é¢åä¹æäºæççäº§åã

![æ¥æºï¼ä¸­å½ä¿¡æ¯éä¿¡ç](https://p0.meituan.net/travelcube/0c465d3ad2f7bd9ab12376a8ac6d67ee1134711.png)

### 1.2 ç°ç¶

ä¸é¢æ¯å½åç¾å¢æ°æ®åºè¿ç»´çä¸äºç°ç¶ï¼è¿éä»äºä¸ªç»´åº¦å±å¼ï¼é¦åéç¾¤è§æ¨¡ï¼åæ¬éç¾¤çå¤§å°åæ°éï¼ççº¿æ§å¢é¿ï¼ç¬¬äºï¼éç¾¤è®¿é®éçæç»­å¢å ï¼å½ç¶è¿ä¹æ¯ç¾å¢ä¸å¡å¢é¿çå¿ç¶ç»æï¼ç¬¬ä¸ï¼çº¿ä¸éå°çæéç§ç±»ä¹è¶æ¥è¶å¤ï¼ç¬¬åï¼åä½æ¶é´æéçå½±åä¹è¶æ¥è¶å¤§ï¼ç¬¬äºï¼ä¸äºå°æ¦çäºä»¶çåçä¹éçéç¾¤è§æ¨¡çæ©å¤§æä¸ºäºå¯è½ã

![](https://p0.meituan.net/travelcube/f4cdbe86a9b19b89e90c74d470cc93d385709.png)

### 1.3 çç¹&ä½ç¨

åºäºä»¥ä¸çé®é¢ï¼æä»¬æ´ä½ä¸å¯¹äºæ°æ®åºéç¾¤çç¨³å®æ§è¦æ±ä¹è¶æ¥è¶é«ãæä»¥ï¼å´ç»çç¨³å®æ§å»ºè®¾ï¼æ°æ®åºå¢éå¨æéçé¢é²ãåç°ãåæãæ¢å¤ä»¥åäºåå¤ç5ä¸ªæ¹é¢åäºå¾å¤å·¥ä½ãå¶ä¸­å¨æéé¢é²æ¹é¢ï¼æä»¬ä¼éè¿æéæ¼ç»æ¢ç´¢ä¸åæéåºæ¯å¯¹æä»¬ä¸å¡çå½±åï¼æåæéåçæ¶ä¸å¡ç³»ç»æ´ä½çå®¹éè½åãæ©æçæ¶åï¼æä»¬éè¿äººå·¥çæ¹å¼æ¥åæéæ¼ç»ï¼ä½äººå·¥æ¼ç»å¨ä»¥ä¸åä¸ªæ¹é¢å­å¨å¾å¤§çé®é¢ï¼

![](https://p0.meituan.net/travelcube/2889f96d4b03fc6bc78e2933c9bc30a3165211.png)

1. å¨æ¼ç»åºæ¯æ¹é¢ï¼äººå·¥æ¼ç»è½æ¼ç»çåºæ¯æ¯è¾å°ï¼æ¼ç»åºæ¯çå¤æåº¦ä¹æ¯è¾é«ï¼
2. å¨æ¼ç»è¦ççæ¹é¢ï¼äººå·¥æ¼ç»æ æ³è¦çå¤§å¤æ°çéç¾¤ï¼ä¹å°±æ æ³ä¿è¯å¸¸æåçæéæ¼ç»ï¼
3. å¨æ¼ç»è§æ¨¡æ¹é¢ï¼äººå·¥æ¼ç»æ²¡æåæ³è¿è¡å¤§è§æ¨¡æ¼ç»ï¼å¨éå°ä¸äºæºæ¿æèäº¤æ¢æºçº§çæéæ¶ï¼åæ¢è½åæ æ³å¾å°ææéªè¯ï¼
4. å¨å½±åèå´æ¹é¢ï¼äººå·¥æ¼ç»å¨æ´ä¸ªæ¼ç»è¿ç¨ä¸­ä¸è½å¾å¥½å°æ§å¶çç¸åå¾ï¼éå°é®é¢ä¸è½å¿«éæ­¢æã

åºäºäººå·¥æ¼ç»çè¿äºçç¹é®é¢ï¼æä»¬è®¾è®¡å¹¶å»ºè®¾äºæ°æ®åºæéæ¼ç»å¹³å°ï¼è¿ä¸ªå¹³å°çä½ç¨ä¸»è¦ä½ç°å¨ä»¥ä¸åä¸ªæ¹é¢ï¼ç¬¬ä¸ï¼éªè¯æéåçæ¶ç»ä»¶çé²å®è½åï¼ç¬¬äºï¼éè¿æ°æ®åºå¤§è§æ¨¡å®¹ç¾æ¼ç»ï¼éªè¯æ°æ®åºéç¾¤çå®¹ç¾è½åï¼ç¬¬ä¸ï¼å¯ä»¥éªè¯æéåçæ¶ç¸å³é¢æ¡ï¼ä¸å¡ãDBAï¼çæææ§ï¼ç¬¬åï¼å¯ä»¥é¢ç¥æéå¯¹ä¸å¡é æçåç§å½±åã

## 02 å»ºè®¾å®è·µ

### 2.1 ä½ç³»æ¶æ

å½åï¼æ°æ®åºæéæ¼ç»å¹³å°ä½ç³»æ¶æä¸»è¦åæ¬å¦ä¸å­ä¸ªæ¨¡åï¼

![](https://p1.meituan.net/travelcube/6dd55219e3d496ea609f86507bb85f22147503.png)

1. **æéç®¡ç**ï¼æ§å¶æ¼ç»åèµ·äººï¼å¯ä»¥å¯¹åªäºéç¾¤åèµ·æéæ¼ç»ï¼
2. **æ¼ç»è¯ä¼°**ï¼æ¼ç»ä¹åä¸ºäºé¿åæ¼ç»é£é©ï¼ä¼å¯¹éç¾¤åä¸äºæ£æ¥ï¼æ¯å¦éç¾¤çé«å¯ç¨æ¯å¦å¼å¯ï¼æææ¯å¦ç¬¦åè¦æ±ï¼æ¼ç»æ¶é´æ¯å¦å¤å¨éç¾¤è®¿é®çé«å³°æç­ï¼
3. **æéæ³¨å¥**ï¼å¨ç¸å³çæ£æ¥éè¿åï¼çæ­£å»æ§è¡æéçä¸åï¼
4. **ææ è§æµ**ï¼å¨æ´ä¸ªæ¼ç»æé´ä¼éè¿ééä¸äºå¯ä»¥åæ ç¨³æçæ°æ®ï¼æ¯å¦ä»¥ä¸å¡çè®¿é®æåçãä¸å¡çååºå»¶è¿ç­ç­ï¼æ¥åææéæ¼ç»å¯¹ä¸å¡é æçå½±åï¼
5. **ç»æ­¢æ³¨å¥**ï¼å¨æ¼ç»è¿ç¨ä¸­åç°æ´ä½å½±åæ¯è¾å¤§ï¼æèæä¸äºéå¯æ§çå½±åï¼å¯ä»¥ç«å»ç»æ­¢æéæ¼ç»ï¼é¿åæéæ¼ç»å¯¹çº¿ä¸ä¸å¡é æçå½±åè¿ä¸æ­¥æ©å¤§ï¼
6. **æºè½åæ**ï¼å¨æ¼ç»ç»æä¹åï¼å¯ä»¥éè¿ééä¸äºååºæéæ³¨å¥æèæ¯é²å®ç»ä»¶çç¸å³æ°æ®å¤å®æ¬æ¬¡æéæ¼ç»æ¯å¦ç¬¦åé¢æã

å½åæéæ³¨å¥æ¯æçä¸»æºç±»åæ¯è¾å¨é¢ï¼å¯ä»¥å¨ç©çæºãèææºãå®¹å¨ä¸åæéæ¼ç»ã

### 2.2 è½åå¨æ¯

è¿é¨åä¸»è¦ä»ç»ä¸ä¸æä»¬æéæ¼ç»å¹³å°çè½åå¨æ¯ï¼å®ä¸»è¦è§åäºæä»¬å½åæ°æ®åºæéæ¼ç»å¹³å°çä¸äºæ ¸å¿è½åï¼æ´ä½çç»èå¦ä¸å¾æç¤ºï¼

![](https://p0.meituan.net/travelcube/31775d490769fc29aa4a0f47e9f3f78a1020356.png)

* ä»æ¯æçæ°æ®åºæ¥çï¼å½åæä»¬ä¸»è¦æ¯æMySQLçæéæ¼ç»ï¼
* æ¯æçæ°æ®åºç»ä»¶ææ°æ®åºè®¿é®ä¸­é´ä»¶ãæ°æ®ä¼ è¾ãé«å¯ç¨ç³»ç»åBinlog Serverï¼æä»¬ä¼å¨åç»­çè¿­ä»£ä¸­éæ­¥æ¯æï¼å½åæä»¬æ­£å¨æ¥å¥æ°æ®åºè®¿é®ä¸­é´ä»¶çä¸äºæ¼ç»åºæ¯ï¼
* å¨æ´ä¸ªæéæ¼ç»è¿ç¨ä¸­ï¼æä»¬ä¼ä¾èµé«å¯ç¨ãå®¹ç¾ç®¡æ§ãæéè¯æ­ãæéååºä»¥åææèªæç­å¤ä¸ªæ¹é¢çè½åï¼ä¸»è¦æ¯éªè¯ä¸é¢æå°çè¿äºç»ä»¶å¨æ´ä¸ªæ¼ç»è¿ç¨ä¸­çè¡¨ç°æ¯å¦ç¬¦åé¢æï¼
* å½åï¼å¹³å°èªèº«å·²ç»å½¢æäºä»æéç¼æãæéæ³¨å¥ãææ è§æµãæéç»æ­¢ãåæå¤ççä¸ä¸ªé­ç¯ã

### 2.3 æéæ³¨å¥è½å

å³äºæéæ³¨å¥è½åï¼å½åæ¯æçæéåºæ¯ä¸»è¦åæ¬5ä¸ªï¼å¦ä¸å¾æç¤ºï¼ï¼ç®åæä»¬ä¸»è¦å»ºè®¾çæ¯å®æºç±»ï¼åæ¬ä¸»åºå®æºãä»åºå®æºï¼ãä¸»ä»å»¶è¿ä»¥åä»åºæ´»è·è¿æ¥å¤ï¼ç±äºå½åçº¿ä¸80%çæéé½æ¯ç±è¿å ä¸ªåºæ¯å¼èµ·çï¼è¿ä¹æ¯æä»¬ç®åæ²¡æå»ºè®¾è¿å¤æéåºæ¯çä¸»è¦åå ãåé¢æä»¬è¿ä¼è§åå»ºè®¾é«å¯ç¨çé¾è·¯æéï¼æ¯å¦æ°æ®åºåé«å¯ç¨åæ¶åºé®é¢æ¶ï¼é«å¯ç¨çè¡¨ç°æ¯æä¹æ ·çï¼æ¯å¦è½å¤é¡ºå©çè¿è¡åæ¢ã

![](https://p0.meituan.net/travelcube/8adb05568e30456278b220dcb67205a468157.png)

å¨æéç¼ææ¹é¢ï¼æä»¬éè¿å»ºç«ä¸ä¸ªä»»å¡åçå­ä»»å¡é´çä¸²è¡æéåå¹¶è¡æéçç¼ææºå¶ï¼æ¥å®ç°æ¼ç»ä»»å¡çç»ä¸ç¼æã

å¨å¹¶åè½åä¸ï¼å½åæéæ¼ç»å¹³å°ä¿å®çå¹¶åæéæ³¨å¥è½åæ¯å¨ä¸åéå®ç°5000+èç¹çæéæ³¨å¥ï¼ç®åè¿ä¸ªè½åå·²ç»å¯ä»¥æ»¡è¶³æä»¬å¯¹äºå¤§è§æ¨¡æéæ¼ç»çæ´ä½éæ±ã

### 2.4 æ¼ç»æµç¨

æ´ä¸ªæ¼ç»æµç¨ä¸»è¦åæä¸é¨åï¼æ¼ç»åãæ¼ç»ä¸­åæ¼ç»åï¼åæ¶æä»¬ä¹å½¢æäºé£é©è¯ä¼°ãé£é©å¤æ ¸ãä¸é®ç»æ­¢ãæéå¤ççè½åé­ç¯ã

![](https://p0.meituan.net/travelcube/9dc6552046830b22599ea53b2bd9f71f167387.png)

å¨æ¼ç»åï¼æä»¬ä¸»è¦åä¸ä¸ªæ¹é¢çå·¥ä½ï¼

* éå¯¹æ¼ç»éç¾¤åé£é©è¯ä¼°ï¼æ¯å¦æ¼ç»éç¾¤çé«å¯ç¨æ¯å¦å¼å¯ãæææ¯å¦ç¬¦åè¦æ±ï¼
* å©ç¨å¤çº§å®¡æ¹æºå¶ï¼è®©ä¸å¡åç¸å³çDBAç¥ææ´ä¸ªæ¼ç»çé£é©ï¼
* å¨æ¼ç»ååå»ºç¸å³äº¤æµç¾¤ï¼ææéæ¼ç»ç¸å³çä¿¡æ¯å¨ç¾¤éè¿è¡å¨ç¥ã

å¨æ¼ç»ä¸­ï¼æä¸¤æ¹é¢...