---
title: 【盗币科普】你可千万不能这样盗别人的虚拟货币钱包
url: https://www.secpulse.com/archives/198953.html
source: 安全脉搏
date: 2023-04-15
fetch_date: 2025-10-04T11:31:40.406877
---

# 【盗币科普】你可千万不能这样盗别人的虚拟货币钱包

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 【盗币科普】你可千万不能这样盗别人的虚拟货币钱包

[区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)

[公众号:安全女巫](https://www.secpulse.com/newpage/author?author_id=49672)

2023-04-14

28,999

**如果你喜欢我的文章，欢迎关注公众号：安全女巫
转载请注明出处：****<https://mp.weixin.qq.com/s/n349zWMXVYCjsmrLo2KoNQ>**

免责申明：

本文仅用于技术讨论和学习，旨在提供相关信息和知识。任何使用者根据本文提供的信息所造成的直接或间接后果及损失，均由使用者本人负责，文章作者不承担任何责任。

文章表达方式可能会让有些人不适。

大家一定要点关注，关注巫巫哦。

在安全行业干了10年才知道，Tony老师总说发质不好，拔罐的总说湿气重，医生总说我有病，网络安全老师总说你不安全。

**前言**

有小伙伴人问巫巫，玩币圈挣钱吗。

我想啊，抛开币圈大佬的请巴菲特吃饭的钱，团队运营，私人游艇，保镖，酒吧里黑桃A。

感觉应该也没有挣多少钱，币圈大佬还是挺有责任感，虽然没有挣多少钱吧，但是还在全力拉动GDP，着实感人，巫巫的良心都疼了。

小伙伴同时还分享了自己被盗的经过，强调币能不能找回来不重要，重要想知道怎么被盗的。

我问：小伙伴被盗了多少？

他说：30W

我：年轻人，钱没了，可以再赚。朋友没了，可以再交。爱情没了，可以再找。记住，你不缺30W。你缺的是一份重新开始的勇气。

他说:   30W USDT。

我：对不起，是我肤浅了。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435944.png)

昧良心的钱，可以不挣，但是小伙伴的述求，咱不能不帮啊。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435946.png)

小伙伴需要什么，巫巫就生产什么内容，喜欢巫巫作品的朋友可以加入巫巫社群，链接在文尾。

**简介**

本文详细介绍了黑客如何利用授权函数和盲签名等方式盗取数字钱包中的加密货币，并提供了一些防范措施。

在数字货币交易中，授权函数是一种常见的网络钓鱼攻击方式。

攻击者会创建一个看起来像正常转账的交易，但实际上这个交易会调用授权函数来转移用户的代币。

攻击者会将交易的数据设置为授权的数量，从而能够成功转移用户的代币。用户在看到这个交易时可能会认为这是一个普通的转账。

**实际内容**

巫巫的关注者中，有部分小白，为了让新手能完整明白整个过程，巫巫先将过程在WEB端模拟出来，

通过模拟，读者将知道整个过程，再通过代码自动化，内容是为大家科普原理，学习用途,小伙伴可千万不要这样盗别人的虚拟货币。

然后，大家明白整个过程，巫巫再讲整个过程中逻辑，与代码实现。

为了让大家更加直观的看懂合约的整个交易，我会手动将整个过程还原：

**执行合约前需要准备：**

```
合约地址 Contract Address
合约执行接收地址 to Address
```

现在开始：

这里使用**MEW**为大家模拟整个过程：

输入合约相关信息

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435947.png)

这里会自动匹配合约ABI信息，不知道的可以在合约上面查找.

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435948.png)

执行合约方法:

在这个界面选择你要执行的合约方法，并且输入相应参数。比如我只是想简单的将Token从一个账户转到另外一个账户，所以在这里选择approve。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435949.png)

选择好钱包后，点击最后的 “Write”按钮。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435950.png)

点击“Write”后会看到以下弹框，

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435951.png)

查看详情：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435952.png)

这里的data就是一个approve的头。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-16814359521.png)

到这里就已经是完成了真个手动还原了整个过程，使用的是approve的函数。

---------

基本写到这里，已经没有很多的技术点需要还原了。先将交易包数据进行说明。

有人会上当估计也是因为：大家可能习惯了授权(approve)钓鱼这种常规风险，但对于超出 approve 这类方式的提醒就不一定理解了，其实除了 increaseAllowance 还有permit 等等，更别提低级签名、盲签、多协议组合操作等签名方式了。

**increaseAllowance 授权**

这里给出increaseAllowance 方式的授权钓鱼手法：

请求包的示例内容：

```
请求URL: https://api.etherscan.io/api?module=proxy&action=eth_sendTransaction&apikey=YourApiKeyToken
请求方法: POST
请求头: Content-Type: application/json
请求体:
{
"from": "0x1234567890abcdef1234567890abcdef12345678",
"to": "0xa9ce62c5eddad3755a86e027772b5d90661efd0b",
"value": "1000000000000000000",
"gas": "200000",
"gasPrice": "10000000000",
"data": "0xa9059cbb000000000000000000000000a9ce62c5eddad3755a86e027772b5d90661efd0b000000000000000000000000000000000000000000000000000de0b6b3a7640000"
}
```

解释：

* "from"：转账发起人的以太坊地址。
* "to"：ERC20代币的合约地址。
* "value"：转账金额，以Wei为单位。如果是ERC20代币，该值应该为0。
* "gas"：交易需要的Gas数量。
* "gasPrice"：每单位Gas的价格，以Wei为单位。
* "data"：调用ERC20代币的transfer函数所需要的参数，以16进制表示。其中前4个字节为函数选择器（transfer函数的keccak256哈希值），后面32个字节为接收代币的以太坊地址（去掉前面的"0x"），再后面32个字节为转账金额的以16进制表示（去掉前面的"0x"）。

0x39509351000000000000000000000000a9ce62c5eddad3755a86e027772b5d90661efd0b000000000000000000000000000000000000000c6e5dc250657eda966a606b82

https://www.cyberscope.io/signaturescan?q=0x39509351

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435953.png)

这里可以追加成：fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff 无穷大。或无穷小

该交易数据意味着你向某个账户授权了 100000000000000000000（即 100 ETH）的代币数量，这也是在后续发生转账操作时，该账户可以转出的最大代币数量。

它是函数 increaseAllowance(address,uint256) 的第二个参数，即新的授权金额。它表示你想要将授权的金额设置为多少。

因为该参数在交易数据中的位置是在授权地址之后，所以该参数值是不受攻击者控制的。如果该参数被替换为其他值，就会导致授权金额不正确，从而可能对用户造成财务损失。

```
    /**
    * 增加代币授权
    */
    function increaseAllowance(address spender, uint256 addedValue) public virtual returns (bool) {
        address owner = _msgSender();
        _approve(owner, spender, allowance(owner, spender) + addedValue);
        return true;
   }
```

```
当前确定授权后， 攻击者就可以将你的USDT全部转走，只要你有U 他就能转走。

如果地址没有及时取消授权的话，将会带来跟多的损失，下面教大家如何检查钱包地址授权了哪些合约和地址，定期取消授权过期的合约
```

查看记录，余弦师傅谢过了：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435954.png)

还是那句话：如果你不确定你钱包弹框的含义，就别点确认按钮...

```
permit授权
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-16814359541.png)

```
permit(address,address,uint256,uint256,uint8,bytes32,bytes3
```

```
看到这里，如果看过巫巫之前的文章，巫巫使用的手法就是这种。
```

```
防范虚拟货币钱包盗窃：揭秘非Approve的新型盗U诈骗手段（终极版）
```

```
真个过程的复现大概是这个样子（巫巫改过公众号名字，这是之前巫巫写的）：
```

```
![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435955.gif)
```

```
案例的分析这里有篇详细的过程：
```

```
https://twitter.com/korpi87/status/1560416631678910464
permit 函数是有风险的
详细的解释可以参见这个 Twitter 帖子：
```

```
https://twitter.com/korpi87/status/1560416631678910464。
```

**还有哪些函数是有风险的：**

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-1681435969.png)

详细解释：

https://twitter.com/korpi87/status/1560416631678910464

**transfer 授权**

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198953-16...