---
title: 中科固源：蓝牙协议栈架构与核心协议深度剖析
url: https://www.anquanke.com/post/id/307118
source: 安全客-有思想的安全新媒体
date: 2025-05-08
fetch_date: 2025-10-06T22:24:40.432084
---

# 中科固源：蓝牙协议栈架构与核心协议深度剖析

首页

阅读

* [安全资讯](https://www.anquanke.com/news)
* [安全知识](https://www.anquanke.com/knowledge)
* [安全工具](https://www.anquanke.com/tool)

活动

社区

学院

安全导航

内容精选

* [专栏](/column/index.html)
* [精选专题](https://www.anquanke.com/subject-list)
* [安全KER季刊](https://www.anquanke.com/discovery)
* [360网络安全周报](https://www.anquanke.com/week-list)

# 中科固源：蓝牙协议栈架构与核心协议深度剖析

阅读量**87236**

发布时间 : 2025-05-07 15:45:18

**x**

##### 译文声明

本文是翻译文章

译文仅供参考，具体内容表达以及含义原文为准。

## 一、蓝牙技术概述

蓝牙(Bluetooth)是一种短距离无线通信技术标准，最初由爱立信公司于1994年提出，旨在取代有线连接，实现设备间的无线数据交换。蓝牙技术以10世纪丹麦国王Harald Blåtand的名字命名，象征着统一不同设备的愿景。

### **1.1 蓝牙技术的发展历程**

蓝牙技术自诞生以来经历了多个版本的演进：

蓝牙1.0和1.0B (1999年)：初始版本，存在互操作性问题

蓝牙1.1 (2001年)：第一个广泛采用的版本

蓝牙1.2 (2003年)：改进抗干扰能力，提高传输速度

蓝牙2.0+EDR (2004年)：引入增强数据速率(EDR)

蓝牙2.1+EDR (2007年)：简化配对流程，提高安全性

蓝牙3.0+HS (2009年)：引入高速模式(HS)

蓝牙4.0 (2010年)：引入低功耗蓝牙(BLE)

蓝牙4.1 (2013年)：改进与LTE的共存性

蓝牙4.2 (2014年)：提高数据传输速率和安全性

蓝牙5.0 (2016年)：显著提升范围、速度和广播容量

蓝牙5.1 (2019年)：增加寻向功能

蓝牙5.2 (2020年)：引入LE Audio

蓝牙5.3 (2021年)：进一步优化低功耗性能

### **1.2 蓝牙技术的特点**

蓝牙技术具有以下主要特点：

**短距离通信**：典型通信距离为10米(Class 2)，可扩展至100米(Class 1)

**低功耗**：特别是BLE技术，适合电池供电设备

**ISM频段工作**：2.4GHz全球免许可频段

**跳频扩频技术**：减少干扰，提高安全性

**点对点和点对多点通信**：支持多种网络拓扑

**低成本**：广泛普及，芯片价格低廉

## 二、蓝牙协议栈架构

蓝牙协议栈是蓝牙技术的核心，采用分层架构设计，各层具有明确的功能划分和接口定义。完整的蓝牙协议栈可分为控制器子系统(Controller)和主机子系统(Host)两大部分。

### **2.1 蓝牙协议栈分层结构**

蓝牙协议栈从下到上可分为以下主要层次：

#### **2.1.1 物理层(PHY)**

物理层负责无线信号的调制解调，工作在2.4GHz ISM频段(2400-2483.5MHz)。蓝牙采用高斯频移键控(GFSK)调制方式，将数字信号转换为射频信号。

蓝牙5.0引入了两种新的PHY：

LE Coded PHY：提供更长的通信距离

LE 2M PHY：提供更高的数据传输速率

#### **2.1.2 链路层(LL, Link Layer)**

链路层负责：

设备发现(广告和扫描)

链路建立、维护和释放

数据包格式定义

跳频控制

低功耗管理

链路层定义了五种状态：

待机状态(Standby)

广告状态(Advertising)

扫描状态(Scanning)

发起状态(Initiating)

连接状态(Connection)

#### **2.1.3 主机控制器接口(HCI, Host Controller Interface)**

HCI是控制器和主机之间的标准接口，定义了：

命令接口(主机→控制器)

事件接口(控制器→主机)

数据接口(双向)

HCI可以通过UART、USB或SDIO等物理接口实现

![]()

#### **2.1.4 逻辑链路控制和适配协议(L2CAP, Logical Link Control and Adaptation Protocol)**

L2CAP是蓝牙协议栈的核心协议层，主要功能包括：

协议/信道复用：支持多个高层协议共享底层链路

分段和重组：将大数据包分割为适合底层传输的小包

服务质量(QoS)管理

错误控制和流控制

L2CAP提供了面向连接和无连接的数据服务

![]()

#### **2.1.5 属性协议(ATT, Attribute Protocol)**

ATT是BLE的基础协议，定义了客户端-服务器模型：

服务器：存储数据(属性)

客户端：访问服务器数据

属性由以下要素组成：

属性句柄(16位唯一标识符)

属性类型(UUID)

属性值

属性权限

#### **2.1.6 通用属性配置文件(GATT, Generic Attribute Profile)**

GATT建立在ATT之上，定义了：

服务(Service)：完成特定功能的数据集合

特征(Characteristic)：服务中的数据点

描述符(Descriptor)：特征的元数据

GATT定义了客户端和服务器之间的交互方式，是大多数BLE应用的基础

#### **2.1.7 通用访问配置文件(GAP, Generic Access Profile)**

GAP定义了蓝牙设备的发现、连接和安全等基础功能：

设备角色(广播者、观察者、外围设备、中央设备)

发现流程

连接建立

安全模式

#### **2.1.8 安全管理协议(SMP, Security Manager Protocol)**

SMP负责BLE设备间的配对和密钥分发，提供：

配对和认证

加密密钥生成

身份解析密钥(IRK)分发

隐私保护

### **2.2 蓝牙协议栈变体**

根据蓝牙版本和应用场景，协议栈有不同的实现变体：

#### **2.2.1 经典蓝牙协议栈**

经典蓝牙(Bluetooth Classic)主要用于音频传输和高速数据通信，包含以下额外协议层：

RFCOMM：串口仿真协议

![]()

OBEX：对象交换协议，蓝牙电话本，蓝牙短信，文件传输等协议都是走的OBEX

![]()

SDP：服务发现协议

协议数据单元格式：

Header:              | PDU ID | Transaction ID | ParameterLength |

                               1 byte         2 bytes              2 bytes

Parameters:       | Parameter 1  |  Parameter 2 | — |  Parameter N  |

**PDU ID：**

![]()

AVDTP：音频/视频分发传输协议（以下协议架构图省略）

A2DP：高级音频分发配置文件

AVRCP（AUDIO/VIDEO REMOTE CONTROL PROFILE）：蓝牙音乐控制协议

HFP：免提配置文件

HSP：蓝牙耳机协议，最开始的蓝牙耳机协议，目前已经没有产品在用这个了吧，至少我没有看到了。算是一个简化版的HFP。

SPP（SERIAL PORT PROFILE）：蓝牙串口协议

IAP：苹果的特有协议，分为IAP1/IAP2

PBAP（Phone Book Access）：蓝牙电话本访问协议

MAP（MESSAGE ACCESS PROFILE）：蓝牙短信访问协议

OPP（OBJECT PUSH PROFILE）：对象推送协议

AVCTP（AUDIO/VIDEO CONTROL TRANSPORT PROTOCOL）：音视频控制传输协议，是AVRCP的地方

AVDTP（AUDIO/VIDEO DISTRIBUTION TRANSPORT PROTOCOL）：音视频分布传输协议，是A2DP的底层

HID（HUMAN INTERFACE DEVICE）：人机接口协议

ATT：蓝牙属性协议

GATT：蓝牙通用属性协议

SM: 蓝牙安全管理协议

#### **2.2.2 低功耗蓝牙协议栈(BLE)**

BLE协议栈针对低功耗优化，简化了部分协议层，强调GATT/ATT模型，适合物联网和穿戴设备。

#### **2.2.3 双模蓝牙协议栈**

同时支持经典蓝牙和BLE的协议栈实现，可在同一芯片上运行两种技术。

## 三、蓝牙核心协议详解

### **3.1 物理层技术细节**

蓝牙物理层采用跳频扩频(FHSS)技术：

将2.4GHz频段划分为79个1MHz信道(经典蓝牙)或40个2MHz信道(BLE)

每秒1600次跳频(经典蓝牙)

自适应跳频(AFH)：避开干扰频段

蓝牙5.0的LE Coded PHY使用前向纠错(FEC)编码提高接收灵敏度，实现4倍于传统BLE的范围

### **3.2 链路层操作流程**

#### **3.2.1 设备发现流程**

**广播设备**：发送广告包(Advertising Packet)在三个主要广告信道(37,38,39)上

**扫描设备**：在广告信道上监听广告包

**连接建立**：中央设备发送连接请求给外围设备

#### **3.2.2 数据信道选择**

连接建立后，设备切换到数据信道：

经典蓝牙：使用79个数据信道

BLE：使用37个数据信道(0-36)

### **3.3 L2CAP信道类型**

**面向连接信道**：提供可靠的数据传输，支持分段/重组

**无连接信道**：用于广播数据，不保证可靠性

**信令信道**：用于L2CAP控制命令交换

### **3.4 GATT数据结构**

GATT定义了层次化的数据结构：

**服务(Service)**：

由一个或多个特征组成

由UUID标识(16位标准UUID或128位自定义UUID)

示例：电池服务(0x180F)、心率服务(0x180D)

**特征(Characteristic)**：

包含一个值和多个描述符

属性包括：读、写、通知、指示等权限

示例：心率测量(0x2A37)、电池电平(0x2A19)

**描述符(Descriptor)**：

描述特征的元数据

示例：客户端特征配置描述符(CCCD，用于启用通知/指示)

### **3.5 蓝牙安全机制**

蓝牙安全包括三个主要方面：

**配对(Pairing)**：

临时密钥生成

认证方式：Just Works、Passkey Entry、Out of Band(OOB)

蓝牙4.2引入LE Secure Connections，使用椭圆曲线Diffie-Hellman(ECDH)密钥交换

**绑定(Bonding)**：

长期密钥(LTK)存储

后续连接使用存储的密钥快速重建安全连接

**加密(Encryption)**：

使用AES-CCM算法加密数据

128位密钥长度

## 四、蓝牙协议栈实现

### **4.1 常见蓝牙协议栈实现**

**BlueZ**：Linux官方蓝牙协议栈

**Bluedroid**：Android使用的蓝牙协议栈

**iOS蓝牙协议栈**：苹果专有实现

**Windows蓝牙协议栈**：Microsoft实现

**商用协议栈**：CSR、德州仪器、Nordic等芯片厂商提供的协议栈

### **4.2 协议栈开发考虑因素**

开发蓝牙应用时需要考虑：

**资源限制**：BLE设备通常有有限的内存和处理能力

**功耗优化**：合理设置连接间隔、从设备延迟等参数

**协议版本兼容性**：确保设备间的互操作性

**安全配置**：根据应用需求选择适当的安全级别

## 五、蓝牙应用场景

蓝牙协议栈支持广泛的应用场景：

### **5.1 音频传输**

无线耳机、音箱

车载免提系统

LE Audio新增支持多流音频和广播音频

### **5.2 数据传输**

文件传输

设备同步

远程控制

### **5.3 物联网应用**

智能家居设备

穿戴设备(手环、手表)

健康医疗设备(心率监测器)

### **5.4 位置服务**

蓝牙信标(Beacon)

室内定位

物品追踪

## 六、蓝牙技术未来发展趋势

**LE Audio**：基于LC3编解码器的新一代蓝牙音频

**Mesh网络**：大规模设备组网能力

**更高吞吐量**：持续提升数据传输速率

**更低功耗**：进一步优化能效

**与5G/Wi-Fi 6的融合**：多技术协同工作

蓝牙协议栈作为蓝牙技术的核心，随着版本的演进不断丰富和完善，为各种无线应用场景提供了灵活可靠的通信基础。理解蓝牙协议栈的架构和工作原理，对于开发蓝牙应用和解决连接问题具有重要意义

中科固源专注于通讯协议安全与模糊测试，提供Wisdom系列工具和Swift系列工具，帮助企业构建全面的网络安全防护体系。了解更多产品与解决方案。加入我们，开启你的高效代码创新之旅！

①扫描二维码或添加微信，获取1v1线上云指导。

②解锁免费高效的开源级开发工具，还有更多专属权益等你来拿。

③关注我们，在评论区留言“我要学习资料”，即可免费获得独家学习资料包，包括详细使用教程、应用案例分析及相关技术文档。

![]()

本文翻译自 原文链接。如若转载请注明出处。

商务合作，文章发布请联系 anquanke@360.cn

本文由**中科数测**原创发布

转载，请参考[转载声明](https://www.anquanke.com/note/repost)，注明出处： [https://www.anquanke.com/post/id/307118](/post/id/307118)

安全KER - 有思想的安全新媒体

本文转载自:

如若转载,请注明出处：

安全KER - 有思想的安全新媒体

分享到：![微信](https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png)

**+1**2赞

收藏

![](https://p4.ssl.qhimg.com/t11fd941d712ac4e71048598691.png)中科数测

分享到：![微信](https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png)

## 发表评论

您还未登录，请先登录。

[登录](/login/index.html)

![](https://p1.ssl.qhimg.com/t11fd941d7193e6e009506afa34.png)

[![](https://p4.ssl.qhimg.com/t11fd941d712ac4e71048598691.png)](/member.html?memberId=175961)

[中科数测](/member.html?memberId=175961)

致力于成为全球领先的软件应用安全解决方案提供商

* 文章
* **24**

* 粉丝
* **1**

### TA的文章

* ##### [从技术到安全：中科固源拆解车载以太网的演进路径与防护策略](/post/id/310094)

  2025-08-21 21:48:41
* ##### [从原理到实战：中科固源带你吃透 ASAN 工作机制，影子内存 + 投毒技术捕捉漏洞全流程](/post/id/309321)

  2025-07-03 17:21:58
* ##### [技术向｜Cybellum 实战：从固件上传到漏洞报告生成，我是如何定位路由器安全隐患的？](/post/id/308334)

  2025-06-13 15:21:03
* ##### [中科固源Wisdom发现NASA嵌入式飞行控制系统—F prime通信协议漏洞！](/post/id/308332)

  2025-06-12 15:27:10
* ##### [中科固源获NVIDIA产品安全团队致谢！](/post/id/308330)

  2025-06-12 13:33:12

### 相关文章

* ##### [为AI Agent行为立“规矩”——字节跳动提出Jeddak AgentArmor智能体安全框架](/post/id/312426)

  2025-09-28 13:43:32
* ##### [教你打造一款AI安全助手 | 安全MCP的实践指南](/post/id/311884)

  2025-09-05 10:40:51
* ##### [当数字世界的“万能钥匙”被滥用，谁来守护核心资产？火山的 MCP 安全授权新范式](/post/id/311597)

  2025-08-28 09:50:41
* ##### [Python代码保护之重置操作码映射的攻与防探究（一）](/post/id/311484)

  2025-08-26 10:49:47
* ##### [广汽集团×火山引擎：出海合规助力企业新增长](/post/id/311498)

  2025-08-26 10:17:09
* ##### [从技术到安全：中科固源拆解车载以太网的演进路径与防护策略](/post/id/310094)

  2025-08-21 21:48:41
* ##### [智能体防御 | 一文了解3种系统提示词加固方法](/post/id/311279)

  2025-08-18 16:34:50

### 热门推荐

文章目录

* [一、蓝牙技术概述](#h2-0)
  + [1.1 蓝牙技术的发展历程](#h3-1)
  + [1.2 蓝牙技术的特点](#h3-2)
* [二、蓝牙协议栈架构](#h2-3)
  + [2.1 蓝牙协议栈分层结构](#h3-4)
  + [2.2 蓝牙协议栈变体](#h3-5)
* [三、蓝牙核心协议详解](#h2-6)
  + [3.1 物理层技术细节](#h3-7)
  + [3.2 链路层操作流程](#h3-8)
  + [3.3 L2CAP信道类型](#h3-9)
  + [3.4 GATT数据结构](#h3-10)
  + [3.5 蓝牙安全机制](#h3-11)
* [四、蓝牙协议栈实现](#h2-12)
  + [4.1 常...