---
title: 【技术干货】CVE-2022-25237 Bonitasoft Platform RCE漏洞分析
url: https://mp.weixin.qq.com/s?__biz=Mzg5NjEyMjA5OQ==&mid=2247496080&idx=1&sn=0c8c93506c6b7c979228b89ccc50ff3e&chksm=c0075c0cf770d51a8092d98e8bc2094aefa9a547b0928ad085e10457676fa57de12e22368d99&scene=58&subscene=0#rd
source: 星阑科技
date: 2022-10-19
fetch_date: 2025-10-03T20:16:43.626086
---

# 【技术干货】CVE-2022-25237 Bonitasoft Platform RCE漏洞分析

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/Cc8QqLUKOegj8FMzGMbomYeksBBFASib3sx6KncqO3kvuGW0FUF1lg2oibGxIBDgBxIMVx9zBZ9r5NrAoov47BRg/0?wx_fmt=jpeg)

# 【技术干货】CVE-2022-25237 Bonitasoft Platform RCE漏洞分析

星阑科技

以下文章来源于星阑实验室
，作者PortalLab

![](http://wx.qlogo.cn/mmhead/Q3auHgzwzM7I2gqBRVgAVpkPNqBsibrgE0DM5mTmZIRYzgFUNPjF59g/0)

**星阑实验室**
.

聚焦API安全最新资讯，分享API安全研究成果

![](https://mmbiz.qpic.cn/mmbiz_gif/Cc8QqLUKOeiaFHTFtiatmEIxZQcXOHfyr6GOBM88IeMm28ybjSAHEJKicuQxPxN5L5NFZ5mza2NOnuokf9ant2fUQ/640?wx_fmt=gif)

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1NSkNgX8voWSJmuSUlcQtsLKWSxBUmsxRCOqbNibhhXFuhtfXiak5ibYGMcEGD9yzzIy4qVq1Q5a63IQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1NSkNgX8voWSJmuSUlcQtsLgZE9TXJrsxHuabVS0UbocSyplzJJ0pxtQQZpAzIBdZwlByjZ3qUUAQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1 "好看的图.png")

**xxhzz**

**@PortalLab实验室**

**项目介绍**

Bonitasoft 是一个业务自动化平台，可以更轻松地在业务流程中构建、部署和管理自动化应用程序；Bonita 是一个用于业务流程自动化和优化的开源和可扩展平台。

**漏洞描述**

在Bonitasoft Authorization漏洞版本，由于 API 授权过滤器中配置问题，通过精心构造的的字符串附加到 API URL，能够绕过权限认证。拥有普通用户权限的攻击者在绕过权限认证后，将恶意代码部署到服务器上，进行远程代码执行。

**利用范围**

**For community（社区版）:**

2022.1-u0 (7.14.0) 以下

**For subscription（订阅版）:**

2022.1-u0 (7.14.0) 以下

2021.2-u4 (7.13.4) 以下

2021.1-0307 (7.12.11) 以下

7.11.7 以下

**漏洞分析**

## **环境搭建**

使用docker搭建环境，docker镜像（https://hub.docker.com/\_/bonita/tags）选择7.13.0版本。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpULC9HOT1YxzAuVaSEq3n9t1HzcK9gxGIISfuKF6pGQ2dh9WyWSmJyQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

下载镜像之后，直接输入命令docker run -d -p 8080:8080 -p 5050:5050，5050为远程动态调试端口。

在/opt/bonita目录下载源码。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqp1IlSNiaDyec5EibtU1VcxL9sHcpYQmnFQ2KIEE8ibic44ppdA4I3HR7EKg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

使用idea进行远程调试配置。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpc2KQJc5UZNwgGXrGibC3P4IyX9Oic2UuXymXUJfN1ib25wabDuiclBKB9w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

在/opt/bonita/BonitaCommunity-2021.2-u0/server/bin/catalina.sh中加入配置。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpltlFCoUIw1XxVibC8T91Zz4uRHUxHwlsgUYtGqn9nUf2Jy8g10chMmw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

随即访问http://ip:8080，环境搭建成功。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqptH2LqKeL0wO4Lm6vWNiaFBMFAFAr8I6ujqZ27IQicK3HCjKGmf7UQtmw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

默认账号密码：install/install

## **代码调试**

从漏洞披露参考文章看，该漏洞产生的原理是由于身份验证/权限绕过，导致没有特权的用户可以通过api端口上传恶意文件，从而命令执行。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpxlv9icmnYYic4iaklibZhGYnGcK9UCGEwFX8icbvgCkXl2ajOAibB52r3LGQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

定位到参考文章所提交到的filers

在bonita\BonitaCommunity-2021.2-u0\server\webapps\bonita\WEB-INF\web.xml配置文件中，自定义了filter，并且对参数excludePatterns进行了赋值。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpobxrMjTBoFFdE7TnxcqDkZsG1etwFrhVEYGRrspFAHibLLic0ZnHx5FA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

2个不同的过滤器类RestAPIAuthorizationFilter、TokenValidatorFilter中的参数excludePattern都被指定为“i18ntranslation”

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpZpMge1NUFOCamgZOStZyIcedcia1ZEticqicW2yrsLsOZEPjWDfM1yxtg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1Nbj7Z60r062U9aQGhy1KCqJzwxArTmP56Ijtxz1cb87wSiaMcN9iavJoHLUD7cSGTUYMemtO4g3scQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

在web.xml的192行和215行定义了/API/\*路由下对应的filter为RestAPIAuthorizationFilter、TokenValidatorFilter

而RestAPIAuthorizationFilter和TokenValidatorFilter都属于AbstractAuthorizationFilter子类。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqp7uRr3qzeK6gfjCQCCPFN7oKNpzsNdlWkbGbnyzq6ANjDFGaLE8OORA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqp6XO6qYaTkBMucnF6cgvHctibsYvI4ibZ8EMOrZg5cjksGHWNY2iazSeRw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

定位到org.bonitasoft.console.common.server.login.filter.AbstractAuthorizationFilter#doFilter函数。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpWg9eVefcETJLlgu8w8ALRWdeibLRnUBnvsUMqF53nooiaRENZgeFblKw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

会使用“sessionIsNotNeeded”函数进行检查，如果它返回 true，它将继续应用程序流程。

而sessionIsNotNeeded 函数检查匹配 URL 中的是否包含excludePatterns

在web.xml已经对excludePatterns进行了赋值为“i18ntranslation”，所以当url中包含“i18ntranslation”时，isMatched 就会返回true

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpBkshjaRMQiaexA6On5PglqeZcgQbL7zHX8rlficMibvBj6VbPW63tKgIg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

流程就会继续，就相当于绕过了权限过滤，允许访问资源。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqp8y2picTApVg8dvTkXF9CyM0KmWMia8CSLJkWKbD7cRnJbNVkhgPINUOg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

总结就是在URl包含“/i18ntranslation/../”或“;i18ntranslation”就可以绕过权限认证。

为实现远程命令执行，思路是上传恶意文件，上传接口在web.xml中也定义了，为/API/pageUpload

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqp7LsZmbgkPYFG5vWvSK9WqmpUFh4pCVjEibyBphwzbibgL5yQmVgXexmw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

找到org.bonitasoft.console.common.server.servlet.PageUploadServlet#getPagePermissions

在文件处理过程中，需要获取的session存在apisession

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpCnJNaREHwrNT4Cq6tsTOYS1PmAvaM834Tk5yDXWxOxsosrvy2M86kQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpuX8SDlUNdW3ugHQtHACKehb3PSV5g0NPpKmzYC0vCMcgg0eYjQFzOQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

而且未登录的情况下，apisession也没法赋值，就会导致getPagePermissions抛出异常。

所以，为实现远程命令执行，还需要拥有一个普通的用户。

## **漏洞复现**

先创建一个test/test用户。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpGmSmrCI2HyVP5A4oWAAvMRzYIoYnWuZ46DfZ4e4f1xIRQ5ibpleBu2Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

根据以上分析原理，使用exp，成功执行命令。

![](https://mmbiz.qpic.cn/mmbiz_png/wfFYMXc5G1O8fFaRa1kxNxNoNrjLibzqpNzMHsVXLSUIPVDooHCD2GicT0tXQTnReZuRasqKmdCvExPj7ic0sE2Kg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

**修复建议**

更新至安全无漏洞版本。

**参考材料**

1.https://rhinosecuritylabs.com/application-security/cve-2022-25237-bonitasoft-authorization-bypass/

2.https://hub.docker.com/\_/bonita

**更多技术干货，欢迎关注“星阑实验室”公众号**

**关于Portal Lab**

星阑科技 Portal Lab 致力于前沿安全技术研究及能力工具化。主要研究方向为API 安全、应用安全、攻防对抗等领域。实验室成员研究成果曾发表于BlackHat、HITB、BlueHat、KCon、XCon等国内外知名安全会议，并多次发布开源安全工具。未来，Portal Lab将继续以开放创新的态度积极投入各类安全技术研究，持续为安全社区及企业级客户提供高质量技术输出。

**往期 · 推荐**

[![](https://mmbiz.qpic.cn/mmbiz_jpg/Cc8QqLUKOegoGL5ScibX9RqY6PqMAtnoZfER1hSGkj87C4oXR4PqW7CM8tiavmQur8O7WZQyZgVLn1wKwHsibcvEg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=Mzg5NjEyMjA5OQ==&mid=2247492888&idx=1&sn=219ad26c37836f5cdefc5f41dea620c0&chksm=c0074884f770c192f60f651f3e0c6a0f293b38a59d9499a89cd1b9c2e2d8cbc4dd4620783ed1&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/Cc8QqLUKOegoGL5ScibX9RqY6PqMAtnoZQtEDMUM2CZ3jqhq9cO3DtWcP2KgvjlDJia2Arlsw9IrGfWPEO7RYl3w/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=Mzg5NjEyMjA5OQ==&mid=2247492771&idx=1&sn=5bc86cbf62a83db69b1b1919ad86273b&chksm=c007493ff770c0290f199daef6b03bd09f9f85e35c5179c3ca8fe062623ecc27522b45850f0a&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/Cc8QqLUKOegoGL5ScibX9RqY6PqMAtnoZ1qIhLiasDXUrUT4RWJ7zFYmTMVWz1ww66AqdvxjF9ynLOR7139xQib7Q/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=Mzg5NjEyMjA5OQ==&mid=2247492691&idx=1&sn=7f4fdf863953280d024c2ae7144badff&chksm=c00749cff770c0d98d9848f5415e2c7b395add84d39e4ab51172549c024d36cfc80af23ad43e&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_jpg/Cc8QqLUKOegoGL5ScibX9RqY6PqMAtnoZRibR6e5iawhrSuV4TM3ib9AssGQNZ9SPQGCic3G3M9PgpLt5GafnkEiaPmw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=Mzg5NjEyMjA5OQ==&mid=2247492617&idx=1&sn=103b4a185c02f1435ddcc1778bd038e6&chksm=c0074995f770c08374efe7cda4e53a8991a867e2b1b73fe05f0f4a32335756a56c77483ee75f&scene=21#wechat_redirect...