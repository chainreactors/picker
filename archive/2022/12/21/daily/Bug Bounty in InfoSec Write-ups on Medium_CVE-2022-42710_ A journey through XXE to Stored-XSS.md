---
title: CVE-2022-42710: A journey through XXE to Stored-XSS
url: https://infosecwriteups.com/cve-2022-42710-a-journey-through-xxe-to-stored-xss-851d74dfe917?source=rss----7b722bfd1b8d--bug_bounty
source: Bug Bounty in InfoSec Write-ups on Medium
date: 2022-12-21
fetch_date: 2025-10-04T02:04:53.306918
---

# CVE-2022-42710: A journey through XXE to Stored-XSS

[Sitemap](/sitemap/sitemap.xml)

[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F851d74dfe917&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&%7Estage=mobileNavBar&source=post_page---top_nav_layout_nav-----------------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Finfosecwriteups.com%2Fcve-2022-42710-a-journey-through-xxe-to-stored-xss-851d74dfe917&source=post_page---top_nav_layout_nav-----------------------global_nav------------------)

[Medium Logo](https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav------------------)

[Search](https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Finfosecwriteups.com%2Fcve-2022-42710-a-journey-through-xxe-to-stored-xss-851d74dfe917&source=post_page---top_nav_layout_nav-----------------------global_nav------------------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)

[## InfoSec Write-ups](https://infosecwriteups.com/?source=post_page---publication_nav-7b722bfd1b8d-851d74dfe917---------------------------------------)

·

Follow publication

[![InfoSec Write-ups](https://miro.medium.com/v2/resize:fill:76:76/1*SWJxYWGZzgmBP1D0Qg_3zQ.png)](https://infosecwriteups.com/?source=post_page---post_publication_sidebar-7b722bfd1b8d-851d74dfe917---------------------------------------)

A collection of write-ups from the best hackers in the world on topics ranging from bug bounties and CTFs to vulnhub machines, hardware challenges and real life encounters. Subscribe to our weekly newsletter for the coolest infosec updates: <https://weekly.infosecwriteups.com/>

Follow publication

# CVE-2022-42710: A journey through XXE to Stored-XSS

## Hi everybody, I will share with you in this article in detail how I was able to find CVE-2022–42710 through static analysis

[![Omar Hashem](https://miro.medium.com/v2/resize:fill:64:64/1*ayu-cF0Elq8Emv1cdCLf_A.jpeg)](https://omar0x01.medium.com/?source=post_page---byline--851d74dfe917---------------------------------------)

[Omar Hashem](https://omar0x01.medium.com/?source=post_page---byline--851d74dfe917---------------------------------------)

5 min read

·

Dec 16, 2022

--

1

Listen

Share

Press enter or click to view image in full size

![]()

### Summary of Linear eMerge E3 Series:

The Linear eMerge E3 Series is one of the industry leading products in building management systems as it is one of the most widely used products in the industry which is used for control

* School Districts and Campuses (K12 & Higher Ed)
* Corporate Campuses
* State/Local Government buildings (Civic Centers, City Hall, Police Stations, Jails, etc.)
* Public Utilities
* Transportation (Airports, Subway, Bus Depots)
* Places of Worship (Churches, Mega-Church campuses)
* Medical Facilities (Hospitals, Pharma, Bio Labs, etc.)
* And more

### Let’s start the Static-Analysis:

while i was doing security source code review i came across this PHP script

http://127.0.0.1/badging/badge\_template\_print.php

Press enter or click to view image in full size

![]()

> TPL\_DIR in configuration file =tpl/

we get “tpl” parameter from the user and then pass it to simplexml\_load\_file so our input will be parsed by the XML parser, at first glance it seems that it’s not vulnerable to XXE as to be vulnerable to XXE it needs to load “LIBXML\_NOENT” class which substitute external entity which leading to XXE

example on vulnerable code to XXE

```
try
{
    $template = $_REQUEST["tpl"];
    $xml = simplexml_load_file(TPL_DIR.$template, 'SimpleXMLElement', LIBXML_NOENT);
```

but that is not our scenario so it’s not vulnerable until now to XXE

but i started to gather more information about the XML parser library

Press enter or click to view image in full size

![]()

okay the libxml version is not vulnerable to XXE by “substitute external entity” by default at the latest version but according to this version it seems a little bit old so we need to do some search about it on CVE details <https://www.cvedetails.com/>

maybe there is exploitation or someway to abuse of the function in a bad way

after doing some search found some exploits but they didn’t match the configuration of the application so they didn’t lead to any vulnerability

Anyway, the above step is important in our static code analysis as it sometimes leads to critical vulnerabilities

As there is a researcher who found a similar scenario while he was doing some code review for a java application he found that developers use XMLparser library that allows for external entity substitution by default which eventually leads to XXE vulnerability, you can find more details on the vulnerable XML parser library that were used by the vulnerable application in the previous scenario at <https://nvd.nist.gov/vuln/detail/CVE-2017-1000190>

So i found nothing for this specific version and the only allowed method is by adding the “LIBXML\_NOENT” class to the “simplexml\_load\_file” function to substitution external entity as I described so the product is not vulnerable to XXE

So let’s get back to our point

At the underline code we can figure out how the XML data will be parsed

Press enter or click to view image in full size

![]()

Press enter or click to view image in full size

![]()

The application will take a file as input and parse it by the XMLparser then save it at $xml variable

as you see in the above code the input file should contain an orientations tag and inside it should be two tags orientation and background tags then at line 56 you will find that whatever is inside the background tag will be printed

so to achieve our XSS we should define <xml> tag first to make the parser know that we parse XML file then define <orientations> tag as we saw in the PHP code then inside it defines two tags the first one <orientation> tag and the second one <background> tag which will be printed through echo function and contain our XSS payload

The final payload will be like that

Press enter or click to view image in full size

![]()

exploit

CDATA is used to command the parser that the particular section of the document contains no markup and should be treated as regular text and not parsed as XML

the reason for that is to make the parser consider our <script>tag as text inside the background tag which later will be printed in the application

But wait a minute

How can we upload our XML file that contains the exploit to achieve the XSS?

After some research in the application i came across this PHP script

http://127.0.0.1/badging/person\_funct.php

Press enter or click to view image in full size

![]()

It’s a file upload function that validates size to prevent DOS attack and name the file with the time of uploading the file to prevent XSS in the filename and force “.jpg” file extension to prevent uploading malicious extension

> there are some best practices at this PHP script but let’s focus on more important things

Now we need to upload our exploit.xml file but the application force a jpg extension so how we will do it

Actually, it doesn’t matter what is the file extension because the XML parser used by simplexml\_load\_file() doesn’t care about the file extension all it cares about is the file syntax so we will upload our exploit using the “http://127.0.0.1/badging/person\_funct.php” script

Press enter or click to view image in full size

![]()

Upload our expolit request

Our exploit is uploaded at “http://127.0.0.1/user\_img/20220830152741.jpg”

Now we will request it using the tpl parameter at “http://127.0.0.1/badging/badge\_template\_print.php” script

but ...