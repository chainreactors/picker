---
title: SAP PO: Using attachments in REST Receiver adapter
url: https://blogs.sap.com/2023/08/14/sap-po-using-attachments-in-rest-receiver-adapter/
source: SAP Blogs
date: 2023-08-15
fetch_date: 2025-10-04T12:01:41.124120
---

# SAP PO: Using attachments in REST Receiver adapter

* [SAP Community](/)
* [Products and Technology](/t5/products-and-technology/ct-p/products)
* [Technology](/t5/technology/ct-p/technology)
* [Technology Blog Posts by Members](/t5/technology-blog-posts-by-members/bg-p/technology-blog-members)
* SAP PO: Using attachments in REST Receiver adapter

Technology Blog Posts by Members

All communityThis categoryBlogKnowledge baseUsersManaged tags

cancel

[Turn on suggestions](https://community.sap.com/t5/blogs/v2/blogarticlepage.enableautocomplete%3Aenableautocomplete?t:ac=blog-id/technology-blog-members/article-id/164728&t:cp=action/contributions/searchactions)

Auto-suggest helps you quickly narrow down your search results by suggesting possible matches as you type.

Showing results for

Search instead for

Did you mean:

We have just launched our new Developer forums! Check out more in
[this What's New post](https://community.sap.com/t5/what-s-new/new-developer-forums/ba-p/14230147) (This banner is now dismissible.)

Read only

## [SAP PO: Using attachments in REST Receiver adapter](/t5/technology-blog-posts-by-members/sap-po-using-attachments-in-rest-receiver-adapter/ba-p/13577030)

![platinumicef](https://avatars.profile.sap.com/5/5/id55072126e8a0e5e108c7f280116b0618c30c782a4e5bf5f84b17ab4e07be7e06_small.jpeg "platinumicef")

[platinumicef](https://community.sap.com/t5/user/viewprofilepage/user-id/353185)

Explorer

Options

* [Subscribe to RSS Feed](/khhcw49343/rss/message?board.id=technology-blog-members&message.id=164728)
* Mark as New
* Mark as Read
* Bookmark
* Subscribe
* [Printer Friendly Page](/t5/blogs/blogarticleprintpage/blog-id/technology-blog-members/article-id/164728)
* [Report Inappropriate Content](/t5/notifications/notifymoderatorpage/message-uid/13577030)

â€Ž2023 Aug 15
12:32 AM

[3
Kudos](/t5/kudos/messagepage/board-id/technology-blog-members/message-id/164728/tab/all-users "Click here to see who gave kudos to this post.")

8,204

* SAP Managed Tags
* [SAP Process Integration](https://community.sap.com/t5/c-khhcw49343/SAP%2520Process%2520Integration/pd-p/01200615320800000719)
* [SAP Process Orchestration](https://community.sap.com/t5/c-khhcw49343/SAP%2520Process%2520Orchestration/pd-p/477916618626075516391832082074785)

* [SAP Process Integration

  SAP NetWeaver](/t5/c-khhcw49343/SAP%2BProcess%2BIntegration/pd-p/01200615320800000719)
* [SAP Process Orchestration

  Software Product](/t5/c-khhcw49343/SAP%2BProcess%2BOrchestration/pd-p/477916618626075516391832082074785)

View products (2)

Recently I has been working on synchronous integration scenario which involves sending JSON with some files (usually PDFs) attached using REST adapter. Attachments are accepted by the receiver through HTTP POST request with *multipart/form-data* encoding. Attachment filenames must be preserved for receiver system since they are stored and displayed to end-user. Response contains JSON with operation status and error log (if any). Sender system is SAP S/4HANA with ABAP-proxy generated based on message type defined in SAP PO.

The challenge was to fulfill the task using only standard SAP PO REST adapter without use of any adapter modules and custom JAVA mapping to build the request body.

Here are my findings.

## SAP PO Configuration

I am using SAP PO 7.50 SP24 so if you have earlier releases your milage may vary.

REST Receiver communication channel for receiving system is created. In order to support sending and receiving JSON format you need to select appropriate "Data Format" = JSON for Request and Response configuration sections. Also "Support attachments" must be selected for channel in order to push any attachments to the receiver. Multipart content type "*multipart/form-data*" is also selected as per receiver system requirement.

Other communication channel properties are not relevant to this blog entry but are not related to attachments being sent.

![](/legacyfs/online/storage/blog_attachments/2023/08/1-25.png)

REST Receiver Communication Channel

Operation Mapping and Message Mapping work only on main message part, no attachments. No adjustments were made to Sender Communication Channel (SOAP-XI Channel) or ICo in order to support attachments.

## Code on ABAP side (SAP S/4HANA)

If you follow official guides and articles when dealing with attachments you will get an attachment with internally generated name (specified as Content-ID in XI). This autogenerated name is then passed to the receiver which is not acceptable for this integration scenario.

![](/legacyfs/online/storage/blog_attachments/2023/08/2-19.png)

Message attachments in Message Monitor

In order to fix the issue attachment needs to be added to ABAP-proxy instance in a specific way which exposes "Content-Disposition" attribute of the payload. Below is code required to create attachment object, set up attachment headers correctly and send attachment alongside main payload.

Filename may include non-Latin characters. If this is the case, filename must be encoded according to RFC 2047 and RFC5987, where UTF-8 is used as target encoding.

```
DATA lv_filename TYPE string " filename to be sent

DATA lv_xstring TYPE xstring " binary content of the file to be sent

  " generated ABAP-proxy

  DATA(lo_proxy) = NEW zco_create_document_request_ou( ).

  DATA :

    " support for XI attachment protocol

    lo_attch_protocol TYPE REF TO if_wsprotocol_attachments,

    " request message type

    ls_request        TYPE zcreate_document_request,

    " response message type

    ls_response       TYPE zcreate_document_confirmation.

  " encodes filename for XI

  " see details below

  DATA: lv_encoded_filename TYPE string.

  PERFORM encode_rfc2047_rfc5987 USING lv_filename CHANGING lv_encoded_filename.

  " get MIME type based on filename (extension).

  " if extension is missing or unknown -- generic application/octet-stream will be returned.

  DATA(lv_content_type) = ||.

  CALL FUNCTION 'SKWF_MIMETYPE_OF_FILE_GET'

    EXPORTING

      filename = p_name              " File Name

    IMPORTING

      mimetype = lv_content_type. " MIME Type

  " create attachment object

  DATA(lo_payload) = NEW cl_xms_payload( ).

  lo_payload->if_xms_payload~setpayloadtype( 'A' ). " ApplicationAttachment

  lo_payload->if_xms_payload~setbinarycontent(

                                  data = lv_xstring       " binary content

                                  type = lv_content_type  " MIME content type

                                  ). "

  lo_payload->if_xms_payload~set_disposition( |form-data; name="filename"; { lv_encoded_filename }| ).

  lo_payload->if_xms_payload~setdocumentname( p_name ). " visible in SXI_MONITOR

  " add attachment object to ABAP-proxy instance

  DATA(lo_attachment) = NEW cl_ai_attachment( p_from_type = 'B' ).

  lo_attachment->set_payload( lo_payload ).

  lo_attch_protocol ?= lo_proxy->get_protocol( if_wsprotocol=>attachments ).

  lo_attch_protocol->set_attachments( VALUE #( ( lo_attachment ) ) ).

  " here <ls_request> must be filled as per functional specification

" skipped as non-essential

  " call ABAP-proxy

  lo_proxy->create_document_request_out_sy(

    EXPORTING

      output = ls_request

    IMPORTING

      input  = ls_response ).

**********************************************************************

FORM encode_rfc2047_rfc5987 USING i_filename

                  CHANGING i_encoded_filename TYPE string.

  " encodes filename according to RFC 2047 and RFC 5987

  " uses UTF-8 encoding and BASE64 encoding

  " returns correct header for Content-Disposition MIME field

  " FORM must be used if filename may include symbols outside ISO-8859-1 (Latin 1) codepage

  DATA(lv_filename_to_encode) = CONV string( i_filename ).

  DATA(lv_base64_filename) = cl_http_utility=>if_http_utility~encode_x_base64(

                                          cl_http_utility=>if_http_utility~encode_utf8(

                                                lv_filename_to_encode

                                             ...