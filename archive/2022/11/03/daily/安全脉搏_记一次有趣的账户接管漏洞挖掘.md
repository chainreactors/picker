---
title: 记一次有趣的账户接管漏洞挖掘
url: https://www.secpulse.com/archives/190272.html
source: 安全脉搏
date: 2022-11-03
fetch_date: 2025-10-03T21:37:02.265185
---

# 记一次有趣的账户接管漏洞挖掘

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 记一次有趣的账户接管漏洞挖掘

[漏洞](https://www.secpulse.com/archives/category/vul)

[贝塔安全实验室](https://www.secpulse.com/newpage/author?author_id=9525)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng0.png)

2022-11-02

9,945

**以下文章来源于骨哥说事 ，作者骨哥说事**

**这****是一枚弱加密配合IDOR利用，从而导致完全接管他人帐户的漏洞。**

为了方便称呼，以后咱们就统一叫白帽子小哥为“小白”好了。

最近小白同学经常读到一些帐户接管漏洞的文章，他们通常是利用“X-Forwarded-Host”头来窃取用户Token从而进行账户接管，于是乎小白也想着动手尝试尝试，他在某个漏洞赏金平台中接受了一项赏金任务，并尝试寻找帐户接管漏洞。当然，他成功了！

漏洞存在于“密码重置”功能，通过该功能可以完全接管任意帐户，且无需用户进行任何交互。

**第1步：**

用户通过"example.com/php/login\_or\_password\_forget"，在输入用户个人ID和姓名后，开始请求重置密码；

**第2步：**

他们的用户ID和姓名得到验证后，将生成一个“state”参数，像下面这样：

```
STATE=eJxdkN1OwzAMhd8lDzA1XffT9GpMDE2gdmKTuIxM4paILilJJhBo747DfjRxlfhzYp9zGpHPBduaryiXzqN8wdeVhz1%2BOv8utxEiMsHFTxATwcJfWYEoEpgKppxtTZfIOJGSSG%2FQRmkGVgXBC8H4ZDYq8hHnfMSnZaL0r3cKekwFTUUrH%2B7SnXT0YLsDdP9aRxo1E6y96hrAR4ueVY3Iy1v1i81abk7Ny8loIWkjKQcLe1bVNDrPBHuDIHuEYGwnyUf0oCKrXkWWhFPfo3KdNd%2Bob6k0FiOt34cLJTvy4wD9FZANCVp7DCFtO4vfPS%2Fq7WK5Wze13DWP93WyOM4FgxJn7VgrBS2fTzVqzDLFVY4cs2Le6vSuTMmESL5P0RT8bHrjXWt68j0M8sl1xjZ%2BAyFQSHrlfOdidJbyO%2F4CvKKcYg%3D%3D55840ad4a2f32819aa5da2cf48288290
```

**第3步：**

在这一步中，厂商将向用户注册的电子邮箱发送密码重置链接，如下所示：

https://example.com/php/login\_or\_password\_forgotten?k=789c0dc8610a80200c06d0bbec049bc9d26f870921834192a4ffa2bbd7fbf90a029e810c9adeea98a5753287a844e16555b1016150bfafc3cfbaf94eff2450e494a2e640f67ebc89137aade927d25a020ab2535ab4b5c9dc4fd1

**第4步：**

用户通过点击重置链接后跳转至修改密码界面进行密码更改。

## **有趣的部分：**

这个“?k”参数看起来有不是有点眼熟？小白将其粘贴至CyberChef（经常打CTF比赛的一定对这款工具不陌生吧）中，小白惊讶的发现它确实是一个加密+压缩的字符串：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-190272-1667383729.png)

这段字符串首先使用zlib压缩，然后再进行16进制转换。

经过CyberChef解密后的字符串中，小白发现了两个重要变量“profile\_id”和“timeStamp”，于是小白立即建立了另一个账号，尝试伪造第二个账户令牌，以期望重置这个账户的密码，伪造的字符串如下：

```
789c0dc8510a85201005d0bdcc0ac6f25da6eb62427806034992fe457bb7df93b9f0e9dc28c36be923d726c919107ec0aa40ea0c4a69f775f85976ffcb2746891a610693f44ebe171387
```

但是很遗憾，点击重置链接后，提示该链接不可用。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-190272-1667383731.png)

##

## **转折**

如果仔细观察，我们会发现原始令牌和伪造的令牌长度是不一致的：

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-190272-16673837311.png)

原始令牌和伪造的令牌相差了32个字符，这是一个很大的问题，因为服务器肯定不会接受任意32个字符，但是两个令牌被解密后，却是相同的值，即：

```
“a:2:{s:9:”timestamp”;i:1614104013;s:10:”profile_id”;s:8:”40884692";}”.
```

这让小白同学非常沮丧??，于是他开始查看更多关于Zlib压缩的文章，在经历了2小时的各种阅读后，小白同学发现Zlib包含了一个ADLER32校验值，如果你在使用Adler-32\_checksum()函数后，将会得到“BC89137A”，并且这个校验值会存在于原始令牌中，在Zlib中，该校验值之后的所有内容都不是压缩流的一部分，因此将会被忽略，这就是为什么两个令牌即使在长度不同，也会产生相同结果的原因！

所以是时候挑战这个32位的字符串了，因为所有与令牌相关的工作一般都会客户端进行，所以小白同学尝试在JS文件中寻找线索。

在查看了几个小时的JS文件后，小白发现了一处“/php/user”的URL，于是他尝试爆破目录，最终小白找到了“https://example.com/php/user/example/”，该URL有一个名为“transctionToken”的字符串，实际上这正是要找的最后32位字符串的内容。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-190272-1667383732.png)

##

## **拼接**

是时候将字符串进行拼接了，由于每次刷新页面时“Transaction \_Token”都会发生变化，于是小白同学写了一个Python脚本来自动化整个过程，于是他成功的生成了“受害者“账户的令牌，并利用重置链接，更改了该用户的密码。

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-190272-16673837321.png)

## **心得**

* 如果有令牌，那么就存在被破解的可能
* 不要忘记JS文件，因为这些文件往往包含了有关Web的重要信息
* 试着在一些社区询问技术细节，有时会有你惊喜的结果
* 相信你的直觉，比别人多做一点！

PS：这位白帽同学的推特是：https://twitter.com/mayank\_pandey01

**本文作者：[贝塔安全实验室](newpage/author?author_id=9525)**

**本文为安全脉搏专栏作者发布，转载请注明：**[**https://www.secpulse.com/archives/190272.html**](https://www.secpulse.com/archives/190272.html)

Tags: [CyberChef](https://www.secpulse.com/archives/tag/cyberchef)、[IDOR](https://www.secpulse.com/archives/tag/idor)、[X-Forwarded-Host](https://www.secpulse.com/archives/tag/x-forwarded-host)、[弱加密](https://www.secpulse.com/archives/tag/%E5%BC%B1%E5%8A%A0%E5%AF%86)、[漏洞](https://www.secpulse.com/archives/tag/%E6%BC%8F%E6%B4%9E)

点赞：
0
[评论：0](#goComment)
收藏：
0

*新浪微博
QQ空间
微信扫一扫*

### 相关文章

* [![代码审计 | 同源策略的绕过](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2023/09/a799223d33bd92e8b0620d8ad38ecd2.jpg)

  代码审计 | 同源策略的绕过](https://www.secpulse.com/archives/203439.html "详细阅读 代码审计 | 同源策略的绕过")
* [![云原生安全联防联抗策略玩转微隔离](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2023/09/1694157547520-300x155.png)

  云原生安全联防联抗策略玩转微隔离](https://www.secpulse.com/archives/203414.html "详细阅读 云原生安全联防联抗策略玩转微隔离")
* [![从2023蓝帽杯0解题heapSpary入门堆喷](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2023/08/1693450185258-300x157.png)

  从2023蓝帽杯0解题heapSpary…](https://www.secpulse.com/archives/203218.html "详细阅读 从2023蓝帽杯0解题heapSpary入门堆喷")

评论  (0)

昵称

必填
您当前尚未登录。
[登录？](https://www.secpulse.com/user_login "登录")
[注册](https://www.secpulse.com/user-register)

邮箱

必填（保密）

快来写下你的想法吧！

upload

|  |  |  |
| --- | --- | --- |
| [![]( https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/2020/08/1db8ec186f5e122a1420ccb5499c476d-150x150.png)](https://www.secpulse.com/newpage/author?author_id=9525aaa) | [贝塔安全实验室 ![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng0.png)](https://www.secpulse.com/newpage/author?author_id=9525) | |
| 文章数：29 | 积分： 65 |
|  | |

* [![阿波罗主机安全管理](/wp-content/themes/secpulse2017/img/product-agent.png)](https://linkage.duoyinsu.com)
* [![伏特漏洞扫描云平台](/wp-content/themes/secpulse2017/img/product-fute.png)](https://v.duoyinsu.com)

### 安全问答社区

![安全问答社区](https://www.secpulse.com/wp-content/themes/secpulse2017/img/xcx.png)

### 脉搏官方公众号

![脉搏公众号](https://www.secpulse.com/wp-content/themes/secpulse2017/img/SecPulse.png)

### 活动日程

[显示更多](https://www.secpulse.com/newpage/activity)

#### 2022-06-17

[Gdevops 全球敏捷运维峰会](https://www.bagevent.com/event/8022600?bag_track=AQMB)

#### 2022-05-12

[Mastering the Challenge！——来自The 3rd AutoCS 2022智能汽车信息安全大会的邀请函](https://autocs20...