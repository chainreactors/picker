---
title: Stealthy WordPress Malware Drops Windows Trojan via PHP Backdoor
url: https://blog.sucuri.net/2025/06/stealthy-wordpress-malware-drops-windows-trojan-via-php-backdoor.html
source: Over Security - Cybersecurity news aggregator
date: 2025-06-28
fetch_date: 2025-10-06T22:56:11.275166
---

# Stealthy WordPress Malware Drops Windows Trojan via PHP Backdoor

[![Sucuri Blog](https://blog.sucuri.net/wp-content/uploads/2023/04/Sucuri_Blog_Header_Logo_342x60.png)](https://blog.sucuri.net/)

* Products
  + [Website Security Platform](https://sucuri.net/website-security-platform/)
  + [Website Firewall (WAF)](https://sucuri.net/website-firewall/)
  + [Multi-Site plans](https://sucuri.net/custom/agency/)
  + [Custom & Enterprise Plans](https://sucuri.net/custom/enterprise/)
  + [Partnerships](https://sucuri.net/partners/)
* Features
  + [Detection  Website Monitoring & Alerts](https://sucuri.net/malware-detection-scanning/)
  + [Protection  Future Website Hacks](https://sucuri.net/website-hack-protection/)
  + [Performance  Speed Up Your Website](https://sucuri.net/website-performance/)
  + [Response  Help For Hacked Websites](https://sucuri.net/website-malware-removal/)
  + [Backups  Disaster Recovery Plan](https://sucuri.net/website-backups/)
* Resources
  + [Guides](https://sucuri.net/guides/)
  + [Webinars](https://sucuri.net/webinars/)
  + [Infographics](https://sucuri.net/infographics/)
  + [Blog](/)
  + [SiteCheck](https://sitecheck.sucuri.net/)
  + [Reports](https://sucuri.net/reports/)
  + [Email Courses](https://sucuri.net/email-courses/)
* [Pricing](https://sucuri.net/website-security-platform/signup)
* [Immediate Help](https://sucuri.net/website-security-platform/help-now/)
* [Login](https://sucuri.net/website-security-platform/signup/)

[![Sucuri Blog](https://blog.sucuri.net/wp-content/uploads/2023/04/Sucuri_Blog_Header_Logo_342x60.png)](https://blog.sucuri.net/)

* Products
  + [Website Security Platform](https://sucuri.net/website-security-platform/)
  + [Website Firewall (WAF)](https://sucuri.net/website-firewall/)
  + [Multi-Site plans](https://sucuri.net/custom/agency/)
  + [Custom & Enterprise Plans](https://sucuri.net/custom/enterprise/)
  + [Partnerships](https://sucuri.net/partners/)
* Features
  + [Detection  Website Monitoring & Alerts](https://sucuri.net/malware-detection-scanning/)
  + [Protection  Future Website Hacks](https://sucuri.net/website-hack-protection/)
  + [Performance  Speed Up Your Website](https://sucuri.net/website-performance/)
  + [Response  Help For Hacked Websites](https://sucuri.net/website-malware-removal/)
  + [Backups  Disaster Recovery Plan](https://sucuri.net/website-backups/)
* Resources
  + [Guides](https://sucuri.net/guides/)
  + [Webinars](https://sucuri.net/webinars/)
  + [Infographics](https://sucuri.net/infographics/)
  + [Blog](/)
  + [SiteCheck](https://sitecheck.sucuri.net/)
  + [Reports](https://sucuri.net/reports/)
  + [Email Courses](https://sucuri.net/email-courses/)
* [Pricing](https://sucuri.net/website-security-platform/signup)
* [Immediate Help](https://sucuri.net/website-security-platform/help-now/)
* [Login](https://sucuri.net/website-security-platform/signup/)

* [Immediate Help](https://sucuri.net/website-security-platform/help-now/)

[Login](https://dashboard.sucuri.net/login/)

[Login](https://dashboard.sucuri.net/login)

New Customer?

[Sign up now.](https://sucuri.net/website-security-platform/signup/)

* [Submit a ticket](https://support.sucuri.net/support/?new)
* [Knowledge base](https://docs.sucuri.net/)
* [Chat now](https://sucuri.net/live-chat/)

Search for:

Search

* [Security Advisory](https://blog.sucuri.net/category/security-advisory)
* [Website Malware Infections](https://blog.sucuri.net/category/website-malware-infections)
* [WordPress Security](https://blog.sucuri.net/category/wordpress-security)

# Stealthy WordPress Malware Drops Windows Trojan via PHP Backdoor

[![](https://secure.gravatar.com/avatar/3bb7fb42c6bf04c758d570c2f6bb217266c127e77766dc9d8e6754f15cdd5867?s=60&d=mm&r=g)](https://blog.sucuri.net/author/puja-srivastava)

[Puja Srivastava](https://blog.sucuri.net/author/puja-srivastava)

* June 27, 2025

![Stealthy WordPress Malware Drops Windows Trojan via PHP Backdoor](https://blog.sucuri.net/wp-content/uploads/2025/06/Stealthy-WordPress-Malware-Drops-Windows-Trojan-via-PHP-Backdoor-820x385.png)

Last month, we encountered a particularly interesting and complex malware case that stood out from the usual infections we see in compromised WordPress websites. At first glance, the site looked clean, no visible signs of defacement, no malicious redirects, and nothing suspicious in the plugin list. But beneath the surface, a hidden infection chain was quietly working to deliver a trojan to unsuspecting visitors.

It was a layered attack involving PHP-based droppers, obfuscated code, IP-based evasion, auto-generated batch scripts, and a malicious ZIP archive containing a Windows-based trojan (`client32.exe`).

## The Initial Compromise: Where it Begins

While we don’t have the initial compromise vector in these files, it’s highly probable that this malware originates from a previously compromised website. Attackers often inject malicious code into legitimate PHP files or create new ones to gain a foothold. In this case, two PHP files, header.php and man.php, appear to be central to the operation.

## Summary of the Infection

The threat actor planted a number of malicious files across the WordPress environment. These files included:

* `header.php` – The main malicious controller
* `man.php` – A disguised file interaction handler
* `count.txt` – A log file used to store visiting IPs
* `update.bat` – A generated batch file that downloads and executes malware
* `psps.zip` – A fake ZIP archive containing client32.exe, a Windows Trojan

Together, these components form a stealthy infection chain designed to identify and track unique visitors, log non-repeating IPs, generate and serve a customized .bat file, download and extract a ZIP payload, execute a malicious EXE on the victim machine, and persist by adding a registry entry on Windows startup.

# Analysis of the Malware

## header.php: The Main Dropper

The **`header.php` file is the central intelligence** of this malware campaign. It is meticulously crafted to profile victims, enforce an IP-based blacklist, dynamically generate a heavily obfuscated Windows batch file, and then force its download onto the client’s system.

The script begins with a crucial check on the HTTP request method:

```
<?php

if ($_SERVER['REQUEST_METHOD'] != 'POST') {
    exit;
}
```

### IP Tracking to Avoid Repetition

Following this, the script implements an IP-based logging and anti-replay mechanism:

![IP tracking to avoid repetition](https://blog.sucuri.net/wp-content/uploads/2025/06/ip-tracking-to-avoid-repetition.png)

The malware logs each visitor’s IP in `count.txt` located inside the same directory and avoids serving the batch file twice to the same IP.

### Forced Download Headers

Finally, after the batch file $payload is fully constructed and written to a temporary file named `update.bat` on the server, header.php manipulates the HTTP headers to force a download in the victim’s browser:

![forced download headers](https://blog.sucuri.net/wp-content/uploads/2025/06/forced-download-headers.png)

### update.bat Payload Generation

The core functionality of `header.php` culminates in the construction of a Windows batch script string, stored in the `$payload` variable. This batch script, once executed on a victim’s machine, serves as the multi-stage dropper, orchestrating the download, extraction, execution, and persistence of the final malware. After de-obfuscation and variable substitution, the essence of the generated batch file is as follows:

![update.bat payload generation](https://blog.sucuri.net/wp-content/uploads/2025/06/update-bat-payload-generation.png)

The key actions performed by this batch script upon execution on a Windows system are:

* **Variable Initialization:** Sets several environment variables using the highly obfuscated random names generated by the PHP script. These include the remote URL for the zipped payload, the local path for the downloaded zip (`%APPDATA%\Program.zip`), the local directory for extraction (`%APPDATA%\Directory`), and the final path to th...