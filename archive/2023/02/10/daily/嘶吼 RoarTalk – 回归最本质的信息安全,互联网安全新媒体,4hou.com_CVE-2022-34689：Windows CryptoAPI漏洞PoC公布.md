---
title: CVE-2022-34689：Windows CryptoAPI漏洞PoC公布
url: https://www.4hou.com/posts/7JQy
source: 嘶吼 RoarTalk – 回归最本质的信息安全,互联网安全新媒体,4hou.com
date: 2023-02-10
fetch_date: 2025-10-04T06:12:11.934190
---

# CVE-2022-34689：Windows CryptoAPI漏洞PoC公布

CVE-2022-34689：Windows CryptoAPI漏洞PoC公布 - 嘶吼 RoarTalk – 网络安全行业综合服务平台,4hou.com

[![](https://www.4hou.com/sihou/images/new4hou/newlogoss.png)](https://www.4hou.com)

* [首页](https://www.4hou.com)
* [企业中心](https://www.4hou.com/corp/newindex)
* [产业研究院](https://www.4hou.com/real-time)

![](https://www.4hou.com/sihou/images/new4hou/search-icon.png)

[投稿](https://www.4hou.com/contribute)

[登录](https://www.4hou.com/login)
  |
[注册](https://www.4hou.com/register)

* 导读 ▾
* [活动](https://www.4hou.com/newticket)
* [专题](https://www.4hou.com/category/special)
* [图谱](https://www.4hou.com/atlas/index)
* [报告](https://www.4hou.com/new-report-info)
* [嘶票](https://www.4hou.com/tickets)
* [嘶货](https://www.4hou.com/shop)
* [企业查询](https://www.4hou.com/corp/new-search-company)
* [招聘](https://www.4hou.com/recruit)![](https://www.4hou.com/sihou/images/1561626446625934.png)

* [新闻](https://www.4hou.com/category/news)
* [行业](https://www.4hou.com/category/industry)
* [趋势](https://www.4hou.com/category/observation)
* [访谈](https://www.4hou.com/category/people)
* [漏洞](https://www.4hou.com/category/vulnerable)
* [WEB安全](https://www.4hou.com/category/web)
* [业务安全](https://www.4hou.com/category/business)
* [系统安全](https://www.4hou.com/category/system)
* [内网渗透](https://www.4hou.com/category/penetration)
* [勒索软件](https://www.4hou.com/category/typ)
* [安全工具](https://www.4hou.com/category/tools)

# CVE-2022-34689：Windows CryptoAPI漏洞PoC公布

ang010ela
[漏洞](https://www.4hou.com/category/vulnerable)
2023-02-09 12:00:00

![](https://img.4hou.com/article/%E6%B5%8F%E8%A7%88.png)242647

收藏

导语：该漏洞产生的根源在于证书缓存索引密钥（certificate cache index key），该密钥是基于MD5的，而其安全性假设是无碰撞的。但自2009年起，MD5已被证明是可碰撞的。

**漏洞概述**

CryptoAPI是Windows系统处理与加密相关事务的API。在证书处理方面，负责读取和分析证书来验证是否经过验证的CA。浏览器也会使用CryptoAPI用于TLS证书验证。

2022年，美国国家安全局（NSA）和国家网络安全中心（NCSC）发现了CryptoAPI的一个安全漏洞，漏洞编号CVE-2022-34689，CVSS评分7.5分。攻击者利用该漏洞可以进行身份欺骗，并执行认证、以伪造的目标证书进行代码签名等行为。微软已经2022年8月修复该漏洞。

该漏洞产生的根源在于证书缓存索引密钥（certificate cache index key），该密钥是基于MD5的，而其安全性假设是无碰撞的。但自2009年起，MD5已被证明是可碰撞的。

**漏洞利用：攻击流**

攻击流程分为2个阶段。第一个阶段要求有一个合法的证书，并修改，然后给受害者。第二个阶段包括创建一个MD5与修复后的合法证书的新证书，并使用新证书来欺骗原始证书主体的身份。

![image.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230126/1674705391522607.png "1674705391522607.png")

图 攻击流程

构建给定MD5值的证书叫做原像攻击(Preimage Attack)，目前在计算上是不可行的。但是可以生成2个具有给定前缀MD5指纹的证书，这叫做选定前缀碰撞。

![image.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230126/1674705392199320.png "1674705362197185.png")

图 选定前缀攻击

**漏洞影响**

研究人员检索了使用CryptoAPI的可能受到欺骗攻击的应用，发现Chrome v48及之前版本和基于Chromium的应用都可以被利用。研究人员认为受影响的应用还有很多。

**漏洞PoC**

研究人员给出了2个漏洞PoC，包括利用Chrome v48和crypt32.dll中有漏洞的MD5检查。

**Chrome v48漏洞利用**

漏洞利用代码中包含2个Python脚本和最终生成的微软身份。Chrome v48攻击流如下：

![image.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230126/1674705393183938.png "1674705286155517.png")

PoC视频参见：https://user-images.githubusercontent.com/114926055/214040642-beb765f7-4788-45e8-836c-a08dc441b5b4.mp4

**crypt32.dll本地漏洞利用**

本地漏洞利用会范围证书chainContext的trustStatus，即使第一个证书是合法的，但第二个证书是非法的，因此可以证明crypt32.dll有漏洞的MD5检查。

![image.png](https://img.4hou.com/uploads/ueditor/php/upload/image/20230126/1674705394936922.png "1674705264114020.png")

漏洞利用PoC代码参见：https://github.com/akamai/akamai-security-research/tree/main/PoCs/CVE-2022-34689

更多关于漏洞利用的技术细节参见：https://www.akamai.com/blog/security-research/exploiting-critical-spoofing-vulnerability-microsoft-cryptoap

本文翻译自：https://www.bleepingcomputer.com/news/security/exploit-released-for-critical-windows-cryptoapi-spoofing-bug/如若转载，请注明原文地址

* 分享至

![取消](https://www.4hou.com/sihou/images/close.jpg)
![嘶吼](https://www.4hou.com/sihou/images/logo.png)

感谢您的支持，我会继续努力的!

![扫码支持]( "扫一扫")

打开微信扫一扫后点击右上角即可分享哟

### 发表评论

评论

![](https://www.4hou.com/captcha/flat?B1kHWkVn)

#### 你可能感兴趣的

* [![]()

  Salesloft: GitHub账户遭入侵 导致Drift令牌被盗并引发大规模Salesforce数据窃取](https://www.4hou.com/posts/33NQ)
* [![]()

  TP-Link确认路由器存在未修复零日漏洞](https://www.4hou.com/posts/YZ8p)
* [![]()

  黑客借助HexStrike-AI工具可快速利用新型漏洞](https://www.4hou.com/posts/PGyn)
* [![]()

  黑客利用Sitecore零日漏洞部署WeepSteel侦察恶意软件](https://www.4hou.com/posts/RXAR)
* [![]()

  Docker Desktop严重漏洞可让攻击者劫持Windows主机](https://www.4hou.com/posts/omzK)
* [![]()

  WinRAR 零日漏洞被利用在解压档案时植入恶意软件](https://www.4hou.com/posts/vw4m)

![](https://img.4hou.com/wp-content/uploads/2017/11/1b9b2c77b008ed64b865.gif)

# [ang010ela](https://www.4hou.com/member/e7OO)

这个家伙很懒,什么也没说!

#### 最新文章

* [Salesloft: GitHub账户遭入侵 导致Drift令牌被盗并引发大规模Salesforce数据窃取](https://www.4hou.com/posts/33NQ)
  2025-09-15 12:00:00
* [TP-Link确认路由器存在未修复零日漏洞](https://www.4hou.com/posts/YZ8p)
  2025-09-10 12:00:00
* [黑客借助HexStrike-AI工具可快速利用新型漏洞](https://www.4hou.com/posts/PGyn)
  2025-09-10 12:00:00
* [黑客利用Sitecore零日漏洞部署WeepSteel侦察恶意软件](https://www.4hou.com/posts/RXAR)
  2025-09-08 12:00:00

[查看更多](https://www.4hou.com/member/e7OO)

# 相关热文

* [Salesloft: GitHub账户遭入侵 导致Drift令牌被盗并引发大规模Salesforce数据窃取](https://www.4hou.com/posts/33NQ)

  胡金鱼
* [TP-Link确认路由器存在未修复零日漏洞](https://www.4hou.com/posts/YZ8p)

  胡金鱼
* [黑客借助HexStrike-AI工具可快速利用新型漏洞](https://www.4hou.com/posts/PGyn)

  胡金鱼
* [黑客利用Sitecore零日漏洞部署WeepSteel侦察恶意软件](https://www.4hou.com/posts/RXAR)

  胡金鱼
* [Docker Desktop严重漏洞可让攻击者劫持Windows主机](https://www.4hou.com/posts/omzK)

  胡金鱼
* [WinRAR 零日漏洞被利用在解压档案时植入恶意软件](https://www.4hou.com/posts/vw4m)

  胡金鱼

![]()

[公司简介](https://www.4hou.com/about?title=公司简介)
|
[我要投稿](https://www.4hou.com/about?title=我要投稿)
|
[更新日志](https://www.4hou.com/about?title=更新日志)
|
[友情链接](https://www.4hou.com/about?title=友情链接)
|
[隐私政策](https://www.4hou.com/about?title=隐私政策)
|

[![](https://www.4hou.com/sihou/images/new4hou/weibo.png)](http://weibo.com/u/6069423878)
![](https://www.4hou.com/sihou/images/new4hou/wechat.png)

本站4hou.com，所使用的字体和图片文字等素材部分来源于原作者或互联网共享平台。如使用任何字体和图片文字有侵犯其版权所有方的，嘶吼将配合联系原作者核实，并做出删除处理。

[©2024 北京嘶吼文化传媒有限公司 京ICP备16063439号-1](https://beian.miit.gov.cn/)
本站由 ![](https://www.4hou.com/sihou/images/new4hou/txcloud.png) ![](https://www.4hou.com/sihou/images/new4hou/bdcloud.png) ![](https://www.4hou.com/sihou/images/new4hou/ucloud.png) 提供云计算服务

微信

[微博](http://weibo.com/u/6069423878)
[RSS](https://www.4hou.com/feed)
[知乎](https://zhuanlan.zhihu.com/roartalk)