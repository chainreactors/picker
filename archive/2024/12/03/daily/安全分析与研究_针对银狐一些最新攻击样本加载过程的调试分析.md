---
title: 针对银狐一些最新攻击样本加载过程的调试分析
url: https://mp.weixin.qq.com/s?__biz=MzA4ODEyODA3MQ==&mid=2247489593&idx=1&sn=4791b9831434d21de5e329c04ffde76c&chksm=902fb711a7583e07eb4bc44f530f15e90da55d7b6188348a4a4713a6622ebb1f6e337d0665ac&scene=58&subscene=0#rd
source: 安全分析与研究
date: 2024-12-03
fetch_date: 2025-10-06T19:39:27.795058
---

# 针对银狐一些最新攻击样本加载过程的调试分析

![cover_image](https://mmbiz.qpic.cn/mmbiz_jpg/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibknp8Tx0XBPPWIhzCibewGtFYwxPAJSPgJIm2CXTJnyM4cxgGEexIxhHQ/0?wx_fmt=jpeg)

# 针对银狐一些最新攻击样本加载过程的调试分析

原创

pandazhengzheng

安全分析与研究

**安全分析与研究**

专注于全球恶意软件的分析与研究

前言概述

原文首发出处：

https://xz.aliyun.com/t/14440

先知社区 作者：熊猫正正

去年使用“银狐”黑客工具的黑产团伙非常活跃，今年这些黑产团伙仍然非常活跃，而且仍然在不断的更新自己的攻击样本，采用各种免杀方式，逃避安全厂商的检测，免杀对抗手法一直在升级，近期一些朋友通过微信发给笔者几个使用“银狐”黑客工具的黑产团伙的最攻击样本让笔者看看，笔者针对这些攻击样本的前期加载过程进行了详细分析，分享给大家。

样本分析

样本一

1.样本使用UPX加壳，样本编译时间在2024年2月，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkEbv37q0ciaf6bx2ibK2XjxDw0icb2KCxxnToeSeJE6mXXmcfBEqTSE2dQ/640?wx_fmt=png)

2.脱壳之后，从黑客服务器上下载恶意文件到指定目录，然后执行，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkbRLDQHQsbicX8LV4wyHEUSKhnPy2z6kvkCIuFGVPEibDybSO29DRDB0g/640?wx_fmt=png)

3.查看黑客服务器上的文件，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkRd3tJuAuJH8290HEdaicSkz8Btcicj7mqiaDlkaC6jQ6ft212pnXzVs0w/640?wx_fmt=png)

4.下载的恶意样本也采用UPX加壳，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkhZ9SIWZFv0BS7029Msu8U5sk4QrwgzwNNEJtWz253q2JPO4OpT8lOA/640?wx_fmt=png)

5.调用VirtualAlloc分配相应的内存空间，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibk3Y2pnuRmZ1ib0s9fUJ81iahGFvyrngObfWNx0PeCh1iapoNEVicGNBJJRQ/640?wx_fmt=png)

6.在内存中解密出恶意模块，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkd0a14G46SLzs4j6tuicibu0ibEPLu5m2gHYKfljwaL2ucqEIJqbqAYKIg/640?wx_fmt=png)

7.解密出来的恶意模块导出函数，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibk7JSMFHRy5IWSrwxFEhBPOx0INCLyh4vJib8H4n010PDgngULZkIEQzw/640?wx_fmt=png)

8.通过分析解密出来的恶意模块为Gh0st修改版，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkyQn9e3g7Q15ErNbt6ljKJnW2xlTJlxGunh0uBJtbIL2nehoib4Ria9hA/640?wx_fmt=png)

样本二

1.样本解压之后，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkSicGYWujz54ecfcbGv6BeoHdiahO2GPZvOLkpshWjFhfZj0X7CI7ERsw/640?wx_fmt=png)

2.样本的编译时间为2024年4月，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkhKNWxz9bGhzu9ibEN1Ig4ytINz63U3wiar8xfJpQGM9257newq7TclkQ/640?wx_fmt=png)

3.YourPhone.exe会判断同目录下是否存在mainframe.dll模块，如果存在，则加载同目录下的mainframe.dll模块，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkxibSZL2655BSVpib6iawQAyvs5A6ibDXMzib6Ttt32J2dXEUicHS0wmzAHEA/640?wx_fmt=png)

4.mainframe.dll模块读取同目录下的hpock.png文件内容到内存，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkryUdeUiadYIQGLaNz7yP7iafNGsTYNBteTWUKglBhn4fnuJ8icJbk4c4w/640?wx_fmt=png)

5.在内存中解密hpock.png文件内容，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkOiaTmzY9ia0RroaIzgwlib8dxXibvlE9STRwRASsgzJ5pnXy1ldbt8kmiaw/640?wx_fmt=png)

6.解密之后的shellcode代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibk4N8GHkll7dfqF8gn6lvanW9EA6Ynx1CyJic0SqWRltjEIF1Je1Byfbg/640?wx_fmt=png)

7.跳转执行解密出来的shellcode代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkUc8EVvib7JO4debZvFKE96kUdtOlcbNLTdzypgfXb3FmV0uliaGLM0jA/640?wx_fmt=png)

8.shellcode代码解压缩包含的payload代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibk6ojuPePrMuQazhWHjqbrcAaTxiczCJ2lYj5B6fgvywMialErzdicnxeFw/640?wx_fmt=png)

9.解压缩后的payload，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkGa8advGN0w2t928T6M4V5ibGdXAicmnETibuk7Sl3UcuDKAnSp8vXcDfQ/640?wx_fmt=png)

10.payload导出函数，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkiadgwG5M21TMwc8sAy5QpIW4LjmZ6O1ia2IyJOmQQqWDznm5XQDLaODg/640?wx_fmt=png)

样本三

1.样本采用AutoIt打包生成，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkDichO8icC9LHAR5ucju6ibQ3SdmqicibRbeiaIPhXxTP5dBueBgVYcVeHxfg/640?wx_fmt=png)

2.从程序中解析出来的AutoIt脚本，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibktOZuKYlDN2JJJibun7tABzuDjHVLapeXNF2rVms3yHiaicugPn3XibM30A/640?wx_fmt=png)

3.在指定目录下生成一个白程序和一个恶意模块，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkYAbrLNVpGj825vC13F5W9Iv5oF8ASQFtpAvPoFQw56jTMyrOeUxJaQ/640?wx_fmt=png)

4.采用白+黑的攻击技术，启动webprocess.exe程序加载恶意模块libcef.dll，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkicdofAcLG5Ic4DelhQ6vFDS5XHC9ey3gz2zVJqficZPiaaP7dbic00Wo2w/640?wx_fmt=png)

5.样本的编译时间为2024年4月，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkDxfsFQhLEYdqicPPiaiaFJXM7ZqnML0psBicBVg335QhE6pjDxJ3zgITnQ/640?wx_fmt=png)

6.解密程序中硬编码数据，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibk8CHADSluQ34iacKdkG6DVN1ibQNsekTq0XVjNIpiab19UoFHY4p6bMPIw/640?wx_fmt=png)

7.解密过程，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkBAVEicmWxUcuXaQvCaI4sMbNMTvRNnV3xnvEVP3icQNViczNwky2huvGA/640?wx_fmt=png)

8.解密之后的payload，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkQPLaWfzk9O2gUSxE41z6fNjYghXyiamVyRzf3eUu5yR3Z5tTMibMibZCA/640?wx_fmt=png)

9.分配内存空间，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkVPX18H6KWFX9SxiaYubL8oAOtib1YoNsDVjwA9UF4IA8EnuvH1icqEmtw/640?wx_fmt=png)

10.将解密的payload拷贝到该内存空间当中，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkkvT8HYjEQKoPV2P2pyr4EIJANyQSuWC5Od54COLJLv8lz8sSACPeXA/640?wx_fmt=png)

11.跳转执行payload模块的入口代码，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkaiaSOticgQR1ECZX4ye62u4ZNl141hcnwShlymUMpJzp2a6TIzVgYt1w/640?wx_fmt=png)

12.执行payload模块导出函数JeffcEn，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkZh3SQl6H5N0P27qrHr0WYcMCkib9g7fNvyfYbLuy5EDaJHjrvez3fibQ/640?wx_fmt=png)

13.远程c2服务器IP为156.237.223.130，如下所示：

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkYQZqCszknx4sfAjOazoXW5sYekS2H6OB1SBMLOuAMvFKLM6ic6p7FicQ/640?wx_fmt=png)

到此三个样本的加载过程基本就分析完毕了，最后加载生成的核心payload与此前的变种基本一致，有兴趣的朋友可以参考之前的分析报告，自己去分析研究一下。

威胁情报

![](https://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibkQvqKJO9y0vgRSPlHUh2g0Fibr0PHLxo41fwxaCibo3icYf63nqPYTGApg/640?wx_fmt=png)

总结结尾

正所谓野火烧不尽，春风吹又生，有人的地方就有江湖，有江湖的地方，只要有利益的存在，就会有对抗与斗争，也就会存在黑与白，有攻必有防，有矛必有盾，黑产组织今年似乎比去年更加活跃，更新频率也更快了，安全对抗会一直持续存在，并不断升级，有攻必有防，攻与防就类似于矛与盾的关系，安全研究人员需要持续不断的提升自己的安全能力。

安全分析与研究，专注于全球恶意软件的分析与研究，深度追踪全球黑客组织攻击活动，欢迎大家关注，获取全球最新的黑客组织攻击事件威胁情报。

![](https://mmbiz.qpic.cn/mmbiz_jpg/oibWJqH5OVmXqn09tuVnIKmG2h1IZy4ibk6hVMvHYezFhWYC5MibyuYZbfsxClqTzfrPCSWbfLeOYdNNpDI1tzOXw/640?wx_fmt=jpeg)

王正

笔名：熊猫正正

恶意软件研究员

长期专注于全球恶意软件的分析与研究，深度追踪全球黑客组织的攻击活动，擅长各种恶意软件逆向分析技术，具有丰富的样本分析实战经验，对勒索病毒、挖矿病毒、窃密、远控木马、银行木马、僵尸网络、高端APT样本都有深入的分析与研究

预览时标签不可点

阅读原文

![]()

微信扫一扫
关注该公众号

继续滑动看下一个

轻触阅读原文

![](http://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmVcFgYKtoVnKR7h3pkl3AyxwS0l7iagicAJnYjEQhwIuZgR3RR65DLpJh2TGZS82DY7CjsBUmiaAl7BQ/0?wx_fmt=png)

安全分析与研究

向上滑动看下一个

知道了

![]()
微信扫一扫
使用小程序

取消
允许

取消
允许

取消
允许

×
分析

![跳转二维码]()

![作者头像](http://mmbiz.qpic.cn/mmbiz_png/oibWJqH5OVmVcFgYKtoVnKR7h3pkl3AyxwS0l7iagicAJnYjEQhwIuZgR3RR65DLpJh2TGZS82DY7CjsBUmiaAl7BQ/0?wx_fmt=png)

微信扫一扫可打开此内容，
使用完整服务

：
，
，
，
，
，
，
，
，
，
，
，
，
。

视频
小程序
赞
，轻点两下取消赞
在看
，轻点两下取消在看
分享
留言
收藏
听过